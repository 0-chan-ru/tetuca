{"version":3,"sources":["options/view.js"],"names":[],"mappings":"uPAAQ,mDACD,mDACA,2DACC,4BAAM,iDACP,2CACC,wDAKO,MAAM,YAAN,SAA2B,WAA3B,CAId,aAAc,CACb,MAAM,CAAC,GAAI,eAAJ,CAAP,EADa,IAEb,CAAK,OAAL,CAAa,CACZ,YAAa,WAAb,CACA,UAAW,eAAX,CACA,UAAW,eAAX,CACA,UAAW,aAAX,CAJD,EAFa,IAQb,CAAK,KAAL,CAAW,QAAX,CAAqB,aAArB,EARa,CAAd,MAcA,EAAS,CACR,KAAK,EAAL,CAAQ,SAAR,CAAoB,gBAApB,CADQ,IAER,CAAK,YAAL,GAFQ,IAGR,CAAK,MAAL,CAAc,KAAK,EAAL,CAAQ,KAAR,CAAc,SAAd,CAAd,CAHQ,CAAT,YAaA,EAAe,CACd,IAAK,IAAI,EAAJ,IAAU,YAAf,CAA6B,CAC5B,MAAM,MAAQ,aAAa,EAAb,CAAR,CACL,GAAK,KAAK,EAAL,CAAQ,KAAR,CAAc,IAAM,EAAN,CAAnB,CAF2B,MAGrB,KAAQ,MAAR,IAAD,CAHsB,MAI3B,IAAM,MAAM,GAAN,EAAN,CAJ2B,GAKxB,OAAS,UAAT,CAAqB,CACxB,GAAG,OAAH,CAAa,GAAb,CADwB,CAAzB,KAEO,GAAI,OAAS,QAAT,EAAqB,gBAAgB,KAAhB,CAAuB,CACtD,GAAG,KAAH,CAAW,GAAX,CADsD,CAAhD,KAEA,GAAI,OAAS,UAAT,CAAqB,CAC/B,GAAG,KAAH,CAAW,OAAO,YAAP,CAAoB,GAApB,EAAyB,WAAzB,EAAX,CAD+B,CAAzB,CATR,CADD,SAsBA,CAAU,KAAV,CAAiB,CAChB,MAAM,cAAN,GADgB,MAEV,GAAK,MAAM,MAAN,CAFK,IAKhB,CAAK,KAAK,EAAL,CAAQ,QAAR,CAAkB,MACtB,GAAG,KAAH,CAAS,UAAT,EAAqB,SAArB,CAA+B,MAA/B,CAAsC,SAAtC,CADsB,CAAvB,CALgB,EAShB,CAAG,SAAH,CAAa,GAAb,CAAiB,SAAjB,EATgB,IAUhB,CAAK,KAAK,EAAL,CAAQ,SAAR,CAAkB,QAAlB,CAA4B,MAChC,GAAG,SAAH,CAAa,QAAb,CAAsB,GAAG,YAAH,CAAgB,cAAhB,CAAtB,CADgC,CAAjC,CAGE,SAHF,CAGY,GAHZ,CAGgB,SAHhB,EAVgB,CAAjB,WAqBA,CAAY,KAAZ,CAAmB,CAClB,MAAM,GAAK,MAAM,MAAN,CACV,GAAK,GAAG,YAAH,CAAgB,IAAhB,CAAL,CACA,MAAQ,aAAa,EAAb,CAAR,CAHiB,IAId,GAAJ,CAJkB,OAKV,MAAM,IAAN,EACP,KAAK,UAAL,CACC,IAAM,GAAG,OAAH,CADP,MADD,KAIM,QAAL,CACC,IAAM,SAAS,GAAG,KAAH,CAAf,CADD,MAJD,KAeM,UAAL,CACC,IAAM,GAAG,KAAH,CAAS,WAAT,GAAuB,UAAvB,CAAkC,CAAlC,CAAN,CADD,MAfD,QAmBE,IAAM,GAAG,KAAH,CADP,CAvBiB,GA2Bd,CAAC,MAAM,QAAN,CAAe,GAAf,CAAD,CAAsB,CACzB,GAAG,KAAH,CAAW,EAAX,CADyB,CAA1B,KAEO,CACN,QAAQ,GAAR,CAAY,EAAZ,CAAgB,GAAhB,EADM,CAFP,CA3BD,aAqCA,EAAgB,CACf,MAAM,EAAI,SAAS,cAAT,CAAwB,QAAxB,CAAJ,CADS,CAEf,CAAE,YAAF,CAAe,MAAf,CAAuB,OAAO,GAAP,CACrB,eADqB,CACL,IAAI,IAAJ,CAAS,CAAC,KAAK,SAAL,CAAe,YAAf,CAAD,CAAT,CAAyC,CACzD,KAAM,cAAN,CADgB,CADK,CAAvB,EAFe,CAOf,CAAE,YAAF,CAAe,UAAf,CAA2B,oBAA3B,EAPe,CAAhB,aAcA,CAAc,KAAd,CAAqB,CAEpB,MAAM,cAAN,GAFoB,MAGd,GAAK,SAAS,KAAT,CAAe,iBAAf,CAAL,CAHc,EAIpB,CAAG,KAAH,GAJoB,IAKpB,CAAK,IAAL,CAAU,EAAV,CAAc,QAAd,CAAwB,MAAM,CAC7B,IAAI,OAAS,IAAI,UAAJ,EAAT,CADyB,MAE7B,CAAO,UAAP,CAAkB,MAAM,KAAN,CAAY,CAAZ,CAAlB,EAF6B,MAG7B,CAAO,MAAP,CAAgB,SAAS,CAExB,IAAI,IAAJ,CAFwB,GAGpB,CACH,KAAO,KAAK,KAAL,CAAW,MAAM,MAAN,CAAa,MAAb,CAAlB,CADG,CAAJ,MAGM,GAAN,CAAW,CACV,MAAM,cAAc,OAAd,CAAN,CADU,QAAX,YAIA,CAAa,KAAb,GAVwB,IAWnB,IAAI,GAAJ,IAAW,IAAhB,CAAsB,CACrB,aAAa,GAAb,EAAoB,KAAK,GAAL,CAApB,CADqB,CAAtB,KAGA,CAAM,cAAc,OAAd,CAAN,CAdwB,QAexB,CAAS,MAAT,GAfwB,CAAT,CAHa,CAAN,CAAxB,CALoB,CAArB,YAgCA,CAAa,KAAb,CAAoB,CACnB,MAAM,GAAK,KAAK,MAAL,CADQ,EAEnB,CAAG,WAAH,CAAiB,GAAG,WAAH,CAAe,OAAf,CAAuB,MAAvB,CAA+B,KAA/B,CAAjB,CAFmB,CAApB,WAQA,EAAc,CACb,KAAK,OAAL,CAAa,YAAb,EADa,IAEb,CAAK,YAAL,CAAkB,CAAlB,EAFa,CAAd,CArKc,kBAAM,cA4KrB,CAAC,UAAW,CACX,GAAI,aAAa,WAAb,CAA0B,CAC7B,OAD6B,CAA9B,MAGM,GAAK,SAAS,KAAT,CAAe,UAAf,CAAL,CAJK,EAKX,CAAG,KAAH,CAAS,OAAT,CAAmB,CAAnB,CALW,IAMP,IAAM,IAAN,CACH,OADD,CANW,EAQX,CAAG,gBAAH,CAAoB,OAApB,CAA6B,MAAM,CAClC,QAAU,IAAV,CADkC,YAElC,CAAa,WAAb,CAA2B,CAA3B,CAFkC,CAAN,CAA7B,CARW,IAYX,GAZW,SAcF,IAAT,EAAgB,CAEf,GAAI,OAAJ,CAAa,CACZ,GAAG,KAAH,CAAS,OAAT,CAAmB,CAAnB,CADY,QAAb,EAKA,CAAG,KAAH,CAAS,OAAT,CAAmB,CAAC,GAAG,KAAH,CAAS,OAAT,EAAoB,IAAM,CAAC,IAAD,CAAQ,IAAd,CAArB,CAPJ,MAQT,IAAM,CAAC,GAAG,KAAH,CAAS,OAAT,CARE,GAWX,GAAC,EAAO,KAAO,CAAP,EAAc,CAAC,GAAD,EAAQ,KAAO,CAAP,CAAW,CAC5C,IAAM,CAAC,GAAD,CADsC,CAA7C,qBAGA,CAAsB,IAAtB,EAde,CAAhB,CAdA,CAAD","file":"options/view.js","sourcesContent":["import {BannerModal} from '../modal'\nimport renderContents from './render'\nimport optionModels from './models'\nimport {each, find} from '../../vendor/underscore'\nimport options from '../options'\nimport {importConfigs} from 'lang'\n\n/**\n * View of the options panel\n */\nexport default class OptionsPanel extends BannerModal {\n\t/**\n\t * Construct new OptionsPanel\n\t */\n\tconstructor() {\n\t\tsuper({id: 'options-panel'})\n\t\tthis.onClick({\n\t\t\t'.tab_link': 'switchTab',\n\t\t\t'#export': 'exportConfigs',\n\t\t\t'#import': 'importConfigs',\n\t\t\t'#hidden': 'clearHidden'\n\t\t})\n\t\tthis.onAll('change', 'applyChange')\n\t}\n\n\t/**\n\t * Render the contents of the options panel and insert it into the DOM\n\t */\n\trender() {\n\t\tthis.el.innerHTML = renderContents()\n\t\tthis.assignValues()\n\t\tthis.hidden = this.el.query('#hidden')\n\n\t\t// TODO: Hidden posts count rendering\n\t\t// events.reply('hide:render', this.renderHidden, this)\n\t}\n\n\t/**\n\t * Assign loaded option settings to the respective elements in the options\n\t * panel\n\t */\n\tassignValues() {\n\t\tfor (let id in optionModels) {\n\t\t\tconst model = optionModels[id],\n\t\t\t\tel = this.el.query('#' + id)\n\t\t\tconst {type} = model,\n\t\t\t\tval = model.get()\n\t\t\tif (type === 'checkbox') {\n\t\t\t\tel.checked = val\n\t\t\t} else if (type === 'number' || type instanceof Array) {\n\t\t\t\tel.value = val\n\t\t\t} else if (type === 'shortcut') {\n\t\t\t\tel.value = String.fromCharCode(val).toUpperCase()\n\t\t\t}\n\n\t\t\t// 'image' type simply falls through, as those don't need to be set\n\t\t}\n\t}\n\n\t/**\n\t * Switch to a tab, when clicking the tab butt\n\t * @param {Event} event\n\t */\n\tswitchTab(event) {\n\t\tevent.preventDefault()\n\t\tconst el = event.target\n\n\t\t// Deselect previous tab\n\t\teach(this.el.children, el =>\n\t\t\tel.query('.tab_sel').classList.remove('tab_sel'))\n\n\t\t// Select the new one\n\t\tel.classList.add('tab_sel')\n\t\tfind(this.el.lastChild.children, li =>\n\t\t\tli.classList.contains(el.getAttribute('data-content'))\n\t\t)\n\t\t\t.classList.add('tab_sel')\n\t}\n\n\t/**\n\t * Propagate options panel changes through\n\t * options -> optionModels -> localStorage\n\t * @param {Event} event\n\t */\n\tapplyChange(event) {\n\t\tconst el = event.target,\n\t\t\tid = el.getAttribute('id'),\n\t\t\tmodel = optionModels[id]\n\t\tlet val\n\t\tswitch (model.type) {\n\t\t\tcase 'checkbox':\n\t\t\t\tval = el.checked\n\t\t\t\tbreak\n\t\t\tcase 'number':\n\t\t\t\tval = parseInt(el.value)\n\t\t\t\tbreak\n\n\t\t\t/*\n\t\t\tTODO: System.import().then()\n\t\t\tcase 'image':\n\t\t\t\t// Not recorded. Extracted directly by the background handler.\n\t\t\t\treturn events.request('background:store', event.target)\n\t\t\t*/\n\n\t\t\tcase 'shortcut':\n\t\t\t\tval = el.value.toUpperCase().charCodeAt(0)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tval = el.value\n\t\t}\n\n\t\tif (!model.validate(val)) {\n\t\t\tel.value = ''\n\t\t} else {\n\t\t\toptions.set(id, val)\n\t\t}\n\t}\n\n\t/**\n\t * Dump options to JSON file and upload to user\n\t */\n\texportConfigs() {\n\t\tconst a = document.getElementById('export')\n\t\ta.setAttribute('href', window.URL\n\t\t\t.createObjectURL(new Blob([JSON.stringify(localStorage)], {\n\t\t\t\ttype: 'octet/stream'\n\t\t\t}))\n\t\t)\n\t\ta.setAttribute('download', 'meguca-config.json')\n\t}\n\n\t/**\n\t * Import options from uploaded JSON file\n\t * @param {Event} event\n\t */\n\timportConfigs(event) {\n\t\t// Proxy to hidden file input\n\t\tevent.preventDefault()\n\t\tconst el = document.query('#importSettings')\n\t\tel.click()\n\t\tutil.once(el, 'change', () => {\n\t\t\tvar reader = new FileReader()\n\t\t\treader.readAsText(input.files[0])\n\t\t\treader.onload = event => {\n\t\t\t\t// In case of curruption\n\t\t\t\tlet json\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse(event.target.result)\n\t\t\t\t}\n\t\t\t\tcatch(err) {\n\t\t\t\t\talert(importConfigs.corrupt)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlocalStorage.clear()\n\t\t\t\tfor (let key in json) {\n\t\t\t\t\tlocalStorage[key] = json[key]\n\t\t\t\t}\n\t\t\t\talert(importConfigs.corrupt)\n\t\t\t\tlocation.reload()\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Render Hiden posts counter\n\t * @param {int} count\n\t */\n\trenderHidden(count) {\n\t\tconst el = this.hidden\n\t\tel.textContent = el.textContent.replace(/\\d+$/, count)\n\t}\n\n\t/**\n\t * Clear displayed hidden post counter\n\t */\n\tclearHidden() {\n\t\tmain.request('hide:clear')\n\t\tthis.renderHidden(0)\n\t}\n}\n\n// Highlight options button by fading out and in, if no options are set\n(function() {\n\tif (localStorage.optionsSeen) {\n\t\treturn\n\t}\n\tconst el = document.query('#options')\n\tel.style.opacity = 1\n\tlet out = true,\n\t\tclicked\n\tel.addEventListener(\"click\", () => {\n\t\tclicked = true\n\t\tlocalStorage.optionsSeen = 1\n\t})\n\ttick()\n\n\tfunction tick() {\n\t\t// Stop\n\t\tif (clicked) {\n\t\t\tel.style.opacity = 1\n\t\t\treturn\n\t\t}\n\n\t\tel.style.opacity = +el.style.opacity + (out ? -0.02 : 0.02)\n\t\tconst now = +el.style.opacity\n\n\t\t// Reverse direction\n\t\tif ((out && now <= 0) || (!out && now >= 1)) {\n\t\t\tout = !out\n\t\t}\n\t\trequestAnimationFrame(tick)\n\t}\n})()\n"],"sourceRoot":"/source/"}