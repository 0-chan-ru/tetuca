{"version":3,"sources":["posts/render/header.js"],"names":[],"mappings":"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","file":"posts/render/header.js","sourcesContent":["import {escape} from 'underscore'\nimport {parseHTML, parseAttributes, pad} from '../../util'\nimport lang from 'lang'\nimport {config} from '../../state'\nimport options from '../../options'\n\n// Render the header with various post information\nexport function renderHeader(data) {\n\tconst {num, op, subject} = data,\n\t\tpostURL = renderPostURL(num)\n\treturn parseHTML\n\t\t`<header>\n\t\t\t<input type=\"checkbox\" class=\"postCheckbox\">\n\t\t\t${subject ? `<h3>「${escape(data.subject)}」</h3>` : ''}\n\t\t\t${renderName(data)}\n\t\t\t${renderTime(data.time)}\n\t\t\t<nav>\n\t\t\t\t<a href=\"${postURL}\" class=\"history\">\n\t\t\t\t\tNo.\n\t\t\t\t</a>\n\t\t\t\t<a href=\"${postURL}\" class=\"quote\">\n\t\t\t\t\t${num}\n\t\t\t\t</a>\n\t\t\t</nav>\n\t\t</header>\n\t\t<span class=\"oi control\" data-glyph=\"chevron-bottom\"></span>`\n}\n\n// Render the name of a post's poster\nexport function renderName(data) {\n\tlet html = '<b class=\"name'\n\tconst {auth, email} = data\n\tif (auth) {\n\t\thtml += ` ${auth === 'admin' ? 'admin' : 'moderator'}`\n\t}\n\thtml += '\">'\n\tif (email) {\n\t\tconst attrs = {\n\t\t\tclass: 'email',\n\t\t\thref: 'mailto:' + encodeURI(email),\n\t\t\ttarget: 'blank'\n\t\t}\n\t\thtml += `<a ${parseAttributes(attrs)}>`\n\t}\n\thtml += resolveName(data)\n\tif (email) {\n\t\thtml += '</a>'\n\t}\n\thtml += '</b>'\n\tif (data.mnemonic) {\n\t\thtml += ' ' + renderMnemonic(data.mnemonic)\n\t}\n\treturn html\n}\n\n// Determine the name and tripcode combination to render\nfunction resolveName(data) {\n\tlet html = ''\n\tconst {trip, name, auth} = data\n\tif (name || !trip) {\n\t\tif (name) {\n\t\t\thtml += escape(name)\n\t\t} else {\n\t\t\thtml += lang.anon\n\t\t}\n\t\tif (trip) {\n\t\t\thtml += ' '\n\t\t}\n\t}\n\tif (trip) {\n\t\thtml += `<code>${escape(trip)}</code>`\n\t}\n\tif (auth) { // Render staff title\n\t\tlet alias\n\t\tif (auth in config.staff.classes) {\n\t\t\talias = config.staff.classes[auth].alias\n\t\t} else {\n\t\t\talias = auth\n\t\t}\n\t\thtml += ` ## ${alias}`\n\t}\n\treturn html\n}\n\n// Renders a poster identification mnemonic\nexport function renderMnemonic(mnemonic) {\n\treturn `<b class=\"mod addr\">${mnem}</b>`\n}\n\n// Renders a time element. Can be either absolute or relative.\nexport function renderTime(time) {\n\t// Format according to client's relative post timestamp setting\n\tlet title, text\n\tconst readable = readableTime(time)\n\tif (options.get('relativeTime')) {\n\t\ttitle = readable\n\t\ttext = relativeTime(time, Date.now())\n\t}\n\treturn parseHTML\n\t\t`<time title=\"${title}\">\n\t\t\t${text || readable}\n\t\t</time>`\n}\n\n// Renders classic absolute timestamp\nfunction readableTime(time) {\n\tlet d = new Date(time)\n\treturn pad(d.getDate()) + ' '\n\t\t+ lang.time.year[d.getMonth()] + ' '\n\t\t+ d.getFullYear()\n\t\t+ `(${lang.time.week[d.getDay()]})`\n\t\t+`${pad(d.getHours())}:${pad(d.getMinutes())}`\n}\n\n// Renders readable elapsed time since post\nfunction relativeTime(then, now) {\n\tlet time = Math.floor((now - then) / 60000),\n\t\tisFuture = false\n\tif (time < 1) {\n\t\tif (time > -5) { // Assume to be client clock imprecission\n\t\t\treturn lang.time.just_now\n\t\t}\n\t\telse {\n\t\t\tisFuture = true\n\t\t\ttime = -time\n\t\t}\n\t}\n\n\tconst divide = [60, 24, 30, 12],\n\t\tunit = ['minute', 'hour', 'day', 'month']\n\tfor (let i = 0; i < divide.length; i++) {\n\t\tif (time < divide[i]) {\n\t\t\treturn lang.ago(time, lang.time[unit[i]], isFuture)\n\t\t}\n\t\ttime = Math.floor(time / divide[i])\n\t}\n\n\treturn lang.ago(time, lang.time.year, isFuture)\n}\n\n// Render an anchor that points to the target post number\nexport function renderPostURL(num) {\n\treturn `#p${num}`\n}\n"],"sourceRoot":"/source/"}