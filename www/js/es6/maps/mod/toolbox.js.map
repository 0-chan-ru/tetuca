{"version":3,"sources":["mod/toolbox.js"],"names":[],"mappings":"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","file":"mod/toolbox.js","sourcesContent":["/*\nView containing controls of moderation actions\n */\n\nconst main = require('main'),\n\tinput = require('./input'),\n\tpanels = require('./panels'),\n\tutil = require('./util'),\n\t{$, _, Backbone, common, lang, modals} = main,\n\t{parseHTML} = common;\n\nconst childViews = {\n\tban: input.ban,\n\tlog: require('./panels').log,\n\tadminPanel: panels.adminPanel,\n\tnotification: input.notification,\n\tdjPanel: panels.djPanel\n};\n\nconst ToolboxView = Backbone.View.extend({\n\tid: 'toolbox',\n\tclassName: 'mod modal panel glass',\n\tinitialize() {\n\t\tthis.render();\n\t},\n\trender() {\n\t\tlet specs = this.specs = [\n\t\t\t'clearSelection',\n\t\t\t'spoilerImages',\n\t\t\t'deleteImages',\n\t\t\t'deletePosts',\n\t\t\t'modLog'\n\t\t];\n\n\t\t// Add aditional panel buttons by priveledge level\n\t\tif (main.ident.auth === 'dj')\n\t\t\tspecs = this.specs = ['djPanel']\n\t\tconst accessLevels = [\n\t\t\t['dj', ['toggleMnemonics']],\n\t\t\t['moderator', ['lockThreads', 'ban']],\n\t\t\t['admin', ['sendNotification', 'renderPanel']]\n\t\t]\n\t\tfor (let level of accessLevels) {\n\t\t\tif (!common.checkAuth(level[0], main.ident))\n\t\t\t\tbreak\n\t\t\tlevel[1].forEach(right => specs.push(right))\n\t\t}\n\n\t\tlet controls = '<span>';\n\t\tfor (let i = 0; i < specs.length; i++) {\n\t\t\tconst ln = lang.mod[specs[i]];\n\t\t\tcontrols += parseHTML\n\t\t\t\t`<a class=\"modButton\" data-kind=\"${i}\" title=\"${ln[1]}\">\n\t\t\t\t\t${ln[0]}\n\t\t\t\t</a>`;\n\t\t}\n\t\tcontrols += '</span>';\n\t\tthis.$controls = $(controls);\n\n\t\tthis.$checkboxToggle = $(parseHTML\n\t\t\t\t`<style>\n\t\t\t\t.postCheckbox {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t</style>`\n\t\t)\n\t\t\t.appendTo('head')\n\t\t\t// Disabled only works if the emelemnt is in the DOM\n\t\t\t.prop('disabled', true);\n\n\t\tthis.$toggle = $(`<a id=\"toolboxToggle\">${lang.show}</a>`);\n\t\tthis.$el.prepend(this.$controls, this.$toggle)\n\t\t\t.appendTo(main.$overlay);\n\n\t\t// Sets mnemonic visbility\n\t\tthis.$mnemonicStyle = $(parseHTML\n\t\t\t\t`<style>\n\t\t\t\theader > .mod.addr {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t</style>`\n\t\t)\n\t\t\t.appendTo('head')\n\t\t\t.prop('disabled', localStorage.noMnemonics !== 'true');\n\t\treturn this;\n\t},\n\tevents: {\n\t\t'click #toolboxToggle': 'toggleButtons',\n\t\t'click .modButton': 'buttonHandler'\n\t},\n\ttoggleButtons() {\n\t\tconst hidden = !this.model.get('shown');\n\t\tthis.$toggle.text(lang[hidden ? 'hide' : 'show']);\n\t\tthis.$controls.toggle(0);\n\t\tthis.$checkboxToggle.prop('disabled', !hidden);\n\t\tthis.model.set('shown', hidden);\n\t},\n\tbuttonHandler(event) {\n\t\tthis[this.specs[event.target.getAttribute('data-kind')]](event);\n\t},\n\tclearSelection() {\n\t\tutil.loopCheckboxes(el => el.checked = false);\n\t},\n\ttoggleMnemonics() {\n\t\tconst hide = localStorage.noMnemonics === 'true';\n\t\tthis.$mnemonicStyle.prop('disabled', hide);\n\t\tlocalStorage.noMnemonics = !hide;\n\t},\n\tsend(type) {\n\t\tmain.send([common[type], ...util.getSelected()]);\n\t},\n\tspoilerImages() {\n\t\tthis.send('SPOILER_IMAGES');\n\t},\n\tdeleteImages() {\n\t\tthis.send('DELETE_IMAGES');\n\t},\n\ttoggleChild(type) {\n\t\tif(modals[type])\n\t\t\tmodals[type].kill();\n\t\telse\n\t\t\tnew childViews[type];\n\t},\n\t// Push a notification message to all clients\n\tsendNotification() {\n\t\tthis.toggleChild('notification');\n\t},\n\tmodLog() {\n\t\tthis.toggleChild('log');\n\t},\n\tdjPanel() {\n\t    this.toggleChild('djPanel')\n\t},\n\tban() {\n\t\tthis.toggleChild('ban');\n\t},\n\trenderPanel() {\n\t\tthis.toggleChild('adminPanel');\n\t},\n\tdeletePosts() {\n\t\tthis.send('DELETE_POSTS');\n\t},\n\tlockThreads() {\n\t\tfor (let num of util.getSelected()) {\n\t\t\tconst model = main.state.posts.get(num);\n\t\t\t// Model exists and is an OP\n\t\t\tif (!model || model.get('op'))\n\t\t\t\tcontinue;\n\t\t\tmain.send([\n\t\t\t\tcommon[!model.get('locked') ? 'LOCK_THREAD' : 'UNLOCK_THREAD'],\n\t\t\t\tnum\n\t\t\t]);\n\t\t}\n\t}\n});\n\nmain.$toolbox = new ToolboxView({\n\tmodel: new Backbone.Model()\n});\n"],"sourceRoot":"/source/"}