{"version":3,"sources":["client/loop.js"],"names":[],"mappings":"iGAMM,WAAO,QAAQ,QAAR,CAAP,OACJ,KAAmC,KAAnC,WAAM,OAA6B,KAA7B,aAAQ,QAAqB,KAArB,QAAf,MAAwB,SAAY,KAAZ,QAAxB,OACC,MAAS,KAAK,KAAL,CAAT,MAEF,QAAQ,EAAR,CAAW,CACV,gBAAiB,cAAjB,CACA,kBAAmB,cAAnB,CACA,iBAAkB,aAAlB,CACA,mBAAoB,mBAApB,CACA,cAAe,cAAf,CALD,EAOA,SAAS,cAAT,EAA0B,CACzB,GAAG,KAAK,KAAL,CAAW,IAAX,CAAgB,GAAhB,CAAoB,SAApB,CAAH,CAAkC,CAEjC,MAAM,KAAO,OAAC,CAAQ,GAAR,CAAY,QAAZ,IAAwB,MAAxB,EAAkC,CAAC,KAAK,QAAL,CAAc,QAAd,CAAyB,EAA7D,CAAgE,MAAhE,CAFoB,QAGjC,CAAS,QAAT,CAAkB,WAAlB,EAA+B,OAA/B,CAAuC,MAAM,GAAG,KAAH,CAAS,OAAT,CAAiB,IAAjB,CAA7C,CAHiC,CAAlC,KAKC,OAAO,MAAM,UAAU,CAAC,KAAD,CAAQ,KAAR,KACtB,OAAS,MAAM,QAAN,CAAe,aAAf,CAA8B,KAA9B,CAAT,CADM,CAAP,CALD,CADD,SAUS,SAAT,CAAmB,IAAnB,CAAyB,CACxB,MAAM,IAAN,CAAW,SAAS,KAAK,MAAM,GAAN,CAAU,OAAV,CAAL,CAAyB,KAAzB,CAAT,CAAX,CADwB,CAAzB,SAIS,cAAT,EAA0B,CACzB,OAAO,MAAM,UAAU,CAAC,KAAD,CAAQ,KAAR,KACtB,OAAS,MAAM,OAAN,EAAiB,MAAM,QAAN,CAAe,aAAf,CAA8B,KAA9B,CAA1B,CADM,CAAP,CADyB,CAA1B,SAMS,aAAT,EAAyB,CACxB,OAAO,MAAM,UAAU,CAAC,KAAD,CAAQ,KAAR,KACtB,OAAS,MAAM,GAAN,GAAc,MAAd,EAAwB,MAAM,QAAN,CAAe,aAAf,CAA8B,KAA9B,CAAjC,CADM,CAAP,CADwB,CAAzB,SAKS,mBAAT,CAA6B,MAA7B,CAAqC,MAArC,CAA6C,CAC5C,OAAO,MAAM,CACZ,MAAM,QAAU,OAAS,WAAT,CAAuB,YAAvB,CADJ,KAEZ,CAAM,IAAN,CAAW,SAAS,KAAT,CAAgB,uBACL,MAAM,UAAN,CADK,MACnB,4BADmB,MACb,4BADa,GAEtB,MAAQ,IAAR,CACH,MAAM,QAAN,CAAe,OAAf,EADD,CAFU,CAAX,CAFY,CAAN,CAAP,CAD4C,CAA7C,IAUA,CAAK,KAAL,CAAW,gBAAX,CAA6B,MAC5B,QAAQ,GAAR,CAAY,WAAZ,GAA4B,oBAAoB,IAApB,CAA0B,IAA1B,CAA5B,CADD","file":"client/loop.js","sourcesContent":["/*\n It is not very efficient to spam liteners to the options object. This\n module loops through the post models and calls the appropriate methods in\n batch.\n */\n\nconst main = require('./main'),\n\t{util, follow, options, oneeSama} = main,\n\t{posts} = main.state;\n\noptions.on({\n\t'change:thumbs': reRenderImages,\n\t'change:spoilers': toggleSpoilers,\n\t'change:autogif': toggleAutoGIF,\n\t'change:anonymise': toggleAnonymisation,\n\t'workModeTOG': reRenderImages\n});\nfunction reRenderImages() {\n\tif(main.state.page.get('catalog')){\n\t\t//quick render, because we don't have models in the catalog\n\t\tconst show = (options.get(\"thumbs\")!=='hide' && !main.oneeSama.workMode)? '':'none';\n\t\tdocument.queryAll(\".expanded\").forEach(el => el.style.display=show);\n\t}else\n\t\tfollow(() => getImages((image, model) =>\n\t\t\timage && model.dispatch('renderImage', image)));\n}\n\nfunction getImages(func) {\n\tposts.each(model => func(model.get('image'), model));\n}\n\nfunction toggleSpoilers() {\n\tfollow(() => getImages((image, model) =>\n\t\timage && image.spoiler && model.dispatch('renderImage', image)));\n}\n\n// Toggle animated GIF thumbnails\nfunction toggleAutoGIF() {\n\tfollow(() => getImages((image, model) =>\n\t\timage && image.ext === '.gif' && model.dispatch('renderImage', image)));\n}\n\nfunction toggleAnonymisation(source, toggle) {\n\tfollow(() => {\n\t\tconst command = toggle ? 'anonymise' : 'renderName';\n\t\tposts.each(function(model) {\n\t\t\tconst {name, trip} = model.attributes;\n\t\t\tif (name || trip)\n\t\t\t\tmodel.dispatch(command);\n\t\t});\n\t});\n}\nmain.reply('loop:anonymise', () =>\n\toptions.get('anonymise') && toggleAnonymisation(null, true));\n"],"sourceRoot":"/source/"}