{"version":3,"sources":["client/banner.js"],"names":[],"mappings":"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","file":"client/banner.js","sourcesContent":["/*\n * Handles all things banner and notifications\n */\n\nconst main = require('./main'),\n\t{Backbone, common, dispatcher, etc, options} = main;\n\nconst modalMap = {\n\t'options': 'options-panel',\n\t'banner_identity': 'identity',\n\t'banner_FAQ': 'FAQ',\n\t'banner_schedule': 'schedule'\n};\n\nconst BannerView = Backbone.View.extend({\n\tinitialize() {\n\t\tthis.center = document.getElementById('banner_center');\n\t\tthis.info = document.getElementById('banner_info');\n\t\t// Publish a listener to the message bus\n\t\tmain.reply('banner:radio:clear', this.clearRadio, this);\n\t},\n\tevents: {\n\t\t'click .bfloat': 'revealBmodal'\n\t},\n\trenderInfo(msg) {\n\t\tthis.info.innerHTML = msg;\n\t},\n\t// Toggle the display of the modal windows under the banner\n\trevealBmodal(event) {\n\t\tconst bmodal = modalMap[event.target.closest('.bfloat')\n\t\t\t.getAttribute('id')];\n\t\tif (!bmodal)\n\t\t\treturn;\n\t\tconst el = document.getElementById(bmodal),\n\t\t\tisShown = el && getComputedStyle(el).display !== 'none';\n\t\tfor (let el of document.queryAll('.bmodal')) {\n\t\t\tel.style.display = 'none'\n\t\t}\n\n\t\t// We hid the currently displayed window. All is well\n\t\tif (isShown)\n\t\t\treturn;\n\n\t\t// Place 5 pixels bellow banner\n\t\tel.style.top = document.getElementById('banner').offsetHeight + 5\n\t\t\t+ 'px';\n\t\tel.style.display = 'block';\n\t},\n\t// r/a/dio stream info rendering\n\trenderRadio(data) {\n\t\tdata = JSON.parse(data);\n\t\tconst attrs = {\n\t\t\ttitle: main.lang.googleSong,\n\t\t\thref: `https://google.com/search?q=${encodeURIComponent(data.np)}`,\n\t\t\ttarget: '_blank'\n\t\t};\n\t\tthis.center.innerHTML = common.parseHTML\n\t\t\t`<a href=\"http://r-a-d.io/\" target=\"_blank\">\n\t\t\t\t[${data.listeners}] ${data.dj}\n\t\t\t</a>\n\t\t\t&nbsp;&nbsp;\n\t\t\t<a ${attrs}>\n\t\t\t\t<b>${data.np}</b>\n\t\t\t</a>`;\n\t},\n\tclearRadio() {\n\t\tthis.center.innerHTML = '';\n\t}\n});\n\nconst banner = exports.view = new BannerView({\n\tel: document.getElementById('banner')\n});\n\n// Notification messages bellow the banner\nconst NotificationView = exports.notification = Backbone.View.extend({\n\tinitialize(msg) {\n\t\tthis.render(msg);\n\t},\n\tevents: {\n\t\t'click': 'remove'\n\t},\n\trender(msg) {\n\t\tfor (let el of document.queryAll('.notification')) {\n\t\t\tel.remove();\n\t\t}\n\t\tconst attrs = {\n\t\t\tclass: 'notification modal',\n\t\t\tstyle: `top: ${banner.el.offsetHeight + 5}px;`\n\t\t};\n\t\tconst el = etc.parseDOM(common.parseHTML\n\t\t\t`<span ${attrs}>\n\t\t\t\t<b class=\"admin\">\n\t\t\t\t\t${msg}\n\t\t\t\t</b>\n\t\t\t</span>`);\n\t\tbanner.el.after(el);\n\t\tthis.setElement(el);\n\t\treturn this;\n\t}\n});\nmain.reply('notification', msg => new NotificationView(msg));\n\ndispatcher[common.NOTIFICATION] = msg => new NotificationView(msg[0]);\ndispatcher[common.UPDATE_BANNER] = msg => banner.renderInfo(msg[0]);\n// R/a/dio banner is disabled on mobile\ndispatcher[common.RADIO] = msg =>\n\toptions.get('nowPlaying') && !main.isMobile && banner.renderRadio(msg[0]);\n"],"sourceRoot":"/source/"}