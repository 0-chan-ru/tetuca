{"version":3,"sources":["client/posts/section.js"],"names":[],"mappings":"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","file":"client/posts/section.js","sourcesContent":["/*\n * OP and thread related logic\n */\n\nconst main = require('../main'),\n\tPostCommon = require('./common'),\n\t{$, _, Backbone, util, oneeSama, state} = main;\n\nmodule.exports = PostCommon.extend({\n\ttagName: 'section',\n\trender() {\n\t\tconst attrs = this.model.attributes;\n\t\tthis.setElement(oneeSama.section(attrs)).insertIntoDOM();\n\n\t\t// Insert reply box into the new thread\n\t\tconst reply = util.parseDOM(oneeSama.replyBox());\n\t\tif (attrs.num in state.ownPosts || !!main.request('postForm'))\n\t\t\treply.style.display = 'none';\n\t\tthis.el.append(reply);\n\n\t\t// Remove next <hr>\n\t\tthis.el.nextElementSibling.remove();\n\t\treturn this;\n\t},\n\tinsertIntoDOM() {\n\t\tmain.$threads[0].query('aside')\n\t\t\t.after(this.el, document.createElement('hr'));\n\t\tthis.fun();\n\t},\n\trenderLocked(locked) {\n\t\tthis.el.classList[locked ? 'add' : 'remove']('locked');\n\t},\n\tremove() {\n\t\t// Remove next <hr>\n\t\tthis.el.nextElementSibling.remove();\n\t\tthis.el.remove();\n\t\tthis.stopListening();\n\t\treturn this;\n\t},\n\t/*\n\t Remove the top reply on board pages, if over limit, when a new reply is\n\t added\n\t */\n\tshiftReplies(postForm) {\n\t\tconst attrs = this.model.attributes,\n\t\t\t{replies} = attrs;\n\t\tlet lim = state.hotConfig.get('ABBREVIATED_REPLIES'),\n\t\t\tchanged;\n\t\tif (postForm)\n\t\t\tlim--;\n\t\t// Need a static length, because the original array get's modified\n\t\tconst len = replies.slice().length;\n\t\tfor (let i = len; i > lim; i--) {\n\t\t\tconst post = state.posts.get(replies.shift());\n\t\t\tif (!post)\n\t\t\t\tcontinue;\n\t\t\tif (post.get('image'))\n\t\t\t\tattrs.image_omit++;\n\t\t\tattrs.omit++;\n\t\t\tchanged = true;\n\t\t\tpost.remove();\n\t\t}\n\t\tif (changed)\n\t\t\tthis.renderOmit(attrs.omit, attrs.image_omit)\n\t},\n\t// Posts and images omited indicator\n\trenderOmit(omit = this.model.get('omit'),\n\t\timage_omit = this.model.get('image_omit')\n\t) {\n\t\tif (omit === 0)\n\t\t\treturn;\n\t\tconst {thread, href} = state.page.attributes;\n\t\tthis.el.query('.omit').innerHTML = oneeSama.lang.abbrev_msg(omit,\n\t\t\tthis.model.get('image_omit'), thread && href.split('?')[0]);\n\t},\n\t// Move thread to the top of the page\n\tbumpThread() {\n\t\tthis.el.nextElementSibling.remove();\n\t\tthis.el.remove();\n\t\tthis.insertIntoDOM();\n\t}\n});\n"],"sourceRoot":"/source/"}