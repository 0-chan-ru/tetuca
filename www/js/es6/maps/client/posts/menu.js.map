{"version":3,"sources":["client/posts/menu.js"],"names":[],"mappings":"iGAIM,WAAO,QAAQ,SAAR,CAAP,OACJ,EAA6C,KAA7C,QAAG,EAA0C,KAA1C,QAAG,SAAuC,KAAvC,eAAU,OAA6B,KAA7B,aAAQ,KAAqB,KAArB,WAAM,KAAe,KAAf,WAAM,MAAS,KAAT,MAEtC,MAAM,SAAW,OAAO,OAAP,CAAiB,SAAS,IAAT,CAAc,MAAd,CAAqB,CACtD,UAAW,kBAAX,CACA,QAAS,IAAT,CAEA,QAAS,CAAC,QAAD,CAAW,MAAX,CAAT,CACA,OAAQ,CACP,MAAO,aAAP,CADD,CAGA,gBAAqB,KAAT,mBAAS,MACpB,CAAO,WAAP,CAAqB,IAArB,CADoB,IAEpB,CAAK,MAAL,CAAc,MAAd,CAFoB,IAGpB,CAAK,MAAL,GAHoB,CAArB,CAKA,QAAS,CACR,IAAI,KAAO,EAAP,CADI,IAEH,IAAI,MAAJ,IAAc,KAAK,OAAL,CAAc,CAChC,MAAQ,CAAC,eAAD,GAAkB,MAAlB,EAAyB,EAAzB,GAA6B,KAAK,MAAL,CAA7B,EAA0C,KAA1C,CAAR,CADgC,CAAjC,MAGO,GAAc,KAAd,GALC,MAKG,OAAU,KAAV,OALH,EAMR,CAAG,SAAH,CAAe,IAAf,CANQ,MAOR,CAAO,MAAP,CAAc,EAAd,EAPQ,EAWR,CAAG,KAAH,CAAS,IAAT,CAAgB,GAAG,qBAAH,GAA2B,IAA3B,CACb,CAAC,KAAK,UAAL,CAAgB,EAAhB,EAAsB,GAAG,WAAH,CAAvB,CAAyC,GAAzC,CACA,IAFa,CAXR,CAAT,CAgBA,YAAY,CAAZ,CAAe,CACd,EAAE,eAAF,GADc,IAEd,CAAK,OAAL,CAAa,EAAE,MAAF,CAAS,YAAT,CAAsB,WAAtB,CAAb,CAAiD,KAAK,KAAL,CAAjD,CAFc,IAGd,CAAK,MAAL,GAHc,CAAf,CAKA,QAAS,CACR,KAAK,MAAL,CAAY,WAAZ,CAA0B,IAA1B,CADQ,IAER,CAAK,EAAL,CAAQ,MAAR,GAFQ,IAGR,CAAK,aAAL,GAHQ,CAAT,CAlCiC,CAAjB,CAyCjB,KAAK,KAAL,CAAW,aAAX,CAA0B,UACzB,EAAE,MAAF,CAAS,SAAS,SAAT,CAAmB,OAAnB,CAA4B,MAArC,CADyB,CAA1B,CAGA,KAAK,QAAL,CAAc,EAAd,CAAiB,OAAjB,CAA0B,UAA1B,CAAsC,SAAS,OACvC,OAAU,MAAV,OADuC,GAI1C,OAAO,WAAP,CACH,OAAO,OAAO,WAAP,CAAmB,MAAnB,EAAP,CADD,MAGM,MAAQ,KAAK,QAAL,CAAc,MAAd,CAAR,CAPwC,GAQ1C,KAAJ,CACC,IAAI,QAAJ,CAAa,CAAC,OAAQ,MAAR,CAAgB,KAAjB,CAAb,EADD,CARqC,CAAtC","file":"client/posts/menu.js","sourcesContent":["/*\n Post action header dropdown menu\n */\n\nconst main = require('../main'),\n\t{$, _, Backbone, common, util, lang, state} = main;\n\nconst MenuView = module.exports = Backbone.View.extend({\n\tclassName: 'popup-menu glass',\n\ttagName: 'ul',\n\t// Post menu items\n\tactions: ['report', 'hide'],\n\tevents: {\n\t\tclick: 'handleClick'\n\t},\n\tinitialize({parent}) {\n\t\tparent._popup_menu = this;\n\t\tthis.parent = parent;\n\t\tthis.render();\n\t},\n\trender() {\n\t\tlet html = '';\n\t\tfor (let action of this.actions) {\n\t\t\thtml += `<li data-type=\"${action}\">${lang[action]}</li>`\n\t\t}\n\t\tconst {el, parent} = this;\n\t\tel.innerHTML = html;\n\t\tparent.append(el);\n\n\t\t// Calculate position. Can't use CSS translate, because it shifts\n\t\t// the background.\n\t\tel.style.left = el.getBoundingClientRect().left\n\t\t\t- (util.outerWidth(el) + el.offsetWidth) * 0.6\n\t\t\t+ 'px';\n\t},\n\t// Forward post model to appropriate handler\n\thandleClick(e) {\n\t\te.stopPropagation();\n\t\tmain.request(e.target.getAttribute('data-type'), this.model);\n\t\tthis.remove();\n\t},\n\tremove() {\n\t\tthis.parent._popup_menu = null;\n\t\tthis.el.remove();\n\t\tthis.stopListening();\n\t}\n});\n\nmain.reply('menu:extend', action =>\n\t_.extend(MenuView.prototype.actions, action));\n\nmain.$threads.on('click', '.control', event => {\n\tconst {target} = event;\n\n\t// Menu already exists on the element. Remove it instead.\n\tif (target._popup_menu)\n\t\treturn target._popup_menu.remove();\n\n\tconst model = util.getModel(target);\n\tif (model)\n\t\tnew MenuView({parent: target, model});\n});\n"],"sourceRoot":"/source/"}