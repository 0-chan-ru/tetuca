require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};})();var _templateObject=_taggedTemplateLiteral(['<form>\n\t\t\t\t','\n\t\t\t\t<input type="submit" value="','">\n\t\t\t</form>'],['<form>\n\t\t\t\t','\n\t\t\t\t<input type="submit" value="','">\n\t\t\t</form>']),_templateObject2=_taggedTemplateLiteral(['<input ','>'],['<input ','>']),_templateObject3=_taggedTemplateLiteral(['<label ','>\n\t\t\t\t<input type="checkbox">\n\t\t\t\t','\n\t\t\t</label>'],['<label ','>\n\t\t\t\t<input type="checkbox">\n\t\t\t\t','\n\t\t\t</label>']),_templateObject4=_taggedTemplateLiteral(['<b class="reasonPrompt admin">\n\t\t\t\t\t','\n\t\t\t\t</b>'],['<b class="reasonPrompt admin">\n\t\t\t\t\t','\n\t\t\t\t</b>']);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else {return Array.from(arr);}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var util=require('./util');var $=main.$;var Backbone=main.Backbone;var common=main.common;var lang=main.lang;var modals=main.modals;var parseHTML=common.parseHTML;var InputBoxView=Backbone.View.extend({className:'mod inputBox',events:{submit:'submit'},initialize:function initialize(){modals[this.type]=this;this.render();},render:function render(){var html=parseHTML(_templateObject,this.renderInput(),lang.send);this.$el.html(html).prependTo(main.$toolbox.$el).find('input').first().focus();},submit:function submit(event){event.preventDefault();var values=[];$(event.target).find('input[type!=submit]').each(function(){values.push(this.type==='checkbox'?this.checked:this.value);});this.handler(values);},kill:function kill(){delete modals[this.type];this.remove();}});var NotificationInputView=InputBoxView.extend({type:'notification',renderInput:function renderInput(){return parseHTML(_templateObject2,{type:'text',size:25,placeholder:lang.mod.placeholders.msg});},handler:function handler(msg){main.send([common.NOTIFICATION,msg[0]]);this.kill();}});exports.notification=NotificationInputView;var BanInputView=InputBoxView.extend({type:'ban',renderInput:function renderInput(){var html='';var _arr=['days','hours','minutes'];for(var _i=0;_i<_arr.length;_i++){var field=_arr[_i];html+=parseHTML(_templateObject2,{type:'number',placeholder:lang.mod.placeholders[field]});}html+=parseHTML(_templateObject2,{type:'text',size:25,placeholder:lang.mod.placeholders.reason});var _lang$mod$displayBan=_slicedToArray(lang.mod.displayBan,2);var label=_lang$mod$displayBan[0];var title=_lang$mod$displayBan[1];html+=parseHTML(_templateObject3,{title:title},label);return html;},handler:function handler(info){if(!info[3])return this.renderReasonPrompt();for(var i=0;i<3;i++){info[i]=+info[i];}info[4]=+info[4];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=util.getSelected()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var num=_step.value;main.send([common.BAN,num].concat(_toConsumableArray(info)));}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}this.kill();},renderReasonPrompt:function renderReasonPrompt(){this.$el.find('.reasonPrompt').remove();this.$el.append(parseHTML(_templateObject4,lang.mod.needReason)).find('input[type=text]').focus();}});exports.ban=BanInputView;

},{"./util":5,"main":undefined}],2:[function(require,module,exports){
'use strict';var main=require('main');var _=main._;var Backbone=main.Backbone;var common=main.common;var dispatcher=main.dispatcher;var etc=main.etc;var oneeSama=main.oneeSama;var lang=main.lang;var modals=main.modals;var Memory=main.Memory;var state=main.state;var PanelView=Backbone.View.extend({className:'modal mod panel glass',initialize:function initialize(){var _this=this;this.$el.appendTo(main.$overlay);modals[this.type]=this;dispatcher[this.kind]=function(msg){return _this.render(msg[0]);};main.send([this.kind]);},render:function render(info){if(!info.length){return this.el.innerHTML="God's in his Heaven. All's right"+" with the world.";}this.el.innerHTML=this.renderContents(info);this.postRender&&this.postRender();this.el.scrollTop=this.el.scrollHeight;return this;},kill:function kill(){delete dispatcher[this.kind];delete modals[this.type];this.remove();}});var ModLogView=PanelView.extend({type:'log',kind:common.MOD_LOG,renderContents:function renderContents(info){return table(info,function(act){return [act.num?oneeSama.postRef(act.num,act.op):'',lang.mod.formatLog(act),oneeSama.time(act.time)];});}});exports.log=ModLogView;var AdminPanelView=PanelView.extend({type:'adminPanel',id:'adminPanel',kind:common.ADMIN_PANEL,events:{'click .unban':'unban'},renderContents:function renderContents(info){var _this2=this;this.banCount=0;return table(info,function(ban){_this2.banCount++;return [oneeSama.mnemonic(ban[0]),oneeSama.time(ban[1]),'<a class="unban" data-id="'+ban[0]+'">'+lang.mod.unban+'</a>'];});},unban:function unban(event){var el=event.target;main.send([common.UNBAN,el.getAttribute('data-id')]);el.parentElement.parentElement.remove();if(! --this.banCount)this.kill();}});exports.adminPanel=AdminPanelView;function table(rows,func){var html='<table>';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=rows[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var row=_step.value;html+='<tr>';var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=func(row)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var cell=_step2.value;html+='<td>'+cell+'</td>';}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}html+='</tr>';}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}html+='</table>';return html;}var RequestPanelView=PanelView.extend({type:'djPanel',events:{'click .close':'removeRequest','click #rescan':'scan'},initialize:function initialize(){main.$overlay[0].append(this.el);modals[this.type]=this;this.removed=new Memory('request',2);this.scan();},scan:function scan(){var removed=this.removed.readAll(),requests=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=state.posts.models[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var attributes=_step3.value.attributes;if(attributes.num in removed)continue;var m=attributes.body.match(/\/r\/[^\n]+$/gm);if(!m)continue;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=m[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var request=_step4.value;request=request.replace('/r/','').trim();requests.push([attributes.num,attributes.mnemonic,request]);}}catch(err) {_didIteratorError4=true;_iteratorError4=err;}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally {if(_didIteratorError4){throw _iteratorError4;}}}}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}return this.render(_.sortBy(requests,1));},renderContents:function renderContents(requests){return table(requests,function(request){return [oneeSama.postRef(request[0],oneeSama.op).safe,oneeSama.mnemonic(request[1]),request[2],'<a class="close" data-id="'+request[0]+'">X</a>'];});},postRender:function postRender(){this.el.append(etc.parseDOM('<a id="rescan">'+lang.rescan+'</a>')[0]);},removeRequest:function removeRequest(event){event.preventDefault();var el=event.target;this.removed.write(el.getAttribute('data-id'));el.closest('tr').remove();}});exports.djPanel=RequestPanelView;

},{"main":undefined}],3:[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<label title="','" class="mod">\n\t\t<input type="checkbox" id="authName">\n\t\t ','\n\t </label>'],['<label title="','" class="mod">\n\t\t<input type="checkbox" id="authName">\n\t\t ','\n\t </label>']);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var etc=main.etc;var lang=main.lang;var state=main.state;var auth=main.ident.auth;main.$name.after(main.common.parseHTML(_templateObject,lang.mod.title[1],lang.mod.title[0]));var $authName=main.$('#authName');main.oneeSama.hook('fillMyName',function(el){var checked=$authName[0].checked;if(checked){el.classList.add(auth==='admin'?'admin':'moderator');el.append(document.createTextNode(' ## '+state.hotConfig.get('staff_aliases')[auth]));}});$authName.change(function(){return main.request('postForm:indentity');});override(main.posts.posting.ComposerView.prototype,'allocationMessage',function(orig){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}var msg=orig.call.apply(orig,[this].concat(args));if($authName[0].checked)msg.auth=auth;return msg;});function override(parent,method,upgrade){var orig=parent[method];parent[method]=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return upgrade.call.apply(upgrade,[this,orig].concat(args));};}

},{"main":undefined}],4:[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<a class="modButton" data-kind="','" title="','">\n\t\t\t\t\t','\n\t\t\t\t</a>'],['<a class="modButton" data-kind="','" title="','">\n\t\t\t\t\t','\n\t\t\t\t</a>']),_templateObject2=_taggedTemplateLiteral(['<style>\n\t\t\t\t.postCheckbox {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t</style>'],['<style>\n\t\t\t\t.postCheckbox {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t</style>']),_templateObject3=_taggedTemplateLiteral(['<style>\n\t\t\t\theader > .mod.addr {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t</style>'],['<style>\n\t\t\t\theader > .mod.addr {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t</style>']);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else {return Array.from(arr);}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var input=require('./input');var panels=require('./panels');var util=require('./util');var $=main.$;var _=main._;var Backbone=main.Backbone;var common=main.common;var lang=main.lang;var modals=main.modals;var parseHTML=common.parseHTML;var childViews={ban:input.ban,log:require('./panels').log,adminPanel:panels.adminPanel,notification:input.notification,djPanel:panels.djPanel};var ToolboxView=Backbone.View.extend({id:'toolbox',className:'mod modal panel glass',initialize:function initialize(){this.render();},render:function render(){var specs=this.specs=['clearSelection','spoilerImages','deleteImages','deletePosts','modLog'];if(main.ident.auth==='dj')specs=this.specs=['djPanel'];var accessLevels=[['dj',['toggleMnemonics']],['moderator',['lockThreads','ban']],['admin',['sendNotification','renderPanel']]];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=accessLevels[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var level=_step.value;if(!common.checkAuth(level[0],main.ident))break;level[1].forEach(function(right){return specs.push(right);});}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}var controls='<span>';for(var i=0;i<specs.length;i++){var ln=lang.mod[specs[i]];controls+=parseHTML(_templateObject,i,ln[1],ln[0]);}controls+='</span>';this.$controls=$(controls);this.$checkboxToggle=$(parseHTML(_templateObject2)).appendTo('head').prop('disabled',true);this.$toggle=$('<a id="toolboxToggle">'+lang.show+'</a>');this.$el.prepend(this.$controls,this.$toggle).appendTo(main.$overlay);this.$mnemonicStyle=$(parseHTML(_templateObject3)).appendTo('head').prop('disabled',localStorage.noMnemonics!=='true');return this;},events:{'click #toolboxToggle':'toggleButtons','click .modButton':'buttonHandler'},toggleButtons:function toggleButtons(){var hidden=!this.model.get('shown');this.$toggle.text(lang[hidden?'hide':'show']);this.$controls.toggle(0);this.$checkboxToggle.prop('disabled',!hidden);this.model.set('shown',hidden);},buttonHandler:function buttonHandler(event){this[this.specs[event.target.getAttribute('data-kind')]](event);},clearSelection:function clearSelection(){util.loopCheckboxes(function(el){return el.checked=false;});},toggleMnemonics:function toggleMnemonics(){var hide=localStorage.noMnemonics==='true';this.$mnemonicStyle.prop('disabled',hide);localStorage.noMnemonics=!hide;},send:function send(type){main.send([common[type]].concat(_toConsumableArray(util.getSelected())));},spoilerImages:function spoilerImages(){this.send('SPOILER_IMAGES');},deleteImages:function deleteImages(){this.send('DELETE_IMAGES');},toggleChild:function toggleChild(type){if(modals[type])modals[type].kill();else new childViews[type]();},sendNotification:function sendNotification(){this.toggleChild('notification');},modLog:function modLog(){this.toggleChild('log');},djPanel:function djPanel(){this.toggleChild('djPanel');},ban:function ban(){this.toggleChild('ban');},renderPanel:function renderPanel(){this.toggleChild('adminPanel');},deletePosts:function deletePosts(){this.send('DELETE_POSTS');},lockThreads:function lockThreads(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=util.getSelected()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var num=_step2.value;var model=main.state.posts.get(num);if(!model||model.get('op'))continue;main.send([common[!model.get('locked')?'LOCK_THREAD':'UNLOCK_THREAD'],num]);}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}});main.$toolbox=new ToolboxView({model:new Backbone.Model()});

},{"./input":1,"./panels":2,"./util":5,"main":undefined}],5:[function(require,module,exports){
'use strict';var main=require('main');function getSelected(){var checked=[];loopCheckboxes(function(el){return el.checked&&checked.push(main.etc.getID(el));});return main._.compact(checked);}exports.getSelected=getSelected;function loopCheckboxes(func){var els=main.$threads[0].getElementsByClassName('postCheckbox');for(var i=0;i<els.length;i++){func(els[i]);}}exports.loopCheckboxes=loopCheckboxes;

},{"main":undefined}],"mod":[function(require,module,exports){
'use strict';var main=require('main');var $=main.$;var config=main.config;var ident=main.ident=window.IDENT;window.loggedInUser=ident.email;window.x_csrf=ident.csrf;main.$overlay=$('<div id="modOverlay"></div>').appendTo('body');main.modals={};require('./title');require('./toolbox');$('<link/>',{rel:'stylesheet',href:config.MEDIA_URL+'css/mod.css?v='+main.cssHash}).appendTo('head');var staff=config.STAFF_BOARD;$('#navTop').children('a').last().after(' / <a href="../'+staff+'/" class="history">'+staff+'</a>');

},{"./title":3,"./toolbox":4,"main":undefined}]},{},[])


//# sourceMappingURL=mod.js.map
