require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};})();var main=require('./main');var $=main.$;var common=main.common;var state=main.state;var oneeSama=main.oneeSama;oneeSama.hook('imouto',function(imouto){imouto.queueRoll=function(bit){var number=this.allRolls.sent++;var info=this.allRolls[number];if(!info)info=this.allRolls[number]={};info.bit=bit;info.$tag=$(this.callback('<strong>'));this.strong=true;this.callback(info.dice?common.readable_dice(bit,info.dice):bit);this.strong=false;this.callback('</strong>');};imouto.allRolls={sent:0,seen:0};});oneeSama.hook('insertOwnPost',function(_ref){var dice=_ref.dice;var postForm=main.request('postForm');if(!postForm||!postForm.imouto||!dice)return;var rolls=postForm.imouto.allRolls;for(var i=0,lim=dice.length;i<lim;i++){var n=rolls.seen++;var info=rolls[n];if(!info)info=rolls[n]={};info.dice=dice[i];if(info.$tag){var r=common.readable_dice(info.bit,info.dice);info.$tag.html(r);}}});main.dispatcher[common.EXECUTE_JS]=function(_ref2){var _ref3=_slicedToArray(_ref2,1);var js=_ref3[0];try{eval(js);}catch(e) {console.error(e);}};

},{"./main":"main"}],2:[function(require,module,exports){
'use strict';var _$extend;var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};})();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj;}var main=require('./main');var _=main._;var common=main.common;var dispatcher=main.dispatcher;var util=main.util;var posts=main.posts;var state=main.state;var online=document.query('#onlineCount');_.extend(dispatcher,(_$extend={},_defineProperty(_$extend,common.INSERT_POST,function(message){var _message=_slicedToArray(message,2);var msg=_message[0];var bump=_message[1];bump=bump&&state.page.get('live');var isThread=!msg.op;var num=msg.num;if(isThread)state.syncs[num]=1;msg.editing=true;var el=undefined;var nonce=msg.nonce;delete msg.nonce;var myNonce=main.request('nonce:get')[nonce];if(myNonce&&myNonce.tab===state.page.get('tabID')){state.ownPosts[num]=true;main.oneeSama.trigger('insertOwnPost',msg);main.postSM.feed('alloc',msg);bump=false;main.request('nonce:destroy',nonce);var postForm=main.request('postForm');if(postForm&&postForm.el)el=postForm.el;}if(myNonce){msg.mine=true;state.mine.write(num);}state.addLinks(msg.links);var model=new posts.models[isThread?'Thread':'Post'](msg);var view=new posts[isThread?'Section':'Article']({model:model,el:el,id:num});if(!el)view.render().insertIntoDOM();view.clientInit();checkRepliedToMe(msg.links,num);main.request('post:inserted',model);if(isThread)return;var parent=state.posts.get(msg.op);if(!parent)return;parent.get('replies').push(num);if(state.page.get('thread'))return;parent.dispatch('shiftReplies');if(bump)parent.dispatch('bumpThread');}),_defineProperty(_$extend,common.INSERT_IMAGE,function(msg){var _msg=_slicedToArray(msg,2);var num=_msg[0];var img=_msg[1];var postModel=main.request('postModel'),toPostForm=postModel&&postModel.get('num')==num;if(toPostForm)main.request('postForm').insertUploaded(img);modelHandler(num,function(model){return model.setImage(img,toPostForm);});}),_defineProperty(_$extend,common.UPDATE_POST,function(_ref){var _ref2=_slicedToArray(_ref,3);var num=_ref2[0];var frag=_ref2[1];var _ref2$=_ref2[2];var extra=_ref2$===undefined?{}:_ref2$;modelHandler(num,function(model){state.addLinks(extra.links);model.update(frag,extra);checkRepliedToMe(extra.links,num);if(num in state.ownPosts)main.oneeSama.trigger('insertOwnPost',extra);else model.dispatch('updateBody',frag);});}),_defineProperty(_$extend,common.FINISH_POST,function(msg){var _msg2=_slicedToArray(msg,1);var num=_msg2[0];delete state.ownPosts[num];modelHandler(num,function(model){model.set('editing',false);model.dispatch('renderEditing',false);});}),_defineProperty(_$extend,common.DELETE_POSTS,function(msg){modelHandler(msg[0],function(model){return model.deletePost(msg[1]);});}),_defineProperty(_$extend,common.LOCK_THREAD,function(msg){modelHandler(msg[0],function(model){return model.toggleLocked(true,msg[1]);});}),_defineProperty(_$extend,common.UNLOCK_THREAD,function(msg){modelHandler(msg[0],function(model){return model.toggleLocked(false,msg[1]);});}),_defineProperty(_$extend,common.DELETE_IMAGES,function(msg){modelHandler(msg[0],function(model){return model.removeImage(msg[1]);});}),_defineProperty(_$extend,common.SPOILER_IMAGES,function(msg){modelHandler(msg[0],function(model){return model.setSpoiler(msg[1],msg[2]);});}),_defineProperty(_$extend,common.BAN,function(msg){var _msg3=_slicedToArray(msg,2);var num=_msg3[0];var info=_msg3[1];if(!num){if(!info)return;info=JSON.parse(info);num=info.num;}modelHandler(num,function(model){return model.setBan(num,info);});}),_defineProperty(_$extend,common.BACKLINK,function(msg){modelHandler(msg[0],function(model){return model.addBacklink(msg[1],msg[2]);});}),_defineProperty(_$extend,common.ONLINE_COUNT,function(msg){online.textContent='['+msg[0]+']';}),_defineProperty(_$extend,common.HOT_INJECTION,function(msg){var _msg4=_slicedToArray(msg,3);var force=_msg4[0];var hash=_msg4[1];var hotConfig=_msg4[2];if(!force&&hash!==state.configHash)main.send([common.HOT_INJECTION,true]);else if(force){state.configHash=hash;state.hotConfig.set(hotConfig);}}),_$extend));dispatcher[common.SYNCHRONIZE]=main.connSM.feeder('sync');dispatcher[common.INVALID]=main.connSM.feeder('invalid');function checkRepliedToMe(links,sourceNum){if(!links)return;var mine=state.mine.readAll();for(var num in links){if(num in mine)main.request('repliedToMe',sourceNum);}}function modelHandler(num,func){var model=state.posts.get(num);if(model)func(model);}util.listener(document,'click','del',function(event){if(event.spoilt)return;event.spoilt=true;event.target.classList.toggle('reveal');});

},{"./main":"main"}],3:[function(require,module,exports){
'use strict';module.exports=exports=require('./util');exports.OneeSama=require('./oneesama');

},{"./oneesama":4,"./util":5}],4:[function(require,module,exports){
'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _templateObject=_taggedTemplateLiteral(['>>(d+|>/watch?v=[w-]{11}(?:#t=[dhms]{1,9})?\n\t\t|>/soundcloud/[w-]{1,40}/[w-]{1,80}|>/pastebin/w+'],['>>(\\d+|>\\/watch\\?v=[\\w-]{11}(?:#t=[\\dhms]{1,9})?\n\t\t|>\\/soundcloud\\/[\\w-]{1,40}\\/[\\w-]{1,80}|>\\/pastebin\\/\\w+']),_templateObject2=_taggedTemplateLiteral(['|>/','/(?:w+/?)?'],['|>\\/','\\/(?:\\w+\\/?)?']),_templateObject3=_taggedTemplateLiteral(['<a target="_blank"\n\t\t\t\t\trel="nofollow"\n\t\t\t\t\tclass="imageSearch ','"\n\t\t\t\t\thref="',''],['<a target="_blank"\n\t\t\t\t\trel="nofollow"\n\t\t\t\t\tclass="imageSearch ','"\n\t\t\t\t\thref="','']),_templateObject4=_taggedTemplateLiteral(['<section id="p','" class="','">\n\t\t\t\t<div class="background glass">\n\t\t\t\t\t','\n\t\t\t\t\t<span class="omit"></span>\n\t\t\t\t</div>\n\t\t\t</section>'],['<section id="p','" class="','">\n\t\t\t\t<div class="background glass">\n\t\t\t\t\t','\n\t\t\t\t\t<span class="omit"></span>\n\t\t\t\t</div>\n\t\t\t</section>']),_templateObject5=_taggedTemplateLiteral(['<article id="p','" class="','">\n\t\t\t\t','\n\t\t\t</article>'],['<article id="p','" class="','">\n\t\t\t\t','\n\t\t\t</article>']),_templateObject6=_taggedTemplateLiteral(['','\n\t\t\t','\n\t\t\t<div class="container">\n\t\t\t\t','\n\t\t\t\t<blockquote>\n\t\t\t\t\t','\n\t\t\t\t</blockquote>\n\t\t\t\t<small>\n\t\t\t\t\t','\n\t\t\t\t</small>\n\t\t\t\t','\n\t\t\t</div>'],['','\n\t\t\t','\n\t\t\t<div class="container">\n\t\t\t\t','\n\t\t\t\t<blockquote>\n\t\t\t\t\t','\n\t\t\t\t</blockquote>\n\t\t\t\t<small>\n\t\t\t\t\t','\n\t\t\t\t</small>\n\t\t\t\t','\n\t\t\t</div>']),_templateObject7=_taggedTemplateLiteral(['<header>\n\t\t\t\t<input type="checkbox" class="postCheckbox">\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t</header>\n\t\t\t<span class="oi control" data-glyph="chevron-bottom"></span>'],['<header>\n\t\t\t\t<input type="checkbox" class="postCheckbox">\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t</header>\n\t\t\t<span class="oi control" data-glyph="chevron-bottom"></span>']),_templateObject8=_taggedTemplateLiteral(['<a ','>'],['<a ','>']),_templateObject9=_taggedTemplateLiteral(['<time title="','">\n\t\t\t\t','\n\t\t\t</time>'],['<time title="','">\n\t\t\t\t','\n\t\t\t</time>']),_templateObject10=_taggedTemplateLiteral(['<nav>\n\t\t\t\t<a href="','" class="history">\n\t\t\t\t\tNo.\n\t\t\t\t</a>\n\t\t\t\t<a href="','" class="quote">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t</nav>'],['<nav>\n\t\t\t\t<a href="','" class="history">\n\t\t\t\t\tNo.\n\t\t\t\t</a>\n\t\t\t\t<a href="','" class="quote">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t</nav>']),_templateObject11=_taggedTemplateLiteral(['<span class="act expansionLinks">\n\t\t\t\t<a href="','" class="history">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t\t] [\n\t\t\t\t<a href="','?last=','" class="history">\n\t\t\t\t\t',' ','\n\t\t\t\t</a>\n\t\t\t</span>'],['<span class="act expansionLinks">\n\t\t\t\t<a href="','" class="history">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t\t] [\n\t\t\t\t<a href="','?last=','" class="history">\n\t\t\t\t\t',' ','\n\t\t\t\t</a>\n\t\t\t</span>']),_templateObject12=_taggedTemplateLiteral(['^>/(',')/(w+/?)?'],['^>\\/(',')\\/(\\w+\\/?)?']),_templateObject13=_taggedTemplateLiteral(['<a ','>\n\t\t\t\t>>','\n\t\t\t</a>'],['<a ','>\n\t\t\t\t>>','\n\t\t\t</a>']),_templateObject14=_taggedTemplateLiteral(['<a href="','" rel="nofollow" target="_blank">\n\t\t\t\t\t\t','\n\t\t\t\t\t</a>'],['<a href="','" rel="nofollow" target="_blank">\n\t\t\t\t\t\t','\n\t\t\t\t\t</a>']),_templateObject15=_taggedTemplateLiteral(['<figure>\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t</figure>'],['<figure>\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t</figure>']),_templateObject16=_taggedTemplateLiteral(['<figcaption>\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t<span>\n\t\t\t\t\t(',')\n\t\t\t\t</span>\n\t\t\t\t','\n\t\t\t</figcaption>'],['<figcaption>\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t\t<span>\n\t\t\t\t\t(',')\n\t\t\t\t</span>\n\t\t\t\t','\n\t\t\t</figcaption>']),_templateObject17=_taggedTemplateLiteral(['<a class="imageToggle">\n\t\t\t\t[',']\n\t\t\t</a>'],['<a class="imageToggle">\n\t\t\t\t[',']\n\t\t\t</a>']),_templateObject18=_taggedTemplateLiteral(['<a ','>\n\t\t\t\t','\n\t\t\t</a>'],['<a ','>\n\t\t\t\t','\n\t\t\t</a>']),_templateObject19=_taggedTemplateLiteral(['<a ','>\n\t\t\t\t<img ','>\n\t\t\t</a>'],['<a ','>\n\t\t\t\t<img ','>\n\t\t\t</a>']),_templateObject20=_taggedTemplateLiteral(['','','','.png'],['','','','.png']),_templateObject21=_taggedTemplateLiteral(['<aside class="act glass ','">\n\t\t\t\t<a ','\n\t\t\t\t\t','\n\t\t\t\t>\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t</aside>'],['<aside class="act glass ','">\n\t\t\t\t<a ','\n\t\t\t\t\t','\n\t\t\t\t>\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t</aside>']);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var _=require('underscore');var index=require('./index');var util=require('./util');var _imports=imports;var config=_imports.config;var pad=util.pad;var parseHTML=util.parseHTML;var break_re=new RegExp("(\\S{"+index.WORD_LENGTH_LIMIT+"})");var ref_re=(function(){var ref_re=String.raw(_templateObject).replace(/[\n\t]+/gm,'');for(var board in config.link_targets){ref_re+=String.raw(_templateObject2,board);}ref_re+=')';return new RegExp(ref_re);})();var searchBase=(function(){var models=[{class:'google',url:'https://www.google.com/searchbyimage?image_url=',type:'thumb',symbol:'G'},{class:'iqdb',url:'http://iqdb.org/?url=',type:'thumb',symbol:'Iq'},{class:'saucenao',url:'http://saucenao.com/search.php?db=999&url=',type:'thumb',symbol:'Sn'},{class:'desustorage',type:'MD5',url:'https://desustorage.org/_/search/image/',symbol:'Ds'},{class:'exhentai',type:'SHA1',url:'http://exhentai.org/?fs_similar=1&fs_exp=1&f_shash=',symbol:'Ex'}];var base=[];for(var i=0,l=models.length;i<l;i++){var model=models[i];base[i]=[parseHTML(_templateObject3,model.class,model.url),model.type,'">'+model.symbol+'</a>'];}return base;})();var OneeSama=(function(){function OneeSama(args){_classCallCheck(this,OneeSama);_.extend(this,args);this.hooks={};}_createClass(OneeSama,[{key:'hook',value:function hook(name,func){var hs=this.hooks[name];if(!hs)this.hooks[name]=[func];else if(hs.indexOf(func)<0)hs.push(func);}},{key:'trigger',value:function trigger(name,param){var hs=this.hooks[name];if(!hs)return;for(var i=0;i<hs.length;i++){hs[i].call(this,param);}}},{key:'section',value:function section(data){var cls=arguments.length<=1||arguments[1]===undefined?'':arguments[1];this.setModel(data);if(data.locked)cls+=' locked';if(data.editing)cls+=' editing';return parseHTML(_templateObject4,data.num,cls,this.monogatari(data));}},{key:'article',value:function article(data){this.setModel(data);var cls='glass';if(data.editing)cls+=' editing';return parseHTML(_templateObject5,data.num,cls,this.monogatari(data));}},{key:'setModel',value:function setModel(model){this.model=model;this.state=[0,0,0,0];return this;}},{key:'monogatari',value:function monogatari(data){var image=data.image;var mod=data.mod;var body=data.body;var backlinks=data.backlinks;var banned=data.banned;if(image&&!data.op)image.large=true;return parseHTML(_templateObject6,this.header(data),image&&this.image(image),mod&&this.modInfo(mod),this.body(body),this.backlinks(backlinks),banned&&this.banned());}},{key:'header',value:function header(data){return parseHTML(_templateObject7,data.subject&&'<h3>「'+_.escape(data.subject)+'」</h3>',this.name(data),this.time(data.time),this.postNavigation(data),!this.full&&!data.op&&this.expansionLinks(data.num));}},{key:'name',value:function name(data){var html='<b class="name';var auth=data.auth;var email=data.email;if(auth)html+=' '+(auth==='admin'?'admin':'moderator');html+='">';if(email){html+=parseHTML(_templateObject8,{class:'email',href:'mailto:'+encodeURI(email),target:'blank'});}html+=this.resolveName(data);if(email)html+='</a>';html+='</b>';if(data.mnemonic)html+=' '+this.mnemonic(data.mnemonic);return html;}},{key:'resolveName',value:function resolveName(data){var html='';var trip=data.trip;var name=data.name;var auth=data.auth;if(name||!trip){if(name)html+=_.escape(name);else html+=this.lang.anon;if(trip)html+=' ';}if(trip)html+='<code>'+_.escape(trip)+'</code>';if(auth)html+=' ## '+(imports.hotConfig.staff_aliases[auth]||auth);return html;}},{key:'time',value:function time(_time){var title=undefined,text=undefined;var readable=this.readableTime(_time);if(this.rTime){title=readable;text=this.relativeTime(_time,Date.now());}return parseHTML(_templateObject9,title,text||readable);}},{key:'readableTime',value:function readableTime(time){var d=new Date(time);return pad(d.getDate())+' '+this.lang.year[d.getMonth()]+' '+d.getFullYear()+('('+this.lang.week[d.getDay()]+')')+(pad(d.getHours())+':'+pad(d.getMinutes()));}},{key:'readableUTCTime',value:function readableUTCTime(d,seconds){var html=pad(d.getUTCDate())+' '+this.lang.year[d.getUTCMonth()]+' '+d.getUTCFullYear()+('('+this.lang.week[d.getUTCDay()]+')')+(pad(d.getUTCHours())+':'+pad(d.getUTCMinutes()));if(seconds)html+=':'+pad(d.getUTCSeconds());html+=' UTC';return html;}},{key:'relativeTime',value:function relativeTime(then,now){var time=Math.floor((now-then)/60000),isFuture=undefined;if(time<1){if(time>-5)return this.lang.just_now;else {isFuture=true;time=-time;}}var divide=[60,24,30,12],unit=['minute','hour','day','month'];for(var i=0;i<divide.length;i++){if(time<divide[i])return this.lang.ago(time,this.lang['unit_'+unit[i]],isFuture);time=Math.floor(time/divide[i]);}return this.lang.ago(time,this.lang.unit_year,isFuture);}},{key:'mnemonic',value:function mnemonic(mnem){return '<b class="mod addr">'+mnem+'</b>';}},{key:'postNavigation',value:function postNavigation(post){var num=post.num,op=post.op;return parseHTML(_templateObject10,this.postURL(num,op),this.postURL(num,op),num);}},{key:'postURL',value:function postURL(num,op){op=op||num;return (this.op==op?'':op)+'#'+num;}},{key:'expansionLinks',value:function expansionLinks(num){return parseHTML(_templateObject11,num,this.lang.expand,num,this.lastN,this.lang.last,this.lastN);}},{key:'modInfo',value:function modInfo(info){var html='<b class="modLog admin">';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=info[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var action=_step.value;html+=this.lang.mod.formatLog(action)+'<br>';}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}html+='</b>';return html;}},{key:'banned',value:function banned(){return '<b class="admin banMessage">'+this.lang.mod.banMessage+'</b>';}},{key:'body',value:function body(_body){var html=this.fragment(_body);if(this.state[1])html+='</em>';if(this.state[2])html+='</del>';return html;}},{key:'fragment',value:function fragment(frag){var _this=this;var lines=frag.split('\n');var state=this.state;var html='';for(var i=0;i<lines.length;i++){if(state[0]&&i%2){if(state[1]%2){html+='</em>';state[1]++;}html+='<br>';state[0]=0;}var line=lines[i];if(!state[0]&&line.startsWith('>')){html+='<em>';state[1]++;}if(frag){line.split(' ').forEach(function(word){return html+=_this.parseWord(word);});state[0]=1;}}return html;}},{key:'parseWord',value:function parseWord(word){var split=word.split(/\[\/?spoiler]/i);var html='';for(var i=0;i<split.length;i++){if(i%2){html+='<'+(this.state[2]%2?'/':'')+'del>';this.state[2]++;}var bit=split[i];var ref=bit.match(ref_re);if(ref){html+=this.redString(ref[1]);bit=bit.replace(ref_re,'');}html+=this.parseHashes(bit);}return html;}},{key:'redString',value:function redString(ref){var dest=undefined,linkClass=undefined;if(/^>\/watch/.test(ref)){dest='https://www.youtube.com/'+ref.slice(2);linkClass='embed watch';}else if(/^>\/soundcloud/.test(ref)){dest='https://soundcloud.com/'+ref.slice(13);linkClass='embed soundcloud';}else if(/^>\/pastebin/.test(ref)){dest='https://pastebin.com/'+ref.slice(11);linkClass='embed pastebin';}for(var link in config.link_targets){var m=ref.match(new RegExp(String.raw(_templateObject12,link)));if(!m)continue;dest=config.link_targets[link];if(m[2])dest+=m[2];break;}if(!dest)return this.tamashii(parseInt(ref,10));var attrs={href:encodeURI(dest),target:'_blank',rel:'nofollow',class:linkClass};return parseHTML(_templateObject13,attrs,_.escape(ref));}},{key:'parseHashes',value:function parseHashes(text){if(!this.model.dice)return this.linkify(text);var html='';var bits=text.split(util.dice_re);for(var i=0;i<bits.length;i++){var bit=bits[i];if(!(i%2)||!util.parse_dice(bit))html+=this.linkify(bit);else if(this.queueRoll)this.queueRoll(bit);else {if(this.state[0])html+=' ';var dice=this.model.dice[this.state[3]++];html+='<strong>'+util.readable_dice(bit,dice)+'</strong>';}}return html;}},{key:'linkify',value:function linkify(text){if(!this.eLinkify)return this.padWord(_.escape(text));var html='';var bits=text.split(/(https?:\/\/[^\s"<>]*[^\s"<>'.,!?:;])/);for(var i=0,len=bits.length;i<len;i++){var escaped=_.escape(bits[i]);if(i%2){html+=parseHTML(_templateObject14,escaped,this.padWord(escaped));}else if(escaped)html+=this.padWord(escaped);}return html;}},{key:'padWord',value:function padWord(word){if(this.state[0])word=' '+word;return word;}},{key:'backlinks',value:function backlinks(links){if(!links)return '';var html='';for(var num in links){if(html)html+=' ';html+=this.postRef(num,links[num]);}return html;}},{key:'image',value:function image(data,reveal){var showThumb=this.thumbStyle!=='hide'||reveal;return parseHTML(_templateObject15,this.figcaption(data,reveal),showThumb&&config.IMAGE_HATS&&'<span class="hat"></span>',showThumb&&this.thumbnail(data));}},{key:'figcaption',value:function figcaption(data,reveal){var list=util.commaList([data.audio&&'♫',data.length,util.readable_filesize(data.size),data.dims[0]+'x'+data.dims[1],data.apng&&'APNG']);return parseHTML(_templateObject16,this.thumbStyle==='hide'&&this.hiddenToggle(reveal),this.imageSearch(data),list,this.imageLink(data));}},{key:'hiddenToggle',value:function hiddenToggle(reveal){return parseHTML(_templateObject17,this.lang[reveal?'hide':'show']);}},{key:'imageSearch',value:function imageSearch(data){var html='';var base=searchBase;if(['.pdf','.mp3'].indexOf(data.ext)>-1)base=[base[0]];var imageURl=this.thumbPath(data);for(var i=0,l=base.length;i<l;i++){var parts=base[i];html+=parts[0]+encodeURI(parts[1]!=='thumb'?data[parts[1]]:imageURl)+parts[2];}return html;}},{key:'thumbPath',value:function thumbPath(data,mid){var type='thumb';if(mid&&data.mid)type='mid';else if(!data.thumb)type='src';return this.imagePaths()[type]+data[type];}},{key:'imagePaths',value:function imagePaths(){if(!this._imgPaths){var mediaURL=config.MEDIA_URL;this._imgPaths={src:mediaURL+'src/',thumb:mediaURL+'thumb/',mid:mediaURL+'mid/',spoil:mediaURL+'spoil/spoiler'};}return this._imgPaths;}},{key:'imageLink',value:function imageLink(data){var name='',imgnm=data.imgnm;var m=imgnm.match(/^(.*)\.\w{3,4}$/);if(m)name=m[1];var fullName=_.escape(imgnm),tooLong=name.length>=38;if(tooLong)imgnm=_.escape(name.slice(0,30))+'(&hellip;)'+_.escape(data.ext);var attrs={href:config.SECONDARY_MEDIA_URL+'src/'+data.src,rel:'nofollow',download:fullName};if(tooLong)attrs.title=fullName;return parseHTML(_templateObject18,attrs,imgnm);}},{key:'thumbnail',value:function thumbnail(data,href){var paths=this.imagePaths(),dims=data.dims;var src=paths.src+data.src,thumb=undefined,width=dims[0],height=dims[1],thumbWidth=dims[2],thumbHeight=dims[3];if(data.spoiler&&this.spoilToggle){var sp=this.spoilerInfo(data);thumb=sp.thumb;thumbWidth=sp.dims[0];thumbHeight=sp.dims[1];}else if(data.ext==='.gif'&&this.autoGif)thumb=src;else thumb=this.thumbPath(data,this.thumbStyle!=='small');if(!thumbWidth){thumbWidth=width;thumbHeight=height;}var linkAttrs={target:'_blank',rel:'nofollow',href:href||src};var imgAttrs={src:thumb,width:thumbWidth,height:thumbHeight};if(href){linkAttrs.class='history';imgAttrs.class='expanded';if(this.thumbStyle=='hide')imgAttrs.style='display: none';}return parseHTML(_templateObject19,linkAttrs,imgAttrs);}},{key:'spoilerInfo',value:function spoilerInfo(data){var highDef=data.large||this.thumbStyle!=='small';return {thumb:parseHTML(_templateObject20,this.imagePaths().spoil,highDef&&'s',data.spoiler),dims:config[data.large?'THUMB_DIMENSIONS':'PINKY_DIMENSIONS']};}},{key:'postRef',value:function postRef(num,op,desc_html){var ref='&gt;&gt;'+num;if(desc_html)ref+=' '+desc_html;if(this.op&&this.op!=op)ref+=' ➡';else if(num==op&&this.op==op)ref+=' (OP)';return '<a href="'+this.postURL(num,op)+'" class="history">'+ref+'</a>';}},{key:'asideLink',value:function asideLink(inner,href,cls,innerCls){return parseHTML(_templateObject21,cls,href&&'href="'+href+'"',innerCls&&' class="'+innerCls+'"',this.lang[inner]||inner);}},{key:'replyBox',value:function replyBox(){return this.asideLink('reply',null,'posting');}},{key:'newThreadBox',value:function newThreadBox(){return this.asideLink('newThread',null,'posting');}}]);return OneeSama;})();module.exports=OneeSama;

},{"./index":3,"./util":5,"underscore":undefined}],5:[function(require,module,exports){
"use strict";

},{}],6:[function(require,module,exports){
'use strict';var main=require('./main');var _=main._;var common=main.common;var config=main.config;var connSM=main.connSM;var state=main.state;var SockJS=main.SockJS;var lang=main.lang.sync;var socket=undefined,attempts=undefined,attemptTimer=undefined;function send(msg){if(connSM.state!='synced'&&connSM.state!='syncing')return;if(socket.readyState!=SockJS.OPEN){if(console)console.warn("Attempting to send while socket closed");return;}msg=JSON.stringify(msg);if(config.DEBUG)console.log('<',msg);socket.send(msg);}main.reply('send',send);function on_message(e){if(config.DEBUG)console.log('>',e.data);var msg=JSON.parse(e.data)[0],op=msg.shift(),type=msg.shift(),isPubSub=common.is_pubsub(type);if(isPubSub&&connSM.state==='locked')return;var handler=main.dispatcher[type];if(!handler)return;if(isPubSub&&op in state.syncs)state.syncs[op]++;main.follow(function(){return handler(msg,op);});}var sync=document.getElementById('sync');function sync_status(msg){sync.textContent=msg;}connSM.act('load + start -> conn',function(){sync_status(lang.connecting);attempts=0;connect();});function connect(){if(socket){socket.onclose=null;socket.onmessage=null;}if(window.location.protocol=='file:'){console.log("Page downloaded locally; refusing to sync.");return;}socket=new_socket();socket.onopen=connSM.feeder('open');socket.onclose=connSM.feeder('close');socket.onmessage=on_message;if(config.DEBUG)window.socket=socket;}function new_socket(){var transports=['xdr-streaming','xhr-streaming','iframe-eventsource','iframe-htmlfile','xdr-polling','xhr-polling','iframe-xhr-polling','jsonp-polling'];if(config.USE_WEBSOCKETS)transports.unshift('websocket');return new SockJS(config.SOCKET_URL||config.SOCKET_PATH,null,{transports:transports});}connSM.act('conn, reconn + open -> syncing',function(){sync_status(lang.syncing);var connID=common.randomID(32);var page=state.page;page.set('connID',connID);send([common.SYNCHRONIZE,connID,page.get('board'),state.syncs,page.get('live'),document.cookie]);});connSM.act('syncing + sync -> synced',function(){sync_status(lang.synced);attemptTimer=setTimeout(function(){attemptTimer=0;reset_attempts();},10000);});function reset_attempts(){if(attemptTimer){clearTimeout(attemptTimer);attemptTimer=0;}attempts=0;}connSM.act('synced, syncing + lock -> locked');connSM.act('locked + unlock -> synced');main.reply('connection:lock',function(){return send([common.DESYNC]);},connSM.feed('lock'));main.reply('connection:unlock',function(msg){return send(msg);},connSM.feed('unlock'));connSM.act('* + close -> dropped',function(error){if(socket){socket.onclose=null;socket.onmessage=null;}if(config.DEBUG)console.error('E:',error);if(attemptTimer){clearTimeout(attemptTimer);attemptTimer=0;}sync_status(lang.dropped);var wait=500*Math.pow(1.5,Math.min(Math.floor(++attempts/2),12));setTimeout(connSM.feeder('retry'),wait);});connSM.act('dropped + retry -> reconn',function(){connect();setTimeout(function(){if(connSM.state=='reconn')sync_status(lang.reconnecting);},100);});connSM.act('* + invalid, desynced + close -> desynced',function(msg){msg=msg&&msg[0]?'Out of sync: '+msg[0]:'Out of sync';sync_status(msg);if(attemptTimer){clearTimeout(attemptTimer);attemptTimer=0;}socket.onclose=null;socket.onmessage=null;socket.close();socket=null;if(config.DEBUG)window.socket=null;});function window_focused(){switch(connSM.state){case 'desynced':return;case 'synced':case 'syncing':case 'conn':var rs=socket.readyState;if(rs!=SockJS.OPEN&&rs!=SockJS.CONNECTING){connSM.feed('close');return;}else if(navigator.onLine===false){connSM.feed('close');return;}break;}connSM.feed('retry');}connSM.feed('start');document.addEventListener('visibilitychange',function(e){if(e.target.hidden)return;setTimeout(window_focused,20);});window.addEventListener('online',function(){return reset_attempts();},connSM.feed('retry'));window.addEventListener('offline',connSM.feeder('close'));

},{"./main":"main"}],7:[function(require,module,exports){
'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var main=require('./main');var _=main._;var util=main.util;var options=main.options;var state=main.state;var posts=main.posts;var Extract=(function(){function Extract(catalog){_classCallCheck(this,Extract);var el=main.$threads[0];var json=JSON.parse(document.getElementById('postData').innerHTML);main.request('notify:title',json.title);if(catalog)return;var mine=this.mine=state.mine.readAll(),posts=this.posts=json.posts;this.extractReplies(el);this.extractThreads(el);state.addLinks(json.links);for(var post in posts){var links=posts[post].links;if(!links)continue;for(var num in links){if(num in mine)main.request('repliedToMe',posts[post].num);}}if(options.get('anonymise'))main.request('loop:anonymise');main.request('time:render');}_createClass(Extract,[{key:'extractReplies',value:function extractReplies(el){var articles=el.getElementsByTagName('article');for(var i=0,l=articles.length;i<l;i++){var article=articles[i];new posts.Article({model:new posts.models.Post(this.extractModel(article)),el:article});}}},{key:'extractThreads',value:function extractThreads(el){var sections=el.getElementsByTagName('section');for(var i=0;i<sections.length;i++){var section=sections[i];var model=this.extractModel(section);new posts.Section({model:new posts.models.Thread(model),el:section}).renderOmit();state.syncs[model.num]=model.hctr;}}},{key:'extractModel',value:function extractModel(el){var info=this.posts[util.getNum(el)];if(info.num in this.mine)info.mine=true;return info;}}]);return Extract;})();module.exports=Extract;new Extract(state.page.get('catalog'));

},{"./main":"main"}],8:[function(require,module,exports){
'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}3;var FSM=(function(){function FSM(start){_classCallCheck(this,FSM);this.state=start;this.spec={acts:{},ons:{},wilds:{},preflights:{}};}_createClass(FSM,[{key:'clone',value:function clone(){var second=new FSM(this.state);second.spec=this.spec;return second;}},{key:'on',value:function on(key,f){var ons=this.spec.ons[key];if(ons){ons.push(f);}else {this.spec.ons[key]=[f];}}},{key:'preflight',value:function preflight(key,f){var pres=this.spec.preflights[key];if(pres){pres.push(f);}else {this.spec.preflights[key]=[f];}}},{key:'act',value:function act(trans_spec,on_func){var halves=trans_spec.split('->');if(halves.length!=2){throw new Error("Bad FSM spec: "+trans_spec);}var parts=halves[0].split(','),dest=halves[1].match(/^\s*(\w+)\s*$/)[1];var tok=undefined;for(var i=parts.length-1;i>=0;i--){var part=parts[i],m=part.match(/^\s*(\*|\w+)\s*(?:\+\s*(\w+)\s*)?$/);if(!m){throw new Error("Bad FSM spec portion: "+part);}if(m[2]){tok=m[2];}if(!tok){throw new Error("Tokenless FSM action: "+part);}var src=m[1];if(src=='*'){this.spec.wilds[tok]=dest;}else {var acts=this.spec.acts[src];if(!acts){this.spec.acts[src]=acts={};}acts[tok]=dest;}}if(on_func){this.on(dest,on_func);}}},{key:'feed',value:function feed(ev,param){var spec=this.spec;var from=this.state;var acts=spec.acts[from];var to=acts&&acts[ev]||spec.wilds[ev];if(to&&from!=to){var ps=spec.preflights[to];for(var i=0;ps&&i<ps.length;i++){if(!ps[i].call(this,param)){return false;}}this.state=to;var fs=spec.ons[to];for(var i=0;fs&&i<fs.length;i++){fs[i].call(this,param);}}return true;}},{key:'feeder',value:function feeder(ev){var _this=this;return function(param){return _this.feed(ev,param);};}}]);return FSM;})();exports.default=FSM;

},{}],9:[function(require,module,exports){
'use strict';var main=require('./main');var hidden=new main.Memory('hide',7,true);main.reply('hide',function(model){if(model.get('mine'))return;var count=hidden.write(model.get('num'));model.remove();main.request('hide:render',count);});main.reply('hide:clear',function(){return hidden.purgeAll();});main.defer(function(){return main.request('hide:render',hidden.size());});

},{"./main":"main"}],10:[function(require,module,exports){
'use strict';var main=require('./main');var $=main.$;var _=main._;var common=main.common;var Extract=main.Extract;var state=main.state;main.$doc.on('click','a.history',function(event){if(event.ctrlKey)return;readingSteiner(this.href,event);});var $loading=$('#loadingImage');main.reply('loading:show',function(){return $loading.show();});main.reply('loading:hide',function(){return $loading.hide();});function readingSteiner(url,event){var nextState=state.read(url);if(_.isMatch(state.page.attributes,nextState))return;main.request('connection:lock');if(event)event.preventDefault();var split=url.split('#');var address=split[0]+(/\?/.test(split[0])?'&':'?')+'minimal=true';if(split.length!==1)address+='#'+split[1];$loading.show();var xhr=new XMLHttpRequest();xhr.open('GET',address);xhr.onload=function(){if(this.status!==200){$loading.hide();return alert(this.status);}if(baseURL(url)!==baseURL(this.responseURL))nextState=state.read(this.responseURL);main.request('postSM:feed','done');main.trigger('state:clear');main.$threads[0].innerHTML=this.response;state.page.set(nextState);main.oneeSama.op=nextState.thread;new Extract(nextState.catalog);if(!nextState.catalog){main.request('connection:unlock',[common.RESYNC,nextState.board,state.syncs,nextState.live]);}if(event){history.pushState(null,null,nextState.href);if(location.hash)main.request('scroll:aboveBanner');else window.scrollTo(0,0);}$loading.hide();};xhr.send();}function baseURL(url){return url.split(/[\?#]/)[0];}window.onpopstate=function(event){readingSteiner(event.target.location.href);main.request('scroll:aboveBanner');};

},{"./main":"main"}],11:[function(require,module,exports){
'use strict';var main=require('./main');var util=main.util;var follow=main.follow;var options=main.options;var oneeSama=main.oneeSama;var posts=main.state.posts;options.on({'change:thumbs':reRenderImages,'change:spoilers':toggleSpoilers,'change:autogif':toggleAutoGIF,'change:anonymise':toggleAnonymisation,'workModeTOG':reRenderImages});function reRenderImages(){if(main.state.page.get('catalog')){(function(){var show=options.get("thumbs")!=='hide'&&!main.oneeSama.workMode?'':'none';document.queryAll(".expanded").forEach(function(el){return el.style.display=show;});})();}else follow(function(){return getImages(function(image,model){return image&&model.dispatch('renderImage',image);});});}function getImages(func){posts.each(function(model){return func(model.get('image'),model);});}function toggleSpoilers(){follow(function(){return getImages(function(image,model){return image&&image.spoiler&&model.dispatch('renderImage',image);});});}function toggleAutoGIF(){follow(function(){return getImages(function(image,model){return image&&image.ext==='.gif'&&model.dispatch('renderImage',image);});});}function toggleAnonymisation(source,toggle){follow(function(){var command=toggle?'anonymise':'renderName';posts.each(function(model){var _model$attributes=model.attributes;var name=_model$attributes.name;var trip=_model$attributes.trip;if(name||trip)model.dispatch(command);});});}main.reply('loop:anonymise',function(){return options.get('anonymise')&&toggleAnonymisation(null,true);});

},{"./main":"main"}],12:[function(require,module,exports){
'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var main=require('./main');var _=main._;var Cookie=main.Cookie;var Memory=(function(){function Memory(key,expiry,needCookie){_classCallCheck(this,Memory);this.key=key;this.expiry=expiry;this.needCookie=needCookie;main.defer(this.purgeExpired.bind(this));}_createClass(Memory,[{key:'bakeCookie',value:function bakeCookie(object){if(!this.needCookie)return;var nums=Object.keys(object);nums.sort(function(a,b){return parseInt(a,10)-parseInt(b,10);});Cookie.set(this.key,nums.join('/'));}},{key:'now',value:function now(){return Math.floor(Date.now()/1000);}},{key:'purgeAll',value:function purgeAll(){localStorage.removeItem(this.key);if(this.needCookie)Cookie.remove(this.key);}},{key:'readAll',value:function readAll(){var key=localStorage.getItem(this.key);if(!key)return {};var val=undefined;try{val=JSON.parse(key);}catch(e) {}return _.isObject(val)?val:{};}},{key:'writeAll',value:function writeAll(object){if(_.isEmpty(object))return this.purgeAll();localStorage.setItem(this.key,JSON.stringify(object));this.bakeCookie(object);}},{key:'write',value:function write(key){var object=this.readAll();object[key]=this.now();this.writeAll(object);return _.size(object);}},{key:'size',value:function size(){return _.size(this.readAll());}},{key:'purgeExpired',value:function purgeExpired(){if(!this.expiry)return;var object=this.readAll();var now=this.now(),limit=86400*this.expiry;var expired=[];for(var key in object){var time=object[key];if(time&&now>time+limit)expired.push(key);}if(!expired.length)return;for(var i=0,lim=expired.length;i<lim;i++){delete object[expired[i]];}this.writeAll(object);}}]);return Memory;})();module.exports=Memory;

},{"./main":"main"}],13:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _main=require('main');var _opts=require('./opts');var _opts2=_interopRequireDefault(_opts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var options=undefined;try{options=JSON.parse(localStorage.options);}catch(e) {}if(!options)options={};exports.default=options=new _main.Backbone.Model(options);var OptionsCollection=_main.Backbone.Collection.extend({persist:function persist(){var opts={};this.forEach(function(model){var val=model.getValue();if(val===model.get('default'))return;opts[model.get('id')]=val;});localStorage.options=JSON.stringify(opts);}});var optionsCollection=new OptionsCollection();var OptionModel=_main.Backbone.Model.extend({initialize:function initialize(opts){if(opts.load!==undefined&&!opts.load)return;if(!opts.type)this.set('type','checkbox');var val=this.getValue();this.setValue(val);if(opts.exec!==undefined){this.listenTo(options,'change:'+opts.id,this.execListen);if(opts.execOnStart!==false)opts.exec(val);}optionsCollection.add(this);},setValue:function setValue(val){options.set(this.get('id'),val);},getValue:function getValue(){var val=options.get(this.get('id'));return val===undefined?this.get('default'):val;},validate:function validate(val){var valid=this.get('validation');return valid?valid(val):true;},execListen:function execListen(model,val){this.get('exec')(val);}});(function(){if(localStorage.getItem('options'))return;var $el=$('#options');$el.addClass('noOptions');function fadeout(){$el.filter('.noOptions').fadeOut(fadein);}function fadein(){$el.fadeIn();if($el.filter('.noOptions').length)fadeout();}fadeout();$el.click(function(){$el.removeClass('noOptions');});})();var OptionsView=_main.Backbone.View.extend({initialize:function initialize(){var _this=this;this.setElement(util.parseEl(require('./render')()));document.body.append(this.el);optionsCollection.each(function(model){var $el=_this.$el.find('#'+model.get('id'));if(!$el.length)return;var type=model.get('type'),val=model.getValue();if(type=='checkbox')$el.prop('checked',val);else if(type=='number'||type instanceof Array)$el.val(val);else if(type=='shortcut')$el.val(String.fromCharCode(val).toUpperCase());});this.$hidden=this.$el.find('#hidden');main.reply('hide:render',this.renderHidden,this);},events:{'click .option_tab_sel>li>a':'switchTab','change':'applyChange','click #export':'export','click #import':'import','click #hidden':'clearHidden'},switchTab:function switchTab(event){event.preventDefault();var $a=$(event.target);this.$el.children('.option_tab_sel').find('a').removeClass('tab_sel');$a.addClass('tab_sel');var $li=this.$el.children('.option_tab_cont').children('li');$li.removeClass('tab_sel');$li.filter('.'+$a.data('content')).addClass('tab_sel');},applyChange:function applyChange(event){var $target=$(event.target),model=optionsCollection.get($target.attr('id')),val;if(!model)return;var type=model.get('type');if(type=='checkbox')val=$target.prop('checked');else if(type=='number')val=parseInt($target.val());else if(type=='image')return main.request('background:store',event.target);else if(type=='shortcut')val=$target.val().toUpperCase().charCodeAt(0);else val=$target.val();if(!model.validate(val))return $target.val('');model.setValue(val);optionsCollection.persist();},export:function _export(){var a=document.getElementById('export');a.setAttribute('href',window.URL.createObjectURL(new Blob([JSON.stringify(localStorage)],{type:'octet/stream'})));a.setAttribute('download','meguca-config.json');},import:function _import(event){event.preventDefault();var $input=this.$el.find('#importSettings');$input.click();$input.one('change',function(){var reader=new FileReader();reader.readAsText($input[0].files[0]);reader.onload=function(e){var json;try{json=JSON.parse(e.target.result);}catch(e) {alert('Import failed. File corrupt');}if(!json)return;localStorage.clear();for(var key in json){localStorage[key]=json[key];}alert('Import successfull. The page will now reload.');location.reload(true);};});},renderHidden:function renderHidden(count){var $el=this.$hidden;$el.text($el.text().replace(/\d+$/,count));},clearHidden:function clearHidden(){main.request('hide:clear');this.renderHidden(0);}});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_opts2.default[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var spec=_step.value;new OptionModel(spec);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}main.defer(function(){new OptionsView();});

},{"./opts":14,"./render":15,"main":"main"}],14:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _main=require('main');var notMobile=!_main.isMobile;exports.default=opts=[{id:'lang',type:_main.config.lang.enabled,tab:0,default:_main.config.lang.default,execOnStart:false,exec:function exec(type){alert(_main.lang.langApplied);location.reload();}},{id:'inlinefit',type:['none','full','width','height','both'],tab:1,default:'width'},{id:'thumbs',type:_main.util.thumbStyles,tab:1,default:'small'},{id:'imageHover',default:true,load:notMobile,tab:0},{id:'webmHover',load:notMobile,tab:0},{id:'autogif',load:notMobile,tab:1},{id:'spoilers',tab:1,default:true},{id:'linkify',tab:0,default:true},{id:'notification',load:notMobile,tab:0,exec:function exec(notifToggle){if(notifToggle&&Notification.permission!=="granted")Notification.requestPermission();}},{id:'anonymise',tab:0},{id:'relativeTime',tab:0,default:true},{id:'nowPlaying',load:notMobile&&_main.config.radio,tab:3,default:true,exec:function exec(toggle){if(toggle){main.send({type:'radio'});}else {main.request('banner:radio:clear');}}}];var _arr=['google','iqdb','saucenao','desustorage','exhentai'];for(var _i=0;_i<_arr.length;_i++){var engine=_arr[_i];opts.push({id:engine,lang:'imageSearch',tab:2,default:engine==='google',exec:toggleHeadStyle(engine+'Toggle','.'+engine+'{display:initial;}')});}opts.push({id:'illyaBGToggle',load:notMobile&&_main.config.illyaDance,tab:3},{id:'illyaMuteToggle',load:notMobile&&_main.config.illyaDance,tab:3},{id:'horizontalPosting',tab:3,exec:toggleHeadStyle('horizontal','article,aside{display:inline-block;}')},{id:'replyright',tab:1,exec:toggleHeadStyle('reply-at-right','section>aside{margin: -26px 0 2px auto;}')},{id:'theme',type:['moe','gar','mawaru','moon','ashita','console','tea','higan','ocean','rave','tavern','glass'],tab:1,default:_main.config.defaultCSS,exec:function exec(theme){if(!theme){return;}document.getElementById('theme').setAttribute('href',_main.config.MEDIA_URL+'css/'+theme+'.css?v='+main.cssHash);}},{id:'userBG',load:notMobile,tab:1},{id:'userBGimage',load:notMobile,type:'image',tab:1,execOnStart:false,exec:function exec(upload){main.request('background:store',upload);}},{id:'lastn',type:'number',tab:0,validation:_main.util.resonableLastN,default:_main.config.posts.lastN},{id:'alwaysLock',tab:0});var shorts=[{id:'new',default:78},{id:'togglespoiler',default:73},{id:'textSpoiler',default:68},{id:'done',default:83},{id:'expandAll',default:69},{id:'workMode',default:66}];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=shorts[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var short=_step.value;short.type='shortcut';short.tab=4;short.load=notMobile;opts.push(short);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}function toggleHeadStyle(id,css){return function(toggle){if(!document.getElementById(id)){document.head.appendChild(_main.util.parseEl('<style id="'+id+'">'+css+'</style>'));}document.getElementById(id).disabled=!toggle;};}

},{"main":"main"}],15:[function(require,module,exports){
'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};})();var _templateObject=_taggedTemplateLiteral(['<input ','>'],['<input ','>']);Object.defineProperty(exports,"__esModule",{value:true});exports.default=render;var _main=require('main');function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var lang=main.lang.opts;function render(){var html='<div class="bmodal glass" id="options-panel">'+'<ul class="option_tab_sel">';var tabs=lang.tabs;var opts=[];var _loop=function _loop(i){opts[i]=_main._.filter(_main.options,function(opt){return opt.tab===i&&(opt.load===undefined||opt.load)&&!opt.hidden;});if(!opts[i].length){return 'continue';}html+='<li><a data-content="tab-'+i+'"';if(i===0){html+=' class="tab_sel"';}html+='>'+tabs[i]+'</a></li>';};for(var i=0;i<tabs.length;i++){var _ret=_loop(i);if(_ret==='continue')continue;}html+='</ul><ul class="option_tab_cont">';for(var i=0;i<opts.length;i++){html+=renderTab(opt,i);}html+='</ul></div>';return html;}function renderTab(opt,i){if(!opts[i].length){return '';}var html="";html+='<li class="tab-'+i;if(i===0){html+=' tab_sel';}html+='">';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=opts[i][Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _opt=_step.value;html+=renderOption(_opt);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}if(i===0){html+=renderExtras();}html+='</li>';return html;}function renderOption(opt){var html='';var isShortcut=opt.type==='shortcut',isList=opt.type instanceof Array,isCheckbox=opt.type==='checkbox'||opt.type===undefined,isNumber=opt.type==='number',isImage=opt.type==='image';if(isShortcut){html+='Alt+';}if(!isList){html+='<input';if(isCheckbox||isImage)html+=' type="'+(isCheckbox?'checkbox':'file')+'"';else if(isNumber)html+=' style="width: 4em;" maxlength="4"';else if(isShortcut)html+=' maxlength="1"';}else {html+='<select';}var _lang$opt$id=_slicedToArray(lang[opt.id],2);var label=_lang$opt$id[0];var title=_lang$opt$id[1];html+=' id="'+opt.id+'" title="'+title+'">';if(isList){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=opt.type[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var item=_step2.value;html+='<option value="'+item+'">'+(lang[item]||item)+'</option>';}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}html+='</select>';}html+='<label for="'+opt.id+'" title="'+title+'">'+label+'</label><br>';return html;}function renderExtras(){var html='<br>';var links=['export','import','hidden'];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=links[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var id=_step3.value;var _lang$id=_slicedToArray(lang[id],2);var label=_lang$id[0];var title=_lang$id[1];html+='<a id="'+id+'" title="'+ln[1]+'">'+ln[0]+'</a> ';}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}var attrs={type:'file',id:'importSettings',name:"Import Settings"};html+=common.parseHTML(_templateObject,attrs);return html;}

},{"main":"main"}],16:[function(require,module,exports){
'use strict';var main=require('../main');var PostCommon=require('./common');var _=main._;var Backbone=main.Backbone;module.exports=PostCommon.extend({tagName:'article',render:function render(){this.setElement(main.oneeSama.article(this.model.attributes));return this;},insertIntoDOM:function insertIntoDOM(){_.last(document.query('#p'+this.model.get('op')).queryAll('article')).after(this.el);this.autoExpandImage().fun();}});

},{"../main":"main","./common":17}],17:[function(require,module,exports){
'use strict';var main=require('../main');var imager=require('./imager');var _=main._;var Backbone=main.Backbone;var common=main.common;var util=main.util;var lang=main.lang;var oneeSama=main.oneeSama;var options=main.options;var state=main.state;module.exports=imager.Hidamari.extend({className:'glass',initialize:function initialize(){this.listenTo(this.model,'dispatch',this.redirect);},clientInit:function clientInit(){if(options.get('anonymise'))this.anonymise();return this;},redirect:function redirect(command){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}this[command].apply(this,args);},updateBody:function updateBody(frag){if(!this.blockquote)this.blockquote=this.el.query('blockquote');var model=this.model.attributes;this.blockquote.innerHTML=oneeSama.setModel(model).body(model.body);},renderTime:function renderTime(){this.el.query('time').outerHTML=oneeSama.time(this.model.get('time'));},renderBacklinks:function renderBacklinks(links){this.el.query('small').innerHTML=oneeSama.backlinks(links);},fun:function fun(){},anonymise:function anonymise(){this.el.query('.name').innerHTML='<b class="name">'+lang.anon+'<b>';},renderName:function renderName(){this.el.query('.name').outerHTML=oneeSama.name(this.model.attributes);},renderModerationInfo:function renderModerationInfo(info){var el=this.getContainer();el.query('.modLog').remove();el.query('blockquote').before(util.parseDOM(oneeSama.modInfo(info)));},getContainer:function getContainer(){return this.el.query('.container');},renderBan:function renderBan(){var el=this.getContainer();el.query('.banMessage').remove();el.query('blockquote').after(util.parseDOM(oneeSama.banned()));},renderEditing:function renderEditing(editing){var el=this.el;if(editing)el.classList.add('editing');else {el.classList.remove('editing');el.query('blockquote').normalize();}}});

},{"../main":"main","./imager":20}],18:[function(require,module,exports){
'use strict';var main=require('../main');var $=main.$;var util=main.util;var youtube_url_re=exports.youtube_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtube\.com\/watch\/?\?((?:[^\s#&=]+=[^\s#&]*&)*)?v=([\w-]{11})((?:&[^\s#&=]+=[^\s#&]*)*)&?(#t=[\dhms]{1,9})?/,youtube_short_re=exports.youtube_short_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtu.be\/([\w-]{11})\??(t=[\dhms]{1,9})?/,youtube_time_re=exports.youtube_time_re=/^#t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/,youtube_short_time_re=exports.youtube_short_time_re=/^t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/;function make_video(id,params,start){if(!params)params={allowFullScreen:'true'};params.allowScriptAccess='always';var query={autohide:1,fs:1,modestbranding:1,origin:document.location.origin,rel:0,showinfo:0};if(start)query.start=start;if(params.autoplay)query.autoplay=params.autoplay;if(params.loop){query.loop='1';query.playlist=id;}return $('<iframe></iframe>',{type:'text/html',src:encodeURI('https://www.youtube.com/embed/'+id)+'?'+$.param(query),frameborder:'0',attr:video_dims(),class:'youtube-player'});}function video_dims(){if(window.screen&&screen.width<=320)return {width:250,height:150};else return {width:560,height:340};}main.$threads.on('click','.watch',function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;var $target=$(e.target);if(!$target.is('a'))return;var $video=$target.find('iframe');if($video.length){$video.siblings('br').andSelf().remove();$target.css('width','auto');return false;}if($target.data('noembed'))return;var m=$target.attr('href').match(youtube_url_re);if(!m){m=$target.attr('href').match(youtube_short_re);if(!m)return;timeCall(m[1],m[2],youtube_short_time_re);}timeCall(m[2],m[4],youtube_time_re);function timeCall(url,time,timeRex){var start=0;if(time){var t=time.match(timeRex);if(t){if(t[1])start+=parseInt(t[1],10)*3600;if(t[2])start+=parseInt(t[2],10)*60;if(t[3])start+=parseInt(t[3],10);}}$target.css('width',video_dims().width).append('<br>',make_video(url,null,start));}return false;});main.$threads.on('mouseenter','.watch',function(event){var $target=$(event.target);if($target.data('requestedTitle'))return;$target.data('requestedTitle',true);var node=$target.contents().filter(function(){return this.nodeType===3;})[0];if(!node)return;var orig=node.textContent;node.textContent=orig+'...';var m=$target.attr('href').match(youtube_url_re);if(!m){m=$target.attr('href').match(youtube_short_re);if(!m)return;$.ajax({url:'//gdata.youtube.com/feeds/api/videos/'+m[1],data:{v:'2',alt:'jsonc'},dataType:'json',success:gotInfo,error:function error(){node.textContent=orig+'???';}});}$.ajax({url:'//gdata.youtube.com/feeds/api/videos/'+m[2],data:{v:'2',alt:'jsonc'},dataType:'json',success:gotInfo,error:function error(){node.textContent=orig+'???';}});function gotInfo(data){var title=data&&data.data&&data.data.title;if(title){node.textContent=orig+': '+title;$target.css({color:'black'});}else node.textContent=orig+' (gone?)';if(data&&data.data&&data.data.accessControl&&data.data.accessControl.embed==='denied'){node.textContent+=' (EMBEDDING DISABLED)';$target.data('noembed',true);}}});function make_embed(uri,params,dims){var $obj=$('<object/>',{attr:dims});for(var name in params){$('<param/>',{attr:{name:name,value:params[name]}}).appendTo($obj);}$('<embed/>',{src:uri,type:'application/x-shockwave-flash'}).attr(dims).attr(params).appendTo($obj);return $obj;}var soundcloud_url_re=exports.soundcloud_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.)?soundcloud\.com\/([\w-]{1,40}\/[\w-]{1,80})\/?/;function fetchSoundcloud(target,width,cb){var url='https://soundcloud.com/oembed?url='+encodeURIComponent(target.getAttribute('href'))+('&maxwidth='+width+'&maxheight=166&auto_play=true&format=json')+'&show_comments=false';var xhr=new XMLHttpRequest();xhr.open('GET',url);xhr.responseType='json';xhr.onload=function(){if(this.status!==200)return cb(this.status);cb(null,this.response);};xhr.send();}main.$threads.on('click','.soundcloud',function(e){if(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;var target=e.target;var iframe=target.query('iframe');e.preventDefault();if(iframe){iframe.previousElementSibling.remove();iframe.remove();return;}var width=Math.round(window.innerWidth*0.75);fetchSoundcloud(target,width,function(err,json){if(err)return alert(err);target.append(document.createElement('br'));target.append(util.parseDOM(json.html));target.style.width=width+'px';});});main.$threads.on('mouseenter','.soundcloud:not(.fetched)',function(event){var target=event.target;var node=target.firstChild;var text=node.textContent;node.textContent=text+' ...';fetchSoundcloud(target,1000,function(err,json){if(err)return node.textContent=text+': Error: '+err;node.textContent=text+': '+json.title;target.style.color='black';target.classList.add('fetched');});});var pastebin_re=exports.pastebin_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?pastebin\.com\/(.*)/;$(document).on('click','.pastebin',function(event){if(event.which>1||event.ctrlKey||event.altKey||event.shiftKey||event.metaKey)return;var $target=$(event.target);var $obj=$target.find('iframe');if($obj.length){$obj.siblings('br').andSelf().remove();$target.css({width:'auto',height:'auto'});return false;}var m=$target.attr('href').match(pastebin_re);if(!m)return;var $window=$(window),width=Math.round($window.innerWidth()*0.65),height=Math.round($window.innerHeight()*0.65);$target.css({width:width,height:height}).append('<br>',$('<iframe></iframe>',{type:'text/html',src:'https://pastebin.com/embed_iframe.php?i='+m[1],frameborder:'0',width:width,height:height}));return false;});

},{"../main":"main"}],19:[function(require,module,exports){
'use strict';var main=require('../main');var $=main.$;var $script=main.$script;var $email=main.$email;var $name=main.$name;var _=main._;var common=main.common;var config=main.config;function load(){try{var id=JSON.parse(localStorage.ident);if(id.name)$name.val(id.name);if(id.email)$email.val(id.email);}catch(e) {}}var save=_.debounce(function(){try{var name=$name.val();var email=$email.val();if(email===config.LOGIN_KEYWORD){$email.val('');$script(config.MEDIA_URL+'js/login.js?v='+main.clientHash);email=false;}if(name||email){var id={};if(name)id.name=name;if(email)id.email=email;localStorage.ident=JSON.stringify(id);}else localStorage.removeItem('ident');}catch(e) {}},1000);function propagate(){var postForm=main.request('postForm');if(postForm)postForm.renderIdentity();save();}main.defer(function(){load();$name.on('input',propagate);$email.on('input',propagate);});

},{"../main":"main"}],20:[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<',' ','>'],['<',' ','>']),_templateObject2=_taggedTemplateLiteral(['<audio src="','"\n\t\t\t\twidth="300"\n\t\t\t\theight="3em"\n\t\t\t\tautoplay loop controls\n\t\t\t>\n\t\t\t</audio>'],['<audio src="','"\n\t\t\t\twidth="300"\n\t\t\t\theight="3em"\n\t\t\t\tautoplay loop controls\n\t\t\t>\n\t\t\t</audio>']);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('../main');var $threads=main.$threads;var _=main._;var Backbone=main.Backbone;var common=main.common;var util=main.util;var oneeSama=main.oneeSama;var options=main.options;var state=main.state;exports.Hidamari=Backbone.View.extend({renderImage:function renderImage(arg,image,manual){var reveal=arg===true;var model=this.model;var el=this.el;if(!image||!image.src)image=model.get('image');var figure=el.query('figure');if(figure)figure.remove();if(!image)return;el.query('blockquote').before(util.parseDOM(oneeSama.image(image,reveal)));if(manual&&model.get('tallImage')){window.scrollTop=el.getBoundingClientRect().top+document.body.scrollTop-document.query('#banner').height;}model.set({thumbnailRevealed:reveal,imageExpanded:false,tallImage:false});},autoExpandImage:function autoExpandImage(){var img=this.model.get('image');if(!img||!massExpander.get('expand')||['.webm','.pdf','.mp3'].indexOf(img.ext)>-1)return this;this.toggleImageExpansion(true,img);return this;},toggleImageExpansion:function toggleImageExpansion(expand,img,manual){var fit=options.get('inlinefit');if(!img||fit==='none')return;if(expand)this.fitImage(img,fit);else this.renderImage(null,img,manual);},fitImage:function fitImage(img,fit){if(img.ext==='.pdf')return window.open(oneeSama.imagePaths().src+img.src,'_blank');if(img.ext==='.mp3')return this.renderAudio(img);var newWidth=undefined,newHeight=undefined,width=newWidth=img.dims[0],height=newHeight=img.dims[1];if(fit==='full')return this.expandImage(img,{width:width,height:height});var both=fit==='both',widthFlag=both||fit==='width',heightFlag=both||fit==='height',aspect=width/height;var fullWidth=undefined,fullHeight=undefined;if(widthFlag){var maxWidth=this.imageMaxWidth();if(newWidth>maxWidth){newWidth=maxWidth;newHeight=newWidth/aspect;fullWidth=true;}}if(heightFlag){var maxHeight=window.innerHeight-document.query('#banner').offsetHeight;if(newHeight>maxHeight){newHeight=maxHeight;newWidth=newHeight*aspect;fullHeight=true;}}if(newWidth>50&&newHeight>50){width=newWidth;height=newHeight;}this.expandImage(img,width,height,fullHeight&&!fullWidth);},imageMaxWidth:function imageMaxWidth(){var el=this.el;var model=this.model;return window.innerWidth-parseInt(el.closest('section').getBoundingClientRect().left)*2-util.outerWidth(model.get('op')?el:el.query('.background'));},expandImage:function expandImage(img,width,height,noMargin){var isVideo=img.ext==='.webm';var attrs={src:oneeSama.imagePaths().src+img.src,width:width,height:height};var cls='expanded';if(noMargin)cls+=' noMargin';attrs.class=cls;if(isVideo)attrs.autoplay=attrs.loop=attrs.controls=true;this.el.query('figure').lastChild.innerHTML=common.parseHTML(_templateObject,isVideo?'video':'img',attrs);this.model.set({imageExpanded:true,tallImage:height>window.innerHeight});},renderAudio:function renderAudio(img){this.el.query('figure').append(util.parseDOM(common.parseHTML(_templateObject2,oneeSama.imagePaths().src+img.src)));this.model.set('imageExpanded',true);}});var ExpanderModel=Backbone.Model.extend({initialize:function initialize(){var _this=this;$threads.on('click','#expandImages',function(e){e.preventDefault();_this.toggle();});},toggle:function toggle(){var expand=!this.get('expand');this.set('expand',expand).massToggle(expand);$threads.find('#expandImages').text(main.lang.expander[+expand]);},massToggle:function massToggle(expand){var fit=options.get('inlinefit');if(fit==='none')return;var models=state.posts.models;for(var i=0,l=models.length;i<l;i++){var model=models[i],img=model.get('image');if(!img)continue;if(expand)model.dispatch('fitImage',img,fit);else model.dispatch('renderImage',null,img);}}});var massExpander=exports.massExpander=new ExpanderModel();main.reply('massExpander:unset',function(){return massExpander.unset();});$threads.on('click','img, video',function(e){if(options.get('inlinefit')=='none'||e.which!==1)return;var model=util.getModel(e.target);if(!model)return;e.preventDefault();main.request('imager:clicked');model.dispatch('toggleImageExpansion',!model.get('imageExpanded'),model.get('image'),true);});$threads.on('click','.imageToggle',function(e){e.preventDefault();var model=util.getModel(e.target);if(!model)return;main.follow(function(){return model.dispatch('renderImage',!model.get('thumbnailRevealed'));});});

},{"../main":"main"}],21:[function(require,module,exports){
'use strict';module.exports={imager:require('./imager'),Menu:require('./menu'),common:require('./common'),Article:require('./article'),Section:require('./section'),models:require('./models'),nonce:require('./nonce'),embed:require('./embed'),posting:require('./posting')};

},{"./article":16,"./common":17,"./embed":18,"./imager":20,"./menu":22,"./models":23,"./nonce":24,"./posting":25,"./section":26}],22:[function(require,module,exports){
'use strict';var main=require('../main');var $=main.$;var _=main._;var Backbone=main.Backbone;var common=main.common;var util=main.util;var lang=main.lang;var state=main.state;var MenuView=module.exports=Backbone.View.extend({className:'popup-menu glass',tagName:'ul',actions:['report','hide'],events:{click:'handleClick'},initialize:function initialize(_ref){var parent=_ref.parent;parent._popup_menu=this;this.parent=parent;this.render();},render:function render(){var html='';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.actions[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var action=_step.value;html+='<li data-type="'+action+'">'+lang[action]+'</li>';}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}var el=this.el;var parent=this.parent;el.innerHTML=html;parent.append(el);el.style.left=el.getBoundingClientRect().left-(util.outerWidth(el)+el.offsetWidth)*0.6+'px';},handleClick:function handleClick(e){e.stopPropagation();main.request(e.target.getAttribute('data-type'),this.model);this.remove();},remove:function remove(){this.parent._popup_menu=null;this.el.remove();this.stopListening();}});main.reply('menu:extend',function(action){return _.extend(MenuView.prototype.actions,action);});main.$threads.on('click','.control',function(event){var target=event.target;if(target._popup_menu)return target._popup_menu.remove();var model=util.getModel(target);if(model)new MenuView({parent:target,model:model});});

},{"../main":"main"}],23:[function(require,module,exports){
'use strict';var main=require('../main');var _=main._;var Backbone=main.Backbone;var state=main.state;exports.Post=Backbone.Model.extend({idAttribute:'num',initialize:function initialize(){state.posts.add(this);},dispatch:function dispatch(command){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}this.trigger.apply(this,['dispatch',command].concat(args));},remove:function remove(){this.stopListening().dispatch('remove');state.posts.remove(this);},update:function update(frag,links,dice){var updates={body:this.get('body')+frag};if(links)_.extend(this.get('links'),links);if(dice)updates.dice=(this.get('dice')||[]).concat(dice);this.set(updates);},setImage:function setImage(image,silent){this.set('image',image);if(!silent)this.dispatch('renderImage',image);},setSpoiler:function setSpoiler(spoiler,info){var image=this.get('image');image.spoiler=spoiler;this.dispatch('renderImage',image);this.moderationInfo(info);},removeImage:function removeImage(info){this.moderationInfo(info)||this.unset('image').dispatch('renderImage');},deletePost:function deletePost(info){this.moderationInfo(info)||this.remove();},setBan:function setBan(display,info){if(display)this.set('ban',true).dispatch('renderBan');this.moderationInfo(info);},addBacklink:function addBacklink(num,op){var backlinks=this.get('backlinks')||{};backlinks[num]=op;this.set({backlinks:backlinks}).dispatch('renderBacklinks',backlinks);},moderationInfo:function moderationInfo(info){if(!info)return false;var mod=this.get('mod')||[];mod.push(info);this.set('mod',mod).dispatch('renderModerationInfo',mod);return true;}});exports.Thread=exports.Post.extend({defaults:{replies:[],omit:0,image_omit:0},initialize:function initialize(){if(this.get('omit'))this.getImageOmit();state.posts.add(this);},remove:function remove(){this.stopListening().dispatch('remove');state.posts.remove(this);var replies=this.get('replies');for(var i=0,lim=replies.length;i<lim;i++){var model=state.posts.get(replies[i]);if(model)model.remove();}},getImageOmit:function getImageOmit(){var image_omit=this.get('imgctr')-1;var replies=this.get('replies');for(var i=0,lim=replies.length;i<lim;i++){var model=state.posts.get(replies[i]);if(!model)continue;if(model.get('image'))image_omit--;}this.set('image_omit',image_omit);},toggleLocked:function toggleLocked(val,info){this.moderationInfo(info);this.set('locked',val).dispatch('renderLocked',val);}});

},{"../main":"main"}],24:[function(require,module,exports){
'use strict';var main=require('../main');var common=main.common;var state=main.state;var nonceCache={};function get(){var nonces;if(window.localStorage){try{nonces=JSON.parse(localStorage.postNonces);}catch(e) {}}else nonces=nonceCache;return nonces||{};}main.reply('nonce:get',get);function save_nonces(nonces){if(window.localStorage)localStorage.postNonces=JSON.stringify(nonces);else nonceCache=nonces;}function today_id(){return Math.floor(Date.now()/(1000*60*60*24));}function create(){var nonces=get(),nonce=common.randomID(32);nonces[nonce]={tab:state.page.get('tabID'),day:today_id()};save_nonces(nonces);return nonce;}main.reply('nonce:create',create);setTimeout(function(){if(!window.localStorage)return;var nonces=get();var changed=undefined;var yesterday=today_id()-1;for(var nonce in nonces){if(nonces[nonce].day>=yesterday)continue;delete nonces[nonce];changed=true;}if(changed)save_nonces(nonces);},Math.floor(Math.random()*5000));function destroy(nonce){setTimeout(function(){var nonces=get();if(!nonces[nonce])return;delete nonces[nonce];save_nonces(nonces);},10000);}main.reply('nonce:destroy',destroy);

},{"../main":"main"}],25:[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<header>\n\t\t\t\t<a class="name nope" target="_blank">\n\t\t\t\t\t<b></b>\n\t\t\t\t</a>\n\t\t\t</header>\n\t\t\t<span class="oi control" data-glyph="chevron-bottom"></span>\n\t\t\t<div class="container">\n\t\t\t\t<blockquote>\n\t\t\t\t\t<p id="buffer" class="exclude"></p>\n\t\t\t\t\t<p id="lineBuffer" class="exclude"></p>\n\t\t\t\t\t<textarea ','></textarea>\n\t\t\t\t</blockquote>\n\t\t\t\t<form ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<strong id="uploadStatus"></strong>\n\t\t\t\t</form>\n\t\t\t\t<small></small>\n\t\t\t</div>'],['<header>\n\t\t\t\t<a class="name nope" target="_blank">\n\t\t\t\t\t<b></b>\n\t\t\t\t</a>\n\t\t\t</header>\n\t\t\t<span class="oi control" data-glyph="chevron-bottom"></span>\n\t\t\t<div class="container">\n\t\t\t\t<blockquote>\n\t\t\t\t\t<p id="buffer" class="exclude"></p>\n\t\t\t\t\t<p id="lineBuffer" class="exclude"></p>\n\t\t\t\t\t<textarea ','></textarea>\n\t\t\t\t</blockquote>\n\t\t\t\t<form ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<input ','>\n\t\t\t\t\t<strong id="uploadStatus"></strong>\n\t\t\t\t</form>\n\t\t\t\t<small></small>\n\t\t\t</div>']);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var Article=require('./article');var main=require('../main');var embed=require('./embed');var ident=require('./identity');var imager=require('./imager');var $=main.$;var _=main._;var Backbone=main.Backbone;var Cookie=main.Cookie;var common=main.common;var config=main.config;var connSM=main.connSM;var util=main.util;var lang=main.lang;var oneeSama=main.oneeSama;var options=main.options;var postSM=main.postSM;var state=main.state;var postForm=undefined,postModel=undefined;main.reply('postForm',function(){return postForm;}).reply('postModel',function(){return postModel;}).reply('postForm:indentity',function(){return postForm&&postForm.renderIdentity();});var inputMinSize=300;if(window.screen&&screen.width<=320)inputMinSize=50;var ComposerModel=Backbone.Model.extend({idAttribute:'num'});connSM.on('synced',postSM.feeder('sync'));connSM.on('dropped',postSM.feeder('desync'));connSM.on('desynced',postSM.feeder('desync'));main.reply('postSM:feed',function(state){return postSM.feed(state);});postSM.act('* + desync -> none',function(){if(postForm){postForm.el.classList.remove('editing');postForm.$input.val('');postForm.finish();}main.$threads.find('aside.posting').hide();});postSM.act('none + sync, draft, alloc + done -> ready',function(){if(postForm){postForm.remove();postForm=postModel=null;}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=main.$threads[0].queryAll('aside.posting')[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var el=_step.value;el.style.display='';}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}});postSM.act('ready + new -> draft',function(aside){var op=undefined,section=aside.closest('section');if(section)op=util.getNum(section);else section=document.createElement('section');if(op&&!state.page.get('thread'))state.posts.get(op).dispatch('shiftReplies',true);postForm=new ComposerView({model:postModel=new ComposerModel({op:op}),destination:aside,section:section});});postSM.preflight('draft',function(aside){return aside.matches('aside');});postSM.act('draft + alloc -> alloc',function(msg){return postForm.onAllocation(msg);});main.dispatcher[common.IMAGE_STATUS]=function(msg){return postForm&&postForm.dispatch(msg[0]);};main.$doc.on('click','aside.posting a',function(){postSM.feed('new',this.parentNode);});main.$doc.on('keydown',handle_shortcut);function handle_shortcut(event){if(!event.altKey)return;var opts=options.attributes;switch(event.which){case opts.new:var aside=document.query('aside.posting');if(aside){postSM.feed('new',aside);prevent();}break;case opts.togglespoiler:if(postForm){postForm.onToggle(event);prevent();}break;case opts.done:if(postForm&&!postForm.$submit.attr('disabled')){postForm.finish();prevent();}break;case opts.textSpoiler:if(postForm){var postState=this.imouto.state2.spoiler;var sp=(postState?'[/':' [')+'spoiler]';this.imouto.state2.spoiler=!postState;this.$input.val(this.$input.val()+sp);prevent();}break;case opts.expandAll:imager.massExpander.toggle();prevent();break;case opts.workMode:var val=main.oneeSama.workMode=!main.oneeSama.workMode;Cookie.set('workModeTOG',val);var banner=document.querySelector("h1 > img");if(banner!=null)banner.style.display=val?'none':'';document.getElementById('theme').setAttribute('href',config.MEDIA_URL+'css/'+(val?state.hotConfig.get('DEFAULT_CSS'):main.options.get("theme"))+'.css?v='+main.cssHash);oneeSama.thumbStyle=val?'hide':main.options.get('thumbs');main.options.trigger("workModeTOG");window.addEventListener('beforeunload',function(){Cookie.set("workModeTOG",false);});prevent();break;}function prevent(){event.stopImmediatePropagation();event.preventDefault();}}main.oneeSama.hook('insertOwnPost',function(_ref){var links=_ref.links;if(!postForm||!links)return;postForm.$buffer.find('.nope').each(function(){var $a=$(this);var text=$a.text(),m=text.match(/^>>(\d+)/);if(!m)return;var num=m[1],op=links[num];if(!op)return;var $ref=$(common.join([postForm.imouto.postRef(num,op,false)]));$a.attr('href',$ref.attr('href')).attr('class','history');var refText=$ref.text();if(refText!=text)$a.text(refText);});});var ArticleComposer=Article.extend({events:{'click #cancel':'cancel','change #imageInput':'onImageChosen','input #trans':'onInput','keydown #trans':'onKeyDown','click #done':'finish','click #toggle':'onToggle'},initialize:function initialize(args){Article.prototype.initialize.call(this);this.listenTo(this.model,{'change':this.renderButtons,'change:spoiler':this.renderSpoilerPane});this.render(args).insertIntoDOM(args);this.model.set({spoiler:0,nextSpoiler:-1});this.pending='';this.line_count=1;this.char_count=0;var imouto=this.imouto=new common.OneeSama({callback:inject,op:state.page.get('thread'),blockqoute:this.blockqoute,eLinkify:main.oneeSama.eLinkify,lang:main.lang,tamashii:function tamashii(num){var section=document.query('#p'+num);section=section&&section.closest('section');if(section){var desc=num in state.mine.readAll()&&lang.you;return this.postRef(num,util.getNum(section),desc);}else return '<a class="nope">&gt;&gt;'+num+'</a>';}});imouto.setModel(this.model);},render:function render(){var attrs={input:{name:'body',id:'input',rows:1,class:'themed exclude',autocomplete:main.isMobile},form:{method:'post',enctype:'multipart/form-data',target:'upload',id:'uploadForm'},cancel:{type:'buttom',value:lang.cancel,id:'cancel'},imageInput:{type:'file',id:'imageInput',name:'image',accept:'image/*;.webm;.pdf;.mp3'},toggle:{type:'button',id:'toggle'}};this.el.innerHTML=parseHTML(_templateObject,attrs.input,attrs.form,attrs.cancel,attrs.imageInput,attrs.toggle);var els=['buffer','lineBuffer','input','uploadForm','cancel','imageInput','toggle','uploadStatus','hiddenUpload','sizer'];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=els[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var el=_step2.value;this[el]=document.query('#'+el);}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}this.renderIdentity();return this;},renderIdentity:function renderIdentity(){if(this.model.get('num'))return;var parsed=common.parse_name(main.$name.val(),main.$email.val()),haveTrip=!!(parsed[1]||parsed[2]);var el=this.el.query('.name'),name=el.query('a');if(parsed[0])name.textContent=parsed[0]+' ';else name.tetxContent=haveTrip?'':lang.anon;if(haveTrip)util.parseDOM(' <code>!?</code>').forEach(function(el){return name.after(el);});main.oneeSama.trigger('fillMyName',name);var email=main.$email.val().trim();if(email){el.setAttribute('href','mailto:'+email);el.classList.remove('nope');el.classList.add('email');}else {el.removeAttribute('href');el.classList.add('nope');el.classList.remove('email');}},insertIntoDOM:function insertIntoDOM(_ref2){var destination=_ref2.destination;destination.before(this.el);this.resizeInput();main.$threads.queryAll('aside.postsing').forEach(function(el){return el.style.display='none';});this.fun();},resizeInput:function resizeInput(val){var sizer=this.sizer;var input=this.input;if(typeof val!=='string')val=input.value;sizer.textContent=val;var size=sizer.width+common.INPUT_ROOM;size=Math.max(size,inputMinSize-input.getBoundingClientRect().left-this.el.getBoundingClientRect().left);this.input.style.width=size+'px';},renderButtons:function renderButtons(){var _model$attributes=this.model.attributes;var num=_model$attributes.num;var uploading=_model$attributes.uploading;var uploaded=_model$attributes.uploaded;var uploadStatus=_model$attributes.uploadStatus;var sentAllocRequest=_model$attributes.sentAllocRequest;var allocWait=sentAllocRequest&&!num;this.submit.disabled=!!(uploading||allocWait);if(uploaded)this.submit.style.marginLeft=0;this.cancel.disabled=!!allocWait;this.cancel.style.display=!num||uploading?'':'none';this.imageInput.disabled=!!uploading;this.uploadStatus.innerHTML=uploadStatus;},renderSpoilerPane:function renderSpoilerPane(model,spoiler){var background=spoiler?config.MEDIA_URL+'spoil/spoil'+spoiler+'.png':config.MEDIA_URL+'css/ui/pane.png';this.toggle.style.backgroundImage='url("'+background+'")';}});var ComposerView=Backbone.View.extend({events:{'input #trans':'onInput','keydown #trans':'onKeyDown','click #done':'finish','click #toggle':'onToggle'},initialize:function initialize(args){this.listenTo(this.model,{'change':this.renderButtons,'change:spoiler':this.renderSpoilerPane});this.render(args);this.pending='';this.line_count=1;this.char_count=0;var imouto=this.imouto=new common.OneeSama({callback:inject,op:state.page.get('thread'),state:[common.S_BOL,0],state2:{spoiler:0},$buffer:this.$buffer,eLinkify:main.oneeSama.eLinkify,lang:main.lang,tamashii:function tamashii(num){var section=document.query('#p'+num);section=section&&section.closest('section');if(section){var desc=num in state.mine.readAll()&&this.lang.you;return this.postRef(num,util.getNum(section),desc);}else return '<a class="nope">&gt;&gt;'+num+'</a>';}});imouto.hook('spoilerTag',util.touchable_spoiler_tag);main.oneeSama.trigger('imouto',imouto);},render:function render(_ref3){var destination=_ref3.destination;var section=_ref3.section;var op=this.model.get('op');this.setElement(op?document.createElement('article'):section);this.isThread=!op;this.$buffer=$('<p/>');this.$lineBuffer=$('<p/>');this.$meta=$('<header><a class="nope"><b/></a> <time/></header>');this.$input=$('<textarea/>',{name:'body',id:'trans',rows:'1',class:'themed',autocomplete:main.isMobile});this.$submit=$('<input/>',{id:'done',type:'button',value:main.lang.done});this.$subject=$('<input/>',{id:'subject',class:'themed',maxlength:state.hotConfig.SUBJECT_MAX_LENGTH,width:'80%'});this.$blockquote=$('<blockquote/>');this.$sizer=$('<pre/>').appendTo('body');this.$blockquote.append(this.$buffer,this.$lineBuffer,this.$input);this.$el.append(this.$meta,this.$blockquote,'<small/>');if(this.isThread){this.$el.append('<label for="subject">'+lang.subject+': </label>',this.$subject);this.$blockquote.hide();}this.$uploadForm=this.renderUploadForm();this.$el.append(this.$uploadForm);main.oneeSama.trigger('draft',this.$el);this.renderIdentity();destination.style.display='none';if(this.isThread){destination.after(this.el);this.el.after(document.createElement('hr'));this.$subject.focus();}else {destination.before(this.el);this.resizeInput();this.$input.focus();}main.$threads.find('aside.posting').hide();this.fun();},renderIdentity:function renderIdentity(){if(this.model.get('num'))return;var parsed=common.parse_name(main.$name.val(),main.$email.val()),haveTrip=!!(parsed[1]||parsed[2]);var $b=this.$meta.find('b');if(parsed[0])$b.text(parsed[0]+' ');else $b.text(haveTrip?'':main.lang.anon);if(haveTrip)$b.append(' <code>!?</code>');main.oneeSama.trigger('fillMyName',$b);var email=main.$email.val().trim();var $tag=this.$meta.children('a').first();if(email){$tag.attr({href:'mailto:'+email,target:'_blank',class:'email'});}else $tag.removeAttr('href').removeAttr('target').attr('class','nope');},renderButtons:function renderButtons(){var attrs=this.model.attributes,allocWait=attrs.sentAllocRequest&&!attrs.num,d=attrs.uploading||allocWait;this.$submit.prop('disabled',!!d);if(attrs.uploaded)this.$submit.css({'margin-left':'0'});this.$cancel.prop('disabled',!!allocWait);this.$cancel.toggle(!!(!attrs.num||attrs.uploading));this.$imageInput.prop('disabled',!!attrs.uploading);this.$uploadStatus.html(attrs.uploadStatus);},renderSpoilerPane:function renderSpoilerPane(model,sp){var background=sp?config.MEDIA_URL+'spoil/spoil'+sp+'.png':config.MEDIA_URL+'css/ui/pane.png';this.$toggle.css('background-image','url("'+background+'")');},renderUploadForm:function renderUploadForm(){var $form=$('<form method="post" enctype="multipart/form-data" '+'target="upload"></form>');this.$cancel=$('<input/>',{type:'button',value:lang.cancel,click:$.proxy(this,'cancel')});this.$imageInput=$('<input/>',{type:'file',id:'image',name:'image',accept:config.WEBM?'imager/*;.webm':'image/*',change:$.proxy(this,'onImageChosen')});this.$toggle=$('<input/>',{type:'button',id:'toggle'});this.$uploadStatus=$('<strong/>');$form.append(this.$cancel,this.$imageInput,this.$toggle,' ',this.$uploadStatus);this.$iframe=$('<iframe/>',{src:'',name:'upload',id:'hidden-upload'}).appendTo('body');this.model.set({spoiler:0,nextSpoiler:-1});return $form;},cancel:function cancel(){if(this.model.get('uploading')){this.$iframe.remove();this.$iframe=$('<iframe></iframe>',{src:'',name:'upload',id:'hidden-upload'}).appendTo('body');this.uploadError('');this.model.set({cancelled:true});}else this.finish();},onImageChosen:function onImageChosen(){if(this.model.get('uploading')||this.model.get('uploaded'))return;if(!this.$imageInput.val()){this.model.set('uploadStatus','');return;}var extra=this.prepareUpload();for(var k in extra){$('<input type=hidden>').attr('name',k).val(extra[k]).appendTo(this.$uploadForm);}this.$uploadForm.prop('action',util.uploadURL());this.$uploadForm.submit();this.$iframe.load(function(){if(!postForm)return;var doc=this.contentWindow||this.contentDocument;if(!doc)return;try{var error=$(doc.document||doc).text();if(/legitimate imager response/.test(error))return;if(error.length<5||error.length>100)error=lang.unknownUpload;postForm.uploadError(error);}catch(e) {setTimeout(function(){postForm.uploadFallbackMessage();},500);}});this.notifyUploading();},prepareUpload:function prepareUpload(){this.model.set('uploadStatus',lang.uploading);this.$input.focus();var attrs=this.model.attributes;return {spoiler:attrs.spoiler,op:attrs.op||0};},uploadFallbackMessage:function uploadFallbackMessage(){var a=this.model.attributes,stat=a.uploadStatus;if(!a.cancelled&&a.uploading&&(!stat||stat==lang.uploading))this.model.set('uploadStatus',lang.unknownResult);},notifyUploading:function notifyUploading(){this.model.set({uploading:true,cancelled:false});this.$input.focus();},resizeInput:function resizeInput(val){if(typeof val!=='string')val=this.$input.val();this.$sizer.text(val);var size=this.$sizer.width()+common.INPUT_ROOM;size=Math.max(size,inputMinSize-this.$input.offset().left-this.$el.offset().left);this.$input.css('width',size+'px');},onInput:function onInput(val){if(val===undefined||val instanceof $.Event)val=this.$input.val();var start=this.$input[0].selectionStart,end=this.$input[0].selectionEnd;var changed=false,m,time,video;while(true){m=val.match(embed.youtube_url_re);if(!m)break;time=this.findTimeArg(m[3])||this.findTimeArg(m[1])||m[4]||'';video='>>>/watch?v='+m[2]+time;val=embedRewrite(m,video);}while(true){m=val.match(embed.youtube_short_re);if(!m)break;time=this.findTimeArg(m[2])||'';video='>>>/watch?v='+m[1]+time;val=embedRewrite(m,video);}while(true){m=val.match(embed.soundcloud_url_re);if(!m)break;var sc='>>>/soundcloud/'+m[1];val=embedRewrite(m,sc);}while(true){m=val.match(embed.pastebin_re);if(!m)break;var pbin='>>>/pastebin/'+m[1];val=embedRewrite(m,pbin);}function embedRewrite(m,rw){var old=m[0].length;var newVal=val.substr(0,m.index)+rw+val.substr(m.index+old);changed=true;if(m.index<start){var diff=old-rw.length;start-=diff;end-=diff;}return newVal;}if(changed)this.$input.val(val);var nl=val.lastIndexOf('\n');if(nl>=0){var ok=val.substr(0,nl);val=val.substr(nl+1);this.$input.val(val);if(this.model.get('sentAllocRequest')||/[^ ]/.test(ok))this.commit(ok+'\n');}else {m=val.split('').reverse().join('').match(/^(\s*\S+\s+\S+)\s+(?=\S)/);if(m){var lim=val.length-m[1].length;this.commit(val.substr(0,lim));val=val.substr(lim);start-=lim;end-=lim;this.$input.val(val);this.$input[0].setSelectionRange(start,end);}}this.$input.attr('maxlength',common.MAX_POST_CHARS-this.char_count);this.resizeInput(val);},findTimeArg:function findTimeArg(params){if(!params||params.indexOf('t=')<0)return false;params=params.split('&');for(var i=0,len=params.length;i<len;i++){var pair='#p'+params[i];if(embed.youtube_time_re.test(pair))return pair;}return false;},commit:function commit(text){var lines;if(text.indexOf('\n')>=0){lines=text.split('\n');this.line_count+=lines.length-1;var breach=this.line_count-common.MAX_POST_LINES+1;if(breach>0){for(var i=0;i<breach;i++){lines.pop();}text=lines.join('\n');this.line_count=common.MAX_POST_LINES;}}var left=common.MAX_POST_CHARS-this.char_count;if(left<text.length)text=text.substr(0,left);if(!text)return;this.char_count+=text.length;var attrs=this.model.attributes;if(!attrs.num&&!attrs.sentAllocRequest){main.send([common.INSERT_POST,this.allocationMessage(text,null)]);this.model.set({sentAllocRequest:true});}else if(attrs.num)main.send(text);else this.pending+=text;if(lines){lines[0]=this.$lineBuffer.text()+lines[0];this.$lineBuffer.text(lines.pop());for(var o=0,len=lines.length;o<len;o++){this.imouto.fragment(lines[o]+'\n');}}else {this.$lineBuffer.append(document.createTextNode(text));this.$lineBuffer[0].normalize();}},allocationMessage:function allocationMessage(text,image){var msg={nonce:main.request('nonce:create')};function opt(key,val){if(val)msg[key]=val;}opt('name',main.$name.val().trim());opt('email',main.$email.val().trim());opt('subject',this.$subject.val().trim());opt('frag',text);opt('image',image);opt('op',this.model.get('op'));return msg;},onKeyDown:function onKeyDown(event){var _this=this;main.follow(function(){switch(event.which){case 13:event.preventDefault();case 32:var input=_this.$input[0];var val=_this.$input.val();val=val.slice(0,input.selectionStart)+(event.which==13?'\n':' ')+val.slice(input.selectionEnd);_this.onInput(val);break;default:handle_shortcut.bind(_this)(event);}});},finish:function finish(){var _this2=this;if(this.model.get('num')){this.flushPending();this.commit(this.$input.val());this.$input.remove();this.$submit.remove();if(this.$uploadForm)this.$uploadForm.remove();if(this.$iframe){this.$iframe.remove();this.$iframe=null;}this.imouto.fragment(this.$lineBuffer.text());this.$buffer.replaceWith(this.$buffer.contents());this.$lineBuffer.remove();this.$blockquote.css({'margin-left':'','padding-left':''});main.send([common.FINISH_POST]);this.preserve=true;if(this.isThread)this.$el.append(main.oneeSama.replyBox());var missing=this.imouto.allRolls.sent-this.imouto.allRolls.seen;if(missing>0){(function(){var checkAgain=undefined;(checkAgain=function(n){setTimeout(function(){if(_this2.imouto.allRolls.seen==_this2.imouto.allRolls.sent||n==0)postSM.feed('done');else checkAgain(n-1);},100);})(5);})();}else postSM.feed('done');}else postSM.feed('done');},flushPending:function flushPending(){if(this.pending){main.send(this.pending);this.pending='';}},onToggle:function onToggle(event){var attrs=this.model.attributes;if(attrs.uploading||attrs.uploaded)return;event.preventDefault();event.stopImmediatePropagation();if(attrs.spoiler){this.model.set({spoiler:0});return;}var pick=common.pick_spoiler(attrs.nextSpoiler);this.model.set({spoiler:pick.index,nextSpoiler:pick.next});},onAllocation:function onAllocation(msg){var num=msg.num;state.ownPosts[num]=num;this.model.set({num:num});this.flushPending();var header=$(main.oneeSama.header(msg));this.$meta.replaceWith(header);this.$meta=header;if(!this.isThread)this.$el.addClass('editing');this.$el.attr('id','p'+num);if(msg.image)this.insertUploaded(msg.image);if(this.$uploadForm)this.$uploadForm.append(this.$submit);else this.$blockquote.after(this.$submit);if(this.isThread){this.$subject.siblings('label').andSelf().remove();this.$blockquote.show();this.resizeInput();this.$input.focus();}window.onbeforeunload=function(){return "You have an unfinished post.";};},insertUploaded:function insertUploaded(info){this.renderImage(null,info);this.$imageInput.siblings('strong').andSelf().remove();this.$cancel.remove();this.$uploadForm.find('#toggle').remove();this.flushPending();this.model.set({uploading:false,uploaded:true,sentAllocRequest:true});var $img=this.$el.find('img');this.$blockquote.css({'margin-left':$img.css('margin-right'),'padding-left':$img.width()});this.resizeInput();},dispatch:function dispatch(msg){var a=msg.arg;switch(msg.t){case 'alloc':this.onImageAllocation(a);break;case 'error':this.uploadError(a);break;case 'status':this.uploadStatus(a);break;}},onImageAllocation:function onImageAllocation(msg){var attrs=this.model.attributes;if(attrs.cancelled)return;if(!attrs.num&&!attrs.sentAllocRequest){main.send([common.INSERT_POST,this.allocationMessage(null,msg)]);this.model.set({sentAllocRequest:true});}else main.send([common.INSERT_IMAGE,msg]);},uploadError:function uploadError(msg){if(this.model.get('cancelled'))return;this.model.set({uploadStatus:msg,uploading:false});if(this.$uploadForm)this.$uploadForm.find('input[name=alloc]').remove();},uploadStatus:function uploadStatus(msg){if(this.model.get('cancelled'))return;this.model.set('uploadStatus',msg);},addReference:function addReference(num,sel){var val=this.$input.val();if(/^>>\d+$/.test(val)){this.$input.val(val+'\n');this.onInput();val=this.$input.val();}if(sel){sel=sel.split('\n');for(var i=0,len=sel.length;i<len;i++){sel[i]='>'+sel[i];}num+='\n'+sel.join('\n')+'\n';}this.$input.val(val+'>>'+num);this.$input[0].selectionStart=this.$input.val().length;this.onInput();this.$input.focus();},remove:function remove(){if(!this.preserve){if(this.isThread)this.$el.next('hr').remove();this.$el.remove();}this.$sizer.remove();if(this.$iframe){this.$iframe.remove();this.$iframe=null;}this.stopListening();window.onbeforeunload=null;},renderImage:imager.Hidamari.renderImage,autoExpandImage:function autoExpandImage(){return this;},fun:function fun(){}});exports.ComposerView=ComposerView;function openPostBox(num){postSM.feed('new',document.query('#p'+num+' aside.posting'));}main.reply('openPostBox',openPostBox);window.addEventListener('message',function(event){var msg=event.data;if(msg!=='OK'&&postForm)postForm.uploadError(msg);},false);main.$threads.on('click','a.quote',function(e){e.preventDefault();var post=e.target.closest('article, section'),gsel=getSelection(),num=util.getNum(post);function isInside(prop){var el=gsel[prop]&&gsel[prop].parentElement;return el&&el.closest('blockquote')&&el.closest('article, section')===post;}var sel=undefined;if(isInside('baseNode')&&isInside('focusNode'))sel=gsel.toString();openPostBox(util.getNum(post.closest('section')));postForm.addReference(num,sel);});

},{"../main":"main","./article":16,"./embed":18,"./identity":19,"./imager":20}],26:[function(require,module,exports){
'use strict';var main=require('../main');var PostCommon=require('./common');var $=main.$;var _=main._;var Backbone=main.Backbone;var util=main.util;var oneeSama=main.oneeSama;var state=main.state;module.exports=PostCommon.extend({tagName:'section',render:function render(){var attrs=this.model.attributes;this.setElement(oneeSama.section(attrs)).insertIntoDOM();var reply=util.parseDOM(oneeSama.replyBox());if(attrs.num in state.ownPosts||!!main.request('postForm'))reply.style.display='none';this.el.append(reply);this.el.nextElementSibling.remove();return this;},insertIntoDOM:function insertIntoDOM(){main.$threads[0].query('aside').after(this.el,document.createElement('hr'));this.fun();},renderLocked:function renderLocked(locked){this.el.classList[locked?'add':'remove']('locked');},remove:function remove(){this.el.nextElementSibling.remove();this.el.remove();this.stopListening();return this;},shiftReplies:function shiftReplies(postForm){var attrs=this.model.attributes;var replies=attrs.replies;var lim=state.hotConfig.get('ABBREVIATED_REPLIES'),changed=undefined;if(postForm)lim--;var len=replies.slice().length;for(var i=len;i>lim;i--){var post=state.posts.get(replies.shift());if(!post)continue;if(post.get('image'))attrs.image_omit++;attrs.omit++;changed=true;post.remove();}if(changed)this.renderOmit(attrs.omit,attrs.image_omit);},renderOmit:function renderOmit(){var omit=arguments.length<=0||arguments[0]===undefined?this.model.get('omit'):arguments[0];var image_omit=arguments.length<=1||arguments[1]===undefined?this.model.get('image_omit'):arguments[1];if(omit===0)return;var _state$page$attribute=state.page.attributes;var thread=_state$page$attribute.thread;var href=_state$page$attribute.href;this.el.query('.omit').innerHTML=oneeSama.lang.abbrev_msg(omit,this.model.get('image_omit'),thread&&href.split('?')[0]);},bumpThread:function bumpThread(){this.el.nextElementSibling.remove();this.el.remove();this.insertIntoDOM();}});

},{"../main":"main","./common":17}],27:[function(require,module,exports){
'use strict';var main=require('./main');var $=main.$;var Backbone=main.Backbone;var options=main.options;var state=main.state;var _document=document;var body=_document.body;var atBottom=undefined,lockIndicator=undefined,isThread=undefined;function cacheState(){lockIndicator=document.query('#lock');isThread=!!state.posts.get('thread');}state.page.on('change',cacheState);cacheState();function checkBottom(){atBottom=body.scrollHeight-window.innerHeight<=window.scrollY;if(lockIndicator)lockIndicator.style.visibility=atBottom?'visible':'hidden';}checkBottom();document.addEventListener('scroll',checkBottom);var referenceEl=undefined;function followDOM(func){var previous=referenceDistance(),ret=func();if(atBottom&&(!document.hidden||options.get('alwaysLock')))window.scrollTo(0,body.scrollHeight);else {if(!elExists(referenceEl))return ret;var delta=topDistance(referenceEl,true)-previous;if(delta)window.scrollBy(0,delta);}return ret;}main.follow=followDOM;function elExists(el){return el&&document.contains(el);}function topDistance(el,skipCheck){var _el$getBoundingClient=el.getBoundingClientRect();var top=_el$getBoundingClient.top;if(skipCheck||top>=0&&top<window.innerHeight)return top;return null;}function referenceDistance(){if(elExists(referenceEl)){var bounds=topDistance(referenceEl);if(bounds!==null)return bounds;}var _arr=['article','section','threads'];for(var _i=0;_i<_arr.length;_i++){var selector=_arr[_i];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=main.$threads[0].queryAll(selector)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var el=_step.value;var bounds=topDistance(el);if(bounds!==null){referenceEl=el;return bounds;}}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}}}function aboveBanner(){if(!/^#p\d+$/.test(location.hash))return;var $anchor=$(location.hash);if(!$anchor.length)return;$(window).scrollTop($anchor.offset().top-$('#banner').height());}main.reply('scroll:aboveBanner',aboveBanner);window.onload=aboveBanner;

},{"./main":"main"}],28:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.links=exports.posts=exports.mine=exports.ownPosts=exports.syncs=exports.page=undefined;exports.read=read;exports.addLinks=addLinks;var _main=require('main');main.state=module.exports;function read(href){var state={board:href.match(/\/([a-zA-Z0-9]+?)\//)[1],thread:href.match(/\/(\d+)(:?#\d+)?(?:[\?&]\w+=\w+)*$/),lastN:href.match(/[\?&]last=(\d+)/)};var _arr=['thread','lastN'];for(var _i=0;_i<_arr.length;_i++){var key=_arr[_i];var val=state[key];state[key]=val?parseInt(val[1]):0;}return state;}var page=exports.page=new _main.Backbone.Model(read(location.href));var syncs=exports.syncs={};var ownPosts=exports.ownPosts={};var mine=exports.mine=new main.Memory('mine',2,true);var posts=exports.posts=new _main.Backbone.Collection();main.on('state:clear',function(){main.$threads.innerHTML='';models.each(function(model){return model.dispatch('stopListening');});posts.reset();exports.syncs={};main.request('massExpander:unset');});var links=exports.links={};function addLinks(addition){if(addition){_main._.extend(links,addition);}}

},{"main":"main"}],29:[function(require,module,exports){
'use strict';var main=require('./main');var $=main.$;var Backbone=main.Backbone;var common=main.common;var oneeSama=main.oneeSama;var options=main.options;var state=main.state;var serverTimeOffset=0;main.dispatcher[common.GET_TIME]=function(msg){if(!msg[0])return;serverTimeOffset=msg[0]-Date.now();};main.reply('time:offset',function(){return serverTimeOffset;});var renderTimer=undefined;function batcTimeRender(source){var rtime=arguments.length<=1||arguments[1]===undefined?options.get('relativeTime'):arguments[1];state.posts.each(function(model){return model.dispatch('renderTime');});if(renderTimer)clearTimeout(renderTimer);if(rtime)renderTimer=setTimeout(batcTimeRender,60000);}main.reply('time:render',batcTimeRender);options.on('change:relativeTime',batcTimeRender);function timer_from_el(el){if(!serverTimeOffset)return;el.classList.add('timerTicking');var start=el.getAttribute('start'),end=el.getAttribute('end'),maxh=common.pad(el.getAttribute('hour')),maxm=common.pad(el.getAttribute('min')),maxs=common.pad(el.getAttribute('sec'));(function moumouikkai(){if(!document.body.contains(el))return;var now=common.serverTime();if(now>end)return el.textContent=main.lang.finished;if(start>now){var countdown=Math.round((start-now)/1000);if(countdown===10)main.request('time:syncwatch');el.textContent='Countdown: '+countdown;return setTimeout(moumouikkai,1000);}var diff=now-start;var hour=Math.floor(diff/1000/60/60);diff-=hour*1000*60*60;var min=Math.floor(diff/1000/60);diff-=min*1000*60;var sec=Math.floor(diff/1000);el.textContent=common.pad(hour)+":"+common.pad(min)+":"+common.pad(sec)+" / "+maxh+":"+maxm+":"+maxs;return setTimeout(moumouikkai,1000);})();}function mouikkai(){setInterval(function(){var els=document.getElementsByTagName('syncwatch');for(var i=0;i<els.length;i++){if(els[i].classList.contains('timerTicking'))continue;timer_from_el(els[i]);}},1000);}main.defer(batcTimeRender).defer(mouikkai).defer(function(){var seconds=undefined;var el=document.getElementById('UTCClock').firstChild;el.addEventListener('click',handler);function handler(){seconds=true;this.removeAttribute('title');this.style.cursor='default';this.removeEventListener('click',handler);render();}function render(){if(!serverTimeOffset)return setTimeout(render,1000);el.innerHTML=oneeSama.readableUTCTime(new Date(common.serverTime()),seconds);setTimeout(render,seconds?1000:60000);}render();});

},{"./main":"main"}],30:[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<syncwatch ','>\n\t\t\tsyncwatch\n\t\t</syncwatch>'],['<syncwatch ','>\n\t\t\tsyncwatch\n\t\t</syncwatch>']),_templateObject2=_taggedTemplateLiteral(['<span class="act">\n\t\t\t<a href="','"\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t>\n\t\t\t\t','\n\t\t\t</a>\n\t\t</span>'],['<span class="act">\n\t\t\t<a href="','"\n\t\t\t\t','\n\t\t\t\t','\n\t\t\t>\n\t\t\t\t','\n\t\t\t</a>\n\t\t</span>']);Object.defineProperty(exports,"__esModule",{value:true});exports.thumbStyles=undefined;exports.touchable_spoiler_tag=touchable_spoiler_tag;exports.imageUploadURL=imageUploadURL;exports.getNum=getNum;exports.getID=getID;exports.getModel=getModel;exports.parseEls=parseEls;exports.parseEl=parseEl;exports.listener=listener;exports.once=once;exports.outerWidth=outerWidth;exports.isSage=isSage;exports.serverTime=serverTime;exports.readable_dice=readable_dice;exports.pick_spoiler=pick_spoiler;exports.readable_filesize=readable_filesize;exports.pad=pad;exports.action_link_html=action_link_html;exports.resonableLastN=resonableLastN;exports.parse_name=parse_name;exports.randomID=randomID;exports.parseHTML=parseHTML;exports.commaList=commaList;exports.checkAuth=checkAuth;var _main=require('main');function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr);}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}main.util=module.exports;function touchable_spoiler_tag(del){del.html='<del onclick="void(0)">';}function imageUploadURL(){return (_main.config.hard.HTTP.upload||'../upload/')+'?id='+_main.state.page.get('connID');}function getNum(el){if(!el){return 0;}return parseInt(el.getAttribute('id').slice(1),10);}function getID(el){if(!el){return 0;}return getNum(el.closest('article, section'));}function getModel(el){var id=getID(el);if(!id)return null;return _main.state.posts.get(id);}function parseEls(string){var el=document.createElement('div');el.innerHTML=string;var children=el.childNodes;return Array.from(children);}function parseEl(string){var el=document.createElement('div');el.innerHTML=string;return el.firstChild;}function listener(el,type,selector,handler){el.addEventListener(type,function(event){if(event.target.matches(selector))handler.call(this,event);});}function once(el,type,handler){el.addEventListener(type,function(event){handler.call(this,event);el.removeEventListener(type,handler);});}function outerWidth(el){var style=getComputedStyle(el),props=['marginLeft','marginRight','paddingLeft','paddingRight'];var width=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=props[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var prop=_step.value;width+=parseInt(style[prop]);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}return width;}function isSage(email){return email&&email.trim()==='sage';}var cachedOffset=undefined;function serverTime(){var d=Date.now();if(imports.isNode)return d;if(!cachedOffset)cachedOffset=imports.main.request('time:offset');return d+cachedOffset;}function readable_dice(bit,dice){var inner=undefined;switch(bit){case '#flip':inner=(dice[2]==2).toString();break;case '#8ball':inner=imports.hotConfig.EIGHT_BALL[dice[2]-1];break;case '#pyu':case '#pcount':case '#q':inner=dice[0];break;}if(inner!==undefined)return _main._.escape(bit+' ('+inner+')');if(/^#sw/.test(bit))return readableSyncwatch(dice[0]);return readableRegularDice(bit,dice);}function readableSyncwatch(dice){dice.class='embed';return parseHTML(_templateObject,dice);}function readableRegularDice(bit,_ref){var _ref2=_toArray(_ref);var max=_ref2[0];var bias=_ref2[1];var rolls=_ref2.slice(2);bit+=' (';var eq=rolls.length>1||bias;if(eq)bit+=rolls.join(', ');if(bias)bit+=bias<0?' - '+-bias:' + '+bias;var sum=bias;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=rolls[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var roll=_step2.value;sum+=roll;}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}return bit+(eq?' = ':'')+sum+')';}function pick_spoiler(metaIndex){var imgs=imports.config.SPOILER_IMAGES,n=imgs.length;var i=undefined;if(metaIndex<0)i=Math.floor(Math.random()*n);else i=metaIndex%n;return {index:imgs[i],next:(i+1)%n};}var thumbStyles=exports.thumbStyles=['small','sharp','hide'];function readable_filesize(size){if(size<1024)return size+' B';if(size<1048576)return Math.round(size/1024)+' KB';size=Math.round(size/104857.6).toString();return size.slice(0,-1)+'.'+size.slice(-1)+' MB';}function pad(n){return (n<10?'0':'')+n;}function action_link_html(href,name,id,cls){return parseHTML(_templateObject2,href,id&&' id="'+id+'"',cls&&' class="'+cls+'"',name);}function resonableLastN(n){return Number.isInteger(n)&&n<=500;}function parse_name(name){var tripcode='',secure='';var hash=name.indexOf('#');if(hash>=0){tripcode=name.substr(hash+1);name=name.substr(0,hash);hash=tripcode.indexOf('#');if(hash>=0){secure=_main._.escape(tripcode.substr(hash+1));tripcode=tripcode.substr(0,hash);}tripcode=_main._.escape(tripcode);}name=name.trim().replace(imports.hotConfig.EXCLUDE_REGEXP,'');return [name.substr(0,100),tripcode.substr(0,128),secure.substr(0,128)];}function randomID(len){var id='';for(var i=0;i<len;i++){var char=(Math.random()*36).toString(36)[0];if(Math.random()<0.5)char=char.toUpperCase();id+=char;}return id;}function parseHTML(callSite){if(typeof callSite==='string')return formatHTML(callSite);if(typeof callSite==='function')return formatHTML(callSite(args));var len=arguments.length;var args=[];for(var i=1;i<len;i++){args[i-1]=arguments[i];}var output=callSite.slice(0,len).map(function(text,i){var arg=args[i-1];var result=undefined;if(i===0||!arg&&arg!==0)result='';else if(arg instanceof Object)result=elementAttributes(arg);else result=arg;return result+text;}).join('');return formatHTML(output);}function formatHTML(str){var size=-1;return str.replace(/\n(\s+)/g,function(m,m1){if(size<0)size=m1.replace(/\t/g,'    ').length;return m1.slice(Math.min(m1.length,size));}).replace(/^\s*\n/gm,'');}function elementAttributes(attrs){var html='';for(var key in attrs){html+=' ';var val=attrs[key];if(val===true)html+=key;else if(val||val===0)html+=key+'="'+val+'"';}return html;}function commaList(items){var html='';var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=items[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var item=_step3.value;if(!item&&item!==0)continue;if(html)html+=', ';html+=item;}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}return html;}function checkAuth(action){var cls=_main.config.staff.classes[main.ident&&main.ident.auth];return cls&&!!cls.rights[action];}

},{"main":"main"}],"main":[function(require,module,exports){
'use strict';var _templateObject=_taggedTemplateLiteral(['<style>\n\t\t.locked:after {\n\t\t\tcontent: "','";\n\t\t}\n\t\t.locked > header nav:after {\n\t\t\tcontent: " (',')";\n\t\t}\n\t</style>'],['<style>\n\t\t.locked:after {\n\t\t\tcontent: "','";\n\t\t}\n\t\t.locked > header nav:after {\n\t\t\tcontent: " (',')";\n\t\t}\n\t</style>']);var _fsm=require('./fsm');var _fsm2=_interopRequireDefault(_fsm);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var _=require('underscore'),Backbone=require('backbone'),Cookie=require('js-cookie'),radio=require('backbone.radio');require('core-js');require('dom4');require('backbone.nativeview');Backbone.View=Backbone.NativeView;var main=module.exports=radio.channel('main');_.extend(main,{_:_,Backbone:Backbone,Cookie:Cookie,FSM:_fsm2.default,$script:require('scriptjs'),SockJS:require('sockjs-client'),_deferred:[],defer:function defer(func){main._deferred.push(func);return main;},execDefered:function execDefered(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this._deferred[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var func=_step.value;func();}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}},dispatcher:{}});_.extend(main,{config:config,configHash:configHash,clientHash:clientHash,isMobile:isMobile});var cookieVersion=3;if(localStorage.cookieVersion!=cookieVersion){for(var cookie in Cookie.get()){var paths=main.config.boards.enabled.slice();paths.push('');var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=paths[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var path=_step2.value;Cookie.remove(cookie,{path:path});}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}localStorage.cookieVersion=cookieVersion;}if(/[&\?]debug=true/.test(location.href))main.config.hard.debug=true;if(main.config.hard.debug){radio.DEBUG=true;window.Backbone=Backbone;radio.tuneIn('main');}main.send=main.request.bind(main,'send');main.Memory=require('./memory');var lang=main.lang=require('lang'),state=require('./state'),util=require('./util'),common=main.common=require('./common');main.options=require('./options');main.scroll=require('./scroll');state.page.set('tabID',common.randomID(32));document.head.appendChild(util.parseDOM(common.parseHTML(_templateObject,lang.thread_locked,lang.locked)));_.extend(main,{$threads:document.query('threads'),$name:document.query('input[name=name]'),$email:document.query('input[name=email]'),connSM:new _fsm2.default('load'),postSM:new _fsm2.default('none')});_.extend(main,{loop:require('./loop'),time:require('./time'),amusement:require('./amusement')});main.posts=require('./posts');main.Extract=require('./extract');main.client=require('./client');main.conection=require('./connection');_.extend(main,{history:require('./history'),hide:require('./hide')});main.execDefered();main.request('loading:hide');

},{"./amusement":1,"./client":2,"./common":3,"./connection":6,"./extract":7,"./fsm":8,"./hide":9,"./history":10,"./loop":11,"./memory":12,"./options":13,"./posts":21,"./scroll":27,"./state":28,"./time":29,"./util":30,"backbone":undefined,"backbone.nativeview":undefined,"backbone.radio":undefined,"core-js":undefined,"dom4":undefined,"js-cookie":undefined,"lang":undefined,"scriptjs":undefined,"sockjs-client":undefined,"underscore":undefined}]},{},["main"])


//# sourceMappingURL=main.js.map
