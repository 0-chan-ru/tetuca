{"version":3,"sources":["node_modules/browser-pack/_prelude.js","main.js","client/main/fsm.js","client/main/memory.js","client/main/options/index.js","client/main/options/opts.js","client/main/options/render.js","client/main/scroll.js","client/main/state.js","client/main/util.js","client/main/main.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length",1,"module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","value","FSM","start","this","state","spec","acts","ons","wilds","preflights","second","push","pres","trans_spec","on_func","halves","split","parts","dest","match","tok","undefined","part","m","src","on","ev","param","from","to","ps","fs","_this","feed",2,"main","_","Cookie","Memory","expiry","needCookie","defer","purgeExpired","bind","object","nums","keys","sort","b","parseInt","set","join","Math","floor","Date","now","localStorage","removeItem","remove","getItem","val","JSON","parse","isObject","isEmpty","purgeAll","setItem","stringify","bakeCookie","readAll","writeAll","size","limit","expired","time","lim","./main",3,"_interopRequireDefault","obj","__esModule","default","_main","_opts","_opts2","_render","_render2","options","Backbone","Model","optionModels","OptionModel","model","load","extend","type","attributes","id","get","onchange","execOnStart","execute","stored","read","num","exec","validation","tick","clicked","el","style","opacity","out","requestAnimationFrame","document","query","addEventListener","OptionsView","View","initialize","setElement","body","append","assignValues","hidden","events","reply","renderHidden","click .option_tab_sel>li>a","change","click #export","click #import","click #hidden","_id","checked","Array","String","fromCharCode","toUpperCase","switchTab","event","preventDefault","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","children","Symbol","iterator","next","done","child","classList","err","add","filter","lastChild","li","has","getAttribute","applyChange","request","charCodeAt","validate","export","getElementById","setAttribute","window","URL","createObjectURL","Blob","import","click","util","once","reader","FileReader","readAsText","input","files","onload","json","result","alert","clear","location","reload","count","textContent","replace","clearHidden","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","optionsPanel","./opts","./render",4,"toggleHeadStyle","css","toggle","head","appendChild","parseEl","disabled","notMobile","isMobile","opts","config","lang","enabled","tab","langApplied","thumbStyles","notifToggle","Notification","permission","requestPermission","radio","send","illyaDance","defaultCSS","theme","MEDIA_URL","cssHash","upload","resonableLastN","_arr","_i","engine","shorts","short",5,"_taggedTemplateLiteral","strings","raw","freeze","render","html","tabs","_loop","opt","renderTab","renderOption","renderExtras","isShortcut","isList","isCheckbox","isNumber","isImage","_lang$labels$opt$id","_slicedToArray","labels","label","title","item","parseHTML","_templateObject","modes","links","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_lang$labels$id","attrs","name","_templateObject2","sliceIterator","arr","_n","_d","_e","_s","isArray",6,"cacheState","lockIndicator","isThread","posts","checkBottom","height","scrollHeight","innerHeight","atBottom","scrollY","visibility","followDOM","func","previous","referenceDistance","ret","elExists","referenceEl","delta","topDistance","scrollBy","scrollTo","contains","skipCheck","_el$getBoundingClient","getBoundingClientRect","top","bounds","selector","$threads","queryAll","aboveBanner","test","hash","anchor","$banner","page",7,"href","board","thread","lastN","addLinks","addition","mine","ownPosts","syncs","Collection","innerHTML","models","each","dispatch","reset",8,"_toArray","touchable_spoiler_tag","del","imageUploadURL","hard","HTTP","getNum","slice","getID","closest","getModel","parseEls","string","createElement","childNodes","firstChild","listener","handler","matches","removeEventListener","outerWidth","getComputedStyle","width","prop","isSage","email","trim","serverTime","d","imports","isNode","cachedOffset","readable_dice","bit","dice","inner","toString","hotConfig","EIGHT_BALL","escape","readableSyncwatch","readableRegularDice","_ref","_ref2","bias","rolls","eq","sum","roll","pick_spoiler","metaIndex","imgs","SPOILER_IMAGES","random","index","readable_filesize","round","pad","action_link_html","cls","Number","isInteger","parse_name","tripcode","secure","indexOf","substr","EXCLUDE_REGEXP","randomID","len","char","callSite","formatHTML","args","arguments","output","map","text","arg","elementAttributes","str","m1","min","commaList","items","checkAuth","action","staff","classes","ident","auth","rights","_fsm","_fsm2","NativeView","$script","SockJS","channel","_deferred","execDefered","dispatcher","configHash","clientHash","cookieVersion","cookie","paths","boards","path","debug","DEBUG","tuneIn","fn","scroll","follow","thread_locked","locked","$name","$email","connSM","postSM","./fsm","./memory","./options","./scroll","./state","./util","backbone","backbone.nativeview","backbone.radio","core-js","dom4","js-cookie","scriptjs","sockjs-client","underscore"],"mappings":"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","file":"main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();Object.defineProperty(exports,\"__esModule\",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var FSM=(function(){function FSM(start){_classCallCheck(this,FSM);this.state=start;this.spec={acts:{},ons:{},wilds:{},preflights:{}};}_createClass(FSM,[{key:'clone',value:function clone(){var second=new FSM(this.state);second.spec=this.spec;return second;}},{key:'on',value:function on(key,f){var ons=this.spec.ons[key];if(ons){ons.push(f);}else {this.spec.ons[key]=[f];}}},{key:'preflight',value:function preflight(key,f){var pres=this.spec.preflights[key];if(pres){pres.push(f);}else {this.spec.preflights[key]=[f];}}},{key:'act',value:function act(trans_spec,on_func){var halves=trans_spec.split('->');if(halves.length!=2){throw new Error(\"Bad FSM spec: \"+trans_spec);}var parts=halves[0].split(','),dest=halves[1].match(/^\\s*(\\w+)\\s*$/)[1];var tok=undefined;for(var i=parts.length-1;i>=0;i--){var part=parts[i],m=part.match(/^\\s*(\\*|\\w+)\\s*(?:\\+\\s*(\\w+)\\s*)?$/);if(!m){throw new Error(\"Bad FSM spec portion: \"+part);}if(m[2]){tok=m[2];}if(!tok){throw new Error(\"Tokenless FSM action: \"+part);}var src=m[1];if(src=='*'){this.spec.wilds[tok]=dest;}else {var acts=this.spec.acts[src];if(!acts){this.spec.acts[src]=acts={};}acts[tok]=dest;}}if(on_func){this.on(dest,on_func);}}},{key:'feed',value:function feed(ev,param){var spec=this.spec;var from=this.state;var acts=spec.acts[from];var to=acts&&acts[ev]||spec.wilds[ev];if(to&&from!=to){var ps=spec.preflights[to];for(var i=0;ps&&i<ps.length;i++){if(!ps[i].call(this,param)){return false;}}this.state=to;var fs=spec.ons[to];for(var i=0;fs&&i<fs.length;i++){fs[i].call(this,param);}}return true;}},{key:'feeder',value:function feeder(ev){var _this=this;return function(param){return _this.feed(ev,param);};}}]);return FSM;})();exports.default=FSM;\n\n},{}],2:[function(require,module,exports){\n'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var main=require('./main');var _=main._;var Cookie=main.Cookie;var Memory=(function(){function Memory(key,expiry,needCookie){_classCallCheck(this,Memory);this.key=key;this.expiry=expiry;this.needCookie=needCookie;main.defer(this.purgeExpired.bind(this));}_createClass(Memory,[{key:'bakeCookie',value:function bakeCookie(object){if(!this.needCookie)return;var nums=Object.keys(object);nums.sort(function(a,b){return parseInt(a,10)-parseInt(b,10);});Cookie.set(this.key,nums.join('/'));}},{key:'now',value:function now(){return Math.floor(Date.now()/1000);}},{key:'purgeAll',value:function purgeAll(){localStorage.removeItem(this.key);if(this.needCookie)Cookie.remove(this.key);}},{key:'readAll',value:function readAll(){var key=localStorage.getItem(this.key);if(!key)return {};var val=undefined;try{val=JSON.parse(key);}catch(e) {}return _.isObject(val)?val:{};}},{key:'writeAll',value:function writeAll(object){if(_.isEmpty(object))return this.purgeAll();localStorage.setItem(this.key,JSON.stringify(object));this.bakeCookie(object);}},{key:'write',value:function write(key){var object=this.readAll();object[key]=this.now();this.writeAll(object);return _.size(object);}},{key:'size',value:function size(){return _.size(this.readAll());}},{key:'purgeExpired',value:function purgeExpired(){if(!this.expiry)return;var object=this.readAll();var now=this.now(),limit=86400*this.expiry;var expired=[];for(var key in object){var time=object[key];if(time&&now>time+limit)expired.push(key);}if(!expired.length)return;for(var i=0,lim=expired.length;i<lim;i++){delete object[expired[i]];}this.writeAll(object);}}]);return Memory;})();module.exports=Memory;\n\n},{\"./main\":\"main\"}],3:[function(require,module,exports){\n'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();Object.defineProperty(exports,\"__esModule\",{value:true});var _main=require('main');var _opts=require('./opts');var _opts2=_interopRequireDefault(_opts);var _render=require('./render');var _render2=_interopRequireDefault(_render);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var options=undefined;try{options=JSON.parse(localStorage.options);}catch(e) {}if(!options){options={};}exports.default=options=new _main.Backbone.Model(options);var optionModels={};var OptionModel=(function(){function OptionModel(model){var _this=this;_classCallCheck(this,OptionModel);if(model.load!==undefined&&!model.load){return;}_main._.extend(this,model);if(!this.type){this.type='checkbox';}var val=options.attributes[this.id]=this.get();options.on('change:'+this.id,function(options,val){return _this.onchange(val);});if(this.execOnStart!==false){this.execute(this.val);}optionModels[this.id]=this;}_createClass(OptionModel,[{key:'read',value:function read(){return localStorage.getItem(this.id);}},{key:'get',value:function get(){var stored=this.read();if(!stored){return this.default;}else {if(stored==='false'){return false;}if(stored===\"true\"){return true;}var num=parseInt(stored,10);if(num||num===0){return num;}return this.default;}}},{key:'onChange',value:function onChange(val){this.execute(val);this.set(val);}},{key:'execute',value:function execute(val){if(this.exec){this.exec(val);}}},{key:'set',value:function set(val){if(val!==this.default||this.read()){localStorage.setItem(this.id,val);}}},{key:'validate',value:function validate(val){if(this.validation){return this.validation(val);}return true;}}]);return OptionModel;})();(function(){if(localStorage.getItem('options')){return;}var el=document.query('#options');el.style.opacity=1;var out=true,clicked=undefined;el.addEventListener(\"click\",function(){return clicked=true;});tick();function tick(){if(clicked){el.style.opacity=1;return;}el.style.opacity=+el.style.opacity+(out?-0.02:0.02);var now=+el.style.opacity;if(out&&now<=0||!out&&now>=1){out=!out;}requestAnimationFrame(tick);}})();var OptionsView=_main.Backbone.View.extend({initialize:function initialize(){this.setElement((0,_render2.default)());document.body.append(this.el);this.assignValues();this.hidden=this.el.query('#hidden');_main.events.reply('hide:render',this.renderHidden,this);},events:{'click .option_tab_sel>li>a':'switchTab','change':'applyChange','click #export':'export','click #import':'import','click #hidden':'clearHidden'},assignValues:function assignValues(){for(var _id in optionModels){var model=optionModels[_id],el=this.el.query('#'+_id);var type=model.type;var val=model.get();if(type==='checkbox'){el.checked=val;}else if(type==='number'||type instanceof Array){el.value=val;}else if(type==='shortcut'){el.value=String.fromCharCode(val).toUpperCase();}}},switchTab:function switchTab(event){event.preventDefault();var el=event.target;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=el.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;child.query('.tab_sel').classList.remove('tab_sel');}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}el.classList.add('tab_sel');_main._.filter(this.el.lastChild.children,function(li){return li.classList.has(el.getAttribute('data-content'));}).classList.add('tab_sel');},applyChange:function applyChange(event){var el=event.target,model=optionModels[el.getAttribute('id')];var val=undefined;switch(model.type){case 'checkbox':val=el.checked;break;case 'number':val=parseInt(el.value);break;case 'image':return _main.events.request('background:store',event.target);case 'shortcut':val=el.value.toUpperCase().charCodeAt(0);break;default:val=el.value;}if(!model.validate(val)){el.value='';}else {options.set(id,val);}},export:function _export(){var a=document.getElementById('export');a.setAttribute('href',window.URL.createObjectURL(new Blob([JSON.stringify(localStorage)],{type:'octet/stream'})));a.setAttribute('download','meguca-config.json');},import:function _import(event){event.preventDefault();var el=document.query('#importSettings');el.click();_main.util.once(el,'change',function(){var reader=new FileReader();reader.readAsText(input.files[0]);reader.onload=function(event){var json=undefined;try{json=JSON.parse(event.target.result);}catch(err) {alert('Import failed. File corrupt');return;}localStorage.clear();for(var key in json){localStorage[key]=json[key];}alert('Import successfull. The page will now reload.');location.reload();};});},renderHidden:function renderHidden(count){var el=this.hidden;el.textContent=el.textContent.replace(/\\d+$/,count);},clearHidden:function clearHidden(){main.request('hide:clear');this.renderHidden(0);}});var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_opts2.default[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var spec=_step2.value;new OptionModel(spec);}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}var optionsPanel=undefined;(0,_main.defer)(function(){return optionsPanel=new OptionsView();});\n\n},{\"./opts\":4,\"./render\":5,\"main\":\"main\"}],4:[function(require,module,exports){\n'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});var _main=require('main');var notMobile=!_main.isMobile;var opts=[{id:'lang',type:_main.config.lang.enabled,tab:0,default:_main.config.lang.default,execOnStart:false,exec:function exec(type){alert(_main.lang.langApplied);location.reload();}},{id:'inlinefit',type:['none','full','width','height','both'],tab:1,default:'width'},{id:'thumbs',type:_main.util.thumbStyles,tab:1,default:'small'},{id:'imageHover',default:true,load:notMobile,tab:0},{id:'webmHover',load:notMobile,tab:0},{id:'autogif',load:notMobile,tab:1},{id:'spoilers',tab:1,default:true},{id:'linkify',tab:0,default:true},{id:'notification',load:notMobile,tab:0,exec:function exec(notifToggle){if(notifToggle&&Notification.permission!==\"granted\")Notification.requestPermission();}},{id:'anonymise',tab:0},{id:'relativeTime',tab:0,default:true},{id:'nowPlaying',load:notMobile&&_main.config.radio,tab:3,default:true,exec:function exec(toggle){if(toggle){main.send({type:'radio'});}else {main.request('banner:radio:clear');}}},{id:'illyaBGToggle',load:notMobile&&_main.config.illyaDance,tab:3},{id:'illyaMuteToggle',load:notMobile&&_main.config.illyaDance,tab:3},{id:'horizontalPosting',tab:3,exec:toggleHeadStyle('horizontal','article,aside{display:inline-block;}')},{id:'replyright',tab:1,exec:toggleHeadStyle('reply-at-right','section>aside{margin: -26px 0 2px auto;}')},{id:'theme',type:['moe','gar','mawaru','moon','ashita','console','tea','higan','ocean','rave','tavern','glass'],tab:1,default:_main.config.defaultCSS,exec:function exec(theme){if(!theme){return;}document.getElementById('theme').setAttribute('href',_main.config.MEDIA_URL+'css/'+theme+'.css?v='+main.cssHash);}},{id:'userBG',load:notMobile,tab:1},{id:'userBGimage',load:notMobile,type:'image',tab:1,execOnStart:false,exec:function exec(upload){main.request('background:store',upload);}},{id:'lastn',type:'number',tab:0,validation:_main.util.resonableLastN,default:100},{id:'alwaysLock',tab:0}];var _arr=['google','iqdb','saucenao','desustorage','exhentai'];for(var _i=0;_i<_arr.length;_i++){var engine=_arr[_i];opts.push({id:engine,lang:'imageSearch',tab:2,default:engine==='google',exec:toggleHeadStyle(engine+'Toggle','.'+engine+'{display:initial;}')});}var shorts=[{id:'new',default:78},{id:'togglespoiler',default:73},{id:'textSpoiler',default:68},{id:'done',default:83},{id:'expandAll',default:69},{id:'workMode',default:66}];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=shorts[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var short=_step.value;short.type='shortcut';short.tab=4;short.load=notMobile;opts.push(short);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}function toggleHeadStyle(id,css){return function(toggle){if(!document.getElementById(id)){document.head.appendChild(_main.util.parseEl('<style id=\"'+id+'\">'+css+'</style>'));}document.getElementById(id).disabled=!toggle;};}exports.default=opts;\n\n},{\"main\":\"main\"}],5:[function(require,module,exports){\n'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};})();var _templateObject=_taggedTemplateLiteral(['<option value=\"','\">\\n                    ','\\n                </option>'],['<option value=\"','\">\\n                    ','\\n                </option>']),_templateObject2=_taggedTemplateLiteral(['<input ','>'],['<input ','>']);Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=render;var _main=require('main');var _opts=require('./opts');var _opts2=_interopRequireDefault(_opts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var lang=_main.lang.opts;function render(){var html='<div class=\"bmodal glass\" id=\"options-panel\">'+'<ul class=\"option_tab_sel\">';var tabs=lang.tabs;var opts=[];var _loop=function _loop(i){opts[i]=_main._.filter(_opts2.default,function(opt){return opt.tab===i&&(opt.load===undefined||opt.load)&&!opt.hidden;});if(!opts[i].length){return 'continue';}html+='<li><a data-content=\"tab-'+i+'\"';if(i===0){html+=' class=\"tab_sel\"';}html+='>'+tabs[i]+'</a></li>';};for(var i=0;i<tabs.length;i++){var _ret=_loop(i);if(_ret==='continue')continue;}html+='</ul><ul class=\"option_tab_cont\">';for(var i=0;i<opts.length;i++){html+=renderTab(opts[i],i);}html+='</ul></div>';return (0,_main.parseEl)(html);}function renderTab(opts,i){if(!opts.length){return '';}var html=\"\";html+='<li class=\"tab-'+i;if(i===0){html+=' tab_sel';}html+='\">';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=opts[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var opt=_step.value;html+=renderOption(opt);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}if(i===0){html+=renderExtras();}html+='</li>';return html;}function renderOption(opt){var html='';var isShortcut=opt.type==='shortcut',isList=opt.type instanceof Array,isCheckbox=opt.type==='checkbox'||opt.type===undefined,isNumber=opt.type==='number',isImage=opt.type==='image';if(isShortcut){html+='Alt+';}if(!isList){html+='<input';if(isCheckbox||isImage)html+=' type=\"'+(isCheckbox?'checkbox':'file')+'\"';else if(isNumber)html+=' style=\"width: 4em;\" maxlength=\"4\"';else if(isShortcut)html+=' maxlength=\"1\"';}else {html+='<select';}var _lang$labels$opt$id=_slicedToArray(lang.labels[opt.id],2);var label=_lang$labels$opt$id[0];var title=_lang$labels$opt$id[1];html+=' id=\"'+opt.id+'\" title=\"'+title+'\">';if(isList){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=opt.type[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var item=_step2.value;html+=(0,_main.parseHTML)(_templateObject,item,lang.modes[item]||item);}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}html+='</select>';}html+='<label for=\"'+opt.id+'\" title=\"'+title+'\">'+label+'</label><br>';return html;}function renderExtras(){var html='<br>';var links=['export','import','hidden'];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=links[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var id=_step3.value;var _lang$labels$id=_slicedToArray(lang.labels[id],2);var label=_lang$labels$id[0];var title=_lang$labels$id[1];html+='<a id=\"'+id+'\" title=\"'+_main.lang[1]+'\">'+_main.lang[0]+'</a> ';}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}var attrs={type:'file',id:'importSettings',name:\"Import Settings\"};html+=(0,_main.parseHTML)(_templateObject2,attrs);return html;}\n\n},{\"./opts\":4,\"main\":\"main\"}],6:[function(require,module,exports){\n'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});exports.followDOM=followDOM;var _main=require('main');var atBottom=undefined,lockIndicator=undefined,isThread=undefined;function cacheState(){lockIndicator=document.query('#lock');isThread=!!_main.state.posts.get('thread');}_main.state.page.on('change',cacheState);cacheState();function checkBottom(){var height=document.body.scrollHeight-window.innerHeight;atBottom=height<=window.scrollY;if(lockIndicator){lockIndicator.style.visibility=atBottom?'visible':'hidden';}}checkBottom();document.addEventListener('scroll',checkBottom);var referenceEl=undefined;function followDOM(func){var previous=referenceDistance(),ret=func();if(atBottom&&(!document.hidden||_main.options.get('alwaysLock'))){window.scrollTo(0,document.body.scrollHeight);}else {if(!elExists(referenceEl)){return ret;}var delta=topDistance(referenceEl,true)-previous;if(delta){window.scrollBy(0,delta);}}return ret;}function elExists(el){return el&&document.contains(el);}function topDistance(el,skipCheck){var _el$getBoundingClient=el.getBoundingClientRect();var top=_el$getBoundingClient.top;if(skipCheck||top>=0&&top<window.innerHeight){return top;}return null;}function referenceDistance(){if(elExists(referenceEl)){var bounds=topDistance(referenceEl);if(bounds!==null){return bounds;}}var _arr=['article','section','threads'];for(var _i=0;_i<_arr.length;_i++){var selector=_arr[_i];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_main.$threads.queryAll(selector)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var el=_step.value;var bounds=topDistance(el);if(bounds!==null){referenceEl=el;return bounds;}}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}}}function aboveBanner(){if(!/^#p\\d+$/.test(location.hash)){return;}var anchor=document.query(location.hash);if(!anchor){return;}window.scrollTo(0,topDistance(anchor)-_main.$banner.height);}_main.events.reply('scroll:aboveBanner',aboveBanner);window.onload=aboveBanner;\n\n},{\"main\":\"main\"}],7:[function(require,module,exports){\n'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});exports.links=exports.posts=exports.mine=exports.ownPosts=exports.syncs=exports.page=undefined;exports.read=read;exports.addLinks=addLinks;var _main=require('main');function read(href){var state={board:href.match(/\\/([a-zA-Z0-9]+?)\\//)[1],thread:href.match(/\\/(\\d+)(:?#\\d+)?(?:[\\?&]\\w+=\\w+)*$/),lastN:href.match(/[\\?&]last=(\\d+)/)};var _arr=['thread','lastN'];for(var _i=0;_i<_arr.length;_i++){var key=_arr[_i];var val=state[key];state[key]=val?parseInt(val[1]):0;}return state;}var page=exports.page=new _main.Backbone.Model(read(location.href));var syncs=exports.syncs={};var ownPosts=exports.ownPosts={};var mine=exports.mine=new _main.Memory('mine',2,true);var posts=exports.posts=new _main.Backbone.Collection();_main.events.on('state:clear',function(){main.$threads.innerHTML='';models.each(function(model){return model.dispatch('stopListening');});posts.reset();exports.syncs={};main.request('massExpander:unset');});var links=exports.links={};function addLinks(addition){if(addition){_main._.extend(links,addition);}}\n\n},{\"main\":\"main\"}],8:[function(require,module,exports){\n'use strict';var _templateObject=_taggedTemplateLiteral(['<syncwatch ','>\\n\\t\\t\\tsyncwatch\\n\\t\\t</syncwatch>'],['<syncwatch ','>\\n\\t\\t\\tsyncwatch\\n\\t\\t</syncwatch>']),_templateObject2=_taggedTemplateLiteral(['<span class=\"act\">\\n\\t\\t\\t<a href=\"','\"\\n\\t\\t\\t\\t','\\n\\t\\t\\t\\t','\\n\\t\\t\\t>\\n\\t\\t\\t\\t','\\n\\t\\t\\t</a>\\n\\t\\t</span>'],['<span class=\"act\">\\n\\t\\t\\t<a href=\"','\"\\n\\t\\t\\t\\t','\\n\\t\\t\\t\\t','\\n\\t\\t\\t>\\n\\t\\t\\t\\t','\\n\\t\\t\\t</a>\\n\\t\\t</span>']);Object.defineProperty(exports,\"__esModule\",{value:true});exports.thumbStyles=undefined;exports.touchable_spoiler_tag=touchable_spoiler_tag;exports.imageUploadURL=imageUploadURL;exports.getNum=getNum;exports.getID=getID;exports.getModel=getModel;exports.parseEls=parseEls;exports.parseEl=parseEl;exports.listener=listener;exports.once=once;exports.outerWidth=outerWidth;exports.isSage=isSage;exports.serverTime=serverTime;exports.readable_dice=readable_dice;exports.pick_spoiler=pick_spoiler;exports.readable_filesize=readable_filesize;exports.pad=pad;exports.action_link_html=action_link_html;exports.resonableLastN=resonableLastN;exports.parse_name=parse_name;exports.randomID=randomID;exports.parseHTML=parseHTML;exports.commaList=commaList;exports.checkAuth=checkAuth;var _main=require('main');function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr);}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}function touchable_spoiler_tag(del){del.html='<del onclick=\"void(0)\">';}function imageUploadURL(){return (_main.config.hard.HTTP.upload||'../upload/')+'?id='+_main.state.page.get('connID');}function getNum(el){if(!el){return 0;}return parseInt(el.getAttribute('id').slice(1),10);}function getID(el){if(!el){return 0;}return getNum(el.closest('article, section'));}function getModel(el){var id=getID(el);if(!id)return null;return _main.state.posts.get(id);}function parseEls(string){var el=document.createElement('div');el.innerHTML=string;var children=el.childNodes;return Array.from(children);}function parseEl(string){var el=document.createElement('div');el.innerHTML=string;return el.firstChild;}function listener(el,type,selector,handler){el.addEventListener(type,function(event){if(event.target.matches(selector))handler.call(this,event);});}function once(el,type,handler){el.addEventListener(type,function(event){handler.call(this,event);el.removeEventListener(type,handler);});}function outerWidth(el){var style=getComputedStyle(el),props=['marginLeft','marginRight','paddingLeft','paddingRight'];var width=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=props[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var prop=_step.value;width+=parseInt(style[prop]);}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}return width;}function isSage(email){return email&&email.trim()==='sage';}var cachedOffset=undefined;function serverTime(){var d=Date.now();if(imports.isNode)return d;if(!cachedOffset)cachedOffset=imports.main.request('time:offset');return d+cachedOffset;}function readable_dice(bit,dice){var inner=undefined;switch(bit){case '#flip':inner=(dice[2]==2).toString();break;case '#8ball':inner=imports.hotConfig.EIGHT_BALL[dice[2]-1];break;case '#pyu':case '#pcount':case '#q':inner=dice[0];break;}if(inner!==undefined)return _main._.escape(bit+' ('+inner+')');if(/^#sw/.test(bit))return readableSyncwatch(dice[0]);return readableRegularDice(bit,dice);}function readableSyncwatch(dice){dice.class='embed';return parseHTML(_templateObject,dice);}function readableRegularDice(bit,_ref){var _ref2=_toArray(_ref);var max=_ref2[0];var bias=_ref2[1];var rolls=_ref2.slice(2);bit+=' (';var eq=rolls.length>1||bias;if(eq)bit+=rolls.join(', ');if(bias)bit+=bias<0?' - '+-bias:' + '+bias;var sum=bias;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=rolls[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var roll=_step2.value;sum+=roll;}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}return bit+(eq?' = ':'')+sum+')';}function pick_spoiler(metaIndex){var imgs=imports.config.SPOILER_IMAGES,n=imgs.length;var i=undefined;if(metaIndex<0)i=Math.floor(Math.random()*n);else i=metaIndex%n;return {index:imgs[i],next:(i+1)%n};}var thumbStyles=exports.thumbStyles=['small','sharp','hide'];function readable_filesize(size){if(size<1024)return size+' B';if(size<1048576)return Math.round(size/1024)+' KB';size=Math.round(size/104857.6).toString();return size.slice(0,-1)+'.'+size.slice(-1)+' MB';}function pad(n){return (n<10?'0':'')+n;}function action_link_html(href,name,id,cls){return parseHTML(_templateObject2,href,id&&' id=\"'+id+'\"',cls&&' class=\"'+cls+'\"',name);}function resonableLastN(n){return Number.isInteger(n)&&n<=500;}function parse_name(name){var tripcode='',secure='';var hash=name.indexOf('#');if(hash>=0){tripcode=name.substr(hash+1);name=name.substr(0,hash);hash=tripcode.indexOf('#');if(hash>=0){secure=_main._.escape(tripcode.substr(hash+1));tripcode=tripcode.substr(0,hash);}tripcode=_main._.escape(tripcode);}name=name.trim().replace(imports.hotConfig.EXCLUDE_REGEXP,'');return [name.substr(0,100),tripcode.substr(0,128),secure.substr(0,128)];}function randomID(len){var id='';for(var i=0;i<len;i++){var char=(Math.random()*36).toString(36)[0];if(Math.random()<0.5)char=char.toUpperCase();id+=char;}return id;}function parseHTML(callSite){if(typeof callSite==='string')return formatHTML(callSite);if(typeof callSite==='function')return formatHTML(callSite(args));var len=arguments.length;var args=[];for(var i=1;i<len;i++){args[i-1]=arguments[i];}var output=callSite.slice(0,len).map(function(text,i){var arg=args[i-1];var result=undefined;if(i===0||!arg&&arg!==0)result='';else if(arg instanceof Object)result=elementAttributes(arg);else result=arg;return result+text;}).join('');return formatHTML(output);}function formatHTML(str){var size=-1;return str.replace(/\\n(\\s+)/g,function(m,m1){if(size<0)size=m1.replace(/\\t/g,'    ').length;return m1.slice(Math.min(m1.length,size));}).replace(/^\\s*\\n/gm,'');}function elementAttributes(attrs){var html='';for(var key in attrs){html+=' ';var val=attrs[key];if(val===true)html+=key;else if(val||val===0)html+=key+'=\"'+val+'\"';}return html;}function commaList(items){var html='';var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=items[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var item=_step3.value;if(!item&&item!==0)continue;if(html)html+=', ';html+=item;}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}return html;}function checkAuth(action){var cls=_main.config.staff.classes[main.ident&&main.ident.auth];return cls&&!!cls.rights[action];}\n\n},{\"main\":\"main\"}],\"main\":[function(require,module,exports){\n'use strict';var _templateObject=_taggedTemplateLiteral(['<style>\\n\\t\\t.locked:after {\\n\\t\\t\\tcontent: \"','\";\\n\\t\\t}\\n\\t\\t.locked > header nav:after {\\n\\t\\t\\tcontent: \" (',')\";\\n\\t\\t}\\n\\t</style>'],['<style>\\n\\t\\t.locked:after {\\n\\t\\t\\tcontent: \"','\";\\n\\t\\t}\\n\\t\\t.locked > header nav:after {\\n\\t\\t\\tcontent: \" (',')\";\\n\\t\\t}\\n\\t</style>']);var _fsm=require('./fsm');var _fsm2=_interopRequireDefault(_fsm);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var _=require('underscore'),Backbone=require('backbone'),Cookie=require('js-cookie'),radio=require('backbone.radio');require('core-js');require('dom4');require('backbone.nativeview');Backbone.View=Backbone.NativeView;var main=module.exports={_:_,Backbone:Backbone,Cookie:Cookie,FSM:_fsm2.default,$script:require('scriptjs'),SockJS:require('sockjs-client'),events:radio.channel('main'),_deferred:[],defer:function defer(func){main._deferred.push(func);return main;},execDefered:function execDefered(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this._deferred[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var func=_step.value;func();}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}},dispatcher:{}};_.extend(main,{config:config,configHash:configHash,clientHash:clientHash,isMobile:isMobile});var cookieVersion=3;if(localStorage.cookieVersion!=cookieVersion){for(var cookie in Cookie.get()){var paths=main.config.boards.enabled.slice();paths.push('','/');var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=paths[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var path=_step2.value;Cookie.remove(cookie,{path:path});}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}localStorage.cookieVersion=cookieVersion;}if(/[&\\?]debug=true/.test(location.href))main.config.hard.debug=true;if(main.config.hard.debug){radio.DEBUG=true;window.Backbone=Backbone;radio.tuneIn('main');}main.Memory=require('./memory');var lang=main.lang=require('lang'),state=main.state=require('./state'),util=main.util=require('./util');main.send=main.events.request.bind(main.events,'send');var _arr=['parseHTML','parseEl','parseEls'];for(var _i=0;_i<_arr.length;_i++){var fn=_arr[_i];main[fn]=util[fn];}main.options=require('./options');main.scroll=require('./scroll');main.follow=main.scroll.followDOM;state.page.set('tabID',util.randomID(32));document.head.appendChild(util.parseEl(util.parseHTML(_templateObject,lang.thread_locked,lang.locked)));_.extend(main,{$threads:document.query('threads'),$name:document.query('#name'),$email:document.query('#email'),$banner:document.query('#banner'),connSM:new _fsm2.default('load'),postSM:new _fsm2.default('none')});main.execDefered();main.events.request('loading:hide');\n\n},{\"./fsm\":1,\"./memory\":2,\"./options\":3,\"./scroll\":6,\"./state\":7,\"./util\":8,\"backbone\":undefined,\"backbone.nativeview\":undefined,\"backbone.radio\":undefined,\"core-js\":undefined,\"dom4\":undefined,\"js-cookie\":undefined,\"lang\":undefined,\"scriptjs\":undefined,\"sockjs-client\":undefined,\"underscore\":undefined}]},{},[\"main\"])\n\n","/**\n * Finite State Machine\n */\nexport default class FSM {\n    /**\n     * Create a new finite state machine\n     * @param {string} start - Initial state\n     */\n    constructor(start) {\n        this.state = start\n        this.spec = {\n            acts: {},\n            ons: {},\n            wilds: {},\n            preflights: {}\n        }\n    }\n\n    /**\n     * Clone the current FSM\n     * @returns {FSM}\n     */\n    clone() {\n        const second = new FSM(this.state)\n        second.spec = this.spec\n        return second\n    }\n\n    /**\n     * Assign a handler to be execute on arrival to a new state\n     * @param {string} key - Target state\n     * @param {function} f - Handler\n     */\n    on(key, f) {\n        const ons = this.spec.ons[key]\n        if (ons) {\n            ons.push(f)\n        } else {\n            this.spec.ons[key] = [f]\n        }\n    }\n\n    /**\n     * Assign sanity check to perform before transition to a new state\n     * @param {string} key - Target state\n     * @param {function} f - Handler\n     */\n    preflight(key, f) {\n        const pres = this.spec.preflights[key]\n        if (pres) {\n            pres.push(f)\n        } else {\n            this.spec.preflights[key] = [f]\n        }\n    }\n\n    /**\n     * Specify transition and an optional handler to execute on it\n     * @param {string} trans_spec - Transition specification\n     * @param {function=} on_func - Handler\n     */\n    act(trans_spec, on_func) {\n        const halves = trans_spec.split('->')\n        if (halves.length != 2) {\n            throw new Error(\"Bad FSM spec: \" + trans_spec)\n        }\n        const parts = halves[0].split(','),\n            dest = halves[1].match(/^\\s*(\\w+)\\s*$/)[1]\n        let tok\n        for (let i = parts.length - 1; i >= 0; i--) {\n            const part = parts[i],\n                m = part.match(/^\\s*(\\*|\\w+)\\s*(?:\\+\\s*(\\w+)\\s*)?$/)\n            if (!m) {\n                throw new Error(\"Bad FSM spec portion: \" + part)\n            }\n            if (m[2]) {\n                tok = m[2]\n            }\n            if (!tok) {\n                throw new Error(\"Tokenless FSM action: \" + part)\n            }\n            const src = m[1]\n            if (src == '*') {\n                this.spec.wilds[tok] = dest\n            } else {\n                let acts = this.spec.acts[src]\n                if (!acts) {\n                    this.spec.acts[src] = acts = {}\n                }\n                acts[tok] = dest\n            }\n        }\n        if (on_func) {\n            this.on(dest, on_func)\n        }\n    }\n\n    /**\n     * Transition the FSM to a new state\n     * @param {string} ev - Target state\n     * @param {*} param - Argument for the handler functions\n     * @returns {bool} - Passed preflight sanity check, if any\n     */\n    feed(ev, param) {\n        const {spec} = this,\n            from = this.state,\n            acts = spec.acts[from],\n            to = (acts && acts[ev]) || spec.wilds[ev]\n        if (to && from != to) {\n            const ps = spec.preflights[to]\n            for (let i = 0; ps && i < ps.length; i++) {\n                if (!ps[i].call(this, param)) {\n                    return false\n                }\n            }\n            this.state = to\n            const fs = spec.ons[to]\n            for (let i = 0; fs && i < fs.length; i++) {\n                fs[i].call(this, param)\n            }\n        }\n        return true\n    }\n\n    /**\n     * Returns a function that executes FSM.prototype.feed with the suplied\n     * argument\n     * @param {string} ev - Target state\n     * @returns {function}\n     */\n    feeder(ev) {\n        return param =>  this.feed(ev, param)\n    }\n}\n","/*\n * Self-expiring localStorage key controller\n */\n\nlet main = require('./main'),\n\t{_, Cookie} = main;\n\nclass Memory {\n\tconstructor(key, expiry, needCookie) {\n\t\tthis.key = key;\n\t\tthis.expiry = expiry;\n\t\tthis.needCookie = needCookie;\n\t\tmain.defer(this.purgeExpired.bind(this));\n\t}\n\tbakeCookie(object) {\n\t\tif (!this.needCookie)\n\t\t\treturn;\n\t\tlet nums = Object.keys(object);\n\t\tnums.sort(function(a, b) {\n\t\t\treturn parseInt(a, 10) - parseInt(b, 10);\n\t\t});\n\t\tCookie.set(this.key, nums.join('/'));\n\t}\n\tnow() {\n\t\treturn Math.floor(Date.now() / 1000);\n\t}\n\tpurgeAll() {\n\t\tlocalStorage.removeItem(this.key);\n\t\tif (this.needCookie)\n\t\t\tCookie.remove(this.key);\n\t}\n\treadAll() {\n\t\tconst key = localStorage.getItem(this.key);\n\t\tif (!key)\n\t\t\treturn {};\n\t\tlet val;\n\t\ttry {\n\t\t\tval = JSON.parse(key);\n\t\t}\n\t\tcatch(e) {}\n\t\treturn _.isObject(val) ? val : {};\n\t}\n\twriteAll(object) {\n\t\tif (_.isEmpty(object))\n\t\t\treturn this.purgeAll();\n\t\tlocalStorage.setItem(this.key, JSON.stringify(object));\n\t\tthis.bakeCookie(object)\n\t}\n\twrite(key) {\n\t\tlet object = this.readAll();\n\t\tobject[key] = this.now();\n\t\tthis.writeAll(object);\n\t\t// Return number of keys\n\t\treturn _.size(object);\n\t}\n\tsize() {\n\t\treturn _.size(this.readAll());\n\t}\n\tpurgeExpired() {\n\t\tif (!this.expiry)\n\t\t\treturn;\n\t\tlet object = this.readAll();\n\t\tconst now = this.now(),\n\t\t\tlimit = 86400 * this.expiry;\n\t\tlet expired = [];\n\t\tfor (let key in object) {\n\t\t\tconst time = object[key];\n\t\t\tif (time && now > time + limit)\n\t\t\t\texpired.push(key);\n\t\t}\n\t\tif (!expired.length)\n\t\t\treturn;\n\t\tfor (let i = 0, lim = expired.length; i < lim; i++) {\n\t\t\tdelete object[expired[i]];\n\t\t}\n\t\tthis.writeAll(object);\n\t}\n}\nmodule.exports = Memory;\n","/*\n * Houses both the actual options controler and the options panel renderring\n * logic\n */\n\nimport {_, Backbone, state, defer, events, util} from 'main'\nimport opts from './opts'\nimport render from './render'\n\n// Try to get options from local storage\nlet options\ntry {\n\toptions = JSON.parse(localStorage.options)\n}\ncatch(e) {}\nif (!options) {\n\toptions = {}\n}\nexport default options = new Backbone.Model(options)\n\nconst optionModels = {}\n\n/**\n * Coontroler for each individual option\n */\nclass OptionModel {\n\t/**\n\t * Create new option model from template model\n\t * @param {Object} model\n\t */\n    constructor(model) {\n\t\t// Condition for loading option. Optional.\n\t\tif (model.load !== undefined && !model.load) {\n\t\t\treturn\n\t\t}\n\t\t_.extend(this, model)\n\n\t\t// No type = checkbox + default false\n\t\tif (!this.type) {\n\t\t    this.type = 'checkbox'\n\t\t}\n\n\t\t// Store option value in central stotage options Backbone model\n\t\tconst val = options.attributes[this.id] = this.get()\n\t\toptions.on('change:' + this.id, (options, val) =>\n\t\t\tthis.onchange(val))\n\t\tif (this.execOnStart !== false) {\n\t\t    this.execute(this.val)\n\t\t}\n\t\toptionModels[this.id] = this\n    }\n\n\t/**\n\t * Read value from localStorage\n\t * @returns {string}\n\t */\n\tread() {\n\t    return localStorage.getItem(this.id)\n\t}\n\n\t/**\n\t * Retrieve option value from storage and parse result. If none, return\n\t * default.\n\t * @returns {string|bool|int}\n\t */\n\tget() {\n\t\tconst stored = this.read()\n\t    if (!stored) {\n\t        return this.default\n\t    } else {\n\t\t\tif (stored === 'false') {\n\t\t        return false\n\t\t    }\n\t\t\tif (stored === \"true\") {\n\t\t        return true\n\t\t    }\n\t\t\tconst num = parseInt(stored, 10)\n\t\t\tif (num || num === 0) {\n\t\t\t    return num\n\t\t\t}\n\t\t\treturn this.default\n\t\t}\n\t}\n\n\t/**\n\t * Handler to be executed on field change in central options storage model\n\t * @param {*} val\n\t */\n\tonChange(val) {\n\t    this.execute(val)\n\t\tthis.set(val)\n\t}\n\n\t/**\n\t * Execute handler function, if any\n\t * @param {*} val\n\t */\n\texecute(val) {\n\t    if (this.exec) {\n\t        this.exec(val)\n\t    }\n\t}\n\n\t/**\n\t * Write value to localStorage, if needed\n\t * @param {*} val\n\t */\n\tset(val) {\n\t    if (val !== this.default || this.read()) {\n\t        localStorage.setItem(this.id,val)\n\t    }\n\t}\n\n\t/**\n\t * Perform value validation, if any. Othervise return true.\n\t * @param {*} val\n\t * @returns {bool}\n\t */\n\tvalidate(val) {\n\t    if (this.validation) {\n\t        return this.validation(val)\n\t    }\n\t\treturn true\n\t}\n}\n\n// Highlight options button by fading out and in, if no options are set\n(function() {\n\tif (localStorage.getItem('options')) {\n\t\treturn\n\t}\n\tconst el = document.query('#options')\n\tel.style.opacity = 1\n\tlet out = true,\n\t\tclicked\n\tel.addEventListener(\"click\", () => clicked = true)\n\ttick()\n\n\tfunction tick() {\n\t\t// Stop\n\t\tif (clicked) {\n\t\t    el.style.opacity = 1\n\t\t\treturn\n\t\t}\n\n    \tel.style.opacity = +el.style.opacity + (out ? -0.02 : 0.02)\n\t\tconst now = +el.style.opacity\n\n\t\t// Reverse direction\n\t\tif ((out && now <= 0) || (!out && now >= 1)) {\n\t\t    out = !out\n\t\t}\n\t\trequestAnimationFrame(tick)\n\t}\n})()\n\n// View of the options panel\nconst OptionsView = Backbone.View.extend({\n\tinitialize() {\n\t\t// Render the options panel\n\t\tthis.setElement(render())\n\t\tdocument.body.append(this.el)\n\t\tthis.assignValues()\n\t\tthis.hidden = this.el.query('#hidden')\n\t\tevents.reply('hide:render', this.renderHidden, this)\n\t},\n\n\tevents: {\n\t\t'click .option_tab_sel>li>a': 'switchTab',\n\t\t'change': 'applyChange',\n\t\t'click #export': 'export',\n\t\t'click #import': 'import',\n\t\t'click #hidden': 'clearHidden'\n\t},\n\n\t/**\n\t * Assign loaded option settings to the respective elements in the options\n\t * panel\n\t */\n\tassignValues() {\n\t\tfor (let id in optionModels) {\n\t\t\tconst model = optionModels[id],\n\t\t\t\tel = this.el.query('#' + id)\n\t\t\tconst {type} = model,\n\t\t\t\tval = model.get()\n\t\t\tif (type === 'checkbox') {\n\t\t\t    el.checked = val\n\t\t\t} else if (type === 'number' || type instanceof Array) {\n\t\t\t    el.value = val\n\t\t\t} else if (type === 'shortcut') {\n\t\t\t    el.value = String.fromCharCode(val).toUpperCase()\n\t\t\t}\n\n\t\t\t// 'image' type simply falls through, as those don't need to be set\n\t\t}\n\t},\n\n\t/**\n\t * Switch to a tab, when clicking the tab butt\n\t * @param {Event} event\n\t */\n\tswitchTab(event) {\n\t\tevent.preventDefault()\n\t\tconst el = event.target\n\n\t\t// Deselect previous tab\n\t\tfor (let child of el.children) {\n\t\t    child.query('.tab_sel').classList.remove('tab_sel')\n\t\t}\n\n\t\t// Select the new one\n\t\tel.classList.add('tab_sel')\n\t\t_.filter(this.el.lastChild.children, li =>\n\t\t\tli.classList.has(el.getAttribute('data-content'))\n\t\t)\n\t\t\t.classList.add('tab_sel')\n\t},\n\n\t/**\n\t * Propagate options panel changes through\n\t * options -> optionModels -> localStorage\n\t * @param {Event} event\n\t */\n\tapplyChange(event) {\n\t\tconst el = event.target,\n\t\t\tmodel = optionModels[el.getAttribute('id')]\n\t\tlet val\n\t\tswitch (model.type) {\n\t\t\tcase 'checkbox':\n\t\t\t\tval = el.checked\n\t\t\t\tbreak\n\t\t\tcase 'number':\n\t\t\t\tval = parseInt(el.value)\n\t\t\t\tbreak\n\t\t\tcase 'image':\n\t\t\t\t// Not recorded. Extracted directly by the background handler.\n\t\t\t\treturn events.request('background:store', event.target)\n\t\t\tcase 'shortcut':\n\t\t\t\tval = el.value.toUpperCase().charCodeAt(0)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tval = el.value\n\t\t}\n\n\t\tif (!model.validate(val)) {\n\t\t\tel.value = ''\n\t\t} else {\n\t\t\toptions.set(id, val)\n\t\t}\n\t},\n\n\t/**\n\t * Dump options to JSON file and upload to user\n\t */\n\texport() {\n\t\tconst a = document.getElementById('export')\n\t\ta.setAttribute('href', window.URL\n\t\t\t.createObjectURL(new Blob([JSON.stringify(localStorage)], {\n\t\t\t\ttype: 'octet/stream'\n\t\t\t}))\n\t\t)\n\t\ta.setAttribute('download', 'meguca-config.json')\n\t},\n\n\t/**\n\t * Import options from uploaded JSON file\n\t * @param {Event} event\n\t */\n\timport(event) {\n\t\t// Proxy to hidden file input\n\t\tevent.preventDefault()\n\t\tconst el = document.query('#importSettings')\n\t\tel.click()\n\t\tutil.once(el, 'change', () => {\n\t\t\tvar reader = new FileReader()\n\t\t\treader.readAsText(input.files[0])\n\t\t\treader.onload = event => {\n\t\t\t\t// In case of curruption\n\t\t\t\tlet json\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse(event.target.result)\n\t\t\t\t}\n\t\t\t\tcatch(err) {\n\t\t\t\t\talert('Import failed. File corrupt')\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlocalStorage.clear()\n\t\t\t\tfor (let key in json) {\n\t\t\t\t\tlocalStorage[key] = json[key]\n\t\t\t\t}\n\t\t\t\talert('Import successfull. The page will now reload.')\n\t\t\t\tlocation.reload()\n\t\t\t};\n\t\t})\n\t},\n\n\t/**\n\t * Render Hiden posts counter\n\t * @param {int} count\n\t */\n\trenderHidden(count) {\n\t\tconst el = this.hidden\n\t\tel.textContent = el.textContent.replace(/\\d+$/, count)\n\t},\n\n\t/**\n\t * Clear displayed hidden post counter\n\t */\n\tclearHidden() {\n\t\tmain.request('hide:clear')\n\t\tthis.renderHidden(0)\n\t}\n});\n\n// Create and option model for each object in the array\nfor (let spec of opts) {\n\tnew OptionModel(spec)\n}\n\n// Expensive comutation and not emediatly needed. Put off till later.\nlet optionsPanel\ndefer(() => optionsPanel = new OptionsView())\n","/*\n * This file is used by both the client to populate the Backbone models and the\n * server to render the actual options panel.\n */\n\nimport {Cookie, util, state, config, isMobile, lang} from 'main'\n\n/*\n * Full schema of the option interface\n *\n * - id: Identifier of the option. Used for DOM element and localStorage tagging\n * - type: 'checkbox'/'number'/'image'/'shortCut'/array of options\n *\tarrays become a selection list. Defaults to 'checkbox', if omitted.\n * - default: Default value. false, if omitted.\n * - tab: Index of the tab the option belong to.\n * - exec: Function to execute on option change.\n * - execOnStart: Boolean. Should the function be executed on model population?\n *\tDefaults to true.\n * - load: Condition to display and execute the option. Defaults to true(always)\n * - validation: Function that validates the users input. Returns a boolean.\n * - hidden: If true this option won't be shown to the user. Defaults to false\n *\n * Tooltips and lables are defined per language in `lang/`.\n * All arguments except for `id` and `tab` are optional.\n */\n\nconst notMobile = !isMobile\n\nconst opts = [\n\t// LANGUAGE SELECTION\n\t{\n\t\tid: 'lang',\n\t\ttype: config.lang.enabled,\n\t\ttab: 0,\n\t\tdefault: config.lang.default,\n\t\texecOnStart: false,\n\t\texec(type) {\n\t\t\talert(lang.langApplied)\n\t\t\tlocation.reload()\n\t\t}\n\t},\n\t// INLINE EXPANSION\n\t{\n\t\tid: 'inlinefit',\n\t\ttype: ['none', 'full', 'width', 'height', 'both'],\n\t\ttab: 1,\n\t\tdefault: 'width'\n\t},\n\t// THUMBNAIL MODE\n\t{\n\t\tid: 'thumbs',\n\t\ttype: util.thumbStyles,\n\t\ttab: 1,\n\t\tdefault: 'small'\n\t},\n\t// IMAGE HOVER EXPANSION\n\t{\n\t\tid: 'imageHover',\n\t\tdefault: true,\n\t\tload: notMobile,\n\t\ttab: 0\n\t},\n\t{\n\t\tid: 'webmHover',\n\t\tload: notMobile,\n\t\ttab: 0\n\t},\n\t// Autogif TOGGLE\n\t{\n\t\tid: 'autogif',\n\t\tload: notMobile,\n\t\ttab: 1\n\t},\n\t// SPOILER TOGGLE\n\t{\n\t\tid: 'spoilers',\n\t\ttab: 1,\n\t\tdefault: true\n\t},\n\t// LINKIFY TEXT URLS\n\t{\n\t\tid: 'linkify',\n\t\ttab: 0,\n\t\tdefault: true\n\t},\n\t// DESKTOP NOTIFICATIONS\n\t{\n\t\tid: 'notification',\n\t\tload: notMobile,\n\t\ttab: 0,\n\t\texec(notifToggle) {\n\t\t\tif (notifToggle && (Notification.permission !== \"granted\"))\n\t\t\t\tNotification.requestPermission()\n\t\t}\n\t},\n\t// ANONIMISE ALL POSTER NAMES\n\t{\n\t\tid: 'anonymise',\n\t\ttab: 0\n\t},\n\t// RELATIVE POST TIMESTAMPS\n\t{\n\t\tid: 'relativeTime',\n\t\ttab: 0,\n\t\tdefault: true\n\t},\n\t// R/A/DIO NOW PLAYING BANNER\n\t{\n\t\tid: 'nowPlaying',\n\t\tload: notMobile && config.radio,\n\t\ttab: 3,\n\t\tdefault: true,\n\t\texec(toggle) {\n\t\t\tif (toggle) {\n\t\t\t\t// Query the server for current stream info\n\t\t\t\tmain.send({type: 'radio'})\n\t\t\t} else {\n\t\t\t\tmain.request('banner:radio:clear');\n\t\t\t}\n\t\t}\n\t},\n\t// ILLYA DANCE\n\t{\n\t\tid: 'illyaBGToggle',\n\t\tload: notMobile && config.illyaDance,\n\t\ttab: 3\n\t},\n\t{\n\t\tid: 'illyaMuteToggle',\n\t\tload: notMobile && config.illyaDance,\n\t\ttab: 3\n\t},\n\t// HORIZONTAL POSTING\n\t{\n\t\tid: 'horizontalPosting',\n\t\ttab: 3,\n\t\texec: toggleHeadStyle(\n\t\t\t'horizontal',\n\t\t\t'article,aside{display:inline-block;}'\n\t\t)\n\t},\n\t// REPLY AT RIGHT\n\t{\n\t\tid: 'replyright',\n\t\ttab: 1,\n\t\texec: toggleHeadStyle(\n\t\t\t'reply-at-right',\n\t\t\t'section>aside{margin: -26px 0 2px auto;}'\n\t\t)\n\t},\n\t// THEMES\n\t{\n\t\tid: 'theme',\n\t\ttype: [\n\t\t\t'moe', 'gar', 'mawaru', 'moon', 'ashita', 'console', 'tea',\n\t\t\t'higan', 'ocean', 'rave', 'tavern', 'glass'\n\t\t],\n\t\ttab: 1,\n\t\tdefault: config.defaultCSS,\n\t\texec(theme) {\n\t\t\tif (!theme) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tdocument.getElementById('theme')\n\t\t\t\t.setAttribute(\n\t\t\t\t\t'href',\n\t\t\t\t\t`${config.MEDIA_URL}css/${theme}.css?v=${main.cssHash}`\n\t\t\t\t)\n\t\t}\n\t},\n\t// CUSTOM USER-SET BACKGROUND\n\t{\n\t\tid: 'userBG',\n\t\tload: notMobile,\n\t\ttab: 1\n\t},\n\t{\n\t\tid: 'userBGimage',\n\t\tload: notMobile,\n\t\ttype: 'image',\n\t\ttab: 1,\n\t\texecOnStart: false,\n\t\texec(upload) {\n\t\t\tmain.request('background:store', upload)\n\t\t}\n\t},\n\t// LAST N CONFIG\n\t{\n\t\tid: 'lastn',\n\t\ttype: 'number',\n\t\ttab: 0,\n\t\tvalidation: util.resonableLastN,\n\t\tdefault: 100\n\t},\n\t// KEEP THREAD LENGTH WITHIN LASTN\n\t/*\n\t Disabled, until dependancy features are implemnted (see issue #280)\n\t{\n\t\tid: 'postUnloading',\n\t\ttab: 0\n\t},*/\n\t// LOCK TO BOTTOM EVEN WHEN DOCUMENT HIDDEN\n\t{\n\t\tid: 'alwaysLock',\n\t\ttab: 0\n\t}\n]\n\n// IMAGE SEARCH LINK TOGGLE\nfor (let engine of ['google', 'iqdb', 'saucenao', 'desustorage', 'exhentai']) {\n\topts.push({\n\t\tid: engine,\n\t\t// Use a custom internatiolisation function\n\t\tlang: 'imageSearch',\n\t\ttab: 2,\n\t\tdefault: engine === 'google',\n\t\texec: toggleHeadStyle(engine + 'Toggle', `.${engine}{display:initial;}`)\n\t})\n}\n\n// SHORTCUT KEYS\nconst shorts = [\n\t{id: 'new', default: 78},\n\t{id: 'togglespoiler', default: 73},\n\t{id: 'textSpoiler', default: 68},\n\t{id: 'done', default: 83},\n\t{id: 'expandAll', default: 69},\n\t{id: 'workMode', default: 66}\n]\nfor (let short of shorts) {\n\tshort.type = 'shortcut'\n\tshort.tab = 4\n\tshort.load = notMobile\n\topts.push(short)\n}\n\n/**\n * Create a function to append and toggle a style element in <head>\n */\nfunction toggleHeadStyle(id, css) {\n\treturn function (toggle) {\n\t\tif (!document.getElementById(id)) {\n\t\t\tdocument.head.appendChild(\n\t\t\t\tutil.parseEl(`<style id=\"${id}\">${css}</style>`)\n\t\t\t)\n\t\t}\n\n\t\t// The disabled property only exists on elements in the DOM, so we do\n\t\t// another query\n\t\tdocument.getElementById(id).disabled = !toggle;\n\t}\n}\n\nexport default opts\n","import {_, isMobile, lang as ln, parseEl, parseHTML} from 'main'\nimport {default as options} from \"./opts\"\n\nconst lang = ln.opts\n\n/**\n * Render the options panel\n */\nexport default function render() {\n    let html = `<div class=\"bmodal glass\" id=\"options-panel\">`\n        + `<ul class=\"option_tab_sel\">`\n    const {tabs} = lang,\n        opts = []\n\n    // Render tab butts\n    for (let i = 0; i < tabs.length; i++) {\n        // Pick the options for this specific tab, according to current\n        // template and server configuration\n        opts[i] = _.filter(options, opt =>\n            opt.tab === i\n                && (opt.load === undefined  || opt.load)\n                && !opt.hidden)\n\n        if (!opts[i].length) {\n            continue\n        }\n        html += `<li><a data-content=\"tab-${i}\"`\n\n        // Highlight the first tabButt by default\n        if (i === 0) {\n            html += ' class=\"tab_sel\"'\n        }\n\n        html += `>${tabs[i]}</a></li>`;\n    }\n\n    html += '</ul><ul class=\"option_tab_cont\">'\n    for (let i = 0; i < opts.length; i++) {\n        html += renderTab(opts[i], i)\n    }\n    html += '</ul></div>'\n\n    return parseEl(html)\n}\n\n/**\n * Render tab contents\n */\nfunction renderTab(opts, i) {\n    if (!opts.length) {\n        return ''\n    }\n    let html = \"\"\n    html += `<li class=\"tab-${i}`\n\n    // Show the first tab by default\n    if (i === 0) {\n        html += ' tab_sel'\n    }\n    html += '\">'\n\n    // Render the actual options\n    for (let opt of opts) {\n        html += renderOption(opt)\n    }\n\n    if (i === 0) {\n        html += renderExtras()\n    }\n    html += '</li>'\n\n    return html\n}\n\n/**\n * Render a single option from it's schema\n */\nfunction renderOption(opt) {\n\tlet html = ''\n\tconst isShortcut = opt.type === 'shortcut',\n\t\tisList = opt.type instanceof Array,\n\t\tisCheckbox = opt.type === 'checkbox' || opt.type === undefined,\n\t\tisNumber = opt.type === 'number',\n\t\tisImage = opt.type === 'image'\n\tif (isShortcut) {\n        html += 'Alt+'\n    }\n\tif (!isList) {\n\t\thtml += '<input'\n\t\tif (isCheckbox || isImage)\n\t\t\thtml += ` type=\"${(isCheckbox ? 'checkbox' : 'file')}\"`\n\t\telse if (isNumber)\n\t\t\thtml += ' style=\"width: 4em;\" maxlength=\"4\"'\n\t\telse if (isShortcut)\n\t\t\thtml += ' maxlength=\"1\"'\n\t} else {\n        html += '<select'\n    }\n\n\tconst [label,title] = lang.labels[opt.id]\n\thtml += ` id=\"${opt.id}\" title=\"${title}\">`\n\n\tif (isList) {\n\t\tfor (let item of opt.type) {\n\t\t\thtml += parseHTML\n                `<option value=\"${item}\">\n                    ${lang.modes[item] || item}\n                </option>`\n\t\t}\n\t\thtml += '</select>'\n\t}\n\thtml += `<label for=\"${opt.id}\" title=\"${title}\">${label}</label><br>`\n\n\treturn html\n}\n\n/**\n * Hidden post reset, Export and Import links to first tab\n */\nfunction renderExtras() {\n\tlet html = '<br>'\n\tconst links = ['export', 'import', 'hidden']\n    for (let id of links) {\n        const [label, title] = lang.labels[id]\n        html += `<a id=\"${id}\" title=\"${ln[1]}\">${ln[0]}</a> `\n    }\n\n    // Hidden file input for uploading the JSON\n    const attrs = {\n        type: 'file',\n        id: 'importSettings',\n        name: \"Import Settings\"\n    }\n\thtml += parseHTML`<input ${attrs}>`\n\n    return html\n}\n","/*\n * Various page scrolling logic\n */\n\nimport {Backbone, options, state, $threads, $banner, events} from 'main'\n\nlet atBottom, lockIndicator, isThread\n\n/**\n * Write the current state to variables\n */\nfunction cacheState() {\n\tlockIndicator = document.query('#lock')\n\tisThread = !!state.posts.get('thread')\n}\n\n// Recache state on page change\nstate.page.on('change', cacheState)\ncacheState()\n\n/**\n * Set the scroll lock position to a post or to the bottom of the document\n */\nfunction checkBottom() {\n\tconst height = document.body.scrollHeight - window.innerHeight\n\tatBottom = height <= window.scrollY\n\tif (lockIndicator) {\n\t\tlockIndicator.style.visibility = atBottom ? 'visible' : 'hidden'\n\t}\n}\n\ncheckBottom()\ndocument.addEventListener('scroll', checkBottom)\n\n// Cache previous reference element to minimize DOM lookup\nlet referenceEl\n\n/**\n * Lock position to the bottom of a thread or keep the viewport from bumping\n * on out of sight DOM mutation.\n * @param {function} func\n * @returns {*}\n */\nexport function followDOM(func) {\n\tconst previous = referenceDistance(),\n\t\tret = func()\n\n\t// Prevent scrolling with new posts, if page isn't visible\n\tif (atBottom && (!document.hidden || options.get('alwaysLock'))) {\n\t\twindow.scrollTo(0,  document.body.scrollHeight)\n\t} else {\n\t\t// Element was removed or something\n\t\tif (!elExists(referenceEl)) {\n\t\t\treturn ret\n\t\t}\n\n\t\t// Only compensate, if the height increased above the viewport\n\t\tconst delta = topDistance(referenceEl, true) - previous\n\t\tif (delta) {\n\t\t\twindow.scrollBy(0, delta)\n\t\t}\n\t}\n\treturn ret\n}\n\n/**\n * Check if element reference exists and is in the DOM\n * @param {Element} el\n */\nfunction elExists(el) {\n\treturn el && document.contains(el)\n}\n\n/**\n * Return element position dimentions against the viewport, if the element\n * is withing the viewport\n * @param {Element} el\n * @param {bool} skipCheck\n * @returns {(Number|null)}\n */\nfunction topDistance(el, skipCheck) {\n\tconst {top} = el.getBoundingClientRect()\n\tif (skipCheck || (top >= 0 && top < window.innerHeight)) {\n\t\treturn top\n\t}\n\treturn null\n}\n\n/**\n * Returns distance of viewport to with current reference element\n * @returns {(Number|null)}\n */\nfunction referenceDistance() {\n\tif (elExists(referenceEl)) {\n\t\tconst bounds = topDistance(referenceEl)\n\t\tif (bounds !== null) {\n\t\t\treturn bounds\n\t\t}\n\t}\n\n\t// Find new reference element (first inside viewport). Account for empty\n\t// threads and boards with no artciles or sections.\n\tfor (let selector of ['article', 'section', 'threads']) {\n\t\tfor (let el of $threads.queryAll(selector)) {\n\t\t\tconst bounds = topDistance(el)\n\t\t\tif (bounds !== null) {\n\t\t\t\treferenceEl = el\n\t\t\t\treturn bounds\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Account for banner height, when scrolling to an anchor\n */\nfunction aboveBanner (){\n\tif (!/^#p\\d+$/.test(location.hash)) {\n\t\treturn\n\t}\n\tconst anchor = document.query(location.hash)\n\tif (!anchor) {\n\t\treturn\n\t}\n\twindow.scrollTo(0, topDistance(anchor) - $banner.height)\n}\nevents.reply('scroll:aboveBanner', aboveBanner)\nwindow.onload = aboveBanner\n","/*\n * Central model keeping the state of the page\n */\n\nimport {_, Backbone, Memory, events} from 'main'\n\n// Read page state by parsing a URL\nexport function read(href) {\n\tconst state = {\n\t\tboard: href.match(/\\/([a-zA-Z0-9]+?)\\//)[1],\n\t\tthread: href.match(/\\/(\\d+)(:?#\\d+)?(?:[\\?&]\\w+=\\w+)*$/),\n\t\t// Displayed last N posts setting on thread pages\n\t\tlastN: href.match(/[\\?&]last=(\\d+)/)\n\t}\n\tfor (let key of ['thread', 'lastN']) {\n\t\tconst val = state[key]\n\t    state[key] = val ? parseInt(val[1]) : 0\n\t}\n\treturn state\n}\n\n// Initial page state\nexport const page = new Backbone.Model(read(location.href))\n\n// Hot-reloadable configuration\n\n// TODO: We need actual listeners to this model for hot reloads\n\n// Tracks the synchronisation counter of each thread\nexport let syncs = {}\n\n// Posts I made in this tab\nexport const ownPosts = {}\n\n// remember which posts are mine for two days\nexport const mine = new Memory('mine', 2, true)\n\n// All posts currently displayed\nexport const posts = new Backbone.Collection()\n\nevents.on('state:clear', () => {\n\t/*\n\t * Emptying the whole element should be faster than removing each post\n\t * individually through models and listeners\n\t */\n\tmain.$threads.innerHTML = ''\n\n\t// The <threads> tag has already been emptied, no need to perform\n\t// element removal with the default `.remove()` method\n\tmodels.each(model =>\n\t\tmodel.dispatch('stopListening'))\n\n\tposts.reset()\n\n\t// Prevent old threads from syncing\n\texports.syncs = {}\n\tmain.request('massExpander:unset')\n})\n\n// Post links verified server-side\nexport const links = {}\n\nexport function addLinks(addition) {\n\tif (addition) {\n\t\t_.extend(links, addition);\n\t}\n}\n","/*\n Client-side helper functions\n */\n\nimport {_, config, state} from 'main'\n\n/**\n * Make spoiler tags toggleable on mobile\n * @param {Element}\n */\nexport function touchable_spoiler_tag(del) {\n\tdel.html = '<del onclick=\"void(0)\">'\n}\n\n/**\n * Return image upload URL\n * @returns {string}\n */\nexport function imageUploadURL() {\n\treturn (config.hard.HTTP.upload || '../upload/') + '?id='\n\t\t+ state.page.get('connID')\n}\n\n/**\n * Retrieve post number of post element\n * @param {Element} el\n * @returns {int}\n */\nexport function getNum(el) {\n\tif (!el) {\n\t    return 0\n\t}\n\treturn parseInt(el.getAttribute('id').slice(1), 10)\n}\n\n/**\n * Retrieve post number of closest parent post\n * @param {Element} el\n * @returns {int}\n */\nexport function getID(el) {\n\tif (!el) {\n    \treturn 0\n\t}\n\treturn getNum(el.closest('article, section'))\n}\n\n/**\n * Retrieve model of closest parent post\n * @param {Element} el\n * @returns {(Backbone.Model|null)}\n */\nexport function getModel(el) {\n\tconst id = getID(el)\n\tif (!id)\n\t\treturn null\n\treturn state.posts.get(id)\n}\n\n/**\n * Parse HTML string to node array\n * @param {string} string\n * @returns {Element[]}\n */\nexport function parseEls(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\tconst children = el.childNodes\n\treturn Array.from(children)\n}\n\n/**\n * Parse HTML string to Element\n * @param {string} string\n * @returns {Element}\n */\nexport function parseEl(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\treturn el.firstChild\n}\n\n/**\n * Add an event listener that filters targets according to a CSS selector\n * @param {Element} el - Target element\n * @param {string} type - Event type\n * @param {string} selector - CSS selector\n * @param {function} handler - Callback function\n */\nexport function listener(el, type, selector, handler) {\n\tel.addEventListener(type, function (event) {\n\t\tif (event.target.matches(selector))\n\t\t\thandler.call(this, event)\n\t})\n}\n\n/**\n * Add event listener to element, that will only be executed once\n * @param {Element} el - Target element\n * @param {string} type\t- Event type\n * @param {function} handler - Callback function\n */\nexport function once(el, type, handler) {\n\tel.addEventListener(type, function (event) {\n\t\thandler.call(this, event)\n\t\tel.removeEventListener(type, handler)\n\t})\n}\n\n/**\n * Return width of element with padding and margin\n * @param {Element} el\n * @returns {int}\n */\nexport function outerWidth(el) {\n\tconst style =  getComputedStyle(el),\n\t\tprops = ['marginLeft', 'marginRight', 'paddingLeft','paddingRight']\n\tlet width = 0\n\tfor (let prop of props) {\n\t\twidth += parseInt(style[prop]);\n\t}\n\treturn width\n}\n\n/**\n * Confirms email is saging\n * @param {string} email\n * @returns {bool}\n */\nexport function isSage(email) {\n\treturn email && email.trim() === 'sage'\n}\n\n\n// TODO: Refactor server time syncronisation\nlet cachedOffset;\nexport function serverTime() {\n\tconst d = Date.now();\n\tif (imports.isNode)\n\t\treturn d;\n\n\t// The offset is intialised as 0, so there is something to return, until\n\t// we get a propper number from the server.\n\tif (!cachedOffset)\n\t\tcachedOffset = imports.main.request('time:offset');\n\treturn d + cachedOffset;\n}\n\nexport function readable_dice(bit, dice) {\n\tlet inner;\n\tswitch (bit) {\n\t\tcase '#flip':\n\t\t\tinner = (dice[2] == 2).toString();\n\t\t\tbreak;\n\t\tcase '#8ball':\n\t\t\tinner = imports.hotConfig.EIGHT_BALL[dice[2] - 1];\n\t\t\tbreak;\n\t\tcase '#pyu':\n\t\tcase '#pcount':\n\t\tcase '#q':\n\t\t\tinner = dice[0];\n\t\t\tbreak;\n\t}\n\tif (inner !== undefined)\n\t\treturn _.escape(`${bit} (${inner})`);\n\tif (/^#sw/.test(bit))\n\t\treturn readableSyncwatch(dice[0]);\n\treturn readableRegularDice(bit, dice);\n}\n\nfunction readableSyncwatch(dice) {\n\tdice.class = 'embed';\n\treturn parseHTML\n\t\t`<syncwatch ${dice}>\n\t\t\tsyncwatch\n\t\t</syncwatch>`;\n}\n\nfunction readableRegularDice(bit, [max, bias, ...rolls]) {\n\tbit += ' (';\n\tconst eq = rolls.length > 1 || bias;\n\tif (eq)\n\t\tbit += rolls.join(', ');\n\tif (bias)\n\t\tbit += (bias < 0 ? ' - ' + (-bias) : ' + ' + bias);\n\tlet sum = bias;\n\tfor (let roll of rolls) {\n\t\tsum += roll;\n\t}\n\treturn bit + (eq ? ' = ' : '') + sum + ')';\n}\n\nexport function pick_spoiler(metaIndex) {\n\tconst imgs = imports.config.SPOILER_IMAGES,\n\t\tn = imgs.length;\n\tlet i;\n\tif (metaIndex < 0)\n\t\ti = Math.floor(Math.random() * n);\n\telse\n\t\ti = metaIndex % n;\n\treturn {\n\t\tindex: imgs[i],\n\t\tnext: (i + 1) % n\n\t};\n}\n\nexport const thumbStyles = ['small', 'sharp', 'hide']\n\nexport function readable_filesize(size) {\n\t/* Dealt with it. */\n\tif (size < 1024)\n\t\treturn size + ' B';\n\tif (size < 1048576)\n\t\treturn Math.round(size / 1024) + ' KB';\n\tsize = Math.round(size / 104857.6).toString();\n\treturn size.slice(0, -1) + '.' + size.slice(-1) + ' MB';\n}\n\nexport function pad(n) {\n\treturn (n < 10 ? '0' : '') + n;\n}\n\n// Various UI-related links wrapped in []\nexport function action_link_html(href, name, id, cls) {\n\treturn parseHTML\n\t\t`<span class=\"act\">\n\t\t\t<a href=\"${href}\"\n\t\t\t\t${id && ` id=\"${id}\"`}\n\t\t\t\t${cls && ` class=\"${cls}\"`}\n\t\t\t>\n\t\t\t\t${name}\n\t\t\t</a>\n\t\t</span>`;\n}\n\n/**\n * Confirm last N posts to view setting matches bounds\n * @param {int} n\n * @returns {bool}\n */\nexport function resonableLastN(n) {\n\treturn Number.isInteger(n) && n <= 500\n}\n\nexport function parse_name(name) {\n\tvar tripcode = '', secure = '';\n\tvar hash = name.indexOf('#');\n\tif (hash >= 0) {\n\t\ttripcode = name.substr(hash + 1);\n\t\tname = name.substr(0, hash);\n\t\thash = tripcode.indexOf('#');\n\t\tif (hash >= 0) {\n\t\t\tsecure = _.escape(tripcode.substr(hash + 1));\n\t\t\ttripcode = tripcode.substr(0, hash);\n\t\t}\n\t\ttripcode = _.escape(tripcode);\n\t}\n\tname = name.trim().replace(imports.hotConfig.EXCLUDE_REGEXP, '');\n\treturn [\n\t\tname.substr(0, 100), tripcode.substr(0, 128),\n\t\tsecure.substr(0, 128)\n\t];\n}\n\n/**\n * Generate a random alphannumeric string of lower and upper case hexadecimal\n * characters\n * @param {int} len\t- String length\n * @returns {string}\n */\nexport function randomID(len) {\n\tlet id = ''\n\tfor (let i = 0; i < len; i++) {\n\t\tlet char = (Math.random() * 36).toString(36)[0]\n\t\tif (Math.random() < 0.5)\n\t\t\tchar = char.toUpperCase()\n\t\tid += char\n\t}\n\treturn id\n}\n\n/**\n * Template string tag function for HTML. Strips indentation and trailing\n * newlines. Based on https://gist.github.com/zenparsing/5dffde82d9acef19e43c\n * @param {*}\n * @returns {string}\n */\nexport function parseHTML(callSite) {\n\t// if argumennts.length === 1\n\tif (typeof callSite === 'string')\n\t\treturn formatHTML(callSite);\n\tif (typeof callSite === 'function')\n\t\treturn formatHTML(callSite(args))\n\n\t/*\n\t Slicing the arguments object is deoptimising, so we construct a new array\n\t instead.\n\t */\n\tconst len = arguments.length;\n\tlet args = [];\n\tfor (let i = 1; i < len; i++) {\n\t\targs[i - 1] = arguments[i]\n\t}\n\n\tconst output = callSite\n\t\t.slice(0, len)\n\t\t.map((text, i) => {\n\t\t\tconst arg = args[i - 1]\n\t\t\tlet result;\n\t\t\t/*\n\t\t\t Simplifies conditionals. If the placeholder returns a non-zero\n\t\t\t falsy value, it is ommitted.\n\t\t\t */\n\t\t\tif (i === 0 || (!arg && arg !== 0))\n\t\t\t\tresult = ''\n\t\t\telse if (arg instanceof Object)\n\t\t\t\tresult = elementAttributes(arg)\n\t\t\telse\n\t\t\t\tresult = arg\n\n\t\t\treturn result + text\n\t\t})\n\t\t.join('')\n\n\treturn formatHTML(output)\n}\n\n/**\n * Strip leading indentation from HTML string\n */\nfunction formatHTML(str) {\n\tlet size = -1;\n\treturn str\n\t\t.replace(/\\n(\\s+)/g, (m, m1) => {\n\t\t\tif (size < 0)\n\t\t\t\tsize = m1.replace(/\\t/g, '    ').length\n\t\t\treturn m1.slice(Math.min(m1.length, size))\n\t\t})\n\t\t// Remove empty lines\n\t\t.replace(/^\\s*\\n/gm, '')\n}\n\n/**\n * Generate an HTML element attribute list\n */\nfunction elementAttributes(attrs) {\n\tlet html = '';\n\tfor (let key in attrs) {\n\t\thtml += ' '\n\t\tconst val = attrs[key]\n\t\tif (val === true)\n\t\t\thtml += key\n\t\telse if (val || val === 0)\n\t\t\thtml += `${key}=\"${val}\"`\n\t}\n\treturn html\n}\n\n/**\n * Makes a ', ' seperated list out of on array of strings\n * @param {string[]} items\n * @returns {string}\n */\nexport function commaList(items) {\n\tlet html = ''\n\tfor (let item of items) {\n\t\t// Falsy value. Skip item.\n\t\tif (!item && item !== 0)\n\t\t\tcontinue\n\t\tif (html)\n\t\t\thtml += ', '\n\t\thtml += item\n\t}\n\treturn html\n}\n\n/**\n * Acertains client has the proper authorisation to perfrom task. This is only\n * for rendering. The same validation is performed server-side.\n * @param {string} action - Privilidged action to check permission for\n * @returns {bool}\n */\nexport function checkAuth(action) {\n\tconst cls = config.staff.classes[main.ident && main.ident.auth]\n    return cls && !!cls.rights[action]\n}\n","/*\n * Loads the dependancies in order and aggregates exports from various modules\n */\n\n// NOTE: The entire bundle uses strict mode through the Babel transpiler\n\n/*\n * Because we are going to attach listeners to these all over the place, have\n * to load soome core modules in specific order. Also avoids nasty circular\n * dependancy, by placing some of the exports here and not in child modules.\n */\nconst _ = require('underscore'),\n\tBackbone = require('backbone'),\n\tCookie = require('js-cookie'),\n\tradio = require('backbone.radio')\n\nimport FSM from './fsm'\n\n// Load standard library ES6 polyfills\nrequire('core-js')\n// Load DOM level 4 polyfill\nrequire('dom4')\n// Load Backbone.View native JS replacement\nrequire('backbone.nativeview')\nBackbone.View = Backbone.NativeView\n\n// Central aplication object\nconst main = module.exports = {\n\t// Bind dependancies to main object for pretier destructuring requires\n\t_, Backbone, Cookie, FSM,\n\t$script: require('scriptjs'),\n\tSockJS: require('sockjs-client'),\n\n\t// Message and event bus\n\tevents: radio.channel('main'),\n\n\t/*\n\t Ofload expensive and not that neccessary initialisation logic till\n\t after the core modules are started\n\t */\n\t_deferred: [],\n\tdefer(func) {\n\t\tmain._deferred.push(func)\n\t\treturn main\n\t},\n\texecDefered() {\n\t\tfor (let func of this._deferred) {\n\t\t\tfunc()\n\t\t}\n\t},\n\n\t// Websocket call handler map. Store them here, to avoid requiring\n\t// modules in the wrong order.\n\tdispatcher: {}\n}\n\n// Import configuration variables from the template HTML\n_.extend(main, {config, configHash, clientHash, isMobile})\n\n// Clear cookies, if versions mismatch. Get regenerated each client start\n// anyway.\nconst cookieVersion = 3\nif (localStorage.cookieVersion != cookieVersion) {\n\tfor (let cookie in Cookie.get()) {\n\n\t\t// Clear legacy cookies that were set for each board separatly.\n\t\t// Otherwise, they would override the new ones.\n\t\tconst paths = main.config.boards.enabled.slice()\n\t\tpaths.push('', '/')\n\t\tfor (let path of paths) {\n\t\t\tCookie.remove(cookie, {path})\n\t\t}\n\t}\n\tlocalStorage.cookieVersion = cookieVersion\n}\n\n// You can invoke the client-side debug mode with the `debug=true` query string\nif (/[&\\?]debug=true/.test(location.href))\n\tmain.config.hard.debug = true\nif (main.config.hard.debug) {\n\tradio.DEBUG = true\n\twindow.Backbone = Backbone // Export Backbone instance for easier debugging\n\tradio.tuneIn('main') // Log all channel traffic\n}\n\n/*\n Core modules. The other will be more or less decoupled, but these are the\n monolithic foundation.\n */\nmain.Memory = require('./memory')\nconst lang = main.lang = require('lang'),\n\tstate = main.state = require('./state'),\n\tutil = main.util = require('./util')\n\n// Shorthands\nmain.send = main.events.request.bind(main.events, 'send')\nfor (let fn of ['parseHTML', 'parseEl', 'parseEls']) {\n    main[fn] = util[fn]\n}\n\n/*\n// Initialise main rendering object\nlet oneeSama = main.oneeSama = new common.OneeSama({\n\top: state.page.get('thread'),\n\tlang,\n\t// Core post link handler\n\ttamashii(num) {\n\t\tlet frag;\n\t\tconst op = state.links[num];\n\t\tif (op) {\n\t\t\tconst desc = num in state.mine.readAll() && this.lang.you;\n\t\t\tfrag = this.postRef(num, op, desc);\n\t\t}\n\t\telse\n\t\t\tfrag = '>>' + num;\n\t\treturn frag;\n\t}\n});\n*/\n\nmain.options = require('./options')\nmain.scroll = require('./scroll')\nmain.follow = main.scroll.followDOM // Shorthand\nstate.page.set('tabID', util.randomID(32))\n\n// Load language-specific CSS\ndocument.head.appendChild(util.parseEl(util.parseHTML\n\t`<style>\n\t\t.locked:after {\n\t\t\tcontent: \"${lang.thread_locked}\";\n\t\t}\n\t\t.locked > header nav:after {\n\t\t\tcontent: \" (${lang.locked})\";\n\t\t}\n\t</style>`))\n\n_.extend(main, {\n\t// Cached DOM elements\n\t$threads: document.query('threads'),\n\t$name: document.query('#name'),\n\t$email: document.query('#email'),\n\t$banner: document.query('#banner'),\n\n\tconnSM: new FSM('load'),\n\tpostSM: new FSM('none')\n})\n\n/*\n// 2nd tier dependacy modules. These are needed before the websocket\n// connection is opened, because they populate the dispatcher handler object.\n_.extend(main, {\n\tloop: require('./loop'),\n\ttime: require('./time'),\n\tamusement: require('./amusement')\n});\n\n// Load post models and views\nmain.posts = require('./posts')\nmain.Extract = require('./extract')\n// Start the client\nmain.client = require('./client')\nmain.conection = require('./connection')\n\n// Load independant auxilary modules\n_.extend(main, {\n\thistory: require('./history'),\n\thide: require('./hide')\n})\n*/\n\nmain.execDefered()\nmain.events.request('loading:hide')\n"],"sourceRoot":"/source/"}