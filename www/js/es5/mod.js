require=function e(t,n,r){function o(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var i=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=o(["<form>\n				",'\n				<input type="submit" value="','">\n			</form>'],["<form>\n				",'\n				<input type="submit" value="','">\n			</form>']),l=o(["<input ",">"],["<input ",">"]),s=o(["<label ",'>\n				<input type="checkbox">\n				',"\n			</label>"],["<label ",'>\n				<input type="checkbox">\n				',"\n			</label>"]),d=o(['<b class="reasonPrompt admin">\n					',"\n				</b>"],['<b class="reasonPrompt admin">\n					',"\n				</b>"]),c=e("main"),u=e("./util"),h=c.$,f=c.Backbone,m=c.common,p=c.lang,v=c.modals,y=m.parseHTML,g=f.View.extend({className:"mod inputBox",events:{submit:"submit"},initialize:function(){v[this.type]=this,this.render()},render:function(){var e=y(a,this.renderInput(),p.send);this.$el.html(e).prependTo(c.$toolbox.$el).find("input").first().focus()},submit:function(e){e.preventDefault();var t=[];h(e.target).find("input[type!=submit]").each(function(){t.push("checkbox"===this.type?this.checked:this.value)}),this.handler(t)},kill:function(){delete v[this.type],this.remove()}}),b=g.extend({type:"notification",renderInput:function(){return y(l,{type:"text",size:25,placeholder:p.mod.placeholders.msg})},handler:function(e){c.send([m.NOTIFICATION,e[0]]),this.kill()}});n.notification=b;var k=g.extend({type:"ban",renderInput:function(){for(var e="",t=["days","hours","minutes"],n=0;n<t.length;n++){var r=t[n];e+=y(l,{type:"number",placeholder:p.mod.placeholders[r]})}e+=y(l,{type:"text",size:25,placeholder:p.mod.placeholders.reason});var o=i(p.mod.displayBan,2),a=o[0],d=o[1];return e+=y(s,{title:d},a)},handler:function(e){if(!e[3])return this.renderReasonPrompt();for(var t=0;3>t;t++)e[t]=+e[t];e[4]=+e[4];var n=!0,o=!1,i=void 0;try{for(var a,l=u.getSelected()[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var s=a.value;c.send([m.BAN,s].concat(r(e)))}}catch(d){o=!0,i=d}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw i}}this.kill()},renderReasonPrompt:function(){this.$el.find(".reasonPrompt").remove(),this.$el.append(y(d,p.mod.needReason)).find("input[type=text]").focus()}});n.ban=k},{"./util":5,main:void 0}],2:[function(e,t,n){"use strict";function r(e,t){var n="<table>",r=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value;n+="<tr>";var d=!0,c=!1,u=void 0;try{for(var h,f=t(s)[Symbol.iterator]();!(d=(h=f.next()).done);d=!0){var m=h.value;n+="<td>"+m+"</td>"}}catch(p){c=!0,u=p}finally{try{!d&&f["return"]&&f["return"]()}finally{if(c)throw u}}n+="</tr>"}}catch(p){o=!0,i=p}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw i}}return n+="</table>"}var o=e("main"),i=o._,a=o.Backbone,l=o.common,s=o.dispatcher,d=o.etc,c=o.oneeSama,u=o.lang,h=o.modals,f=o.Memory,m=o.state,p=a.View.extend({className:"modal mod panel glass",initialize:function(){var e=this;this.$el.appendTo(o.$overlay),h[this.type]=this,s[this.kind]=function(t){return e.render(t[0])},o.send([this.kind])},render:function(e){return e.length?(this.el.innerHTML=this.renderContents(e),this.postRender&&this.postRender(),this.el.scrollTop=this.el.scrollHeight,this):this.el.innerHTML="God's in his Heaven. All's right with the world."},kill:function(){delete s[this.kind],delete h[this.type],this.remove()}}),v=p.extend({type:"log",kind:l.MOD_LOG,renderContents:function(e){return r(e,function(e){return[e.num?c.postRef(e.num,e.op):"",u.mod.formatLog(e),c.time(e.time)]})}});n.log=v;var y=p.extend({type:"adminPanel",id:"adminPanel",kind:l.ADMIN_PANEL,events:{"click .unban":"unban"},renderContents:function(e){var t=this;return this.banCount=0,r(e,function(e){return t.banCount++,[c.mnemonic(e[0]),c.time(e[1]),'<a class="unban" data-id="'+e[0]+'">'+u.mod.unban+"</a>"]})},unban:function(e){var t=e.target;o.send([l.UNBAN,t.getAttribute("data-id")]),t.parentElement.parentElement.remove(),--this.banCount||this.kill()}});n.adminPanel=y;var g=p.extend({type:"djPanel",events:{"click .close":"removeRequest","click #rescan":"scan"},initialize:function(){o.$overlay[0].append(this.el),h[this.type]=this,this.removed=new f("request",2),this.scan()},scan:function(){var e=this.removed.readAll(),t=[],n=!0,r=!1,o=void 0;try{for(var a,l=m.posts.models[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var s=a.value.attributes;if(!(s.num in e)){var d=s.body.match(/\/r\/[^\n]+$/gm);if(d){var c=!0,u=!1,h=void 0;try{for(var f,p=d[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;v=v.replace("/r/","").trim(),t.push([s.num,s.mnemonic,v])}}catch(y){u=!0,h=y}finally{try{!c&&p["return"]&&p["return"]()}finally{if(u)throw h}}}}}}catch(y){r=!0,o=y}finally{try{!n&&l["return"]&&l["return"]()}finally{if(r)throw o}}return this.render(i.sortBy(t,1))},renderContents:function(e){return r(e,function(e){return[c.postRef(e[0],c.op).safe,c.mnemonic(e[1]),e[2],'<a class="close" data-id="'+e[0]+'">X</a>']})},postRender:function(){this.el.append(d.parseDOM('<a id="rescan">'+u.rescan+"</a>")[0])},removeRequest:function(e){e.preventDefault();var t=e.target;this.removed.write(t.getAttribute("data-id")),t.closest("tr").remove()}});n.djPanel=g},{main:void 0}],3:[function(e,t,n){"use strict";function r(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function o(e,t,n){var r=e[t];e[t]=function(){for(var e=arguments.length,t=Array(e),o=0;e>o;o++)t[o]=arguments[o];return n.call.apply(n,[this,r].concat(t))}}var i=r(['<label title="','" class="mod">\n		<input type="checkbox" id="authName">\n		 ',"\n	 </label>"],['<label title="','" class="mod">\n		<input type="checkbox" id="authName">\n		 ',"\n	 </label>"]),a=e("main"),l=(a.etc,a.lang),s=a.state,d=a.ident.auth;a.$name.after(a.common.parseHTML(i,l.mod.title[1],l.mod.title[0]));var c=a.$("#authName");a.oneeSama.hook("fillMyName",function(e){var t=c[0].checked;t&&(e.classList.add("admin"===d?"admin":"moderator"),e.append(document.createTextNode(" ## "+s.hotConfig.get("staff_aliases")[d])))}),c.change(function(){return a.request("postForm:indentity")}),o(a.posts.posting.ComposerView.prototype,"allocationMessage",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var o=e.call.apply(e,[this].concat(n));return c[0].checked&&(o.auth=d),o})},{main:void 0}],4:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var i=o(['<a class="modButton" data-kind="','" title="','">\n					',"\n				</a>"],['<a class="modButton" data-kind="','" title="','">\n					',"\n				</a>"]),a=o(["<style>\n				.postCheckbox {\n					display: inline-block;\n				}\n			</style>"],["<style>\n				.postCheckbox {\n					display: inline-block;\n				}\n			</style>"]),l=o(["<style>\n				header > .mod.addr {\n					display: none;\n				}\n			</style>"],["<style>\n				header > .mod.addr {\n					display: none;\n				}\n			</style>"]),s=e("main"),d=e("./input"),c=e("./panels"),u=e("./util"),h=s.$,f=(s._,s.Backbone),m=s.common,p=s.lang,v=s.modals,y=m.parseHTML,g={ban:d.ban,log:e("./panels").log,adminPanel:c.adminPanel,notification:d.notification,djPanel:c.djPanel},b=f.View.extend({id:"toolbox",className:"mod modal panel glass",initialize:function(){this.render()},render:function(){var e=this.specs=["clearSelection","spoilerImages","deleteImages","deletePosts","modLog"];"dj"===s.ident.auth&&(e=this.specs=["djPanel"]);var t=[["dj",["toggleMnemonics"]],["moderator",["lockThreads","ban"]],["admin",["sendNotification","renderPanel"]]],n=!0,r=!1,o=void 0;try{for(var d,c=t[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var u=d.value;if(!m.checkAuth(u[0],s.ident))break;u[1].forEach(function(t){return e.push(t)})}}catch(f){r=!0,o=f}finally{try{!n&&c["return"]&&c["return"]()}finally{if(r)throw o}}for(var v="<span>",g=0;g<e.length;g++){var b=p.mod[e[g]];v+=y(i,g,b[1],b[0])}return v+="</span>",this.$controls=h(v),this.$checkboxToggle=h(y(a)).appendTo("head").prop("disabled",!0),this.$toggle=h('<a id="toolboxToggle">'+p.show+"</a>"),this.$el.prepend(this.$controls,this.$toggle).appendTo(s.$overlay),this.$mnemonicStyle=h(y(l)).appendTo("head").prop("disabled","true"!==localStorage.noMnemonics),this},events:{"click #toolboxToggle":"toggleButtons","click .modButton":"buttonHandler"},toggleButtons:function(){var e=!this.model.get("shown");this.$toggle.text(p[e?"hide":"show"]),this.$controls.toggle(0),this.$checkboxToggle.prop("disabled",!e),this.model.set("shown",e)},buttonHandler:function(e){this[this.specs[e.target.getAttribute("data-kind")]](e)},clearSelection:function(){u.loopCheckboxes(function(e){return e.checked=!1})},toggleMnemonics:function(){var e="true"===localStorage.noMnemonics;this.$mnemonicStyle.prop("disabled",e),localStorage.noMnemonics=!e},send:function(e){s.send([m[e]].concat(r(u.getSelected())))},spoilerImages:function(){this.send("SPOILER_IMAGES")},deleteImages:function(){this.send("DELETE_IMAGES")},toggleChild:function(e){v[e]?v[e].kill():new g[e]},sendNotification:function(){this.toggleChild("notification")},modLog:function(){this.toggleChild("log")},djPanel:function(){this.toggleChild("djPanel")},ban:function(){this.toggleChild("ban")},renderPanel:function(){this.toggleChild("adminPanel")},deletePosts:function(){this.send("DELETE_POSTS")},lockThreads:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=u.getSelected()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value,a=s.state.posts.get(i);a&&!a.get("op")&&s.send([m[a.get("locked")?"UNLOCK_THREAD":"LOCK_THREAD"],i])}}catch(l){t=!0,n=l}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}}});s.$toolbox=new b({model:new f.Model})},{"./input":1,"./panels":2,"./util":5,main:void 0}],5:[function(e,t,n){"use strict";function r(){var e=[];return o(function(t){return t.checked&&e.push(i.etc.getID(t))}),i._.compact(e)}function o(e){for(var t=i.$threads[0].getElementsByClassName("postCheckbox"),n=0;n<t.length;n++)e(t[n])}var i=e("main");n.getSelected=r,n.loopCheckboxes=o},{main:void 0}],mod:[function(e,t,n){"use strict";var r=e("main"),o=r.$,i=r.config,a=r.ident=window.IDENT;window.loggedInUser=a.email,window.x_csrf=a.csrf,r.$overlay=o('<div id="modOverlay"></div>').appendTo("body"),r.modals={},e("./title"),e("./toolbox"),o("<link/>",{rel:"stylesheet",href:i.MEDIA_URL+"css/mod.css?v="+r.cssHash}).appendTo("head");var l=i.STAFF_BOARD;o("#navTop").children("a").last().after(' / <a href="../'+l+'/" class="history">'+l+"</a>")},{"./title":3,"./toolbox":4,main:void 0}]},{},[]);
//# sourceMappingURL=mod.js.map
