"use strict";System.register([],function(e){function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function t(e,n){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var a,s,i,r,o,l,h,u,c,g,d,m,f,p,v,y,b,k,w,_,x,T,S,L,M,I,U,R,N,P,q,C,D;return{setters:[],execute:function(){a=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),s=t([">>(d+|>/watch?v=[w-]{11}(?:#t=[dhms]{1,9})?\n		|>/soundcloud/[w-]{1,40}/[w-]{1,80}|>/pastebin/w+"],[">>(\\d+|>\\/watch\\?v=[\\w-]{11}(?:#t=[\\dhms]{1,9})?\n		|>\\/soundcloud\\/[\\w-]{1,40}\\/[\\w-]{1,80}|>\\/pastebin\\/\\w+"]),i=t(["|>/","/(?:w+/?)?"],["|>\\/","\\/(?:\\w+\\/?)?"]),r=t(['<a target="_blank"\n					rel="nofollow"\n					class="imageSearch ','"\n					href="',""],['<a target="_blank"\n					rel="nofollow"\n					class="imageSearch ','"\n					href="',""]),o=t(['<section id="p','" class="','">\n				<div class="background glass">\n					','\n					<span class="omit"></span>\n				</div>\n			</section>'],['<section id="p','" class="','">\n				<div class="background glass">\n					','\n					<span class="omit"></span>\n				</div>\n			</section>']),l=t(['<article id="p','" class="','">\n				',"\n			</article>"],['<article id="p','" class="','">\n				',"\n			</article>"]),h=t(["","\n			",'\n			<div class="container">\n				',"\n				<blockquote>\n					","\n				</blockquote>\n				<small>\n					","\n				</small>\n				","\n			</div>"],["","\n			",'\n			<div class="container">\n				',"\n				<blockquote>\n					","\n				</blockquote>\n				<small>\n					","\n				</small>\n				","\n			</div>"]),u=t(['<header>\n				<input type="checkbox" class="postCheckbox">\n				',"\n				","\n				","\n				","\n				",'\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>'],['<header>\n				<input type="checkbox" class="postCheckbox">\n				',"\n				","\n				","\n				","\n				",'\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>']),c=t(["<a ",">"],["<a ",">"]),g=t(['<time title="','">\n				',"\n			</time>"],['<time title="','">\n				',"\n			</time>"]),d=t(['<nav>\n				<a href="','" class="history">\n					No.\n				</a>\n				<a href="','" class="quote">\n					',"\n				</a>\n			</nav>"],['<nav>\n				<a href="','" class="history">\n					No.\n				</a>\n				<a href="','" class="quote">\n					',"\n				</a>\n			</nav>"]),m=t(['<span class="act expansionLinks">\n				<a href="','" class="history">\n					','\n				</a>\n				] [\n				<a href="',"?last=",'" class="history">\n					'," ","\n				</a>\n			</span>"],['<span class="act expansionLinks">\n				<a href="','" class="history">\n					','\n				</a>\n				] [\n				<a href="',"?last=",'" class="history">\n					'," ","\n				</a>\n			</span>"]),f=t(["^>/(",")/(w+/?)?"],["^>\\/(",")\\/(\\w+\\/?)?"]),p=t(["<a ",">\n				>>","\n			</a>"],["<a ",">\n				>>","\n			</a>"]),v=t(['<a href="','" rel="nofollow" target="_blank">\n						',"\n					</a>"],['<a href="','" rel="nofollow" target="_blank">\n						',"\n					</a>"]),y=t(["<figure>\n				","\n				","\n				","\n			</figure>"],["<figure>\n				","\n				","\n				","\n			</figure>"]),b=t(["<figcaption>\n				","\n				","\n				<span>\n					(",")\n				</span>\n				","\n			</figcaption>"],["<figcaption>\n				","\n				","\n				<span>\n					(",")\n				</span>\n				","\n			</figcaption>"]),k=t(['<a class="imageToggle">\n				[',"]\n			</a>"],['<a class="imageToggle">\n				[',"]\n			</a>"]),w=t(["<a ",">\n				","\n			</a>"],["<a ",">\n				","\n			</a>"]),_=t(["<a ",">\n				<img ",">\n			</a>"],["<a ",">\n				<img ",">\n			</a>"]),x=t(["","","",".png"],["","","",".png"]),T=t(['<aside class="act glass ','">\n				<a ',"\n					","\n				>\n					","\n				</a>\n			</aside>"],['<aside class="act glass ','">\n				<a ',"\n					","\n				>\n					","\n				</a>\n			</aside>"]),S=require("underscore"),L=require("./index"),M=require("./util"),I=imports,U=I.config,R=M.pad,N=M.parseHTML,P=new RegExp("(\\S{"+L.WORD_LENGTH_LIMIT+"})"),q=function(){var e=String.raw(s).replace(/[\n\t]+/gm,"");for(var n in U.link_targets)e+=String.raw(i,n);return e+=")",new RegExp(e)}(),C=function(){for(var e=[{"class":"google",url:"https://www.google.com/searchbyimage?image_url=",type:"thumb",symbol:"G"},{"class":"iqdb",url:"http://iqdb.org/?url=",type:"thumb",symbol:"Iq"},{"class":"saucenao",url:"http://saucenao.com/search.php?db=999&url=",type:"thumb",symbol:"Sn"},{"class":"desustorage",type:"MD5",url:"https://desustorage.org/_/search/image/",symbol:"Ds"},{"class":"exhentai",type:"SHA1",url:"http://exhentai.org/?fs_similar=1&fs_exp=1&f_shash=",symbol:"Ex"}],n=[],t=0,a=e.length;a>t;t++){var s=e[t];n[t]=[N(r,s["class"],s.url),s.type,'">'+s.symbol+"</a>"]}return n}(),D=function(){function e(t){n(this,e),S.extend(this,t),this.hooks={}}return a(e,[{key:"hook",value:function(e,n){var t=this.hooks[e];t?t.indexOf(n)<0&&t.push(n):this.hooks[e]=[n]}},{key:"trigger",value:function(e,n){var t=this.hooks[e];if(t)for(var a=0;a<t.length;a++)t[a].call(this,n)}},{key:"section",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return this.setModel(e),e.locked&&(n+=" locked"),e.editing&&(n+=" editing"),N(o,e.num,n,this.monogatari(e))}},{key:"article",value:function(e){this.setModel(e);var n="glass";return e.editing&&(n+=" editing"),N(l,e.num,n,this.monogatari(e))}},{key:"setModel",value:function(e){return this.model=e,this.state=[0,0,0,0],this}},{key:"monogatari",value:function(e){var n=e.image,t=e.mod,a=e.body,s=e.backlinks,i=e.banned;return n&&!e.op&&(n.large=!0),N(h,this.header(e),n&&this.image(n),t&&this.modInfo(t),this.body(a),this.backlinks(s),i&&this.banned())}},{key:"header",value:function(e){return N(u,e.subject&&"<h3>「"+S.escape(e.subject)+"」</h3>",this.name(e),this.time(e.time),this.postNavigation(e),!this.full&&!e.op&&this.expansionLinks(e.num))}},{key:"name",value:function(e){var n='<b class="name',t=e.auth,a=e.email;return t&&(n+=" "+("admin"===t?"admin":"moderator")),n+='">',a&&(n+=N(c,{"class":"email",href:"mailto:"+encodeURI(a),target:"blank"})),n+=this.resolveName(e),a&&(n+="</a>"),n+="</b>",e.mnemonic&&(n+=" "+this.mnemonic(e.mnemonic)),n}},{key:"resolveName",value:function(e){var n="",t=e.trip,a=e.name,s=e.auth;return(a||!t)&&(n+=a?S.escape(a):this.lang.anon,t&&(n+=" ")),t&&(n+="<code>"+S.escape(t)+"</code>"),s&&(n+=" ## "+(imports.hotConfig.staff_aliases[s]||s)),n}},{key:"time",value:function(e){var n=void 0,t=void 0,a=this.readableTime(e);return this.rTime&&(n=a,t=this.relativeTime(e,Date.now())),N(g,n,t||a)}},{key:"readableTime",value:function(e){var n=new Date(e);return R(n.getDate())+" "+this.lang.year[n.getMonth()]+" "+n.getFullYear()+("("+this.lang.week[n.getDay()]+")")+(R(n.getHours())+":"+R(n.getMinutes()))}},{key:"readableUTCTime",value:function(e,n){var t=R(e.getUTCDate())+" "+this.lang.year[e.getUTCMonth()]+" "+e.getUTCFullYear()+("("+this.lang.week[e.getUTCDay()]+")")+(R(e.getUTCHours())+":"+R(e.getUTCMinutes()));return n&&(t+=":"+R(e.getUTCSeconds())),t+=" UTC"}},{key:"relativeTime",value:function(e,n){var t=Math.floor((n-e)/6e4),a=void 0;if(1>t){if(t>-5)return this.lang.just_now;a=!0,t=-t}for(var s=[60,24,30,12],i=["minute","hour","day","month"],r=0;r<s.length;r++){if(t<s[r])return this.lang.ago(t,this.lang["unit_"+i[r]],a);t=Math.floor(t/s[r])}return this.lang.ago(t,this.lang.unit_year,a)}},{key:"mnemonic",value:function(e){return'<b class="mod addr">'+e+"</b>"}},{key:"postNavigation",value:function(e){var n=e.num,t=e.op;return N(d,this.postURL(n,t),this.postURL(n,t),n)}},{key:"postURL",value:function(e,n){return n=n||e,(this.op==n?"":n)+"#"+e}},{key:"expansionLinks",value:function(e){return N(m,e,this.lang.expand,e,this.lastN,this.lang.last,this.lastN)}},{key:"modInfo",value:function(e){var n='<b class="modLog admin">',t=!0,a=!1,s=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;n+=this.lang.mod.formatLog(o)+"<br>"}}catch(l){a=!0,s=l}finally{try{!t&&r["return"]&&r["return"]()}finally{if(a)throw s}}return n+="</b>"}},{key:"banned",value:function(){return'<b class="admin banMessage">'+this.lang.mod.banMessage+"</b>"}},{key:"body",value:function(e){var n=this.fragment(e);return this.state[1]&&(n+="</em>"),this.state[2]&&(n+="</del>"),n}},{key:"fragment",value:function(e){for(var n=this,t=e.split("\n"),a=this.state,s="",i=0;i<t.length;i++){a[0]&&i%2&&(a[1]%2&&(s+="</em>",a[1]++),s+="<br>",a[0]=0);var r=t[i];!a[0]&&r.startsWith(">")&&(s+="<em>",a[1]++),e&&(r.split(" ").forEach(function(e){return s+=n.parseWord(e)}),a[0]=1)}return s}},{key:"parseWord",value:function(e){for(var n=e.split(/\[\/?spoiler]/i),t="",a=0;a<n.length;a++){a%2&&(t+="<"+(this.state[2]%2?"/":"")+"del>",this.state[2]++);var s=n[a],i=s.match(q);i&&(t+=this.redString(i[1]),s=s.replace(q,"")),t+=this.parseHashes(s)}return t}},{key:"redString",value:function(e){var n=void 0,t=void 0;/^>\/watch/.test(e)?(n="https://www.youtube.com/"+e.slice(2),t="embed watch"):/^>\/soundcloud/.test(e)?(n="https://soundcloud.com/"+e.slice(13),t="embed soundcloud"):/^>\/pastebin/.test(e)&&(n="https://pastebin.com/"+e.slice(11),t="embed pastebin");for(var a in U.link_targets){var s=e.match(new RegExp(String.raw(f,a)));if(s){n=U.link_targets[a],s[2]&&(n+=s[2]);break}}if(!n)return this.tamashii(parseInt(e,10));var i={href:encodeURI(n),target:"_blank",rel:"nofollow","class":t};return N(p,i,S.escape(e))}},{key:"parseHashes",value:function(e){if(!this.model.dice)return this.linkify(e);for(var n="",t=e.split(M.dice_re),a=0;a<t.length;a++){var s=t[a];if(a%2&&M.parse_dice(s))if(this.queueRoll)this.queueRoll(s);else{this.state[0]&&(n+=" ");var i=this.model.dice[this.state[3]++];n+="<strong>"+M.readable_dice(s,i)+"</strong>"}else n+=this.linkify(s)}return n}},{key:"linkify",value:function(e){if(!this.eLinkify)return this.padWord(S.escape(e));for(var n="",t=e.split(/(https?:\/\/[^\s"<>]*[^\s"<>'.,!?:;])/),a=0,s=t.length;s>a;a++){var i=S.escape(t[a]);a%2?n+=N(v,i,this.padWord(i)):i&&(n+=this.padWord(i))}return n}},{key:"padWord",value:function(e){return this.state[0]&&(e=" "+e),e}},{key:"backlinks",value:function(e){if(!e)return"";var n="";for(var t in e)n&&(n+=" "),n+=this.postRef(t,e[t]);return n}},{key:"image",value:function(e,n){var t="hide"!==this.thumbStyle||n;return N(y,this.figcaption(e,n),t&&U.IMAGE_HATS&&'<span class="hat"></span>',t&&this.thumbnail(e))}},{key:"figcaption",value:function(e,n){var t=M.commaList([e.audio&&"♫",e.length,M.readable_filesize(e.size),e.dims[0]+"x"+e.dims[1],e.apng&&"APNG"]);return N(b,"hide"===this.thumbStyle&&this.hiddenToggle(n),this.imageSearch(e),t,this.imageLink(e))}},{key:"hiddenToggle",value:function(e){return N(k,this.lang[e?"hide":"show"])}},{key:"imageSearch",value:function(e){var n="",t=C;[".pdf",".mp3"].indexOf(e.ext)>-1&&(t=[t[0]]);for(var a=this.thumbPath(e),s=0,i=t.length;i>s;s++){var r=t[s];n+=r[0]+encodeURI("thumb"!==r[1]?e[r[1]]:a)+r[2]}return n}},{key:"thumbPath",value:function(e,n){var t="thumb";return n&&e.mid?t="mid":e.thumb||(t="src"),this.imagePaths()[t]+e[t]}},{key:"imagePaths",value:function(){if(!this._imgPaths){var e=U.MEDIA_URL;this._imgPaths={src:e+"src/",thumb:e+"thumb/",mid:e+"mid/",spoil:e+"spoil/spoiler"}}return this._imgPaths}},{key:"imageLink",value:function(e){var n="",t=e.imgnm,a=t.match(/^(.*)\.\w{3,4}$/);a&&(n=a[1]);var s=S.escape(t),i=n.length>=38;i&&(t=S.escape(n.slice(0,30))+"(&hellip;)"+S.escape(e.ext));var r={href:U.SECONDARY_MEDIA_URL+"src/"+e.src,rel:"nofollow",download:s};return i&&(r.title=s),N(w,r,t)}},{key:"thumbnail",value:function(e,n){var t=this.imagePaths(),a=e.dims,s=t.src+e.src,i=void 0,r=a[0],o=a[1],l=a[2],h=a[3];if(e.spoiler&&this.spoilToggle){var u=this.spoilerInfo(e);i=u.thumb,l=u.dims[0],h=u.dims[1]}else i=".gif"===e.ext&&this.autoGif?s:this.thumbPath(e,"small"!==this.thumbStyle);l||(l=r,h=o);var c={target:"_blank",rel:"nofollow",href:n||s},g={src:i,width:l,height:h};return n&&(c["class"]="history",g["class"]="expanded","hide"==this.thumbStyle&&(g.style="display: none")),N(_,c,g)}},{key:"spoilerInfo",value:function(e){var n=e.large||"small"!==this.thumbStyle;return{thumb:N(x,this.imagePaths().spoil,n&&"s",e.spoiler),dims:U[e.large?"THUMB_DIMENSIONS":"PINKY_DIMENSIONS"]}}},{key:"postRef",value:function(e,n,t){var a="&gt;&gt;"+e;return t&&(a+=" "+t),this.op&&this.op!=n?a+=" ➡":e==n&&this.op==n&&(a+=" (OP)"),'<a href="'+this.postURL(e,n)+'" class="history">'+a+"</a>"}},{key:"asideLink",value:function(e,n,t,a){return N(T,t,n&&'href="'+n+'"',a&&' class="'+a+'"',this.lang[e]||e)}},{key:"replyBox",value:function(){return this.asideLink("reply",null,"posting")}},{key:"newThreadBox",value:function(){return this.asideLink("newThread",null,"posting")}}]),e}(),module.exports=D}}});
//# sourceMappingURL=../maps/common/oneesama.js.map
