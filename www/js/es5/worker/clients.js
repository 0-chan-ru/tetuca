"use strict";System.register(["../common","underscore"],function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a,r,i,s,o,u,c,h;return{setters:[function(e){a=e.randomID,r=e.WeakSetMap,i=e.message},function(e){s=e.extend}],execute:function(){o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),e("byID",u={}),e("byID",u),e("byPage",c=new r),e("byPage",c),self.onmessage=function(e){return new h(e)},h=function(){function e(t){n(this,e),this.port=t.ports[0],this.port.onmessage=this.receive.bind(this),this.setState(t.data);var r=void 0;do r=a(8);while(r in u);this.id=r,u[r]=this}return o(e,[{key:"setState",value:function(e){this.unsetState();var t=this.parseURL(e);s(this,t);var n=t.board,a=t.thread;c.add(a?a:n,this)}},{key:"unsetState",value:function(){c.remove(this.board,this),c.remove(this.thread,this)}},{key:"parseURL",value:function(e){for(var t={board:e.match(/\/([a-zA-Z0-9]+?)\//)[1],thread:e.match(/\/(\d+)(:?#\d+)?(?:[\?&]\w+=\w+)*$/),lastN:e.match(/[\?&]last=(\d+)/)},n=["thread","lastN"],a=0;a<n.length;a++){var r=n[a],i=t[r];t[r]=i?parseInt(i[1]):0}return t}},{key:"remove",value:function(){this.unsetState(),this.port.close(),delete u[this.id]}},{key:"receive",value:function(e){switch(e.data){case i.disconnect:this.remove();break;default:throw new Error("Unknown client message type: "+e.data)}}}]),e}()}}});
//# sourceMappingURL=../maps/worker/clients.js.map
