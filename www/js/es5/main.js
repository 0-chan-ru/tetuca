require=function e(t,n,i){function a(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return a(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(require,module,exports){"use strict";var _slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(l){a=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),main=require("./main"),$=main.$,common=main.common,state=main.state,oneeSama=main.oneeSama;oneeSama.hook("imouto",function(e){e.queueRoll=function(e){var t=this.allRolls.sent++,n=this.allRolls[t];n||(n=this.allRolls[t]={}),n.bit=e,n.$tag=$(this.callback("<strong>")),this.strong=!0,this.callback(n.dice?common.readable_dice(e,n.dice):e),this.strong=!1,this.callback("</strong>")},e.allRolls={sent:0,seen:0}}),oneeSama.hook("insertOwnPost",function(e){var t=e.dice,n=main.request("postForm");if(n&&n.imouto&&t)for(var i=n.imouto.allRolls,a=0,r=t.length;r>a;a++){var o=i.seen++,s=i[o];if(s||(s=i[o]={}),s.dice=t[a],s.$tag){var l=common.readable_dice(s.bit,s.dice);s.$tag.html(l)}}}),main.dispatcher[common.EXECUTE_JS]=function(_ref2){var _ref3=_slicedToArray(_ref2,1),js=_ref3[0];try{eval(js)}catch(e){console.error(e)}}},{"./main":"main"}],2:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(e){var n=m.mine.readAll();for(var i in e)i in n&&l.request("repliedToMe",t)}}function r(e,t){var n=m.posts.get(e);n&&t(n)}var o,s=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(l){a=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./main"),c=l._,u=l.common,d=l.dispatcher,h=l.util,f=l.posts,m=l.state,p=document.query("#onlineCount");c.extend(d,(o={},i(o,u.INSERT_POST,function(e){var t=s(e,2),n=t[0],i=t[1];i=i&&m.page.get("live");var r=!n.op,o=n.num;r&&(m.syncs[o]=1),n.editing=!0;var c=void 0,u=n.nonce;delete n.nonce;var d=l.request("nonce:get")[u];if(d&&d.tab===m.page.get("tabID")){m.ownPosts[o]=!0,l.oneeSama.trigger("insertOwnPost",n),l.postSM.feed("alloc",n),i=!1,l.request("nonce:destroy",u);var h=l.request("postForm");h&&h.el&&(c=h.el)}d&&(n.mine=!0,m.mine.write(o)),m.addLinks(n.links);var p=new f.models[r?"Thread":"Post"](n),g=new f[r?"Section":"Article"]({model:p,el:c,id:o});if(c||g.render().insertIntoDOM(),g.clientInit(),a(n.links,o),l.request("post:inserted",p),!r){var v=m.posts.get(n.op);v&&(v.get("replies").push(o),m.page.get("thread")||(v.dispatch("shiftReplies"),i&&v.dispatch("bumpThread")))}}),i(o,u.INSERT_IMAGE,function(e){var t=s(e,2),n=t[0],i=t[1],a=l.request("postModel"),o=a&&a.get("num")==n;o&&l.request("postForm").insertUploaded(i),r(n,function(e){return e.setImage(i,o)})}),i(o,u.UPDATE_POST,function(e){var t=s(e,3),n=t[0],i=t[1],o=t[2],c=void 0===o?{}:o;r(n,function(e){m.addLinks(c.links),e.update(i,c),a(c.links,n),n in m.ownPosts?l.oneeSama.trigger("insertOwnPost",c):e.dispatch("updateBody",i)})}),i(o,u.FINISH_POST,function(e){var t=s(e,1),n=t[0];delete m.ownPosts[n],r(n,function(e){e.set("editing",!1),e.dispatch("renderEditing",!1)})}),i(o,u.DELETE_POSTS,function(e){r(e[0],function(t){return t.deletePost(e[1])})}),i(o,u.LOCK_THREAD,function(e){r(e[0],function(t){return t.toggleLocked(!0,e[1])})}),i(o,u.UNLOCK_THREAD,function(e){r(e[0],function(t){return t.toggleLocked(!1,e[1])})}),i(o,u.DELETE_IMAGES,function(e){r(e[0],function(t){return t.removeImage(e[1])})}),i(o,u.SPOILER_IMAGES,function(e){r(e[0],function(t){return t.setSpoiler(e[1],e[2])})}),i(o,u.BAN,function(e){var t=s(e,2),n=t[0],i=t[1];if(!n){if(!i)return;i=JSON.parse(i),n=i.num}r(n,function(e){return e.setBan(n,i)})}),i(o,u.BACKLINK,function(e){r(e[0],function(t){return t.addBacklink(e[1],e[2])})}),i(o,u.ONLINE_COUNT,function(e){p.textContent="["+e[0]+"]"}),i(o,u.HOT_INJECTION,function(e){var t=s(e,3),n=t[0],i=t[1],a=t[2];n||i===m.configHash?n&&(m.configHash=i,m.hotConfig.set(a)):l.send([u.HOT_INJECTION,!0])}),o)),d[u.SYNCHRONIZE]=l.connSM.feeder("sync"),d[u.INVALID]=l.connSM.feeder("invalid"),h.listener(document,"click","del",function(e){e.spoilt||(e.spoilt=!0,e.target.classList.toggle("reveal"))})},{"./main":"main"}],3:[function(e,t,n){"use strict";t.exports=n=e("./util"),n.OneeSama=e("./oneesama")},{"./oneesama":4,"./util":5}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a([">>(d+|>/watch?v=[w-]{11}(?:#t=[dhms]{1,9})?\n		|>/soundcloud/[w-]{1,40}/[w-]{1,80}|>/pastebin/w+"],[">>(\\d+|>\\/watch\\?v=[\\w-]{11}(?:#t=[\\dhms]{1,9})?\n		|>\\/soundcloud\\/[\\w-]{1,40}\\/[\\w-]{1,80}|>\\/pastebin\\/\\w+"]),s=a(["|>/","/(?:w+/?)?"],["|>\\/","\\/(?:\\w+\\/?)?"]),l=a(['<a target="_blank"\n					rel="nofollow"\n					class="imageSearch ','"\n					href="',""],['<a target="_blank"\n					rel="nofollow"\n					class="imageSearch ','"\n					href="',""]),c=a(['<section id="p','" class="','">\n				<div class="background glass">\n					','\n					<span class="omit"></span>\n				</div>\n			</section>'],['<section id="p','" class="','">\n				<div class="background glass">\n					','\n					<span class="omit"></span>\n				</div>\n			</section>']),u=a(['<article id="p','" class="','">\n				',"\n			</article>"],['<article id="p','" class="','">\n				',"\n			</article>"]),d=a(["","\n			",'\n			<div class="container">\n				',"\n				<blockquote>\n					","\n				</blockquote>\n				<small>\n					","\n				</small>\n				","\n			</div>"],["","\n			",'\n			<div class="container">\n				',"\n				<blockquote>\n					","\n				</blockquote>\n				<small>\n					","\n				</small>\n				","\n			</div>"]),h=a(['<header>\n				<input type="checkbox" class="postCheckbox">\n				',"\n				","\n				","\n				","\n				",'\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>'],['<header>\n				<input type="checkbox" class="postCheckbox">\n				',"\n				","\n				","\n				","\n				",'\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>']),f=a(["<a ",">"],["<a ",">"]),m=a(['<time title="','">\n				',"\n			</time>"],['<time title="','">\n				',"\n			</time>"]),p=a(['<nav>\n				<a href="','" class="history">\n					No.\n				</a>\n				<a href="','" class="quote">\n					',"\n				</a>\n			</nav>"],['<nav>\n				<a href="','" class="history">\n					No.\n				</a>\n				<a href="','" class="quote">\n					',"\n				</a>\n			</nav>"]),g=a(['<span class="act expansionLinks">\n				<a href="','" class="history">\n					','\n				</a>\n				] [\n				<a href="',"?last=",'" class="history">\n					'," ","\n				</a>\n			</span>"],['<span class="act expansionLinks">\n				<a href="','" class="history">\n					','\n				</a>\n				] [\n				<a href="',"?last=",'" class="history">\n					'," ","\n				</a>\n			</span>"]),v=a(["^>/(",")/(w+/?)?"],["^>\\/(",")\\/(\\w+\\/?)?"]),y=a(["<a ",">\n				>>","\n			</a>"],["<a ",">\n				>>","\n			</a>"]),b=a(['<a href="','" rel="nofollow" target="_blank">\n						',"\n					</a>"],['<a href="','" rel="nofollow" target="_blank">\n						',"\n					</a>"]),w=a(["<figure>\n				","\n				","\n				","\n			</figure>"],["<figure>\n				","\n				","\n				","\n			</figure>"]),k=a(["<figcaption>\n				","\n				","\n				<span>\n					(",")\n				</span>\n				","\n			</figcaption>"],["<figcaption>\n				","\n				","\n				<span>\n					(",")\n				</span>\n				","\n			</figcaption>"]),x=a(['<a class="imageToggle">\n				[',"]\n			</a>"],['<a class="imageToggle">\n				[',"]\n			</a>"]),S=a(["<a ",">\n				","\n			</a>"],["<a ",">\n				","\n			</a>"]),_=a(["<a ",">\n				<img ",">\n			</a>"],["<a ",">\n				<img ",">\n			</a>"]),I=a(["","","",".png"],["","","",".png"]),T=a(['<aside class="act glass ','">\n				<a ',"\n					","\n				>\n					","\n				</a>\n			</aside>"],['<aside class="act glass ','">\n				<a ',"\n					","\n				>\n					","\n				</a>\n			</aside>"]),$=e("underscore"),M=e("./index"),E=e("./util"),O=imports,L=O.config,q=E.pad,A=E.parseHTML,C=(new RegExp("(\\S{"+M.WORD_LENGTH_LIMIT+"})"),function(){var e=String.raw(o).replace(/[\n\t]+/gm,"");for(var t in L.link_targets)e+=String.raw(s,t);return e+=")",new RegExp(e)}()),N=function(){for(var e=[{"class":"google",url:"https://www.google.com/searchbyimage?image_url=",type:"thumb",symbol:"G"},{"class":"iqdb",url:"http://iqdb.org/?url=",type:"thumb",symbol:"Iq"},{"class":"saucenao",url:"http://saucenao.com/search.php?db=999&url=",type:"thumb",symbol:"Sn"},{"class":"desustorage",type:"MD5",url:"https://desustorage.org/_/search/image/",symbol:"Ds"},{"class":"exhentai",type:"SHA1",url:"http://exhentai.org/?fs_similar=1&fs_exp=1&f_shash=",symbol:"Ex"}],t=[],n=0,i=e.length;i>n;n++){var a=e[n];t[n]=[A(l,a["class"],a.url),a.type,'">'+a.symbol+"</a>"]}return t}(),R=function(){function e(t){i(this,e),$.extend(this,t),this.hooks={}}return r(e,[{key:"hook",value:function(e,t){var n=this.hooks[e];n?n.indexOf(t)<0&&n.push(t):this.hooks[e]=[t]}},{key:"trigger",value:function(e,t){var n=this.hooks[e];if(n)for(var i=0;i<n.length;i++)n[i].call(this,t)}},{key:"section",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return this.setModel(e),e.locked&&(t+=" locked"),e.editing&&(t+=" editing"),A(c,e.num,t,this.monogatari(e))}},{key:"article",value:function(e){this.setModel(e);var t="glass";return e.editing&&(t+=" editing"),A(u,e.num,t,this.monogatari(e))}},{key:"setModel",value:function(e){return this.model=e,this.state=[0,0,0,0],this}},{key:"monogatari",value:function(e){var t=e.image,n=e.mod,i=e.body,a=e.backlinks,r=e.banned;return t&&!e.op&&(t.large=!0),A(d,this.header(e),t&&this.image(t),n&&this.modInfo(n),this.body(i),this.backlinks(a),r&&this.banned())}},{key:"header",value:function(e){return A(h,e.subject&&"<h3>「"+$.escape(e.subject)+"」</h3>",this.name(e),this.time(e.time),this.postNavigation(e),!this.full&&!e.op&&this.expansionLinks(e.num))}},{key:"name",value:function(e){var t='<b class="name',n=e.auth,i=e.email;return n&&(t+=" "+("admin"===n?"admin":"moderator")),t+='">',i&&(t+=A(f,{"class":"email",href:"mailto:"+encodeURI(i),target:"blank"})),t+=this.resolveName(e),i&&(t+="</a>"),t+="</b>",e.mnemonic&&(t+=" "+this.mnemonic(e.mnemonic)),t}},{key:"resolveName",value:function(e){var t="",n=e.trip,i=e.name,a=e.auth;return(i||!n)&&(t+=i?$.escape(i):this.lang.anon,n&&(t+=" ")),n&&(t+="<code>"+$.escape(n)+"</code>"),a&&(t+=" ## "+(imports.hotConfig.staff_aliases[a]||a)),t}},{key:"time",value:function(e){var t=void 0,n=void 0,i=this.readableTime(e);return this.rTime&&(t=i,n=this.relativeTime(e,Date.now())),A(m,t,n||i)}},{key:"readableTime",value:function(e){var t=new Date(e);return q(t.getDate())+" "+this.lang.year[t.getMonth()]+" "+t.getFullYear()+("("+this.lang.week[t.getDay()]+")")+(q(t.getHours())+":"+q(t.getMinutes()))}},{key:"readableUTCTime",value:function(e,t){var n=q(e.getUTCDate())+" "+this.lang.year[e.getUTCMonth()]+" "+e.getUTCFullYear()+("("+this.lang.week[e.getUTCDay()]+")")+(q(e.getUTCHours())+":"+q(e.getUTCMinutes()));return t&&(n+=":"+q(e.getUTCSeconds())),n+=" UTC"}},{key:"relativeTime",value:function(e,t){var n=Math.floor((t-e)/6e4),i=void 0;if(1>n){if(n>-5)return this.lang.just_now;i=!0,n=-n}for(var a=[60,24,30,12],r=["minute","hour","day","month"],o=0;o<a.length;o++){if(n<a[o])return this.lang.ago(n,this.lang["unit_"+r[o]],i);n=Math.floor(n/a[o])}return this.lang.ago(n,this.lang.unit_year,i)}},{key:"mnemonic",value:function(e){return'<b class="mod addr">'+e+"</b>"}},{key:"postNavigation",value:function(e){var t=e.num,n=e.op;return A(p,this.postURL(t,n),this.postURL(t,n),t)}},{key:"postURL",value:function(e,t){return t=t||e,(this.op==t?"":t)+"#"+e}},{key:"expansionLinks",value:function(e){return A(g,e,this.lang.expand,e,this.lastN,this.lang.last,this.lastN)}},{key:"modInfo",value:function(e){var t='<b class="modLog admin">',n=!0,i=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;t+=this.lang.mod.formatLog(s)+"<br>"}}catch(l){i=!0,a=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}return t+="</b>"}},{key:"banned",value:function(){return'<b class="admin banMessage">'+this.lang.mod.banMessage+"</b>"}},{key:"body",value:function(e){var t=this.fragment(e);return this.state[1]&&(t+="</em>"),this.state[2]&&(t+="</del>"),t}},{key:"fragment",value:function(e){for(var t=this,n=e.split("\n"),i=this.state,a="",r=0;r<n.length;r++){i[0]&&r%2&&(i[1]%2&&(a+="</em>",i[1]++),a+="<br>",i[0]=0);var o=n[r];!i[0]&&o.startsWith(">")&&(a+="<em>",i[1]++),e&&(o.split(" ").forEach(function(e){return a+=t.parseWord(e)}),i[0]=1)}return a}},{key:"parseWord",value:function(e){for(var t=e.split(/\[\/?spoiler]/i),n="",i=0;i<t.length;i++){i%2&&(n+="<"+(this.state[2]%2?"/":"")+"del>",this.state[2]++);var a=t[i],r=a.match(C);r&&(n+=this.redString(r[1]),a=a.replace(C,"")),n+=this.parseHashes(a)}return n}},{key:"redString",value:function(e){var t=void 0,n=void 0;/^>\/watch/.test(e)?(t="https://www.youtube.com/"+e.slice(2),n="embed watch"):/^>\/soundcloud/.test(e)?(t="https://soundcloud.com/"+e.slice(13),n="embed soundcloud"):/^>\/pastebin/.test(e)&&(t="https://pastebin.com/"+e.slice(11),n="embed pastebin");for(var i in L.link_targets){var a=e.match(new RegExp(String.raw(v,i)));if(a){t=L.link_targets[i],a[2]&&(t+=a[2]);break}}if(!t)return this.tamashii(parseInt(e,10));var r={href:encodeURI(t),target:"_blank",rel:"nofollow","class":n};return A(y,r,$.escape(e))}},{key:"parseHashes",value:function(e){if(!this.model.dice)return this.linkify(e);for(var t="",n=e.split(E.dice_re),i=0;i<n.length;i++){var a=n[i];if(i%2&&E.parse_dice(a))if(this.queueRoll)this.queueRoll(a);else{this.state[0]&&(t+=" ");var r=this.model.dice[this.state[3]++];t+="<strong>"+E.readable_dice(a,r)+"</strong>"}else t+=this.linkify(a)}return t}},{key:"linkify",value:function(e){if(!this.eLinkify)return this.padWord($.escape(e));for(var t="",n=e.split(/(https?:\/\/[^\s"<>]*[^\s"<>'.,!?:;])/),i=0,a=n.length;a>i;i++){var r=$.escape(n[i]);i%2?t+=A(b,r,this.padWord(r)):r&&(t+=this.padWord(r))}return t}},{key:"padWord",value:function(e){return this.state[0]&&(e=" "+e),e}},{key:"backlinks",value:function(e){if(!e)return"";var t="";for(var n in e)t&&(t+=" "),t+=this.postRef(n,e[n]);return t}},{key:"image",value:function(e,t){var n="hide"!==this.thumbStyle||t;return A(w,this.figcaption(e,t),n&&L.IMAGE_HATS&&'<span class="hat"></span>',n&&this.thumbnail(e))}},{key:"figcaption",value:function(e,t){var n=E.commaList([e.audio&&"♫",e.length,E.readable_filesize(e.size),e.dims[0]+"x"+e.dims[1],e.apng&&"APNG"]);return A(k,"hide"===this.thumbStyle&&this.hiddenToggle(t),this.imageSearch(e),n,this.imageLink(e))}},{key:"hiddenToggle",value:function(e){return A(x,this.lang[e?"hide":"show"])}},{key:"imageSearch",value:function(e){var t="",n=N;[".pdf",".mp3"].indexOf(e.ext)>-1&&(n=[n[0]]);for(var i=this.thumbPath(e),a=0,r=n.length;r>a;a++){var o=n[a];t+=o[0]+encodeURI("thumb"!==o[1]?e[o[1]]:i)+o[2]}return t}},{key:"thumbPath",value:function(e,t){var n="thumb";return t&&e.mid?n="mid":e.thumb||(n="src"),this.imagePaths()[n]+e[n]}},{key:"imagePaths",value:function(){if(!this._imgPaths){var e=L.MEDIA_URL;this._imgPaths={src:e+"src/",thumb:e+"thumb/",mid:e+"mid/",spoil:e+"spoil/spoiler"}}return this._imgPaths}},{key:"imageLink",value:function(e){var t="",n=e.imgnm,i=n.match(/^(.*)\.\w{3,4}$/);i&&(t=i[1]);var a=$.escape(n),r=t.length>=38;r&&(n=$.escape(t.slice(0,30))+"(&hellip;)"+$.escape(e.ext));var o={href:L.SECONDARY_MEDIA_URL+"src/"+e.src,rel:"nofollow",download:a};return r&&(o.title=a),A(S,o,n)}},{key:"thumbnail",value:function(e,t){var n=this.imagePaths(),i=e.dims,a=n.src+e.src,r=void 0,o=i[0],s=i[1],l=i[2],c=i[3];if(e.spoiler&&this.spoilToggle){var u=this.spoilerInfo(e);r=u.thumb,l=u.dims[0],c=u.dims[1]}else r=".gif"===e.ext&&this.autoGif?a:this.thumbPath(e,"small"!==this.thumbStyle);l||(l=o,c=s);var d={target:"_blank",rel:"nofollow",href:t||a},h={src:r,width:l,height:c};return t&&(d["class"]="history",h["class"]="expanded","hide"==this.thumbStyle&&(h.style="display: none")),A(_,d,h)}},{key:"spoilerInfo",value:function(e){var t=e.large||"small"!==this.thumbStyle;return{thumb:A(I,this.imagePaths().spoil,t&&"s",e.spoiler),dims:L[e.large?"THUMB_DIMENSIONS":"PINKY_DIMENSIONS"]}}},{key:"postRef",value:function(e,t,n){var i="&gt;&gt;"+e;return n&&(i+=" "+n),this.op&&this.op!=t?i+=" ➡":e==t&&this.op==t&&(i+=" (OP)"),'<a href="'+this.postURL(e,t)+'" class="history">'+i+"</a>"}},{key:"asideLink",value:function(e,t,n,i){return A(T,n,t&&'href="'+t+'"',i&&' class="'+i+'"',this.lang[e]||e)}},{key:"replyBox",value:function(){return this.asideLink("reply",null,"posting")}},{key:"newThreadBox",value:function(){return this.asideLink("newThread",null,"posting")}}]),e}();t.exports=R},{"./index":3,"./util":5,underscore:void 0}],5:[function(e,t,n){"use strict"},{}],6:[function(e,t,n){"use strict";function i(e){if("synced"==f.state||"syncing"==f.state){if(v.readyState!=p.OPEN)return void(console&&console.warn("Attempting to send while socket closed"));e=JSON.stringify(e),h.DEBUG&&console.log("<",e),v.send(e)}}function a(e){h.DEBUG&&console.log(">",e.data);var t=JSON.parse(e.data)[0],n=t.shift(),i=t.shift(),a=d.is_pubsub(i);if(!a||"locked"!==f.state){var r=u.dispatcher[i];r&&(a&&n in m.syncs&&m.syncs[n]++,u.follow(function(){return r(t,n)}))}}function r(e){w.textContent=e}function o(){return v&&(v.onclose=null,v.onmessage=null),"file:"==window.location.protocol?void console.log("Page downloaded locally; refusing to sync."):(v=s(),v.onopen=f.feeder("open"),v.onclose=f.feeder("close"),v.onmessage=a,void(h.DEBUG&&(window.socket=v)))}function s(){var e=["xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];return h.USE_WEBSOCKETS&&e.unshift("websocket"),new p(h.SOCKET_URL||h.SOCKET_PATH,null,{transports:e})}function l(){b&&(clearTimeout(b),b=0),y=0}function c(){switch(f.state){case"desynced":return;case"synced":case"syncing":case"conn":var e=v.readyState;if(e!=p.OPEN&&e!=p.CONNECTING)return void f.feed("close");if(navigator.onLine===!1)return void f.feed("close")}f.feed("retry")}var u=e("./main"),d=(u._,u.common),h=u.config,f=u.connSM,m=u.state,p=u.SockJS,g=u.lang.sync,v=void 0,y=void 0,b=void 0;u.reply("send",i);var w=document.getElementById("sync");f.act("load + start -> conn",function(){r(g.connecting),y=0,o()}),f.act("conn, reconn + open -> syncing",function(){r(g.syncing);var e=d.randomID(32),t=m.page;t.set("connID",e),i([d.SYNCHRONIZE,e,t.get("board"),m.syncs,t.get("live"),document.cookie])}),f.act("syncing + sync -> synced",function(){r(g.synced),b=setTimeout(function(){b=0,l()},1e4)}),f.act("synced, syncing + lock -> locked"),f.act("locked + unlock -> synced"),u.reply("connection:lock",function(){return i([d.DESYNC])},f.feed("lock")),u.reply("connection:unlock",function(e){return i(e)},f.feed("unlock")),f.act("* + close -> dropped",function(e){v&&(v.onclose=null,v.onmessage=null),h.DEBUG&&console.error("E:",e),b&&(clearTimeout(b),b=0),r(g.dropped);var t=500*Math.pow(1.5,Math.min(Math.floor(++y/2),12));setTimeout(f.feeder("retry"),t)}),f.act("dropped + retry -> reconn",function(){o(),setTimeout(function(){"reconn"==f.state&&r(g.reconnecting)},100)}),f.act("* + invalid, desynced + close -> desynced",function(e){e=e&&e[0]?"Out of sync: "+e[0]:"Out of sync",r(e),b&&(clearTimeout(b),b=0),v.onclose=null,v.onmessage=null,v.close(),v=null,h.DEBUG&&(window.socket=null)}),f.feed("start"),document.addEventListener("visibilitychange",function(e){e.target.hidden||setTimeout(c,20)}),window.addEventListener("online",function(){return l()},f.feed("retry")),window.addEventListener("offline",f.feeder("close"))},{"./main":"main"}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./main"),o=(r._,r.util),s=r.options,l=r.state,c=r.posts,u=function(){function e(t){i(this,e);var n=r.$threads[0],a=JSON.parse(document.getElementById("postData").innerHTML);if(r.request("notify:title",a.title),!t){var o=this.mine=l.mine.readAll(),c=this.posts=a.posts;this.extractReplies(n),this.extractThreads(n),l.addLinks(a.links);for(var u in c){var d=c[u].links;if(d)for(var h in d)h in o&&r.request("repliedToMe",c[u].num)}s.get("anonymise")&&r.request("loop:anonymise"),r.request("time:render")}}return a(e,[{key:"extractReplies",value:function(e){for(var t=e.getElementsByTagName("article"),n=0,i=t.length;i>n;n++){var a=t[n];new c.Article({model:new c.models.Post(this.extractModel(a)),el:a})}}},{key:"extractThreads",value:function(e){for(var t=e.getElementsByTagName("section"),n=0;n<t.length;n++){var i=t[n],a=this.extractModel(i);new c.Section({model:new c.models.Thread(a),el:i}).renderOmit(),l.syncs[a.num]=a.hctr}}},{key:"extractModel",value:function(e){var t=this.posts[o.getNum(e)];return t.num in this.mine&&(t.mine=!0),t}}]),e}();t.exports=u,new u(l.page.get("catalog"))},{"./main":"main"}],8:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(t){i(this,e),this.state=t,this.spec={acts:{},ons:{},wilds:{},preflights:{}}}return a(e,[{key:"clone",value:function(){var t=new e(this.state);return t.spec=this.spec,t}},{key:"on",value:function(e,t){var n=this.spec.ons[e];n?n.push(t):this.spec.ons[e]=[t]}},{key:"preflight",value:function(e,t){var n=this.spec.preflights[e];n?n.push(t):this.spec.preflights[e]=[t]}},{key:"act",value:function(e,t){var n=e.split("->");if(2!=n.length)throw new Error("Bad FSM spec: "+e);for(var i=n[0].split(","),a=n[1].match(/^\s*(\w+)\s*$/)[1],r=void 0,o=i.length-1;o>=0;o--){var s=i[o],l=s.match(/^\s*(\*|\w+)\s*(?:\+\s*(\w+)\s*)?$/);if(!l)throw new Error("Bad FSM spec portion: "+s);if(l[2]&&(r=l[2]),!r)throw new Error("Tokenless FSM action: "+s);var c=l[1];if("*"==c)this.spec.wilds[r]=a;else{var u=this.spec.acts[c];u||(this.spec.acts[c]=u={}),u[r]=a}}t&&this.on(a,t)}},{key:"feed",value:function(e,t){var n=this.spec,i=this.state,a=n.acts[i],r=a&&a[e]||n.wilds[e];if(r&&i!=r){for(var o=n.preflights[r],s=0;o&&s<o.length;s++)if(!o[s].call(this,t))return!1;this.state=r;for(var l=n.ons[r],s=0;l&&s<l.length;s++)l[s].call(this,t)}return!0}},{key:"feeder",value:function(e){var t=this;return function(n){return t.feed(e,n)}}}]),e}();n["default"]=r},{}],9:[function(e,t,n){"use strict";var i=e("./main"),a=new i.Memory("hide",7,!0);i.reply("hide",function(e){if(!e.get("mine")){var t=a.write(e.get("num"));e.remove(),i.request("hide:render",t)}}),i.reply("hide:clear",function(){return a.purgeAll()}),i.defer(function(){return i.request("hide:render",a.size())})},{"./main":"main"}],10:[function(e,t,n){"use strict";function i(e,t){var n=u.read(e);if(!s.isMatch(u.page.attributes,n)){r.request("connection:lock"),t&&t.preventDefault();var i=e.split("#"),o=i[0]+(/\?/.test(i[0])?"&":"?")+"minimal=true";1!==i.length&&(o+="#"+i[1]),d.show();var h=new XMLHttpRequest;h.open("GET",o),h.onload=function(){return 200!==this.status?(d.hide(),alert(this.status)):(a(e)!==a(this.responseURL)&&(n=u.read(this.responseURL)),r.request("postSM:feed","done"),r.trigger("state:clear"),r.$threads[0].innerHTML=this.response,u.page.set(n),r.oneeSama.op=n.thread,new c(n.catalog),n.catalog||r.request("connection:unlock",[l.RESYNC,n.board,u.syncs,n.live]),t&&(history.pushState(null,null,n.href),location.hash?r.request("scroll:aboveBanner"):window.scrollTo(0,0)),void d.hide())},h.send()}}function a(e){return e.split(/[\?#]/)[0]}var r=e("./main"),o=r.$,s=r._,l=r.common,c=r.Extract,u=r.state;r.$doc.on("click","a.history",function(e){e.ctrlKey||i(this.href,e)});var d=o("#loadingImage");r.reply("loading:show",function(){return d.show()}),r.reply("loading:hide",function(){return d.hide()}),window.onpopstate=function(e){i(e.target.location.href),r.request("scroll:aboveBanner")}},{"./main":"main"}],11:[function(e,t,n){"use strict";function i(){l.state.page.get("catalog")?!function(){var e="hide"===u.get("thumbs")||l.oneeSama.workMode?"none":"";document.queryAll(".expanded").forEach(function(t){return t.style.display=e})}():c(function(){return a(function(e,t){return e&&t.dispatch("renderImage",e)})})}function a(e){d.each(function(t){return e(t.get("image"),t)})}function r(){c(function(){return a(function(e,t){return e&&e.spoiler&&t.dispatch("renderImage",e)})})}function o(){c(function(){return a(function(e,t){return e&&".gif"===e.ext&&t.dispatch("renderImage",e)})})}function s(e,t){c(function(){var e=t?"anonymise":"renderName";d.each(function(t){var n=t.attributes,i=n.name,a=n.trip;(i||a)&&t.dispatch(e)})})}var l=e("./main"),c=(l.util,l.follow),u=l.options,d=(l.oneeSama,l.state.posts);u.on({"change:thumbs":i,"change:spoilers":r,"change:autogif":o,"change:anonymise":s,workModeTOG:i}),l.reply("loop:anonymise",function(){return u.get("anonymise")&&s(null,!0)})},{"./main":"main"}],12:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./main"),o=r._,s=r.Cookie,l=function(){function e(t,n,a){i(this,e),this.key=t,this.expiry=n,this.needCookie=a,r.defer(this.purgeExpired.bind(this))}return a(e,[{key:"bakeCookie",value:function(e){if(this.needCookie){var t=Object.keys(e);t.sort(function(e,t){return parseInt(e,10)-parseInt(t,10)}),s.set(this.key,t.join("/"))}}},{key:"now",value:function(){return Math.floor(Date.now()/1e3)}},{key:"purgeAll",value:function(){localStorage.removeItem(this.key),this.needCookie&&s.remove(this.key)}},{key:"readAll",value:function(){var e=localStorage.getItem(this.key);if(!e)return{};var t=void 0;try{t=JSON.parse(e)}catch(n){}return o.isObject(t)?t:{}}},{key:"writeAll",value:function(e){return o.isEmpty(e)?this.purgeAll():(localStorage.setItem(this.key,JSON.stringify(e)),void this.bakeCookie(e))}},{key:"write",value:function(e){var t=this.readAll();return t[e]=this.now(),this.writeAll(t),o.size(t)}},{key:"size",value:function(){return o.size(this.readAll())}},{key:"purgeExpired",value:function(){if(this.expiry){var e=this.readAll(),t=this.now(),n=86400*this.expiry,i=[];for(var a in e){var r=e[a];r&&t>r+n&&i.push(a)}if(i.length){for(var o=0,s=i.length;s>o;o++)delete e[i[o]];this.writeAll(e)}}}}]),e}();t.exports=l},{"./main":"main"}],13:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("main"),r=e("./opts"),o=i(r),s=void 0;try{s=JSON.parse(localStorage.options)}catch(l){}s||(s={}),n["default"]=s=new a.Backbone.Model(s);var c=a.Backbone.Collection.extend({persist:function(){var e={};this.forEach(function(t){var n=t.getValue();n!==t.get("default")&&(e[t.get("id")]=n)}),localStorage.options=JSON.stringify(e)}}),u=new c,d=a.Backbone.Model.extend({initialize:function(e){if(void 0===e.load||e.load){e.type||this.set("type","checkbox");var t=this.getValue();this.setValue(t),void 0!==e.exec&&(this.listenTo(s,"change:"+e.id,this.execListen),e.execOnStart!==!1&&e.exec(t)),u.add(this)}},setValue:function(e){s.set(this.get("id"),e)},getValue:function(){var e=s.get(this.get("id"));return void 0===e?this.get("default"):e},validate:function(e){var t=this.get("validation");return t?t(e):!0},execListen:function(e,t){this.get("exec")(t)}});!function(){function e(){n.filter(".noOptions").fadeOut(t)}function t(){n.fadeIn(),n.filter(".noOptions").length&&e()}if(!localStorage.getItem("options")){var n=$("#options");n.addClass("noOptions"),e(),n.click(function(){n.removeClass("noOptions")})}}();var h=a.Backbone.View.extend({initialize:function(){var t=this;this.setElement(util.parseEl(e("./render")())),document.body.append(this.el),u.each(function(e){var n=t.$el.find("#"+e.get("id"));if(n.length){var i=e.get("type"),a=e.getValue();"checkbox"==i?n.prop("checked",a):"number"==i||i instanceof Array?n.val(a):"shortcut"==i&&n.val(String.fromCharCode(a).toUpperCase())}}),this.$hidden=this.$el.find("#hidden"),main.reply("hide:render",this.renderHidden,this)},events:{"click .option_tab_sel>li>a":"switchTab",change:"applyChange","click #export":"export","click #import":"import","click #hidden":"clearHidden"},switchTab:function(e){e.preventDefault();var t=$(e.target);this.$el.children(".option_tab_sel").find("a").removeClass("tab_sel"),t.addClass("tab_sel");var n=this.$el.children(".option_tab_cont").children("li");n.removeClass("tab_sel"),n.filter("."+t.data("content")).addClass("tab_sel")},applyChange:function(e){var t,n=$(e.target),i=u.get(n.attr("id"));if(i){var a=i.get("type");if("checkbox"==a)t=n.prop("checked");else if("number"==a)t=parseInt(n.val());else{if("image"==a)return main.request("background:store",e.target);t="shortcut"==a?n.val().toUpperCase().charCodeAt(0):n.val()}if(!i.validate(t))return n.val("");i.setValue(t),u.persist()}},"export":function(){var e=document.getElementById("export");e.setAttribute("href",window.URL.createObjectURL(new Blob([JSON.stringify(localStorage)],{type:"octet/stream"}))),e.setAttribute("download","meguca-config.json")},"import":function(e){e.preventDefault();var t=this.$el.find("#importSettings");t.click(),t.one("change",function(){var e=new FileReader;e.readAsText(t[0].files[0]),e.onload=function(e){var t;try{t=JSON.parse(e.target.result)}catch(e){alert("Import failed. File corrupt")}if(t){localStorage.clear();for(var n in t)localStorage[n]=t[n];alert("Import successfull. The page will now reload."),location.reload(!0)}}})},renderHidden:function(e){var t=this.$hidden;t.text(t.text().replace(/\d+$/,e))},clearHidden:function(){main.request("hide:clear"),this.renderHidden(0)}}),f=!0,m=!1,p=void 0;try{for(var g,v=o["default"][Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var y=g.value;new d(y)}}catch(b){m=!0,p=b}finally{try{!f&&v["return"]&&v["return"]()}finally{if(m)throw p}}main.defer(function(){new h})},{"./opts":14,"./render":15,main:"main"}],14:[function(e,t,n){"use strict";function i(e,t){return function(n){document.getElementById(e)||document.head.appendChild(a.util.parseEl('<style id="'+e+'">'+t+"</style>")),document.getElementById(e).disabled=!n}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("main"),r=!a.isMobile;
n["default"]=opts=[{id:"lang",type:a.config.lang.enabled,tab:0,"default":a.config.lang["default"],execOnStart:!1,exec:function(e){alert(a.lang.langApplied),location.reload()}},{id:"inlinefit",type:["none","full","width","height","both"],tab:1,"default":"width"},{id:"thumbs",type:a.util.thumbStyles,tab:1,"default":"small"},{id:"imageHover","default":!0,load:r,tab:0},{id:"webmHover",load:r,tab:0},{id:"autogif",load:r,tab:1},{id:"spoilers",tab:1,"default":!0},{id:"linkify",tab:0,"default":!0},{id:"notification",load:r,tab:0,exec:function(e){e&&"granted"!==Notification.permission&&Notification.requestPermission()}},{id:"anonymise",tab:0},{id:"relativeTime",tab:0,"default":!0},{id:"nowPlaying",load:r&&a.config.radio,tab:3,"default":!0,exec:function(e){e?main.send({type:"radio"}):main.request("banner:radio:clear")}}];for(var o=["google","iqdb","saucenao","desustorage","exhentai"],s=0;s<o.length;s++){var l=o[s];opts.push({id:l,lang:"imageSearch",tab:2,"default":"google"===l,exec:i(l+"Toggle","."+l+"{display:initial;}")})}opts.push({id:"illyaBGToggle",load:r&&a.config.illyaDance,tab:3},{id:"illyaMuteToggle",load:r&&a.config.illyaDance,tab:3},{id:"horizontalPosting",tab:3,exec:i("horizontal","article,aside{display:inline-block;}")},{id:"replyright",tab:1,exec:i("reply-at-right","section>aside{margin: -26px 0 2px auto;}")},{id:"theme",type:["moe","gar","mawaru","moon","ashita","console","tea","higan","ocean","rave","tavern","glass"],tab:1,"default":a.config.defaultCSS,exec:function(e){e&&document.getElementById("theme").setAttribute("href",a.config.MEDIA_URL+"css/"+e+".css?v="+main.cssHash)}},{id:"userBG",load:r,tab:1},{id:"userBGimage",load:r,type:"image",tab:1,execOnStart:!1,exec:function(e){main.request("background:store",e)}},{id:"lastn",type:"number",tab:0,validation:a.util.resonableLastN,"default":a.config.posts.lastN},{id:"alwaysLock",tab:0});var c=[{id:"new","default":78},{id:"togglespoiler","default":73},{id:"textSpoiler","default":68},{id:"done","default":83},{id:"expandAll","default":69},{id:"workMode","default":66}],u=!0,d=!1,h=void 0;try{for(var f,m=c[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var p=f.value;p.type="shortcut",p.tab=4,p.load=r,opts.push(p)}}catch(g){d=!0,h=g}finally{try{!u&&m["return"]&&m["return"]()}finally{if(d)throw h}}},{main:"main"}],15:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function a(){for(var e='<div class="bmodal glass" id="options-panel"><ul class="option_tab_sel">',t=d.tabs,n=[],i=function(i){return n[i]=u._.filter(u.options,function(e){return e.tab===i&&(void 0===e.load||e.load)&&!e.hidden}),n[i].length?(e+='<li><a data-content="tab-'+i+'"',0===i&&(e+=' class="tab_sel"'),void(e+=">"+t[i]+"</a></li>")):"continue"},a=0;a<t.length;a++){i(a)}e+='</ul><ul class="option_tab_cont">';for(var a=0;a<n.length;a++)e+=r(opt,a);return e+="</ul></div>"}function r(e,t){if(!opts[t].length)return"";var n="";n+='<li class="tab-'+t,0===t&&(n+=" tab_sel"),n+='">';var i=!0,a=!1,r=void 0;try{for(var l,c=opts[t][Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;n+=o(u)}}catch(d){a=!0,r=d}finally{try{!i&&c["return"]&&c["return"]()}finally{if(a)throw r}}return 0===t&&(n+=s()),n+="</li>"}function o(e){var t="",n="shortcut"===e.type,i=e.type instanceof Array,a="checkbox"===e.type||void 0===e.type,r="number"===e.type,o="image"===e.type;n&&(t+="Alt+"),i?t+="<select":(t+="<input",a||o?t+=' type="'+(a?"checkbox":"file")+'"':r?t+=' style="width: 4em;" maxlength="4"':n&&(t+=' maxlength="1"'));var s=l(d[e.id],2),c=s[0],u=s[1];if(t+=' id="'+e.id+'" title="'+u+'">',i){var h=!0,f=!1,m=void 0;try{for(var p,g=e.type[Symbol.iterator]();!(h=(p=g.next()).done);h=!0){var v=p.value;t+='<option value="'+v+'">'+(d[v]||v)+"</option>"}}catch(y){f=!0,m=y}finally{try{!h&&g["return"]&&g["return"]()}finally{if(f)throw m}}t+="</select>"}return t+='<label for="'+e.id+'" title="'+u+'">'+c+"</label><br>"}function s(){var e="<br>",t=["export","import","hidden"],n=!0,i=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,u=l(d[s],2);u[0],u[1];e+='<a id="'+s+'" title="'+ln[1]+'">'+ln[0]+"</a> "}}catch(h){i=!0,a=h}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}var f={type:"file",id:"importSettings",name:"Import Settings"};return e+=common.parseHTML(c,f)}var l=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(l){a=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=i(["<input ",">"],["<input ",">"]);Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a;var u=e("main"),d=main.lang.opts},{main:"main"}],16:[function(e,t,n){"use strict";var i=e("../main"),a=e("./common"),r=i._;i.Backbone;t.exports=a.extend({tagName:"article",render:function(){return this.setElement(i.oneeSama.article(this.model.attributes)),this},insertIntoDOM:function(){r.last(document.query("#p"+this.model.get("op")).queryAll("article")).after(this.el),this.autoExpandImage().fun()}})},{"../main":"main","./common":17}],17:[function(e,t,n){"use strict";var i=e("../main"),a=e("./imager"),r=(i._,i.Backbone,i.common,i.util),o=i.lang,s=i.oneeSama,l=i.options;i.state;t.exports=a.Hidamari.extend({className:"glass",initialize:function(){this.listenTo(this.model,"dispatch",this.redirect)},clientInit:function(){return l.get("anonymise")&&this.anonymise(),this},redirect:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];this[e].apply(this,n)},updateBody:function(e){this.blockquote||(this.blockquote=this.el.query("blockquote"));var t=this.model.attributes;this.blockquote.innerHTML=s.setModel(t).body(t.body)},renderTime:function(){this.el.query("time").outerHTML=s.time(this.model.get("time"))},renderBacklinks:function(e){this.el.query("small").innerHTML=s.backlinks(e)},fun:function(){},anonymise:function(){this.el.query(".name").innerHTML='<b class="name">'+o.anon+"<b>"},renderName:function(){this.el.query(".name").outerHTML=s.name(this.model.attributes)},renderModerationInfo:function(e){var t=this.getContainer();t.query(".modLog").remove(),t.query("blockquote").before(r.parseDOM(s.modInfo(e)))},getContainer:function(){return this.el.query(".container")},renderBan:function(){var e=this.getContainer();e.query(".banMessage").remove(),e.query("blockquote").after(r.parseDOM(s.banned()))},renderEditing:function(e){var t=this.el;e?t.classList.add("editing"):(t.classList.remove("editing"),t.query("blockquote").normalize())}})},{"../main":"main","./imager":20}],18:[function(e,t,n){"use strict";function i(e,t,n){t||(t={allowFullScreen:"true"}),t.allowScriptAccess="always";var i={autohide:1,fs:1,modestbranding:1,origin:document.location.origin,rel:0,showinfo:0};return n&&(i.start=n),t.autoplay&&(i.autoplay=t.autoplay),t.loop&&(i.loop="1",i.playlist=e),s("<iframe></iframe>",{type:"text/html",src:encodeURI("https://www.youtube.com/embed/"+e)+"?"+s.param(i),frameborder:"0",attr:a(),"class":"youtube-player"})}function a(){return window.screen&&screen.width<=320?{width:250,height:150}:{width:560,height:340}}function r(e,t,n){var i="https://soundcloud.com/oembed?url="+encodeURIComponent(e.getAttribute("href"))+("&maxwidth="+t+"&maxheight=166&auto_play=true&format=json")+"&show_comments=false",a=new XMLHttpRequest;a.open("GET",i),a.responseType="json",a.onload=function(){return 200!==this.status?n(this.status):void n(null,this.response)},a.send()}var o=e("../main"),s=o.$,l=o.util,c=n.youtube_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtube\.com\/watch\/?\?((?:[^\s#&=]+=[^\s#&]*&)*)?v=([\w-]{11})((?:&[^\s#&=]+=[^\s#&]*)*)&?(#t=[\dhms]{1,9})?/,u=n.youtube_short_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtu.be\/([\w-]{11})\??(t=[\dhms]{1,9})?/,d=n.youtube_time_re=/^#t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/,h=n.youtube_short_time_re=/^t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/;o.$threads.on("click",".watch",function(e){function t(e,t,r){var o=0;if(t){var s=t.match(r);s&&(s[1]&&(o+=3600*parseInt(s[1],10)),s[2]&&(o+=60*parseInt(s[2],10)),s[3]&&(o+=parseInt(s[3],10)))}n.css("width",a().width).append("<br>",i(e,null,o))}if(!(e.which>1||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)){var n=s(e.target);if(n.is("a")){var r=n.find("iframe");if(r.length)return r.siblings("br").andSelf().remove(),n.css("width","auto"),!1;if(!n.data("noembed")){var o=n.attr("href").match(c);if(!o){if(o=n.attr("href").match(u),!o)return;t(o[1],o[2],h)}return t(o[2],o[4],d),!1}}}}),o.$threads.on("mouseenter",".watch",function(e){function t(e){var t=e&&e.data&&e.data.title;t?(i.textContent=a+": "+t,n.css({color:"black"})):i.textContent=a+" (gone?)",e&&e.data&&e.data.accessControl&&"denied"===e.data.accessControl.embed&&(i.textContent+=" (EMBEDDING DISABLED)",n.data("noembed",!0))}var n=s(e.target);if(!n.data("requestedTitle")){n.data("requestedTitle",!0);var i=n.contents().filter(function(){return 3===this.nodeType})[0];if(i){var a=i.textContent;i.textContent=a+"...";var r=n.attr("href").match(c);if(!r){if(r=n.attr("href").match(u),!r)return;s.ajax({url:"//gdata.youtube.com/feeds/api/videos/"+r[1],data:{v:"2",alt:"jsonc"},dataType:"json",success:t,error:function(){i.textContent=a+"???"}})}s.ajax({url:"//gdata.youtube.com/feeds/api/videos/"+r[2],data:{v:"2",alt:"jsonc"},dataType:"json",success:t,error:function(){i.textContent=a+"???"}})}}});n.soundcloud_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.)?soundcloud\.com\/([\w-]{1,40}\/[\w-]{1,80})\/?/;o.$threads.on("click",".soundcloud",function(e){if(!(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)){var t=e.target,n=t.query("iframe");if(e.preventDefault(),n)return n.previousElementSibling.remove(),void n.remove();var i=Math.round(.75*window.innerWidth);r(t,i,function(e,n){return e?alert(e):(t.append(document.createElement("br")),t.append(l.parseDOM(n.html)),void(t.style.width=i+"px"))})}}),o.$threads.on("mouseenter",".soundcloud:not(.fetched)",function(e){var t=e.target,n=t.firstChild,i=n.textContent;n.textContent=i+" ...",r(t,1e3,function(e,a){return e?n.textContent=i+": Error: "+e:(n.textContent=i+": "+a.title,t.style.color="black",void t.classList.add("fetched"))})});var f=n.pastebin_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?pastebin\.com\/(.*)/;s(document).on("click",".pastebin",function(e){if(!(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)){var t=s(e.target),n=t.find("iframe");if(n.length)return n.siblings("br").andSelf().remove(),t.css({width:"auto",height:"auto"}),!1;var i=t.attr("href").match(f);if(i){var a=s(window),r=Math.round(.65*a.innerWidth()),o=Math.round(.65*a.innerHeight());return t.css({width:r,height:o}).append("<br>",s("<iframe></iframe>",{type:"text/html",src:"https://pastebin.com/embed_iframe.php?i="+i[1],frameborder:"0",width:r,height:o})),!1}}})},{"../main":"main"}],19:[function(e,t,n){"use strict";function i(){try{var e=JSON.parse(localStorage.ident);e.name&&l.val(e.name),e.email&&s.val(e.email)}catch(t){}}function a(){var e=r.request("postForm");e&&e.renderIdentity(),d()}var r=e("../main"),o=(r.$,r.$script),s=r.$email,l=r.$name,c=r._,u=(r.common,r.config),d=c.debounce(function(){try{var e=l.val(),t=s.val();if(t===u.LOGIN_KEYWORD&&(s.val(""),o(u.MEDIA_URL+"js/login.js?v="+r.clientHash),t=!1),e||t){var n={};e&&(n.name=e),t&&(n.email=t),localStorage.ident=JSON.stringify(n)}else localStorage.removeItem("ident")}catch(i){}},1e3);r.defer(function(){i(),l.on("input",a),s.on("input",a)})},{"../main":"main"}],20:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var a=i(["<"," ",">"],["<"," ",">"]),r=i(['<audio src="','"\n				width="300"\n				height="3em"\n				autoplay loop controls\n			>\n			</audio>'],['<audio src="','"\n				width="300"\n				height="3em"\n				autoplay loop controls\n			>\n			</audio>']),o=e("../main"),s=o.$threads,l=(o._,o.Backbone),c=o.common,u=o.util,d=o.oneeSama,h=o.options,f=o.state;n.Hidamari=l.View.extend({renderImage:function(e,t,n){var i=e===!0,a=this.model,r=this.el;t&&t.src||(t=a.get("image"));var o=r.query("figure");o&&o.remove(),t&&(r.query("blockquote").before(u.parseDOM(d.image(t,i))),n&&a.get("tallImage")&&(window.scrollTop=r.getBoundingClientRect().top+document.body.scrollTop-document.query("#banner").height),a.set({thumbnailRevealed:i,imageExpanded:!1,tallImage:!1}))},autoExpandImage:function(){var e=this.model.get("image");return!e||!p.get("expand")||[".webm",".pdf",".mp3"].indexOf(e.ext)>-1?this:(this.toggleImageExpansion(!0,e),this)},toggleImageExpansion:function(e,t,n){var i=h.get("inlinefit");t&&"none"!==i&&(e?this.fitImage(t,i):this.renderImage(null,t,n))},fitImage:function(e,t){if(".pdf"===e.ext)return window.open(d.imagePaths().src+e.src,"_blank");if(".mp3"===e.ext)return this.renderAudio(e);var n=void 0,i=void 0,a=n=e.dims[0],r=i=e.dims[1];if("full"===t)return this.expandImage(e,{width:a,height:r});var o="both"===t,s=o||"width"===t,l=o||"height"===t,c=a/r,u=void 0,h=void 0;if(s){var f=this.imageMaxWidth();n>f&&(n=f,i=n/c,u=!0)}if(l){var m=window.innerHeight-document.query("#banner").offsetHeight;i>m&&(i=m,n=i*c,h=!0)}n>50&&i>50&&(a=n,r=i),this.expandImage(e,a,r,h&&!u)},imageMaxWidth:function(){var e=this.el,t=this.model;return window.innerWidth-2*parseInt(e.closest("section").getBoundingClientRect().left)-u.outerWidth(t.get("op")?e:e.query(".background"))},expandImage:function(e,t,n,i){var r=".webm"===e.ext,o={src:d.imagePaths().src+e.src,width:t,height:n},s="expanded";i&&(s+=" noMargin"),o["class"]=s,r&&(o.autoplay=o.loop=o.controls=!0),this.el.query("figure").lastChild.innerHTML=c.parseHTML(a,r?"video":"img",o),this.model.set({imageExpanded:!0,tallImage:n>window.innerHeight})},renderAudio:function(e){this.el.query("figure").append(u.parseDOM(c.parseHTML(r,d.imagePaths().src+e.src))),this.model.set("imageExpanded",!0)}});var m=l.Model.extend({initialize:function(){var e=this;s.on("click","#expandImages",function(t){t.preventDefault(),e.toggle()})},toggle:function(){var e=!this.get("expand");this.set("expand",e).massToggle(e),s.find("#expandImages").text(o.lang.expander[+e])},massToggle:function(e){var t=h.get("inlinefit");if("none"!==t)for(var n=f.posts.models,i=0,a=n.length;a>i;i++){var r=n[i],o=r.get("image");o&&(e?r.dispatch("fitImage",o,t):r.dispatch("renderImage",null,o))}}}),p=n.massExpander=new m;o.reply("massExpander:unset",function(){return p.unset()}),s.on("click","img, video",function(e){if("none"!=h.get("inlinefit")&&1===e.which){var t=u.getModel(e.target);t&&(e.preventDefault(),o.request("imager:clicked"),t.dispatch("toggleImageExpansion",!t.get("imageExpanded"),t.get("image"),!0))}}),s.on("click",".imageToggle",function(e){e.preventDefault();var t=u.getModel(e.target);t&&o.follow(function(){return t.dispatch("renderImage",!t.get("thumbnailRevealed"))})})},{"../main":"main"}],21:[function(e,t,n){"use strict";t.exports={imager:e("./imager"),Menu:e("./menu"),common:e("./common"),Article:e("./article"),Section:e("./section"),models:e("./models"),nonce:e("./nonce"),embed:e("./embed"),posting:e("./posting")}},{"./article":16,"./common":17,"./embed":18,"./imager":20,"./menu":22,"./models":23,"./nonce":24,"./posting":25,"./section":26}],22:[function(e,t,n){"use strict";var i=e("../main"),a=(i.$,i._),r=i.Backbone,o=(i.common,i.util),s=i.lang,l=(i.state,t.exports=r.View.extend({className:"popup-menu glass",tagName:"ul",actions:["report","hide"],events:{click:"handleClick"},initialize:function(e){var t=e.parent;t._popup_menu=this,this.parent=t,this.render()},render:function(){var e="",t=!0,n=!1,i=void 0;try{for(var a,r=this.actions[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var l=a.value;e+='<li data-type="'+l+'">'+s[l]+"</li>"}}catch(c){n=!0,i=c}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw i}}var u=this.el,d=this.parent;u.innerHTML=e,d.append(u),u.style.left=u.getBoundingClientRect().left-.6*(o.outerWidth(u)+u.offsetWidth)+"px"},handleClick:function(e){e.stopPropagation(),i.request(e.target.getAttribute("data-type"),this.model),this.remove()},remove:function(){this.parent._popup_menu=null,this.el.remove(),this.stopListening()}}));i.reply("menu:extend",function(e){return a.extend(l.prototype.actions,e)}),i.$threads.on("click",".control",function(e){var t=e.target;if(t._popup_menu)return t._popup_menu.remove();var n=o.getModel(t);n&&new l({parent:t,model:n})})},{"../main":"main"}],23:[function(e,t,n){"use strict";var i=e("../main"),a=i._,r=i.Backbone,o=i.state;n.Post=r.Model.extend({idAttribute:"num",initialize:function(){o.posts.add(this)},dispatch:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];this.trigger.apply(this,["dispatch",e].concat(n))},remove:function(){this.stopListening().dispatch("remove"),o.posts.remove(this)},update:function(e,t,n){var i={body:this.get("body")+e};t&&a.extend(this.get("links"),t),n&&(i.dice=(this.get("dice")||[]).concat(n)),this.set(i)},setImage:function(e,t){this.set("image",e),t||this.dispatch("renderImage",e)},setSpoiler:function(e,t){var n=this.get("image");n.spoiler=e,this.dispatch("renderImage",n),this.moderationInfo(t)},removeImage:function(e){this.moderationInfo(e)||this.unset("image").dispatch("renderImage")},deletePost:function(e){this.moderationInfo(e)||this.remove()},setBan:function(e,t){e&&this.set("ban",!0).dispatch("renderBan"),this.moderationInfo(t)},addBacklink:function(e,t){var n=this.get("backlinks")||{};n[e]=t,this.set({backlinks:n}).dispatch("renderBacklinks",n)},moderationInfo:function(e){if(!e)return!1;var t=this.get("mod")||[];return t.push(e),this.set("mod",t).dispatch("renderModerationInfo",t),!0}}),n.Thread=n.Post.extend({defaults:{replies:[],omit:0,image_omit:0},initialize:function(){this.get("omit")&&this.getImageOmit(),o.posts.add(this)},remove:function(){this.stopListening().dispatch("remove"),o.posts.remove(this);for(var e=this.get("replies"),t=0,n=e.length;n>t;t++){var i=o.posts.get(e[t]);i&&i.remove()}},getImageOmit:function(){for(var e=this.get("imgctr")-1,t=this.get("replies"),n=0,i=t.length;i>n;n++){var a=o.posts.get(t[n]);a&&a.get("image")&&e--}this.set("image_omit",e)},toggleLocked:function(e,t){this.moderationInfo(t),this.set("locked",e).dispatch("renderLocked",e)}})},{"../main":"main"}],24:[function(e,t,n){"use strict";function i(){var e;if(window.localStorage)try{e=JSON.parse(localStorage.postNonces)}catch(t){}else e=d;return e||{}}function a(e){window.localStorage?localStorage.postNonces=JSON.stringify(e):d=e}function r(){return Math.floor(Date.now()/864e5)}function o(){var e=i(),t=c.randomID(32);return e[t]={tab:u.page.get("tabID"),day:r()},a(e),t}function s(e){setTimeout(function(){var t=i();t[e]&&(delete t[e],a(t))},1e4)}var l=e("../main"),c=l.common,u=l.state,d={};l.reply("nonce:get",i),l.reply("nonce:create",o),setTimeout(function(){if(window.localStorage){var e=i(),t=void 0,n=r()-1;for(var o in e)e[o].day>=n||(delete e[o],t=!0);t&&a(e)}},Math.floor(5e3*Math.random())),l.reply("nonce:destroy",s)},{"../main":"main"}],25:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function a(e){function t(){e.stopImmediatePropagation(),e.preventDefault()}if(e.altKey){var n=w.attributes;switch(e.which){case n["new"]:var i=document.query("aside.posting");i&&(k.feed("new",i),t());break;case n.togglespoiler:S&&(S.onToggle(e),t());break;case n.done:S&&!S.$submit.attr("disabled")&&(S.finish(),t());break;case n.textSpoiler:if(S){var a=this.imouto.state2.spoiler,r=(a?"[/":" [")+"spoiler]";this.imouto.state2.spoiler=!a,this.$input.val(this.$input.val()+r),t()}break;case n.expandAll:u.massExpander.toggle(),t();break;case n.workMode:var o=l.oneeSama.workMode=!l.oneeSama.workMode;f.set("workModeTOG",o);var s=document.querySelector("h1 > img");null!=s&&(s.style.display=o?"none":""),document.getElementById("theme").setAttribute("href",p.MEDIA_URL+"css/"+(o?x.hotConfig.get("DEFAULT_CSS"):l.options.get("theme"))+".css?v="+l.cssHash),b.thumbStyle=o?"hide":l.options.get("thumbs"),l.options.trigger("workModeTOG"),window.addEventListener("beforeunload",function(){f.set("workModeTOG",!1)}),t()}}}function r(e){k.feed("new",document.query("#p"+e+" aside.posting"))}var o=i(['<header>\n				<a class="name nope" target="_blank">\n					<b></b>\n				</a>\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>\n			<div class="container">\n				<blockquote>\n					<p id="buffer" class="exclude"></p>\n					<p id="lineBuffer" class="exclude"></p>\n					<textarea ',"></textarea>\n				</blockquote>\n				<form ",">\n					<input ",">\n					<input ",">\n					<input ",'>\n					<strong id="uploadStatus"></strong>\n				</form>\n				<small></small>\n			</div>'],['<header>\n				<a class="name nope" target="_blank">\n					<b></b>\n				</a>\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>\n			<div class="container">\n				<blockquote>\n					<p id="buffer" class="exclude"></p>\n					<p id="lineBuffer" class="exclude"></p>\n					<textarea ',"></textarea>\n				</blockquote>\n				<form ",">\n					<input ",">\n					<input ",">\n					<input ",'>\n					<strong id="uploadStatus"></strong>\n				</form>\n				<small></small>\n			</div>']),s=e("./article"),l=e("../main"),c=e("./embed"),u=(e("./identity"),e("./imager")),d=l.$,h=(l._,l.Backbone),f=l.Cookie,m=l.common,p=l.config,g=l.connSM,v=l.util,y=l.lang,b=l.oneeSama,w=l.options,k=l.postSM,x=l.state,S=void 0,_=void 0;l.reply("postForm",function(){return S}).reply("postModel",function(){return _}).reply("postForm:indentity",function(){return S&&S.renderIdentity()});var I=300;window.screen&&screen.width<=320&&(I=50);var T=h.Model.extend({idAttribute:"num"});g.on("synced",k.feeder("sync")),g.on("dropped",k.feeder("desync")),g.on("desynced",k.feeder("desync")),l.reply("postSM:feed",function(e){return k.feed(e)}),k.act("* + desync -> none",function(){S&&(S.el.classList.remove("editing"),S.$input.val(""),S.finish()),l.$threads.find("aside.posting").hide()}),k.act("none + sync, draft, alloc + done -> ready",function(){S&&(S.remove(),S=_=null);var e=!0,t=!1,n=void 0;try{for(var i,a=l.$threads[0].queryAll("aside.posting")[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;r.style.display=""}}catch(o){t=!0,n=o}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}}),k.act("ready + new -> draft",function(e){var t=void 0,n=e.closest("section");n?t=v.getNum(n):n=document.createElement("section"),t&&!x.page.get("thread")&&x.posts.get(t).dispatch("shiftReplies",!0),S=new $({model:_=new T({op:t}),destination:e,section:n})}),k.preflight("draft",function(e){return e.matches("aside")}),k.act("draft + alloc -> alloc",function(e){return S.onAllocation(e)}),l.dispatcher[m.IMAGE_STATUS]=function(e){return S&&S.dispatch(e[0])},l.$doc.on("click","aside.posting a",function(){k.feed("new",this.parentNode)}),l.$doc.on("keydown",a),l.oneeSama.hook("insertOwnPost",function(e){var t=e.links;S&&t&&S.$buffer.find(".nope").each(function(){var e=d(this),n=e.text(),i=n.match(/^>>(\d+)/);if(i){var a=i[1],r=t[a];if(r){var o=d(m.join([S.imouto.postRef(a,r,!1)]));e.attr("href",o.attr("href")).attr("class","history");var s=o.text();s!=n&&e.text(s)}}})});var $=(s.extend({events:{"click #cancel":"cancel","change #imageInput":"onImageChosen","input #trans":"onInput","keydown #trans":"onKeyDown","click #done":"finish","click #toggle":"onToggle"},initialize:function(e){s.prototype.initialize.call(this),this.listenTo(this.model,{change:this.renderButtons,"change:spoiler":this.renderSpoilerPane}),this.render(e).insertIntoDOM(e),this.model.set({spoiler:0,nextSpoiler:-1}),this.pending="",this.line_count=1,this.char_count=0;var t=this.imouto=new m.OneeSama({callback:inject,op:x.page.get("thread"),blockqoute:this.blockqoute,eLinkify:l.oneeSama.eLinkify,lang:l.lang,tamashii:function(e){var t=document.query("#p"+e);if(t=t&&t.closest("section")){var n=e in x.mine.readAll()&&y.you;return this.postRef(e,v.getNum(t),n)}return'<a class="nope">&gt;&gt;'+e+"</a>"}});t.setModel(this.model)},render:function(){var e={input:{name:"body",id:"input",rows:1,"class":"themed exclude",autocomplete:l.isMobile},form:{method:"post",enctype:"multipart/form-data",target:"upload",id:"uploadForm"},cancel:{type:"buttom",value:y.cancel,id:"cancel"},imageInput:{type:"file",id:"imageInput",name:"image",accept:"image/*;.webm;.pdf;.mp3"},toggle:{type:"button",id:"toggle"}};this.el.innerHTML=parseHTML(o,e.input,e.form,e.cancel,e.imageInput,e.toggle);var t=["buffer","lineBuffer","input","uploadForm","cancel","imageInput","toggle","uploadStatus","hiddenUpload","sizer"],n=!0,i=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var c=r.value;this[c]=document.query("#"+c)}}catch(u){i=!0,a=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw a}}return this.renderIdentity(),this},renderIdentity:function(){if(!this.model.get("num")){var e=m.parse_name(l.$name.val(),l.$email.val()),t=!(!e[1]&&!e[2]),n=this.el.query(".name"),i=n.query("a");e[0]?i.textContent=e[0]+" ":i.tetxContent=t?"":y.anon,t&&v.parseDOM(" <code>!?</code>").forEach(function(e){return i.after(e)}),l.oneeSama.trigger("fillMyName",i);var a=l.$email.val().trim();a?(n.setAttribute("href","mailto:"+a),n.classList.remove("nope"),n.classList.add("email")):(n.removeAttribute("href"),n.classList.add("nope"),n.classList.remove("email"))}},insertIntoDOM:function(e){var t=e.destination;t.before(this.el),this.resizeInput(),l.$threads.queryAll("aside.postsing").forEach(function(e){return e.style.display="none"}),this.fun()},resizeInput:function(e){var t=this.sizer,n=this.input;"string"!=typeof e&&(e=n.value),t.textContent=e;var i=t.width+m.INPUT_ROOM;i=Math.max(i,I-n.getBoundingClientRect().left-this.el.getBoundingClientRect().left),this.input.style.width=i+"px"},renderButtons:function(){var e=this.model.attributes,t=e.num,n=e.uploading,i=e.uploaded,a=e.uploadStatus,r=e.sentAllocRequest,o=r&&!t;this.submit.disabled=!(!n&&!o),i&&(this.submit.style.marginLeft=0),this.cancel.disabled=!!o,this.cancel.style.display=!t||n?"":"none",this.imageInput.disabled=!!n,this.uploadStatus.innerHTML=a},renderSpoilerPane:function(e,t){var n=t?p.MEDIA_URL+"spoil/spoil"+t+".png":p.MEDIA_URL+"css/ui/pane.png";this.toggle.style.backgroundImage='url("'+n+'")'}}),h.View.extend({events:{"input #trans":"onInput","keydown #trans":"onKeyDown","click #done":"finish","click #toggle":"onToggle"},initialize:function(e){this.listenTo(this.model,{change:this.renderButtons,"change:spoiler":this.renderSpoilerPane}),this.render(e),this.pending="",this.line_count=1,this.char_count=0;var t=this.imouto=new m.OneeSama({callback:inject,op:x.page.get("thread"),state:[m.S_BOL,0],state2:{spoiler:0},$buffer:this.$buffer,eLinkify:l.oneeSama.eLinkify,lang:l.lang,tamashii:function(e){var t=document.query("#p"+e);if(t=t&&t.closest("section")){var n=e in x.mine.readAll()&&this.lang.you;return this.postRef(e,v.getNum(t),n)}return'<a class="nope">&gt;&gt;'+e+"</a>"}});t.hook("spoilerTag",v.touchable_spoiler_tag),l.oneeSama.trigger("imouto",t)},render:function(e){var t=e.destination,n=e.section,i=this.model.get("op");this.setElement(i?document.createElement("article"):n),this.isThread=!i,this.$buffer=d("<p/>"),this.$lineBuffer=d("<p/>"),this.$meta=d('<header><a class="nope"><b/></a> <time/></header>'),this.$input=d("<textarea/>",{name:"body",id:"trans",rows:"1","class":"themed",autocomplete:l.isMobile}),this.$submit=d("<input/>",{id:"done",type:"button",value:l.lang.done}),this.$subject=d("<input/>",{id:"subject","class":"themed",maxlength:x.hotConfig.SUBJECT_MAX_LENGTH,width:"80%"}),this.$blockquote=d("<blockquote/>"),this.$sizer=d("<pre/>").appendTo("body"),this.$blockquote.append(this.$buffer,this.$lineBuffer,this.$input),this.$el.append(this.$meta,this.$blockquote,"<small/>"),this.isThread&&(this.$el.append('<label for="subject">'+y.subject+": </label>",this.$subject),this.$blockquote.hide()),this.$uploadForm=this.renderUploadForm(),this.$el.append(this.$uploadForm),l.oneeSama.trigger("draft",this.$el),this.renderIdentity(),t.style.display="none",this.isThread?(t.after(this.el),this.el.after(document.createElement("hr")),this.$subject.focus()):(t.before(this.el),this.resizeInput(),this.$input.focus()),l.$threads.find("aside.posting").hide(),this.fun()},renderIdentity:function(){if(!this.model.get("num")){var e=m.parse_name(l.$name.val(),l.$email.val()),t=!(!e[1]&&!e[2]),n=this.$meta.find("b");e[0]?n.text(e[0]+" "):n.text(t?"":l.lang.anon),t&&n.append(" <code>!?</code>"),l.oneeSama.trigger("fillMyName",n);var i=l.$email.val().trim(),a=this.$meta.children("a").first();i?a.attr({href:"mailto:"+i,target:"_blank","class":"email"}):a.removeAttr("href").removeAttr("target").attr("class","nope")}},renderButtons:function(){var e=this.model.attributes,t=e.sentAllocRequest&&!e.num,n=e.uploading||t;this.$submit.prop("disabled",!!n),e.uploaded&&this.$submit.css({"margin-left":"0"}),this.$cancel.prop("disabled",!!t),this.$cancel.toggle(!(e.num&&!e.uploading)),this.$imageInput.prop("disabled",!!e.uploading),this.$uploadStatus.html(e.uploadStatus)},renderSpoilerPane:function(e,t){var n=t?p.MEDIA_URL+"spoil/spoil"+t+".png":p.MEDIA_URL+"css/ui/pane.png";this.$toggle.css("background-image",'url("'+n+'")')},renderUploadForm:function(){var e=d('<form method="post" enctype="multipart/form-data" target="upload"></form>');return this.$cancel=d("<input/>",{type:"button",value:y.cancel,click:d.proxy(this,"cancel")}),this.$imageInput=d("<input/>",{type:"file",id:"image",name:"image",accept:p.WEBM?"imager/*;.webm":"image/*",change:d.proxy(this,"onImageChosen")}),this.$toggle=d("<input/>",{type:"button",id:"toggle"}),this.$uploadStatus=d("<strong/>"),e.append(this.$cancel,this.$imageInput,this.$toggle," ",this.$uploadStatus),this.$iframe=d("<iframe/>",{src:"",name:"upload",id:"hidden-upload"}).appendTo("body"),this.model.set({spoiler:0,nextSpoiler:-1}),e},cancel:function(){this.model.get("uploading")?(this.$iframe.remove(),this.$iframe=d("<iframe></iframe>",{src:"",name:"upload",id:"hidden-upload"}).appendTo("body"),this.uploadError(""),this.model.set({cancelled:!0})):this.finish()},onImageChosen:function(){if(!this.model.get("uploading")&&!this.model.get("uploaded")){if(!this.$imageInput.val())return void this.model.set("uploadStatus","");var e=this.prepareUpload();for(var t in e)d("<input type=hidden>").attr("name",t).val(e[t]).appendTo(this.$uploadForm);this.$uploadForm.prop("action",v.uploadURL()),this.$uploadForm.submit(),this.$iframe.load(function(){if(S){var e=this.contentWindow||this.contentDocument;if(e)try{var t=d(e.document||e).text();if(/legitimate imager response/.test(t))return;(t.length<5||t.length>100)&&(t=y.unknownUpload),S.uploadError(t)}catch(n){setTimeout(function(){S.uploadFallbackMessage()},500)}}}),this.notifyUploading()}},prepareUpload:function(){this.model.set("uploadStatus",y.uploading),this.$input.focus();var e=this.model.attributes;return{spoiler:e.spoiler,op:e.op||0}},uploadFallbackMessage:function(){var e=this.model.attributes,t=e.uploadStatus;e.cancelled||!e.uploading||t&&t!=y.uploading||this.model.set("uploadStatus",y.unknownResult)},notifyUploading:function(){this.model.set({uploading:!0,cancelled:!1}),this.$input.focus()},resizeInput:function(e){"string"!=typeof e&&(e=this.$input.val()),this.$sizer.text(e);var t=this.$sizer.width()+m.INPUT_ROOM;t=Math.max(t,I-this.$input.offset().left-this.$el.offset().left),this.$input.css("width",t+"px")},onInput:function(e){function t(t,n){var i=t[0].length,a=e.substr(0,t.index)+n+e.substr(t.index+i);if(s=!0,t.index<r){var l=i-n.length;r-=l,o-=l}return a}(void 0===e||e instanceof d.Event)&&(e=this.$input.val());for(var n,i,a,r=this.$input[0].selectionStart,o=this.$input[0].selectionEnd,s=!1;;){if(n=e.match(c.youtube_url_re),
!n)break;i=this.findTimeArg(n[3])||this.findTimeArg(n[1])||n[4]||"",a=">>>/watch?v="+n[2]+i,e=t(n,a)}for(;;){if(n=e.match(c.youtube_short_re),!n)break;i=this.findTimeArg(n[2])||"",a=">>>/watch?v="+n[1]+i,e=t(n,a)}for(;;){if(n=e.match(c.soundcloud_url_re),!n)break;var l=">>>/soundcloud/"+n[1];e=t(n,l)}for(;;){if(n=e.match(c.pastebin_re),!n)break;var u=">>>/pastebin/"+n[1];e=t(n,u)}s&&this.$input.val(e);var h=e.lastIndexOf("\n");if(h>=0){var f=e.substr(0,h);e=e.substr(h+1),this.$input.val(e),(this.model.get("sentAllocRequest")||/[^ ]/.test(f))&&this.commit(f+"\n")}else if(n=e.split("").reverse().join("").match(/^(\s*\S+\s+\S+)\s+(?=\S)/)){var p=e.length-n[1].length;this.commit(e.substr(0,p)),e=e.substr(p),r-=p,o-=p,this.$input.val(e),this.$input[0].setSelectionRange(r,o)}this.$input.attr("maxlength",m.MAX_POST_CHARS-this.char_count),this.resizeInput(e)},findTimeArg:function(e){if(!e||e.indexOf("t=")<0)return!1;e=e.split("&");for(var t=0,n=e.length;n>t;t++){var i="#p"+e[t];if(c.youtube_time_re.test(i))return i}return!1},commit:function(e){var t;if(e.indexOf("\n")>=0){t=e.split("\n"),this.line_count+=t.length-1;var n=this.line_count-m.MAX_POST_LINES+1;if(n>0){for(var i=0;n>i;i++)t.pop();e=t.join("\n"),this.line_count=m.MAX_POST_LINES}}var a=m.MAX_POST_CHARS-this.char_count;if(a<e.length&&(e=e.substr(0,a)),e){this.char_count+=e.length;var r=this.model.attributes;if(r.num||r.sentAllocRequest?r.num?l.send(e):this.pending+=e:(l.send([m.INSERT_POST,this.allocationMessage(e,null)]),this.model.set({sentAllocRequest:!0})),t){t[0]=this.$lineBuffer.text()+t[0],this.$lineBuffer.text(t.pop());for(var o=0,s=t.length;s>o;o++)this.imouto.fragment(t[o]+"\n")}else this.$lineBuffer.append(document.createTextNode(e)),this.$lineBuffer[0].normalize()}},allocationMessage:function(e,t){function n(e,t){t&&(i[e]=t)}var i={nonce:l.request("nonce:create")};return n("name",l.$name.val().trim()),n("email",l.$email.val().trim()),n("subject",this.$subject.val().trim()),n("frag",e),n("image",t),n("op",this.model.get("op")),i},onKeyDown:function(e){var t=this;l.follow(function(){switch(e.which){case 13:e.preventDefault();case 32:var n=t.$input[0],i=t.$input.val();i=i.slice(0,n.selectionStart)+(13==e.which?"\n":" ")+i.slice(n.selectionEnd),t.onInput(i);break;default:a.bind(t)(e)}})},finish:function(){var e=this;if(this.model.get("num")){this.flushPending(),this.commit(this.$input.val()),this.$input.remove(),this.$submit.remove(),this.$uploadForm&&this.$uploadForm.remove(),this.$iframe&&(this.$iframe.remove(),this.$iframe=null),this.imouto.fragment(this.$lineBuffer.text()),this.$buffer.replaceWith(this.$buffer.contents()),this.$lineBuffer.remove(),this.$blockquote.css({"margin-left":"","padding-left":""}),l.send([m.FINISH_POST]),this.preserve=!0,this.isThread&&this.$el.append(l.oneeSama.replyBox());var t=this.imouto.allRolls.sent-this.imouto.allRolls.seen;t>0?!function(){var t=void 0;(t=function(n){setTimeout(function(){e.imouto.allRolls.seen==e.imouto.allRolls.sent||0==n?k.feed("done"):t(n-1)},100)})(5)}():k.feed("done")}else k.feed("done")},flushPending:function(){this.pending&&(l.send(this.pending),this.pending="")},onToggle:function(e){var t=this.model.attributes;if(!t.uploading&&!t.uploaded){if(e.preventDefault(),e.stopImmediatePropagation(),t.spoiler)return void this.model.set({spoiler:0});var n=m.pick_spoiler(t.nextSpoiler);this.model.set({spoiler:n.index,nextSpoiler:n.next})}},onAllocation:function(e){var t=e.num;x.ownPosts[t]=t,this.model.set({num:t}),this.flushPending();var n=d(l.oneeSama.header(e));this.$meta.replaceWith(n),this.$meta=n,this.isThread||this.$el.addClass("editing"),this.$el.attr("id","p"+t),e.image&&this.insertUploaded(e.image),this.$uploadForm?this.$uploadForm.append(this.$submit):this.$blockquote.after(this.$submit),this.isThread&&(this.$subject.siblings("label").andSelf().remove(),this.$blockquote.show(),this.resizeInput(),this.$input.focus()),window.onbeforeunload=function(){return"You have an unfinished post."}},insertUploaded:function(e){this.renderImage(null,e),this.$imageInput.siblings("strong").andSelf().remove(),this.$cancel.remove(),this.$uploadForm.find("#toggle").remove(),this.flushPending(),this.model.set({uploading:!1,uploaded:!0,sentAllocRequest:!0});var t=this.$el.find("img");this.$blockquote.css({"margin-left":t.css("margin-right"),"padding-left":t.width()}),this.resizeInput()},dispatch:function(e){var t=e.arg;switch(e.t){case"alloc":this.onImageAllocation(t);break;case"error":this.uploadError(t);break;case"status":this.uploadStatus(t)}},onImageAllocation:function(e){var t=this.model.attributes;t.cancelled||(t.num||t.sentAllocRequest?l.send([m.INSERT_IMAGE,e]):(l.send([m.INSERT_POST,this.allocationMessage(null,e)]),this.model.set({sentAllocRequest:!0})))},uploadError:function(e){this.model.get("cancelled")||(this.model.set({uploadStatus:e,uploading:!1}),this.$uploadForm&&this.$uploadForm.find("input[name=alloc]").remove())},uploadStatus:function(e){this.model.get("cancelled")||this.model.set("uploadStatus",e)},addReference:function(e,t){var n=this.$input.val();if(/^>>\d+$/.test(n)&&(this.$input.val(n+"\n"),this.onInput(),n=this.$input.val()),t){t=t.split("\n");for(var i=0,a=t.length;a>i;i++)t[i]=">"+t[i];e+="\n"+t.join("\n")+"\n"}this.$input.val(n+">>"+e),this.$input[0].selectionStart=this.$input.val().length,this.onInput(),this.$input.focus()},remove:function(){this.preserve||(this.isThread&&this.$el.next("hr").remove(),this.$el.remove()),this.$sizer.remove(),this.$iframe&&(this.$iframe.remove(),this.$iframe=null),this.stopListening(),window.onbeforeunload=null},renderImage:u.Hidamari.renderImage,autoExpandImage:function(){return this},fun:function(){}}));n.ComposerView=$,l.reply("openPostBox",r),window.addEventListener("message",function(e){var t=e.data;"OK"!==t&&S&&S.uploadError(t)},!1),l.$threads.on("click","a.quote",function(e){function t(e){var t=i[e]&&i[e].parentElement;return t&&t.closest("blockquote")&&t.closest("article, section")===n}e.preventDefault();var n=e.target.closest("article, section"),i=getSelection(),a=v.getNum(n),o=void 0;t("baseNode")&&t("focusNode")&&(o=i.toString()),r(v.getNum(n.closest("section"))),S.addReference(a,o)})},{"../main":"main","./article":16,"./embed":18,"./identity":19,"./imager":20}],26:[function(e,t,n){"use strict";var i=e("../main"),a=e("./common"),r=(i.$,i._,i.Backbone,i.util),o=i.oneeSama,s=i.state;t.exports=a.extend({tagName:"section",render:function(){var e=this.model.attributes;this.setElement(o.section(e)).insertIntoDOM();var t=r.parseDOM(o.replyBox());return(e.num in s.ownPosts||i.request("postForm"))&&(t.style.display="none"),this.el.append(t),this.el.nextElementSibling.remove(),this},insertIntoDOM:function(){i.$threads[0].query("aside").after(this.el,document.createElement("hr")),this.fun()},renderLocked:function(e){this.el.classList[e?"add":"remove"]("locked")},remove:function(){return this.el.nextElementSibling.remove(),this.el.remove(),this.stopListening(),this},shiftReplies:function(e){var t=this.model.attributes,n=t.replies,i=s.hotConfig.get("ABBREVIATED_REPLIES"),a=void 0;e&&i--;for(var r=n.slice().length,o=r;o>i;o--){var l=s.posts.get(n.shift());l&&(l.get("image")&&t.image_omit++,t.omit++,a=!0,l.remove())}a&&this.renderOmit(t.omit,t.image_omit)},renderOmit:function(){var e=arguments.length<=0||void 0===arguments[0]?this.model.get("omit"):arguments[0];arguments.length<=1||void 0===arguments[1]?this.model.get("image_omit"):arguments[1];if(0!==e){var t=s.page.attributes,n=t.thread,i=t.href;this.el.query(".omit").innerHTML=o.lang.abbrev_msg(e,this.model.get("image_omit"),n&&i.split("?")[0])}},bumpThread:function(){this.el.nextElementSibling.remove(),this.el.remove(),this.insertIntoDOM()}})},{"../main":"main","./common":17}],27:[function(e,t,n){"use strict";function i(){v=document.query("#lock"),y=!!f.posts.get("thread")}function a(){g=p.scrollHeight-window.innerHeight<=window.scrollY,v&&(v.style.visibility=g?"visible":"hidden")}function r(e){var t=l(),n=e();if(!g||document.hidden&&!h.get("alwaysLock")){if(!o(b))return n;var i=s(b,!0)-t;i&&window.scrollBy(0,i)}else window.scrollTo(0,p.scrollHeight);return n}function o(e){return e&&document.contains(e)}function s(e,t){var n=e.getBoundingClientRect(),i=n.top;return t||i>=0&&i<window.innerHeight?i:null}function l(){if(o(b)){var e=s(b);if(null!==e)return e}for(var t=["article","section","threads"],n=0;n<t.length;n++){var i=t[n],a=!0,r=!1,l=void 0;try{for(var c,d=u.$threads[0].queryAll(i)[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var h=c.value,e=s(h);if(null!==e)return b=h,e}}catch(f){r=!0,l=f}finally{try{!a&&d["return"]&&d["return"]()}finally{if(r)throw l}}}}function c(){if(/^#p\d+$/.test(location.hash)){var e=d(location.hash);e.length&&d(window).scrollTop(e.offset().top-d("#banner").height())}}var u=e("./main"),d=u.$,h=(u.Backbone,u.options),f=u.state,m=document,p=m.body,g=void 0,v=void 0,y=void 0;f.page.on("change",i),i(),a(),document.addEventListener("scroll",a);var b=void 0;u.follow=r,u.reply("scroll:aboveBanner",c),window.onload=c},{"./main":"main"}],28:[function(e,t,n){"use strict";function i(e){for(var t={board:e.match(/\/([a-zA-Z0-9]+?)\//)[1],thread:e.match(/\/(\d+)(:?#\d+)?(?:[\?&]\w+=\w+)*$/),lastN:e.match(/[\?&]last=(\d+)/)},n=["thread","lastN"],i=0;i<n.length;i++){var a=n[i],r=t[a];t[a]=r?parseInt(r[1]):0}return t}function a(e){e&&r._.extend(s,e)}Object.defineProperty(n,"__esModule",{value:!0}),n.links=n.posts=n.mine=n.ownPosts=n.syncs=n.page=void 0,n.read=i,n.addLinks=a;var r=e("main");main.state=t.exports;var o=(n.page=new r.Backbone.Model(i(location.href)),n.syncs={},n.ownPosts={},n.mine=new main.Memory("mine",2,!0),n.posts=new r.Backbone.Collection);main.on("state:clear",function(){main.$threads.innerHTML="",models.each(function(e){return e.dispatch("stopListening")}),o.reset(),n.syncs={},main.request("massExpander:unset")});var s=n.links={}},{main:"main"}],29:[function(e,t,n){"use strict";function i(e){var t=arguments.length<=1||void 0===arguments[1]?c.get("relativeTime"):arguments[1];u.posts.each(function(e){return e.dispatch("renderTime")}),h&&clearTimeout(h),t&&(h=setTimeout(i,6e4))}function a(e){if(d){e.classList.add("timerTicking");var t=e.getAttribute("start"),n=e.getAttribute("end"),i=s.pad(e.getAttribute("hour")),a=s.pad(e.getAttribute("min")),r=s.pad(e.getAttribute("sec"));!function l(){if(document.body.contains(e)){var c=s.serverTime();if(c>n)return e.textContent=o.lang.finished;if(t>c){var u=Math.round((t-c)/1e3);return 10===u&&o.request("time:syncwatch"),e.textContent="Countdown: "+u,setTimeout(l,1e3)}var d=c-t,h=Math.floor(d/1e3/60/60);d-=1e3*h*60*60;var f=Math.floor(d/1e3/60);d-=1e3*f*60;var m=Math.floor(d/1e3);return e.textContent=s.pad(h)+":"+s.pad(f)+":"+s.pad(m)+" / "+i+":"+a+":"+r,setTimeout(l,1e3)}}()}}function r(){setInterval(function(){for(var e=document.getElementsByTagName("syncwatch"),t=0;t<e.length;t++)e[t].classList.contains("timerTicking")||a(e[t])},1e3)}var o=e("./main"),s=(o.$,o.Backbone,o.common),l=o.oneeSama,c=o.options,u=o.state,d=0;o.dispatcher[s.GET_TIME]=function(e){e[0]&&(d=e[0]-Date.now())},o.reply("time:offset",function(){return d});var h=void 0;o.reply("time:render",i),c.on("change:relativeTime",i),o.defer(i).defer(r).defer(function(){function e(){n=!0,this.removeAttribute("title"),this.style.cursor="default",this.removeEventListener("click",e),t()}function t(){return d?(i.innerHTML=l.readableUTCTime(new Date(s.serverTime()),n),void setTimeout(t,n?1e3:6e4)):setTimeout(t,1e3)}var n=void 0,i=document.getElementById("UTCClock").firstChild;i.addEventListener("click",e),t()})},{"./main":"main"}],30:[function(e,t,n){"use strict";function i(e){return Array.isArray(e)?e:Array.from(e)}function a(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function r(e){e.html='<del onclick="void(0)">'}function o(){return(C.config.hard.HTTP.upload||"../upload/")+"?id="+C.state.page.get("connID")}function s(e){return e?parseInt(e.getAttribute("id").slice(1),10):0}function l(e){return e?s(e.closest("article, section")):0}function c(e){var t=l(e);return t?C.state.posts.get(t):null}function u(e){var t=document.createElement("div");t.innerHTML=e;var n=t.childNodes;return Array.from(n)}function d(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}function h(e,t,n,i){e.addEventListener(t,function(e){e.target.matches(n)&&i.call(this,e)})}function f(e,t,n){e.addEventListener(t,function(i){n.call(this,i),e.removeEventListener(t,n)})}function m(e){var t=getComputedStyle(e),n=["marginLeft","marginRight","paddingLeft","paddingRight"],i=0,a=!0,r=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;i+=parseInt(t[c])}}catch(u){r=!0,o=u}finally{try{!a&&l["return"]&&l["return"]()}finally{if(r)throw o}}return i}function p(e){return e&&"sage"===e.trim()}function g(){var e=Date.now();return imports.isNode?e:(N||(N=imports.main.request("time:offset")),e+N)}function v(e,t){var n=void 0;switch(e){case"#flip":n=(2==t[2]).toString();break;case"#8ball":n=imports.hotConfig.EIGHT_BALL[t[2]-1];break;case"#pyu":case"#pcount":case"#q":n=t[0]}return void 0!==n?C._.escape(e+" ("+n+")"):/^#sw/.test(e)?y(t[0]):b(e,t)}function y(e){return e["class"]="embed",$(q,e)}function b(e,t){var n=i(t),a=(n[0],n[1]),r=n.slice(2);e+=" (";var o=r.length>1||a;o&&(e+=r.join(", ")),a&&(e+=0>a?" - "+-a:" + "+a);var s=a,l=!0,c=!1,u=void 0;try{for(var d,h=r[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;s+=f}}catch(m){c=!0,u=m}finally{try{!l&&h["return"]&&h["return"]()}finally{if(c)throw u}}return e+(o?" = ":"")+s+")"}function w(e){var t=imports.config.SPOILER_IMAGES,n=t.length,i=void 0;return i=0>e?Math.floor(Math.random()*n):e%n,{index:t[i],next:(i+1)%n}}function k(e){return 1024>e?e+" B":1048576>e?Math.round(e/1024)+" KB":(e=Math.round(e/104857.6).toString(),e.slice(0,-1)+"."+e.slice(-1)+" MB")}function x(e){return(10>e?"0":"")+e}function S(e,t,n,i){return $(A,e,n&&' id="'+n+'"',i&&' class="'+i+'"',t)}function _(e){return Number.isInteger(e)&&500>=e}function I(e){var t="",n="",i=e.indexOf("#");return i>=0&&(t=e.substr(i+1),e=e.substr(0,i),i=t.indexOf("#"),i>=0&&(n=C._.escape(t.substr(i+1)),t=t.substr(0,i)),t=C._.escape(t)),e=e.trim().replace(imports.hotConfig.EXCLUDE_REGEXP,""),[e.substr(0,100),t.substr(0,128),n.substr(0,128)]}function T(e){for(var t="",n=0;e>n;n++){var i=(36*Math.random()).toString(36)[0];Math.random()<.5&&(i=i.toUpperCase()),t+=i}return t}function $(e){if("string"==typeof e)return M(e);if("function"==typeof e)return M(e(n));for(var t=arguments.length,n=[],i=1;t>i;i++)n[i-1]=arguments[i];var a=e.slice(0,t).map(function(e,t){var i=n[t-1],a=void 0;return a=0===t||!i&&0!==i?"":i instanceof Object?E(i):i,a+e}).join("");return M(a)}function M(e){var t=-1;return e.replace(/\n(\s+)/g,function(e,n){return 0>t&&(t=n.replace(/\t/g,"    ").length),n.slice(Math.min(n.length,t))}).replace(/^\s*\n/gm,"")}function E(e){var t="";for(var n in e){t+=" ";var i=e[n];i===!0?t+=n:(i||0===i)&&(t+=n+'="'+i+'"')}return t}function O(e){var t="",n=!0,i=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;(s||0===s)&&(t&&(t+=", "),t+=s)}}catch(l){i=!0,a=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}return t}function L(e){var t=C.config.staff.classes[main.ident&&main.ident.auth];return t&&!!t.rights[e]}var q=a(["<syncwatch ",">\n			syncwatch\n		</syncwatch>"],["<syncwatch ",">\n			syncwatch\n		</syncwatch>"]),A=a(['<span class="act">\n			<a href="','"\n				',"\n				","\n			>\n				","\n			</a>\n		</span>"],['<span class="act">\n			<a href="','"\n				',"\n				","\n			>\n				","\n			</a>\n		</span>"]);Object.defineProperty(n,"__esModule",{value:!0}),n.thumbStyles=void 0,n.touchable_spoiler_tag=r,n.imageUploadURL=o,n.getNum=s,n.getID=l,n.getModel=c,n.parseEls=u,n.parseEl=d,n.listener=h,n.once=f,n.outerWidth=m,n.isSage=p,n.serverTime=g,n.readable_dice=v,n.pick_spoiler=w,n.readable_filesize=k,n.pad=x,n.action_link_html=S,n.resonableLastN=_,n.parse_name=I,n.randomID=T,n.parseHTML=$,n.commaList=O,n.checkAuth=L;var C=e("main");main.util=t.exports;var N=void 0;n.thumbStyles=["small","sharp","hide"]},{main:"main"}],main:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var r=a(['<style>\n		.locked:after {\n			content: "','";\n		}\n		.locked > header nav:after {\n			content: " (',')";\n		}\n	</style>'],['<style>\n		.locked:after {\n			content: "','";\n		}\n		.locked > header nav:after {\n			content: " (',')";\n		}\n	</style>']),o=e("./fsm"),s=i(o),l=e("underscore"),c=e("backbone"),u=e("js-cookie"),d=e("backbone.radio");e("core-js"),e("dom4"),e("backbone.nativeview"),c.View=c.NativeView;var h=t.exports=d.channel("main");l.extend(h,{_:l,Backbone:c,Cookie:u,FSM:s["default"],$script:e("scriptjs"),SockJS:e("sockjs-client"),_deferred:[],defer:function(e){return h._deferred.push(e),h},execDefered:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=this._deferred[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;r()}}catch(o){t=!0,n=o}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}},dispatcher:{}}),l.extend(h,{config:config,configHash:configHash,clientHash:clientHash,isMobile:isMobile});var f=3;if(localStorage.cookieVersion!=f){for(var m in u.get()){var p=h.config.boards.enabled.slice();p.push("");var g=!0,v=!1,y=void 0;try{for(var b,w=p[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var k=b.value;u.remove(m,{path:k})}}catch(x){v=!0,y=x}finally{try{!g&&w["return"]&&w["return"]()}finally{if(v)throw y}}}localStorage.cookieVersion=f}/[&\?]debug=true/.test(location.href)&&(h.config.hard.debug=!0),h.config.hard.debug&&(d.DEBUG=!0,window.Backbone=c,d.tuneIn("main")),h.send=h.request.bind(h,"send"),h.Memory=e("./memory");var S=h.lang=e("lang"),_=e("./state"),I=e("./util"),T=h.common=e("./common");h.options=e("./options"),h.scroll=e("./scroll"),_.page.set("tabID",T.randomID(32)),document.head.appendChild(I.parseDOM(T.parseHTML(r,S.thread_locked,S.locked))),l.extend(h,{$threads:document.query("threads"),$name:document.query("input[name=name]"),$email:document.query("input[name=email]"),connSM:new s["default"]("load"),postSM:new s["default"]("none")}),l.extend(h,{loop:e("./loop"),time:e("./time"),amusement:e("./amusement")}),h.posts=e("./posts"),h.Extract=e("./extract"),h.client=e("./client"),h.conection=e("./connection"),l.extend(h,{history:e("./history"),hide:e("./hide")}),h.execDefered(),h.request("loading:hide")},{"./amusement":1,"./client":2,"./common":3,"./connection":6,"./extract":7,"./fsm":8,"./hide":9,"./history":10,"./loop":11,"./memory":12,"./options":13,"./posts":21,"./scroll":27,"./state":28,"./time":29,"./util":30,backbone:void 0,"backbone.nativeview":void 0,"backbone.radio":void 0,"core-js":void 0,dom4:void 0,"js-cookie":void 0,lang:void 0,scriptjs:void 0,"sockjs-client":void 0,underscore:void 0}]},{},["main"]);
//# sourceMappingURL=main.js.map
