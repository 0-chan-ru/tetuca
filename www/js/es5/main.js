require=function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(require,module,exports){"use strict";var _slicedToArray=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(l){o=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),main=require("./main"),$=main.$,common=main.common,state=main.state,oneeSama=main.oneeSama;oneeSama.hook("imouto",function(e){e.queueRoll=function(e){var t=this.allRolls.sent++,n=this.allRolls[t];n||(n=this.allRolls[t]={}),n.bit=e,n.$tag=$(this.callback("<strong>")),this.strong=!0,this.callback(n.dice?common.readable_dice(e,n.dice):e),this.strong=!1,this.callback("</strong>")},e.allRolls={sent:0,seen:0}}),oneeSama.hook("insertOwnPost",function(e){var t=e.dice,n=main.request("postForm");if(n&&n.imouto&&t)for(var i=n.imouto.allRolls,o=0,r=t.length;r>o;o++){var a=i.seen++,s=i[a];if(s||(s=i[a]={}),s.dice=t[o],s.$tag){var l=common.readable_dice(s.bit,s.dice);s.$tag.html(l)}}}),main.dispatcher[common.EXECUTE_JS]=function(_ref2){var _ref3=_slicedToArray(_ref2,1),js=_ref3[0];try{eval(js)}catch(e){console.error(e)}}},{"./main":"main"}],2:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(e){var n=m.mine.readAll();for(var i in e)i in n&&l.request("repliedToMe",t)}}function r(e,t){var n=m.posts.get(e);n&&t(n)}var a,s=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(l){o=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./main"),c=l._,u=l.common,d=l.dispatcher,f=l.util,h=l.posts,m=l.state,p=document.query("#onlineCount");c.extend(d,(a={},i(a,u.INSERT_POST,function(e){var t=s(e,2),n=t[0],i=t[1];i=i&&m.page.get("live");var r=!n.op,a=n.num;r&&(m.syncs[a]=1),n.editing=!0;var c=void 0,u=n.nonce;delete n.nonce;var d=l.request("nonce:get")[u];if(d&&d.tab===m.page.get("tabID")){m.ownPosts[a]=!0,l.oneeSama.trigger("insertOwnPost",n),l.postSM.feed("alloc",n),i=!1,l.request("nonce:destroy",u);var f=l.request("postForm");f&&f.el&&(c=f.el)}d&&(n.mine=!0,m.mine.write(a)),m.addLinks(n.links);var p=new h.models[r?"Thread":"Post"](n),g=new h[r?"Section":"Article"]({model:p,el:c,id:a});if(c||g.render().insertIntoDOM(),g.clientInit(),o(n.links,a),l.request("post:inserted",p),!r){var v=m.posts.get(n.op);v&&(v.get("replies").push(a),m.page.get("thread")||(v.dispatch("shiftReplies"),i&&v.dispatch("bumpThread")))}}),i(a,u.INSERT_IMAGE,function(e){var t=s(e,2),n=t[0],i=t[1],o=l.request("postModel"),a=o&&o.get("num")==n;a&&l.request("postForm").insertUploaded(i),r(n,function(e){return e.setImage(i,a)})}),i(a,u.UPDATE_POST,function(e){var t=s(e,3),n=t[0],i=t[1],a=t[2],c=void 0===a?{}:a;r(n,function(e){m.addLinks(c.links),e.update(i,c),o(c.links,n),n in m.ownPosts?l.oneeSama.trigger("insertOwnPost",c):e.dispatch("updateBody",i)})}),i(a,u.FINISH_POST,function(e){var t=s(e,1),n=t[0];delete m.ownPosts[n],r(n,function(e){e.set("editing",!1),e.dispatch("renderEditing",!1)})}),i(a,u.DELETE_POSTS,function(e){r(e[0],function(t){return t.deletePost(e[1])})}),i(a,u.LOCK_THREAD,function(e){r(e[0],function(t){return t.toggleLocked(!0,e[1])})}),i(a,u.UNLOCK_THREAD,function(e){r(e[0],function(t){return t.toggleLocked(!1,e[1])})}),i(a,u.DELETE_IMAGES,function(e){r(e[0],function(t){return t.removeImage(e[1])})}),i(a,u.SPOILER_IMAGES,function(e){r(e[0],function(t){return t.setSpoiler(e[1],e[2])})}),i(a,u.BAN,function(e){var t=s(e,2),n=t[0],i=t[1];if(!n){if(!i)return;i=JSON.parse(i),n=i.num}r(n,function(e){return e.setBan(n,i)})}),i(a,u.BACKLINK,function(e){r(e[0],function(t){return t.addBacklink(e[1],e[2])})}),i(a,u.ONLINE_COUNT,function(e){p.textContent="["+e[0]+"]"}),i(a,u.HOT_INJECTION,function(e){var t=s(e,3),n=t[0],i=t[1],o=t[2];n||i===m.configHash?n&&(m.configHash=i,m.hotConfig.set(o)):l.send([u.HOT_INJECTION,!0])}),a)),d[u.SYNCHRONIZE]=l.connSM.feeder("sync"),d[u.INVALID]=l.connSM.feeder("invalid"),f.listener(document,"click","del",function(e){e.spoilt||(e.spoilt=!0,e.target.classList.toggle("reveal"))})},{"./main":"main"}],3:[function(e,t,n){"use strict";function i(e){if("synced"==h.state||"syncing"==h.state){if(v.readyState!=p.OPEN)return void(console&&console.warn("Attempting to send while socket closed"));e=JSON.stringify(e),f.DEBUG&&console.log("<",e),v.send(e)}}function o(e){f.DEBUG&&console.log(">",e.data);var t=JSON.parse(e.data)[0],n=t.shift(),i=t.shift(),o=d.is_pubsub(i);if(!o||"locked"!==h.state){var r=u.dispatcher[i];r&&(o&&n in m.syncs&&m.syncs[n]++,u.follow(function(){return r(t,n)}))}}function r(e){w.textContent=e}function a(){return v&&(v.onclose=null,v.onmessage=null),"file:"==window.location.protocol?void console.log("Page downloaded locally; refusing to sync."):(v=s(),v.onopen=h.feeder("open"),v.onclose=h.feeder("close"),v.onmessage=o,void(f.DEBUG&&(window.socket=v)))}function s(){var e=["xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];return f.USE_WEBSOCKETS&&e.unshift("websocket"),new p(f.SOCKET_URL||f.SOCKET_PATH,null,{transports:e})}function l(){b&&(clearTimeout(b),b=0),y=0}function c(){switch(h.state){case"desynced":return;case"synced":case"syncing":case"conn":var e=v.readyState;if(e!=p.OPEN&&e!=p.CONNECTING)return void h.feed("close");if(navigator.onLine===!1)return void h.feed("close")}h.feed("retry")}var u=e("./main"),d=(u._,u.common),f=u.config,h=u.connSM,m=u.state,p=u.SockJS,g=u.lang.sync,v=void 0,y=void 0,b=void 0;u.reply("send",i);var w=document.getElementById("sync");h.act("load + start -> conn",function(){r(g.connecting),y=0,a()}),h.act("conn, reconn + open -> syncing",function(){r(g.syncing);var e=d.randomID(32),t=m.page;t.set("connID",e),i([d.SYNCHRONIZE,e,t.get("board"),m.syncs,t.get("live"),document.cookie])}),h.act("syncing + sync -> synced",function(){r(g.synced),b=setTimeout(function(){b=0,l()},1e4)}),h.act("synced, syncing + lock -> locked"),h.act("locked + unlock -> synced"),u.reply("connection:lock",function(){return i([d.DESYNC])},h.feed("lock")),u.reply("connection:unlock",function(e){return i(e)},h.feed("unlock")),h.act("* + close -> dropped",function(e){v&&(v.onclose=null,v.onmessage=null),f.DEBUG&&console.error("E:",e),b&&(clearTimeout(b),b=0),r(g.dropped);var t=500*Math.pow(1.5,Math.min(Math.floor(++y/2),12));setTimeout(h.feeder("retry"),t)}),h.act("dropped + retry -> reconn",function(){a(),setTimeout(function(){"reconn"==h.state&&r(g.reconnecting)},100)}),h.act("* + invalid, desynced + close -> desynced",function(e){e=e&&e[0]?"Out of sync: "+e[0]:"Out of sync",r(e),b&&(clearTimeout(b),b=0),v.onclose=null,v.onmessage=null,v.close(),v=null,f.DEBUG&&(window.socket=null)}),h.feed("start"),document.addEventListener("visibilitychange",function(e){e.target.hidden||setTimeout(c,20)}),window.addEventListener("online",function(){return l()},h.feed("retry")),window.addEventListener("offline",h.feeder("close"))},{"./main":"main"}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./main"),a=(r._,r.util),s=r.options,l=r.state,c=r.posts,u=function(){function e(t){i(this,e);var n=r.$threads[0],o=JSON.parse(document.getElementById("postData").innerHTML);if(r.request("notify:title",o.title),!t){var a=this.mine=l.mine.readAll(),c=this.posts=o.posts;this.extractReplies(n),this.extractThreads(n),l.addLinks(o.links);for(var u in c){var d=c[u].links;if(d)for(var f in d)f in a&&r.request("repliedToMe",c[u].num)}s.get("anonymise")&&r.request("loop:anonymise"),r.request("time:render")}}return o(e,[{key:"extractReplies",value:function(e){for(var t=e.getElementsByTagName("article"),n=0,i=t.length;i>n;n++){var o=t[n];new c.Article({model:new c.models.Post(this.extractModel(o)),el:o})}}},{key:"extractThreads",value:function(e){for(var t=e.getElementsByTagName("section"),n=0;n<t.length;n++){var i=t[n],o=this.extractModel(i);new c.Section({model:new c.models.Thread(o),el:i}).renderOmit(),l.syncs[o.num]=o.hctr}}},{key:"extractModel",value:function(e){var t=this.posts[a.getNum(e)];return t.num in this.mine&&(t.mine=!0),t}}]),e}();t.exports=u,new u(l.page.get("catalog"))},{"./main":"main"}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(t){i(this,e),this.state=t,this.spec={acts:{},ons:{},wilds:{},preflights:{}}}return o(e,[{key:"clone",value:function(){var t=new e(this.state);return t.spec=this.spec,t}},{key:"on",value:function(e,t){var n=this.spec.ons[e];n?n.push(t):this.spec.ons[e]=[t]}},{key:"preflight",value:function(e,t){var n=this.spec.preflights[e];n?n.push(t):this.spec.preflights[e]=[t]}},{key:"act",value:function(e,t){var n=e.split("->");if(2!=n.length)throw new Error("Bad FSM spec: "+e);for(var i=n[0].split(","),o=n[1].match(/^\s*(\w+)\s*$/)[1],r=void 0,a=i.length-1;a>=0;a--){var s=i[a],l=s.match(/^\s*(\*|\w+)\s*(?:\+\s*(\w+)\s*)?$/);if(!l)throw new Error("Bad FSM spec portion: "+s);if(l[2]&&(r=l[2]),!r)throw new Error("Tokenless FSM action: "+s);var c=l[1];if("*"==c)this.spec.wilds[r]=o;else{var u=this.spec.acts[c];u||(this.spec.acts[c]=u={}),u[r]=o}}t&&this.on(o,t)}},{key:"feed",value:function(e,t){var n=this.spec,i=this.state,o=n.acts[i],r=o&&o[e]||n.wilds[e];if(r&&i!=r){for(var a=n.preflights[r],s=0;a&&s<a.length;s++)if(!a[s].call(this,t))return!1;this.state=r;for(var l=n.ons[r],s=0;l&&s<l.length;s++)l[s].call(this,t)}return!0}},{key:"feeder",value:function(e){var t=this;return function(n){return t.feed(e,n)}}}]),e}();n["default"]=r},{}],6:[function(e,t,n){"use strict";var i=e("./main"),o=new i.Memory("hide",7,!0);i.reply("hide",function(e){if(!e.get("mine")){var t=o.write(e.get("num"));e.remove(),i.request("hide:render",t)}}),i.reply("hide:clear",function(){return o.purgeAll()}),i.defer(function(){return i.request("hide:render",o.size())})},{"./main":"main"}],7:[function(e,t,n){"use strict";function i(e,t){var n=u.read(e);if(!s.isMatch(u.page.attributes,n)){r.request("connection:lock"),t&&t.preventDefault();var i=e.split("#"),a=i[0]+(/\?/.test(i[0])?"&":"?")+"minimal=true";1!==i.length&&(a+="#"+i[1]),d.show();var f=new XMLHttpRequest;f.open("GET",a),f.onload=function(){return 200!==this.status?(d.hide(),alert(this.status)):(o(e)!==o(this.responseURL)&&(n=u.read(this.responseURL)),r.request("postSM:feed","done"),r.trigger("state:clear"),r.$threads[0].innerHTML=this.response,u.page.set(n),r.oneeSama.op=n.thread,new c(n.catalog),n.catalog||r.request("connection:unlock",[l.RESYNC,n.board,u.syncs,n.live]),t&&(history.pushState(null,null,n.href),location.hash?r.request("scroll:aboveBanner"):window.scrollTo(0,0)),void d.hide())},f.send()}}function o(e){return e.split(/[\?#]/)[0]}var r=e("./main"),a=r.$,s=r._,l=r.common,c=r.Extract,u=r.state;r.$doc.on("click","a.history",function(e){e.ctrlKey||i(this.href,e)});var d=a("#loadingImage");r.reply("loading:show",function(){return d.show()}),r.reply("loading:hide",function(){return d.hide()}),window.onpopstate=function(e){i(e.target.location.href),r.request("scroll:aboveBanner")}},{"./main":"main"}],8:[function(e,t,n){"use strict";function i(){l.state.page.get("catalog")?!function(){var e="hide"===u.get("thumbs")||l.oneeSama.workMode?"none":"";document.queryAll(".expanded").forEach(function(t){return t.style.display=e})}():c(function(){return o(function(e,t){return e&&t.dispatch("renderImage",e)})})}function o(e){d.each(function(t){return e(t.get("image"),t)})}function r(){c(function(){return o(function(e,t){return e&&e.spoiler&&t.dispatch("renderImage",e)})})}function a(){c(function(){return o(function(e,t){return e&&".gif"===e.ext&&t.dispatch("renderImage",e)})})}function s(e,t){c(function(){var e=t?"anonymise":"renderName";d.each(function(t){var n=t.attributes,i=n.name,o=n.trip;(i||o)&&t.dispatch(e)})})}var l=e("./main"),c=(l.util,l.follow),u=l.options,d=(l.oneeSama,l.state.posts);u.on({"change:thumbs":i,"change:spoilers":r,"change:autogif":a,"change:anonymise":s,workModeTOG:i}),l.reply("loop:anonymise",function(){return u.get("anonymise")&&s(null,!0)})},{"./main":"main"}],9:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./main"),a=r._,s=r.Cookie,l=function(){function e(t,n,o){i(this,e),this.key=t,this.expiry=n,this.needCookie=o,r.defer(this.purgeExpired.bind(this))}return o(e,[{key:"bakeCookie",value:function(e){if(this.needCookie){var t=Object.keys(e);t.sort(function(e,t){return parseInt(e,10)-parseInt(t,10)}),s.set(this.key,t.join("/"))}}},{key:"now",value:function(){return Math.floor(Date.now()/1e3)}},{key:"purgeAll",value:function(){localStorage.removeItem(this.key),this.needCookie&&s.remove(this.key)}},{key:"readAll",value:function(){var e=localStorage.getItem(this.key);if(!e)return{};var t=void 0;try{t=JSON.parse(e)}catch(n){}return a.isObject(t)?t:{}}},{key:"writeAll",value:function(e){return a.isEmpty(e)?this.purgeAll():(localStorage.setItem(this.key,JSON.stringify(e)),void this.bakeCookie(e))}},{key:"write",value:function(e){var t=this.readAll();return t[e]=this.now(),this.writeAll(t),a.size(t)}},{key:"size",value:function(){return a.size(this.readAll())}},{key:"purgeExpired",value:function(){if(this.expiry){var e=this.readAll(),t=this.now(),n=86400*this.expiry,i=[];for(var o in e){var r=e[o];r&&t>r+n&&i.push(o)}if(i.length){for(var a=0,s=i.length;s>a;a++)delete e[i[a]];this.writeAll(e)}}}}]),e}();t.exports=l},{"./main":"main"}],10:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("main"),r=e("./opts"),a=i(r),s=void 0;try{s=JSON.parse(localStorage.options)}catch(l){}s||(s={}),n["default"]=s=new o.Backbone.Model(s);var c=o.Backbone.Collection.extend({persist:function(){var e={};this.forEach(function(t){var n=t.getValue();n!==t.get("default")&&(e[t.get("id")]=n)}),localStorage.options=JSON.stringify(e)}}),u=new c,d=o.Backbone.Model.extend({initialize:function(e){if(void 0===e.load||e.load){e.type||this.set("type","checkbox");var t=this.getValue();this.setValue(t),void 0!==e.exec&&(this.listenTo(s,"change:"+e.id,this.execListen),e.execOnStart!==!1&&e.exec(t)),u.add(this)}},setValue:function(e){s.set(this.get("id"),e)},getValue:function(){var e=s.get(this.get("id"));return void 0===e?this.get("default"):e},validate:function(e){var t=this.get("validation");return t?t(e):!0},execListen:function(e,t){this.get("exec")(t)}});!function(){function e(){n.filter(".noOptions").fadeOut(t)}function t(){n.fadeIn(),n.filter(".noOptions").length&&e()}if(!localStorage.getItem("options")){var n=$("#options");n.addClass("noOptions"),e(),n.click(function(){n.removeClass("noOptions")})}}();var f=o.Backbone.View.extend({initialize:function(){var t=this;this.setElement(util.parseEl(e("./render")())),document.body.append(this.el),u.each(function(e){var n=t.$el.find("#"+e.get("id"));if(n.length){var i=e.get("type"),o=e.getValue();"checkbox"==i?n.prop("checked",o):"number"==i||i instanceof Array?n.val(o):"shortcut"==i&&n.val(String.fromCharCode(o).toUpperCase())}}),this.$hidden=this.$el.find("#hidden"),main.reply("hide:render",this.renderHidden,this)},events:{"click .option_tab_sel>li>a":"switchTab",change:"applyChange","click #export":"export","click #import":"import","click #hidden":"clearHidden"},switchTab:function(e){e.preventDefault();var t=$(e.target);this.$el.children(".option_tab_sel").find("a").removeClass("tab_sel"),t.addClass("tab_sel");var n=this.$el.children(".option_tab_cont").children("li");n.removeClass("tab_sel"),n.filter("."+t.data("content")).addClass("tab_sel")},applyChange:function(e){var t,n=$(e.target),i=u.get(n.attr("id"));if(i){var o=i.get("type");if("checkbox"==o)t=n.prop("checked");else if("number"==o)t=parseInt(n.val());else{if("image"==o)return main.request("background:store",e.target);t="shortcut"==o?n.val().toUpperCase().charCodeAt(0):n.val()}if(!i.validate(t))return n.val("");i.setValue(t),u.persist()}},"export":function(){var e=document.getElementById("export");e.setAttribute("href",window.URL.createObjectURL(new Blob([JSON.stringify(localStorage)],{type:"octet/stream"}))),e.setAttribute("download","meguca-config.json")},"import":function(e){e.preventDefault();var t=this.$el.find("#importSettings");t.click(),t.one("change",function(){var e=new FileReader;e.readAsText(t[0].files[0]),e.onload=function(e){var t;try{t=JSON.parse(e.target.result)}catch(e){alert("Import failed. File corrupt")}if(t){localStorage.clear();for(var n in t)localStorage[n]=t[n];alert("Import successfull. The page will now reload."),location.reload(!0)}}})},renderHidden:function(e){var t=this.$hidden;t.text(t.text().replace(/\d+$/,e))},clearHidden:function(){main.request("hide:clear"),this.renderHidden(0)}}),h=!0,m=!1,p=void 0;try{for(var g,v=a["default"][Symbol.iterator]();!(h=(g=v.next()).done);h=!0){var y=g.value;new d(y)}}catch(b){m=!0,p=b}finally{try{!h&&v["return"]&&v["return"]()}finally{if(m)throw p}}main.defer(function(){new f})},{"./opts":11,"./render":12,main:"main"}],11:[function(e,t,n){"use strict";function i(e,t){return function(n){document.getElementById(e)||document.head.appendChild(o.util.parseEl('<style id="'+e+'">'+t+"</style>")),document.getElementById(e).disabled=!n}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("main"),r=!o.isMobile;n["default"]=opts=[{id:"lang",type:o.config.lang.enabled,tab:0,"default":o.config.lang["default"],execOnStart:!1,exec:function(e){alert(o.lang.langApplied),location.reload()}},{id:"inlinefit",type:["none","full","width","height","both"],tab:1,"default":"width"},{id:"thumbs",type:o.util.thumbStyles,tab:1,"default":"small"},{id:"imageHover","default":!0,load:r,tab:0},{id:"webmHover",load:r,tab:0},{id:"autogif",load:r,tab:1},{id:"spoilers",tab:1,"default":!0},{id:"linkify",tab:0,"default":!0},{id:"notification",load:r,tab:0,exec:function(e){e&&"granted"!==Notification.permission&&Notification.requestPermission()}},{id:"anonymise",tab:0},{id:"relativeTime",tab:0,"default":!0},{id:"nowPlaying",load:r&&o.config.radio,tab:3,"default":!0,exec:function(e){e?main.send({type:"radio"}):main.request("banner:radio:clear")}}];for(var a=["google","iqdb","saucenao","desustorage","exhentai"],s=0;s<a.length;s++){var l=a[s];opts.push({id:l,lang:"imageSearch",tab:2,"default":"google"===l,exec:i(l+"Toggle","."+l+"{display:initial;}")})}opts.push({id:"illyaBGToggle",load:r&&o.config.illyaDance,tab:3},{id:"illyaMuteToggle",load:r&&o.config.illyaDance,tab:3},{id:"horizontalPosting",tab:3,exec:i("horizontal","article,aside{display:inline-block;}")},{id:"replyright",tab:1,exec:i("reply-at-right","section>aside{margin: -26px 0 2px auto;}")},{id:"theme",type:["moe","gar","mawaru","moon","ashita","console","tea","higan","ocean","rave","tavern","glass"],tab:1,"default":o.config.defaultCSS,exec:function(e){e&&document.getElementById("theme").setAttribute("href",o.config.MEDIA_URL+"css/"+e+".css?v="+main.cssHash)}},{id:"userBG",load:r,tab:1},{id:"userBGimage",load:r,type:"image",tab:1,execOnStart:!1,exec:function(e){main.request("background:store",e)}},{id:"lastn",type:"number",tab:0,validation:o.util.resonableLastN,"default":o.config.posts.lastN},{id:"alwaysLock",tab:0});var c=[{id:"new","default":78},{id:"togglespoiler","default":73},{id:"textSpoiler","default":68},{id:"done","default":83},{id:"expandAll","default":69},{id:"workMode","default":66}],u=!0,d=!1,f=void 0;try{for(var h,m=c[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){var p=h.value;p.type="shortcut",p.tab=4,p.load=r,opts.push(p)}}catch(g){d=!0,f=g}finally{try{!u&&m["return"]&&m["return"]()}finally{if(d)throw f}}},{main:"main"}],12:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function o(){for(var e='<div class="bmodal glass" id="options-panel"><ul class="option_tab_sel">',t=d.tabs,n=[],i=function(i){return n[i]=u._.filter(u.options,function(e){return e.tab===i&&(void 0===e.load||e.load)&&!e.hidden}),n[i].length?(e+='<li><a data-content="tab-'+i+'"',0===i&&(e+=' class="tab_sel"'),void(e+=">"+t[i]+"</a></li>")):"continue"},o=0;o<t.length;o++){i(o)}e+='</ul><ul class="option_tab_cont">';for(var o=0;o<n.length;o++)e+=r(opt,o);return e+="</ul></div>"}function r(e,t){if(!opts[t].length)return"";var n="";n+='<li class="tab-'+t,0===t&&(n+=" tab_sel"),n+='">';var i=!0,o=!1,r=void 0;try{for(var l,c=opts[t][Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;n+=a(u)}}catch(d){o=!0,r=d}finally{try{!i&&c["return"]&&c["return"]()}finally{if(o)throw r}}return 0===t&&(n+=s()),n+="</li>"}function a(e){var t="",n="shortcut"===e.type,i=e.type instanceof Array,o="checkbox"===e.type||void 0===e.type,r="number"===e.type,a="image"===e.type;n&&(t+="Alt+"),i?t+="<select":(t+="<input",o||a?t+=' type="'+(o?"checkbox":"file")+'"':r?t+=' style="width: 4em;" maxlength="4"':n&&(t+=' maxlength="1"'));var s=l(d[e.id],2),c=s[0],u=s[1];if(t+=' id="'+e.id+'" title="'+u+'">',i){var f=!0,h=!1,m=void 0;try{for(var p,g=e.type[Symbol.iterator]();!(f=(p=g.next()).done);f=!0){var v=p.value;t+='<option value="'+v+'">'+(d[v]||v)+"</option>"}}catch(y){h=!0,m=y}finally{try{!f&&g["return"]&&g["return"]()}finally{if(h)throw m}}t+="</select>"}return t+='<label for="'+e.id+'" title="'+u+'">'+c+"</label><br>"}function s(){var e="<br>",t=["export","import","hidden"],n=!0,i=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=r.value,u=l(d[s],2);u[0],u[1];e+='<a id="'+s+'" title="'+ln[1]+'">'+ln[0]+"</a> "}}catch(f){i=!0,o=f}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}var h={type:"file",id:"importSettings",name:"Import Settings"};return e+=common.parseHTML(c,h)}var l=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(l){o=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=i(["<input ",">"],["<input ",">"]);Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o;var u=e("main"),d=main.lang.opts},{main:"main"}],13:[function(e,t,n){"use strict";var i=e("../main"),o=e("./common"),r=i._;i.Backbone;t.exports=o.extend({tagName:"article",render:function(){return this.setElement(i.oneeSama.article(this.model.attributes)),this},insertIntoDOM:function(){r.last(document.query("#p"+this.model.get("op")).queryAll("article")).after(this.el),this.autoExpandImage().fun()}})},{"../main":"main","./common":14}],14:[function(e,t,n){"use strict";var i=e("../main"),o=e("./imager"),r=(i._,i.Backbone,i.common,i.util),a=i.lang,s=i.oneeSama,l=i.options;i.state;t.exports=o.Hidamari.extend({className:"glass",initialize:function(){this.listenTo(this.model,"dispatch",this.redirect)},clientInit:function(){return l.get("anonymise")&&this.anonymise(),this},redirect:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];this[e].apply(this,n)},updateBody:function(e){this.blockquote||(this.blockquote=this.el.query("blockquote"));var t=this.model.attributes;this.blockquote.innerHTML=s.setModel(t).body(t.body)},renderTime:function(){this.el.query("time").outerHTML=s.time(this.model.get("time"))},renderBacklinks:function(e){this.el.query("small").innerHTML=s.backlinks(e)},fun:function(){},anonymise:function(){this.el.query(".name").innerHTML='<b class="name">'+a.anon+"<b>"},renderName:function(){this.el.query(".name").outerHTML=s.name(this.model.attributes)},renderModerationInfo:function(e){var t=this.getContainer();t.query(".modLog").remove(),t.query("blockquote").before(r.parseDOM(s.modInfo(e)))},getContainer:function(){return this.el.query(".container")},renderBan:function(){var e=this.getContainer();e.query(".banMessage").remove(),e.query("blockquote").after(r.parseDOM(s.banned()))},renderEditing:function(e){var t=this.el;e?t.classList.add("editing"):(t.classList.remove("editing"),t.query("blockquote").normalize())}})},{"../main":"main","./imager":17}],15:[function(e,t,n){"use strict";function i(e,t,n){t||(t={allowFullScreen:"true"}),t.allowScriptAccess="always";var i={autohide:1,fs:1,modestbranding:1,origin:document.location.origin,rel:0,showinfo:0};return n&&(i.start=n),t.autoplay&&(i.autoplay=t.autoplay),t.loop&&(i.loop="1",i.playlist=e),s("<iframe></iframe>",{type:"text/html",src:encodeURI("https://www.youtube.com/embed/"+e)+"?"+s.param(i),frameborder:"0",attr:o(),"class":"youtube-player"})}function o(){return window.screen&&screen.width<=320?{width:250,height:150}:{width:560,height:340}}function r(e,t,n){var i="https://soundcloud.com/oembed?url="+encodeURIComponent(e.getAttribute("href"))+("&maxwidth="+t+"&maxheight=166&auto_play=true&format=json")+"&show_comments=false",o=new XMLHttpRequest;o.open("GET",i),o.responseType="json",o.onload=function(){return 200!==this.status?n(this.status):void n(null,this.response)},o.send()}var a=e("../main"),s=a.$,l=a.util,c=n.youtube_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtube\.com\/watch\/?\?((?:[^\s#&=]+=[^\s#&]*&)*)?v=([\w-]{11})((?:&[^\s#&=]+=[^\s#&]*)*)&?(#t=[\dhms]{1,9})?/,u=n.youtube_short_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?youtu.be\/([\w-]{11})\??(t=[\dhms]{1,9})?/,d=n.youtube_time_re=/^#t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/,f=n.youtube_short_time_re=/^t=(?:(\d\d?)h)?(?:(\d{1,3})m)?(?:(\d{1,3})s)?$/;a.$threads.on("click",".watch",function(e){function t(e,t,r){var a=0;if(t){var s=t.match(r);s&&(s[1]&&(a+=3600*parseInt(s[1],10)),s[2]&&(a+=60*parseInt(s[2],10)),s[3]&&(a+=parseInt(s[3],10)))}n.css("width",o().width).append("<br>",i(e,null,a))}if(!(e.which>1||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)){var n=s(e.target);if(n.is("a")){var r=n.find("iframe");if(r.length)return r.siblings("br").andSelf().remove(),n.css("width","auto"),!1;if(!n.data("noembed")){var a=n.attr("href").match(c);if(!a){if(a=n.attr("href").match(u),!a)return;t(a[1],a[2],f)}return t(a[2],a[4],d),!1}}}}),a.$threads.on("mouseenter",".watch",function(e){function t(e){var t=e&&e.data&&e.data.title;t?(i.textContent=o+": "+t,n.css({color:"black"})):i.textContent=o+" (gone?)",e&&e.data&&e.data.accessControl&&"denied"===e.data.accessControl.embed&&(i.textContent+=" (EMBEDDING DISABLED)",n.data("noembed",!0))}var n=s(e.target);if(!n.data("requestedTitle")){n.data("requestedTitle",!0);var i=n.contents().filter(function(){return 3===this.nodeType})[0];if(i){var o=i.textContent;i.textContent=o+"...";var r=n.attr("href").match(c);if(!r){if(r=n.attr("href").match(u),!r)return;s.ajax({url:"//gdata.youtube.com/feeds/api/videos/"+r[1],data:{v:"2",alt:"jsonc"},dataType:"json",success:t,error:function(){i.textContent=o+"???"}})}s.ajax({url:"//gdata.youtube.com/feeds/api/videos/"+r[2],data:{v:"2",alt:"jsonc"},dataType:"json",success:t,error:function(){i.textContent=o+"???"}})}}});n.soundcloud_url_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.)?soundcloud\.com\/([\w-]{1,40}\/[\w-]{1,80})\/?/;a.$threads.on("click",".soundcloud",function(e){if(!(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)){var t=e.target,n=t.query("iframe");if(e.preventDefault(),n)return n.previousElementSibling.remove(),void n.remove();var i=Math.round(.75*window.innerWidth);r(t,i,function(e,n){return e?alert(e):(t.append(document.createElement("br")),t.append(l.parseDOM(n.html)),void(t.style.width=i+"px"))})}}),a.$threads.on("mouseenter",".soundcloud:not(.fetched)",function(e){var t=e.target,n=t.firstChild,i=n.textContent;n.textContent=i+" ...",r(t,1e3,function(e,o){return e?n.textContent=i+": Error: "+e:(n.textContent=i+": "+o.title,t.style.color="black",void t.classList.add("fetched"))})});var h=n.pastebin_re=/(?:>>>*?)?(?:https?:\/\/)?(?:www\.|m.)?pastebin\.com\/(.*)/;s(document).on("click",".pastebin",function(e){if(!(e.which>1||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)){var t=s(e.target),n=t.find("iframe");if(n.length)return n.siblings("br").andSelf().remove(),t.css({width:"auto",height:"auto"}),!1;var i=t.attr("href").match(h);if(i){var o=s(window),r=Math.round(.65*o.innerWidth()),a=Math.round(.65*o.innerHeight());return t.css({width:r,height:a}).append("<br>",s("<iframe></iframe>",{type:"text/html",src:"https://pastebin.com/embed_iframe.php?i="+i[1],frameborder:"0",width:r,height:a})),!1}}})},{"../main":"main"}],16:[function(e,t,n){"use strict";function i(){try{var e=JSON.parse(localStorage.ident);e.name&&l.val(e.name),e.email&&s.val(e.email)}catch(t){}}function o(){var e=r.request("postForm");e&&e.renderIdentity(),d()}var r=e("../main"),a=(r.$,r.$script),s=r.$email,l=r.$name,c=r._,u=(r.common,r.config),d=c.debounce(function(){try{var e=l.val(),t=s.val();if(t===u.LOGIN_KEYWORD&&(s.val(""),a(u.MEDIA_URL+"js/login.js?v="+r.clientHash),t=!1),e||t){var n={};e&&(n.name=e),t&&(n.email=t),localStorage.ident=JSON.stringify(n)}else localStorage.removeItem("ident")}catch(i){}},1e3);r.defer(function(){i(),l.on("input",o),s.on("input",o)})},{"../main":"main"}],17:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var o=i(["<"," ",">"],["<"," ",">"]),r=i(['<audio src="','"\n				width="300"\n				height="3em"\n				autoplay loop controls\n			>\n			</audio>'],['<audio src="','"\n				width="300"\n				height="3em"\n				autoplay loop controls\n			>\n			</audio>']),a=e("../main"),s=a.$threads,l=(a._,a.Backbone),c=a.common,u=a.util,d=a.oneeSama,f=a.options,h=a.state;n.Hidamari=l.View.extend({renderImage:function(e,t,n){var i=e===!0,o=this.model,r=this.el;t&&t.src||(t=o.get("image"));var a=r.query("figure");a&&a.remove(),t&&(r.query("blockquote").before(u.parseDOM(d.image(t,i))),n&&o.get("tallImage")&&(window.scrollTop=r.getBoundingClientRect().top+document.body.scrollTop-document.query("#banner").height),o.set({thumbnailRevealed:i,imageExpanded:!1,tallImage:!1}))},autoExpandImage:function(){var e=this.model.get("image");return!e||!p.get("expand")||[".webm",".pdf",".mp3"].indexOf(e.ext)>-1?this:(this.toggleImageExpansion(!0,e),this)},toggleImageExpansion:function(e,t,n){var i=f.get("inlinefit");t&&"none"!==i&&(e?this.fitImage(t,i):this.renderImage(null,t,n));
},fitImage:function(e,t){if(".pdf"===e.ext)return window.open(d.imagePaths().src+e.src,"_blank");if(".mp3"===e.ext)return this.renderAudio(e);var n=void 0,i=void 0,o=n=e.dims[0],r=i=e.dims[1];if("full"===t)return this.expandImage(e,{width:o,height:r});var a="both"===t,s=a||"width"===t,l=a||"height"===t,c=o/r,u=void 0,f=void 0;if(s){var h=this.imageMaxWidth();n>h&&(n=h,i=n/c,u=!0)}if(l){var m=window.innerHeight-document.query("#banner").offsetHeight;i>m&&(i=m,n=i*c,f=!0)}n>50&&i>50&&(o=n,r=i),this.expandImage(e,o,r,f&&!u)},imageMaxWidth:function(){var e=this.el,t=this.model;return window.innerWidth-2*parseInt(e.closest("section").getBoundingClientRect().left)-u.outerWidth(t.get("op")?e:e.query(".background"))},expandImage:function(e,t,n,i){var r=".webm"===e.ext,a={src:d.imagePaths().src+e.src,width:t,height:n},s="expanded";i&&(s+=" noMargin"),a["class"]=s,r&&(a.autoplay=a.loop=a.controls=!0),this.el.query("figure").lastChild.innerHTML=c.parseHTML(o,r?"video":"img",a),this.model.set({imageExpanded:!0,tallImage:n>window.innerHeight})},renderAudio:function(e){this.el.query("figure").append(u.parseDOM(c.parseHTML(r,d.imagePaths().src+e.src))),this.model.set("imageExpanded",!0)}});var m=l.Model.extend({initialize:function(){var e=this;s.on("click","#expandImages",function(t){t.preventDefault(),e.toggle()})},toggle:function(){var e=!this.get("expand");this.set("expand",e).massToggle(e),s.find("#expandImages").text(a.lang.expander[+e])},massToggle:function(e){var t=f.get("inlinefit");if("none"!==t)for(var n=h.posts.models,i=0,o=n.length;o>i;i++){var r=n[i],a=r.get("image");a&&(e?r.dispatch("fitImage",a,t):r.dispatch("renderImage",null,a))}}}),p=n.massExpander=new m;a.reply("massExpander:unset",function(){return p.unset()}),s.on("click","img, video",function(e){if("none"!=f.get("inlinefit")&&1===e.which){var t=u.getModel(e.target);t&&(e.preventDefault(),a.request("imager:clicked"),t.dispatch("toggleImageExpansion",!t.get("imageExpanded"),t.get("image"),!0))}}),s.on("click",".imageToggle",function(e){e.preventDefault();var t=u.getModel(e.target);t&&a.follow(function(){return t.dispatch("renderImage",!t.get("thumbnailRevealed"))})})},{"../main":"main"}],18:[function(e,t,n){"use strict";t.exports={imager:e("./imager"),Menu:e("./menu"),common:e("./common"),Article:e("./article"),Section:e("./section"),models:e("./models"),nonce:e("./nonce"),embed:e("./embed"),posting:e("./posting")}},{"./article":13,"./common":14,"./embed":15,"./imager":17,"./menu":19,"./models":20,"./nonce":21,"./posting":22,"./section":23}],19:[function(e,t,n){"use strict";var i=e("../main"),o=(i.$,i._),r=i.Backbone,a=(i.common,i.util),s=i.lang,l=(i.state,t.exports=r.View.extend({className:"popup-menu glass",tagName:"ul",actions:["report","hide"],events:{click:"handleClick"},initialize:function(e){var t=e.parent;t._popup_menu=this,this.parent=t,this.render()},render:function(){var e="",t=!0,n=!1,i=void 0;try{for(var o,r=this.actions[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var l=o.value;e+='<li data-type="'+l+'">'+s[l]+"</li>"}}catch(c){n=!0,i=c}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw i}}var u=this.el,d=this.parent;u.innerHTML=e,d.append(u),u.style.left=u.getBoundingClientRect().left-.6*(a.outerWidth(u)+u.offsetWidth)+"px"},handleClick:function(e){e.stopPropagation(),i.request(e.target.getAttribute("data-type"),this.model),this.remove()},remove:function(){this.parent._popup_menu=null,this.el.remove(),this.stopListening()}}));i.reply("menu:extend",function(e){return o.extend(l.prototype.actions,e)}),i.$threads.on("click",".control",function(e){var t=e.target;if(t._popup_menu)return t._popup_menu.remove();var n=a.getModel(t);n&&new l({parent:t,model:n})})},{"../main":"main"}],20:[function(e,t,n){"use strict";var i=e("../main"),o=i._,r=i.Backbone,a=i.state;n.Post=r.Model.extend({idAttribute:"num",initialize:function(){a.posts.add(this)},dispatch:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];this.trigger.apply(this,["dispatch",e].concat(n))},remove:function(){this.stopListening().dispatch("remove"),a.posts.remove(this)},update:function(e,t,n){var i={body:this.get("body")+e};t&&o.extend(this.get("links"),t),n&&(i.dice=(this.get("dice")||[]).concat(n)),this.set(i)},setImage:function(e,t){this.set("image",e),t||this.dispatch("renderImage",e)},setSpoiler:function(e,t){var n=this.get("image");n.spoiler=e,this.dispatch("renderImage",n),this.moderationInfo(t)},removeImage:function(e){this.moderationInfo(e)||this.unset("image").dispatch("renderImage")},deletePost:function(e){this.moderationInfo(e)||this.remove()},setBan:function(e,t){e&&this.set("ban",!0).dispatch("renderBan"),this.moderationInfo(t)},addBacklink:function(e,t){var n=this.get("backlinks")||{};n[e]=t,this.set({backlinks:n}).dispatch("renderBacklinks",n)},moderationInfo:function(e){if(!e)return!1;var t=this.get("mod")||[];return t.push(e),this.set("mod",t).dispatch("renderModerationInfo",t),!0}}),n.Thread=n.Post.extend({defaults:{replies:[],omit:0,image_omit:0},initialize:function(){this.get("omit")&&this.getImageOmit(),a.posts.add(this)},remove:function(){this.stopListening().dispatch("remove"),a.posts.remove(this);for(var e=this.get("replies"),t=0,n=e.length;n>t;t++){var i=a.posts.get(e[t]);i&&i.remove()}},getImageOmit:function(){for(var e=this.get("imgctr")-1,t=this.get("replies"),n=0,i=t.length;i>n;n++){var o=a.posts.get(t[n]);o&&o.get("image")&&e--}this.set("image_omit",e)},toggleLocked:function(e,t){this.moderationInfo(t),this.set("locked",e).dispatch("renderLocked",e)}})},{"../main":"main"}],21:[function(e,t,n){"use strict";function i(){var e;if(window.localStorage)try{e=JSON.parse(localStorage.postNonces)}catch(t){}else e=d;return e||{}}function o(e){window.localStorage?localStorage.postNonces=JSON.stringify(e):d=e}function r(){return Math.floor(Date.now()/864e5)}function a(){var e=i(),t=c.randomID(32);return e[t]={tab:u.page.get("tabID"),day:r()},o(e),t}function s(e){setTimeout(function(){var t=i();t[e]&&(delete t[e],o(t))},1e4)}var l=e("../main"),c=l.common,u=l.state,d={};l.reply("nonce:get",i),l.reply("nonce:create",a),setTimeout(function(){if(window.localStorage){var e=i(),t=void 0,n=r()-1;for(var a in e)e[a].day>=n||(delete e[a],t=!0);t&&o(e)}},Math.floor(5e3*Math.random())),l.reply("nonce:destroy",s)},{"../main":"main"}],22:[function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function o(e){function t(){e.stopImmediatePropagation(),e.preventDefault()}if(e.altKey){var n=w.attributes;switch(e.which){case n["new"]:var i=document.query("aside.posting");i&&(k.feed("new",i),t());break;case n.togglespoiler:S&&(S.onToggle(e),t());break;case n.done:S&&!S.$submit.attr("disabled")&&(S.finish(),t());break;case n.textSpoiler:if(S){var o=this.imouto.state2.spoiler,r=(o?"[/":" [")+"spoiler]";this.imouto.state2.spoiler=!o,this.$input.val(this.$input.val()+r),t()}break;case n.expandAll:u.massExpander.toggle(),t();break;case n.workMode:var a=l.oneeSama.workMode=!l.oneeSama.workMode;h.set("workModeTOG",a);var s=document.querySelector("h1 > img");null!=s&&(s.style.display=a?"none":""),document.getElementById("theme").setAttribute("href",p.MEDIA_URL+"css/"+(a?x.hotConfig.get("DEFAULT_CSS"):l.options.get("theme"))+".css?v="+l.cssHash),b.thumbStyle=a?"hide":l.options.get("thumbs"),l.options.trigger("workModeTOG"),window.addEventListener("beforeunload",function(){h.set("workModeTOG",!1)}),t()}}}function r(e){k.feed("new",document.query("#p"+e+" aside.posting"))}var a=i(['<header>\n				<a class="name nope" target="_blank">\n					<b></b>\n				</a>\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>\n			<div class="container">\n				<blockquote>\n					<p id="buffer" class="exclude"></p>\n					<p id="lineBuffer" class="exclude"></p>\n					<textarea ',"></textarea>\n				</blockquote>\n				<form ",">\n					<input ",">\n					<input ",">\n					<input ",'>\n					<strong id="uploadStatus"></strong>\n				</form>\n				<small></small>\n			</div>'],['<header>\n				<a class="name nope" target="_blank">\n					<b></b>\n				</a>\n			</header>\n			<span class="oi control" data-glyph="chevron-bottom"></span>\n			<div class="container">\n				<blockquote>\n					<p id="buffer" class="exclude"></p>\n					<p id="lineBuffer" class="exclude"></p>\n					<textarea ',"></textarea>\n				</blockquote>\n				<form ",">\n					<input ",">\n					<input ",">\n					<input ",'>\n					<strong id="uploadStatus"></strong>\n				</form>\n				<small></small>\n			</div>']),s=e("./article"),l=e("../main"),c=e("./embed"),u=(e("./identity"),e("./imager")),d=l.$,f=(l._,l.Backbone),h=l.Cookie,m=l.common,p=l.config,g=l.connSM,v=l.util,y=l.lang,b=l.oneeSama,w=l.options,k=l.postSM,x=l.state,S=void 0,$=void 0;l.reply("postForm",function(){return S}).reply("postModel",function(){return $}).reply("postForm:indentity",function(){return S&&S.renderIdentity()});var I=300;window.screen&&screen.width<=320&&(I=50);var _=f.Model.extend({idAttribute:"num"});g.on("synced",k.feeder("sync")),g.on("dropped",k.feeder("desync")),g.on("desynced",k.feeder("desync")),l.reply("postSM:feed",function(e){return k.feed(e)}),k.act("* + desync -> none",function(){S&&(S.el.classList.remove("editing"),S.$input.val(""),S.finish()),l.$threads.find("aside.posting").hide()}),k.act("none + sync, draft, alloc + done -> ready",function(){S&&(S.remove(),S=$=null);var e=!0,t=!1,n=void 0;try{for(var i,o=l.$threads[0].queryAll("aside.posting")[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;r.style.display=""}}catch(a){t=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}}),k.act("ready + new -> draft",function(e){var t=void 0,n=e.closest("section");n?t=v.getNum(n):n=document.createElement("section"),t&&!x.page.get("thread")&&x.posts.get(t).dispatch("shiftReplies",!0),S=new T({model:$=new _({op:t}),destination:e,section:n})}),k.preflight("draft",function(e){return e.matches("aside")}),k.act("draft + alloc -> alloc",function(e){return S.onAllocation(e)}),l.dispatcher[m.IMAGE_STATUS]=function(e){return S&&S.dispatch(e[0])},l.$doc.on("click","aside.posting a",function(){k.feed("new",this.parentNode)}),l.$doc.on("keydown",o),l.oneeSama.hook("insertOwnPost",function(e){var t=e.links;S&&t&&S.$buffer.find(".nope").each(function(){var e=d(this),n=e.text(),i=n.match(/^>>(\d+)/);if(i){var o=i[1],r=t[o];if(r){var a=d(m.join([S.imouto.postRef(o,r,!1)]));e.attr("href",a.attr("href")).attr("class","history");var s=a.text();s!=n&&e.text(s)}}})});var T=(s.extend({events:{"click #cancel":"cancel","change #imageInput":"onImageChosen","input #trans":"onInput","keydown #trans":"onKeyDown","click #done":"finish","click #toggle":"onToggle"},initialize:function(e){s.prototype.initialize.call(this),this.listenTo(this.model,{change:this.renderButtons,"change:spoiler":this.renderSpoilerPane}),this.render(e).insertIntoDOM(e),this.model.set({spoiler:0,nextSpoiler:-1}),this.pending="",this.line_count=1,this.char_count=0;var t=this.imouto=new m.OneeSama({callback:inject,op:x.page.get("thread"),blockqoute:this.blockqoute,eLinkify:l.oneeSama.eLinkify,lang:l.lang,tamashii:function(e){var t=document.query("#p"+e);if(t=t&&t.closest("section")){var n=e in x.mine.readAll()&&y.you;return this.postRef(e,v.getNum(t),n)}return'<a class="nope">&gt;&gt;'+e+"</a>"}});t.setModel(this.model)},render:function(){var e={input:{name:"body",id:"input",rows:1,"class":"themed exclude",autocomplete:l.isMobile},form:{method:"post",enctype:"multipart/form-data",target:"upload",id:"uploadForm"},cancel:{type:"buttom",value:y.cancel,id:"cancel"},imageInput:{type:"file",id:"imageInput",name:"image",accept:"image/*;.webm;.pdf;.mp3"},toggle:{type:"button",id:"toggle"}};this.el.innerHTML=parseHTML(a,e.input,e.form,e.cancel,e.imageInput,e.toggle);var t=["buffer","lineBuffer","input","uploadForm","cancel","imageInput","toggle","uploadStatus","hiddenUpload","sizer"],n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var c=r.value;this[c]=document.query("#"+c)}}catch(u){i=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}return this.renderIdentity(),this},renderIdentity:function(){if(!this.model.get("num")){var e=m.parse_name(l.$name.val(),l.$email.val()),t=!(!e[1]&&!e[2]),n=this.el.query(".name"),i=n.query("a");e[0]?i.textContent=e[0]+" ":i.tetxContent=t?"":y.anon,t&&v.parseDOM(" <code>!?</code>").forEach(function(e){return i.after(e)}),l.oneeSama.trigger("fillMyName",i);var o=l.$email.val().trim();o?(n.setAttribute("href","mailto:"+o),n.classList.remove("nope"),n.classList.add("email")):(n.removeAttribute("href"),n.classList.add("nope"),n.classList.remove("email"))}},insertIntoDOM:function(e){var t=e.destination;t.before(this.el),this.resizeInput(),l.$threads.queryAll("aside.postsing").forEach(function(e){return e.style.display="none"}),this.fun()},resizeInput:function(e){var t=this.sizer,n=this.input;"string"!=typeof e&&(e=n.value),t.textContent=e;var i=t.width+m.INPUT_ROOM;i=Math.max(i,I-n.getBoundingClientRect().left-this.el.getBoundingClientRect().left),this.input.style.width=i+"px"},renderButtons:function(){var e=this.model.attributes,t=e.num,n=e.uploading,i=e.uploaded,o=e.uploadStatus,r=e.sentAllocRequest,a=r&&!t;this.submit.disabled=!(!n&&!a),i&&(this.submit.style.marginLeft=0),this.cancel.disabled=!!a,this.cancel.style.display=!t||n?"":"none",this.imageInput.disabled=!!n,this.uploadStatus.innerHTML=o},renderSpoilerPane:function(e,t){var n=t?p.MEDIA_URL+"spoil/spoil"+t+".png":p.MEDIA_URL+"css/ui/pane.png";this.toggle.style.backgroundImage='url("'+n+'")'}}),f.View.extend({events:{"input #trans":"onInput","keydown #trans":"onKeyDown","click #done":"finish","click #toggle":"onToggle"},initialize:function(e){this.listenTo(this.model,{change:this.renderButtons,"change:spoiler":this.renderSpoilerPane}),this.render(e),this.pending="",this.line_count=1,this.char_count=0;var t=this.imouto=new m.OneeSama({callback:inject,op:x.page.get("thread"),state:[m.S_BOL,0],state2:{spoiler:0},$buffer:this.$buffer,eLinkify:l.oneeSama.eLinkify,lang:l.lang,tamashii:function(e){var t=document.query("#p"+e);if(t=t&&t.closest("section")){var n=e in x.mine.readAll()&&this.lang.you;return this.postRef(e,v.getNum(t),n)}return'<a class="nope">&gt;&gt;'+e+"</a>"}});t.hook("spoilerTag",v.touchable_spoiler_tag),l.oneeSama.trigger("imouto",t)},render:function(e){var t=e.destination,n=e.section,i=this.model.get("op");this.setElement(i?document.createElement("article"):n),this.isThread=!i,this.$buffer=d("<p/>"),this.$lineBuffer=d("<p/>"),this.$meta=d('<header><a class="nope"><b/></a> <time/></header>'),this.$input=d("<textarea/>",{name:"body",id:"trans",rows:"1","class":"themed",autocomplete:l.isMobile}),this.$submit=d("<input/>",{id:"done",type:"button",value:l.lang.done}),this.$subject=d("<input/>",{id:"subject","class":"themed",maxlength:x.hotConfig.SUBJECT_MAX_LENGTH,width:"80%"}),this.$blockquote=d("<blockquote/>"),this.$sizer=d("<pre/>").appendTo("body"),this.$blockquote.append(this.$buffer,this.$lineBuffer,this.$input),this.$el.append(this.$meta,this.$blockquote,"<small/>"),this.isThread&&(this.$el.append('<label for="subject">'+y.subject+": </label>",this.$subject),this.$blockquote.hide()),this.$uploadForm=this.renderUploadForm(),this.$el.append(this.$uploadForm),l.oneeSama.trigger("draft",this.$el),this.renderIdentity(),t.style.display="none",this.isThread?(t.after(this.el),this.el.after(document.createElement("hr")),this.$subject.focus()):(t.before(this.el),this.resizeInput(),this.$input.focus()),l.$threads.find("aside.posting").hide(),this.fun()},renderIdentity:function(){if(!this.model.get("num")){var e=m.parse_name(l.$name.val(),l.$email.val()),t=!(!e[1]&&!e[2]),n=this.$meta.find("b");e[0]?n.text(e[0]+" "):n.text(t?"":l.lang.anon),t&&n.append(" <code>!?</code>"),l.oneeSama.trigger("fillMyName",n);var i=l.$email.val().trim(),o=this.$meta.children("a").first();i?o.attr({href:"mailto:"+i,target:"_blank","class":"email"}):o.removeAttr("href").removeAttr("target").attr("class","nope")}},renderButtons:function(){var e=this.model.attributes,t=e.sentAllocRequest&&!e.num,n=e.uploading||t;this.$submit.prop("disabled",!!n),e.uploaded&&this.$submit.css({"margin-left":"0"}),this.$cancel.prop("disabled",!!t),this.$cancel.toggle(!(e.num&&!e.uploading)),this.$imageInput.prop("disabled",!!e.uploading),this.$uploadStatus.html(e.uploadStatus)},renderSpoilerPane:function(e,t){var n=t?p.MEDIA_URL+"spoil/spoil"+t+".png":p.MEDIA_URL+"css/ui/pane.png";this.$toggle.css("background-image",'url("'+n+'")')},renderUploadForm:function(){var e=d('<form method="post" enctype="multipart/form-data" target="upload"></form>');return this.$cancel=d("<input/>",{type:"button",value:y.cancel,click:d.proxy(this,"cancel")}),this.$imageInput=d("<input/>",{type:"file",id:"image",name:"image",accept:p.WEBM?"imager/*;.webm":"image/*",change:d.proxy(this,"onImageChosen")}),this.$toggle=d("<input/>",{type:"button",id:"toggle"}),this.$uploadStatus=d("<strong/>"),e.append(this.$cancel,this.$imageInput,this.$toggle," ",this.$uploadStatus),this.$iframe=d("<iframe/>",{src:"",name:"upload",id:"hidden-upload"}).appendTo("body"),this.model.set({spoiler:0,nextSpoiler:-1}),e},cancel:function(){this.model.get("uploading")?(this.$iframe.remove(),this.$iframe=d("<iframe></iframe>",{src:"",name:"upload",id:"hidden-upload"}).appendTo("body"),this.uploadError(""),this.model.set({cancelled:!0})):this.finish()},onImageChosen:function(){if(!this.model.get("uploading")&&!this.model.get("uploaded")){if(!this.$imageInput.val())return void this.model.set("uploadStatus","");var e=this.prepareUpload();for(var t in e)d("<input type=hidden>").attr("name",t).val(e[t]).appendTo(this.$uploadForm);this.$uploadForm.prop("action",v.uploadURL()),this.$uploadForm.submit(),this.$iframe.load(function(){if(S){var e=this.contentWindow||this.contentDocument;if(e)try{var t=d(e.document||e).text();if(/legitimate imager response/.test(t))return;(t.length<5||t.length>100)&&(t=y.unknownUpload),S.uploadError(t)}catch(n){setTimeout(function(){S.uploadFallbackMessage()},500)}}}),this.notifyUploading()}},prepareUpload:function(){this.model.set("uploadStatus",y.uploading),this.$input.focus();var e=this.model.attributes;return{spoiler:e.spoiler,op:e.op||0}},uploadFallbackMessage:function(){var e=this.model.attributes,t=e.uploadStatus;e.cancelled||!e.uploading||t&&t!=y.uploading||this.model.set("uploadStatus",y.unknownResult)},notifyUploading:function(){this.model.set({uploading:!0,cancelled:!1}),this.$input.focus()},resizeInput:function(e){"string"!=typeof e&&(e=this.$input.val()),this.$sizer.text(e);var t=this.$sizer.width()+m.INPUT_ROOM;t=Math.max(t,I-this.$input.offset().left-this.$el.offset().left),this.$input.css("width",t+"px")},onInput:function(e){function t(t,n){var i=t[0].length,o=e.substr(0,t.index)+n+e.substr(t.index+i);if(s=!0,t.index<r){var l=i-n.length;r-=l,a-=l}return o}(void 0===e||e instanceof d.Event)&&(e=this.$input.val());for(var n,i,o,r=this.$input[0].selectionStart,a=this.$input[0].selectionEnd,s=!1;;){if(n=e.match(c.youtube_url_re),!n)break;i=this.findTimeArg(n[3])||this.findTimeArg(n[1])||n[4]||"",o=">>>/watch?v="+n[2]+i,e=t(n,o)}for(;;){if(n=e.match(c.youtube_short_re),!n)break;i=this.findTimeArg(n[2])||"",o=">>>/watch?v="+n[1]+i,e=t(n,o)}for(;;){if(n=e.match(c.soundcloud_url_re),!n)break;var l=">>>/soundcloud/"+n[1];e=t(n,l)}for(;;){if(n=e.match(c.pastebin_re),!n)break;var u=">>>/pastebin/"+n[1];e=t(n,u)}s&&this.$input.val(e);var f=e.lastIndexOf("\n");if(f>=0){var h=e.substr(0,f);e=e.substr(f+1),this.$input.val(e),(this.model.get("sentAllocRequest")||/[^ ]/.test(h))&&this.commit(h+"\n")}else if(n=e.split("").reverse().join("").match(/^(\s*\S+\s+\S+)\s+(?=\S)/)){var p=e.length-n[1].length;this.commit(e.substr(0,p)),e=e.substr(p),r-=p,a-=p,this.$input.val(e),this.$input[0].setSelectionRange(r,a)}this.$input.attr("maxlength",m.MAX_POST_CHARS-this.char_count),this.resizeInput(e)},findTimeArg:function(e){if(!e||e.indexOf("t=")<0)return!1;e=e.split("&");for(var t=0,n=e.length;n>t;t++){var i="#p"+e[t];if(c.youtube_time_re.test(i))return i}return!1},commit:function(e){var t;if(e.indexOf("\n")>=0){t=e.split("\n"),this.line_count+=t.length-1;var n=this.line_count-m.MAX_POST_LINES+1;if(n>0){for(var i=0;n>i;i++)t.pop();e=t.join("\n"),this.line_count=m.MAX_POST_LINES}}var o=m.MAX_POST_CHARS-this.char_count;if(o<e.length&&(e=e.substr(0,o)),e){this.char_count+=e.length;var r=this.model.attributes;if(r.num||r.sentAllocRequest?r.num?l.send(e):this.pending+=e:(l.send([m.INSERT_POST,this.allocationMessage(e,null)]),this.model.set({sentAllocRequest:!0})),t){t[0]=this.$lineBuffer.text()+t[0],this.$lineBuffer.text(t.pop());for(var a=0,s=t.length;s>a;a++)this.imouto.fragment(t[a]+"\n")}else this.$lineBuffer.append(document.createTextNode(e)),this.$lineBuffer[0].normalize()}},allocationMessage:function(e,t){function n(e,t){t&&(i[e]=t)}var i={nonce:l.request("nonce:create")};return n("name",l.$name.val().trim()),n("email",l.$email.val().trim()),n("subject",this.$subject.val().trim()),n("frag",e),n("image",t),n("op",this.model.get("op")),i},onKeyDown:function(e){var t=this;l.follow(function(){switch(e.which){case 13:e.preventDefault();case 32:var n=t.$input[0],i=t.$input.val();i=i.slice(0,n.selectionStart)+(13==e.which?"\n":" ")+i.slice(n.selectionEnd),t.onInput(i);break;default:o.bind(t)(e)}})},finish:function(){var e=this;if(this.model.get("num")){this.flushPending(),this.commit(this.$input.val()),this.$input.remove(),this.$submit.remove(),this.$uploadForm&&this.$uploadForm.remove(),this.$iframe&&(this.$iframe.remove(),this.$iframe=null),this.imouto.fragment(this.$lineBuffer.text()),this.$buffer.replaceWith(this.$buffer.contents()),this.$lineBuffer.remove(),this.$blockquote.css({"margin-left":"","padding-left":""}),l.send([m.FINISH_POST]),this.preserve=!0,this.isThread&&this.$el.append(l.oneeSama.replyBox());var t=this.imouto.allRolls.sent-this.imouto.allRolls.seen;t>0?!function(){var t=void 0;(t=function(n){setTimeout(function(){e.imouto.allRolls.seen==e.imouto.allRolls.sent||0==n?k.feed("done"):t(n-1)},100)})(5)}():k.feed("done")}else k.feed("done")},flushPending:function(){this.pending&&(l.send(this.pending),this.pending="")},onToggle:function(e){var t=this.model.attributes;if(!t.uploading&&!t.uploaded){if(e.preventDefault(),e.stopImmediatePropagation(),t.spoiler)return void this.model.set({spoiler:0});var n=m.pick_spoiler(t.nextSpoiler);this.model.set({spoiler:n.index,nextSpoiler:n.next})}},onAllocation:function(e){var t=e.num;x.ownPosts[t]=t,this.model.set({num:t}),this.flushPending();var n=d(l.oneeSama.header(e));this.$meta.replaceWith(n),this.$meta=n,this.isThread||this.$el.addClass("editing"),this.$el.attr("id","p"+t),e.image&&this.insertUploaded(e.image),this.$uploadForm?this.$uploadForm.append(this.$submit):this.$blockquote.after(this.$submit),this.isThread&&(this.$subject.siblings("label").andSelf().remove(),this.$blockquote.show(),this.resizeInput(),this.$input.focus()),window.onbeforeunload=function(){return"You have an unfinished post."}},insertUploaded:function(e){this.renderImage(null,e),this.$imageInput.siblings("strong").andSelf().remove(),this.$cancel.remove(),this.$uploadForm.find("#toggle").remove(),this.flushPending(),this.model.set({uploading:!1,uploaded:!0,sentAllocRequest:!0});var t=this.$el.find("img");this.$blockquote.css({"margin-left":t.css("margin-right"),"padding-left":t.width()}),this.resizeInput()},dispatch:function(e){var t=e.arg;switch(e.t){case"alloc":this.onImageAllocation(t);break;case"error":this.uploadError(t);break;case"status":this.uploadStatus(t)}},onImageAllocation:function(e){var t=this.model.attributes;t.cancelled||(t.num||t.sentAllocRequest?l.send([m.INSERT_IMAGE,e]):(l.send([m.INSERT_POST,this.allocationMessage(null,e)]),this.model.set({sentAllocRequest:!0})))},uploadError:function(e){this.model.get("cancelled")||(this.model.set({uploadStatus:e,uploading:!1}),this.$uploadForm&&this.$uploadForm.find("input[name=alloc]").remove())},uploadStatus:function(e){this.model.get("cancelled")||this.model.set("uploadStatus",e)},addReference:function(e,t){var n=this.$input.val();if(/^>>\d+$/.test(n)&&(this.$input.val(n+"\n"),this.onInput(),n=this.$input.val()),t){t=t.split("\n");for(var i=0,o=t.length;o>i;i++)t[i]=">"+t[i];e+="\n"+t.join("\n")+"\n"}this.$input.val(n+">>"+e),this.$input[0].selectionStart=this.$input.val().length,this.onInput(),this.$input.focus()},remove:function(){this.preserve||(this.isThread&&this.$el.next("hr").remove(),this.$el.remove()),this.$sizer.remove(),this.$iframe&&(this.$iframe.remove(),this.$iframe=null),this.stopListening(),window.onbeforeunload=null},renderImage:u.Hidamari.renderImage,autoExpandImage:function(){return this},fun:function(){}}));n.ComposerView=T,l.reply("openPostBox",r),window.addEventListener("message",function(e){var t=e.data;"OK"!==t&&S&&S.uploadError(t)},!1),l.$threads.on("click","a.quote",function(e){function t(e){var t=i[e]&&i[e].parentElement;return t&&t.closest("blockquote")&&t.closest("article, section")===n}e.preventDefault();var n=e.target.closest("article, section"),i=getSelection(),o=v.getNum(n),a=void 0;t("baseNode")&&t("focusNode")&&(a=i.toString()),r(v.getNum(n.closest("section"))),S.addReference(o,a)})},{"../main":"main","./article":13,"./embed":15,"./identity":16,"./imager":17}],23:[function(e,t,n){"use strict";var i=e("../main"),o=e("./common"),r=(i.$,i._,i.Backbone,i.util),a=i.oneeSama,s=i.state;t.exports=o.extend({tagName:"section",render:function(){var e=this.model.attributes;this.setElement(a.section(e)).insertIntoDOM();var t=r.parseDOM(a.replyBox());return(e.num in s.ownPosts||i.request("postForm"))&&(t.style.display="none"),this.el.append(t),this.el.nextElementSibling.remove(),this},insertIntoDOM:function(){i.$threads[0].query("aside").after(this.el,document.createElement("hr")),this.fun()},renderLocked:function(e){this.el.classList[e?"add":"remove"]("locked")},remove:function(){return this.el.nextElementSibling.remove(),this.el.remove(),this.stopListening(),this},shiftReplies:function(e){var t=this.model.attributes,n=t.replies,i=s.hotConfig.get("ABBREVIATED_REPLIES"),o=void 0;e&&i--;for(var r=n.slice().length,a=r;a>i;a--){var l=s.posts.get(n.shift());l&&(l.get("image")&&t.image_omit++,t.omit++,o=!0,l.remove())}o&&this.renderOmit(t.omit,t.image_omit)},renderOmit:function(){var e=arguments.length<=0||void 0===arguments[0]?this.model.get("omit"):arguments[0];arguments.length<=1||void 0===arguments[1]?this.model.get("image_omit"):arguments[1];if(0!==e){var t=s.page.attributes,n=t.thread,i=t.href;this.el.query(".omit").innerHTML=a.lang.abbrev_msg(e,this.model.get("image_omit"),n&&i.split("?")[0])}},bumpThread:function(){this.el.nextElementSibling.remove(),this.el.remove(),this.insertIntoDOM()}})},{"../main":"main","./common":14}],24:[function(e,t,n){"use strict";function i(){v=document.query("#lock"),y=!!h.posts.get("thread")}function o(){g=p.scrollHeight-window.innerHeight<=window.scrollY,v&&(v.style.visibility=g?"visible":"hidden")}function r(e){var t=l(),n=e();if(!g||document.hidden&&!f.get("alwaysLock")){if(!a(b))return n;var i=s(b,!0)-t;i&&window.scrollBy(0,i)}else window.scrollTo(0,p.scrollHeight);return n}function a(e){return e&&document.contains(e)}function s(e,t){var n=e.getBoundingClientRect(),i=n.top;return t||i>=0&&i<window.innerHeight?i:null}function l(){if(a(b)){var e=s(b);if(null!==e)return e}for(var t=["article","section","threads"],n=0;n<t.length;n++){var i=t[n],o=!0,r=!1,l=void 0;try{for(var c,d=u.$threads[0].queryAll(i)[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var f=c.value,e=s(f);if(null!==e)return b=f,e}}catch(h){r=!0,l=h}finally{try{!o&&d["return"]&&d["return"]()}finally{if(r)throw l}}}}function c(){if(/^#p\d+$/.test(location.hash)){var e=d(location.hash);e.length&&d(window).scrollTop(e.offset().top-d("#banner").height())}}var u=e("./main"),d=u.$,f=(u.Backbone,u.options),h=u.state,m=document,p=m.body,g=void 0,v=void 0,y=void 0;h.page.on("change",i),i(),o(),document.addEventListener("scroll",o);var b=void 0;u.follow=r,u.reply("scroll:aboveBanner",c),window.onload=c},{"./main":"main"}],25:[function(e,t,n){"use strict";function i(e){for(var t={board:e.match(/\/([a-zA-Z0-9]+?)\//)[1],thread:e.match(/\/(\d+)(:?#\d+)?(?:[\?&]\w+=\w+)*$/),lastN:e.match(/[\?&]last=(\d+)/)},n=["thread","lastN"],i=0;i<n.length;i++){var o=n[i],r=t[o];t[o]=r?parseInt(r[1]):0}return t}function o(e){e&&r._.extend(s,e)}Object.defineProperty(n,"__esModule",{value:!0}),n.links=n.posts=n.mine=n.ownPosts=n.syncs=n.page=void 0,n.read=i,n.addLinks=o;var r=e("main"),a=(n.page=new r.Backbone.Model(i(location.href)),n.syncs={},n.ownPosts={},n.mine=new main.Memory("mine",2,!0),n.posts=new r.Backbone.Collection);main.on("state:clear",function(){main.$threads.innerHTML="",models.each(function(e){return e.dispatch("stopListening")}),a.reset(),n.syncs={},main.request("massExpander:unset")});var s=n.links={}},{main:"main"}],26:[function(e,t,n){"use strict";function i(e){var t=arguments.length<=1||void 0===arguments[1]?c.get("relativeTime"):arguments[1];u.posts.each(function(e){return e.dispatch("renderTime")}),f&&clearTimeout(f),t&&(f=setTimeout(i,6e4))}function o(e){if(d){e.classList.add("timerTicking");var t=e.getAttribute("start"),n=e.getAttribute("end"),i=s.pad(e.getAttribute("hour")),o=s.pad(e.getAttribute("min")),r=s.pad(e.getAttribute("sec"));!function l(){if(document.body.contains(e)){var c=s.serverTime();if(c>n)return e.textContent=a.lang.finished;if(t>c){var u=Math.round((t-c)/1e3);return 10===u&&a.request("time:syncwatch"),e.textContent="Countdown: "+u,setTimeout(l,1e3)}var d=c-t,f=Math.floor(d/1e3/60/60);d-=1e3*f*60*60;var h=Math.floor(d/1e3/60);d-=1e3*h*60;var m=Math.floor(d/1e3);return e.textContent=s.pad(f)+":"+s.pad(h)+":"+s.pad(m)+" / "+i+":"+o+":"+r,setTimeout(l,1e3)}}()}}function r(){setInterval(function(){for(var e=document.getElementsByTagName("syncwatch"),t=0;t<e.length;t++)e[t].classList.contains("timerTicking")||o(e[t])},1e3)}var a=e("./main"),s=(a.$,a.Backbone,a.common),l=a.oneeSama,c=a.options,u=a.state,d=0;a.dispatcher[s.GET_TIME]=function(e){e[0]&&(d=e[0]-Date.now())},a.reply("time:offset",function(){return d});var f=void 0;a.reply("time:render",i),c.on("change:relativeTime",i),a.defer(i).defer(r).defer(function(){function e(){n=!0,this.removeAttribute("title"),this.style.cursor="default",this.removeEventListener("click",e),t()}function t(){return d?(i.innerHTML=l.readableUTCTime(new Date(s.serverTime()),n),void setTimeout(t,n?1e3:6e4)):setTimeout(t,1e3)}var n=void 0,i=document.getElementById("UTCClock").firstChild;i.addEventListener("click",e),t()})},{"./main":"main"}],27:[function(e,t,n){"use strict";function i(e){return Array.isArray(e)?e:Array.from(e)}function o(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function r(e){e.html='<del onclick="void(0)">'}function a(){return(C.config.hard.HTTP.upload||"../upload/")+"?id="+C.state.page.get("connID")}function s(e){return e?parseInt(e.getAttribute("id").slice(1),10):0}function l(e){return e?s(e.closest("article, section")):0}function c(e){var t=l(e);return t?C.state.posts.get(t):null}function u(e){var t=document.createElement("div");t.innerHTML=e;var n=t.childNodes;return Array.from(n)}function d(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}function f(e,t,n,i){e.addEventListener(t,function(e){e.target.matches(n)&&i.call(this,e)})}function h(e,t,n){e.addEventListener(t,function(i){n.call(this,i),e.removeEventListener(t,n)})}function m(e){var t=getComputedStyle(e),n=["marginLeft","marginRight","paddingLeft","paddingRight"],i=0,o=!0,r=!1,a=void 0;try{for(var s,l=n[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;i+=parseInt(t[c])}}catch(u){r=!0,a=u}finally{try{!o&&l["return"]&&l["return"]()}finally{if(r)throw a}}return i}function p(e){return e&&"sage"===e.trim()}function g(){var e=Date.now();return imports.isNode?e:(B||(B=imports.main.request("time:offset")),
e+B)}function v(e,t){var n=void 0;switch(e){case"#flip":n=(2==t[2]).toString();break;case"#8ball":n=imports.hotConfig.EIGHT_BALL[t[2]-1];break;case"#pyu":case"#pcount":case"#q":n=t[0]}return void 0!==n?C._.escape(e+" ("+n+")"):/^#sw/.test(e)?y(t[0]):b(e,t)}function y(e){return e["class"]="embed",T(A,e)}function b(e,t){var n=i(t),o=(n[0],n[1]),r=n.slice(2);e+=" (";var a=r.length>1||o;a&&(e+=r.join(", ")),o&&(e+=0>o?" - "+-o:" + "+o);var s=o,l=!0,c=!1,u=void 0;try{for(var d,f=r[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var h=d.value;s+=h}}catch(m){c=!0,u=m}finally{try{!l&&f["return"]&&f["return"]()}finally{if(c)throw u}}return e+(a?" = ":"")+s+")"}function w(e){var t=imports.config.SPOILER_IMAGES,n=t.length,i=void 0;return i=0>e?Math.floor(Math.random()*n):e%n,{index:t[i],next:(i+1)%n}}function k(e){return 1024>e?e+" B":1048576>e?Math.round(e/1024)+" KB":(e=Math.round(e/104857.6).toString(),e.slice(0,-1)+"."+e.slice(-1)+" MB")}function x(e){return(10>e?"0":"")+e}function S(e,t,n,i){return T(L,e,n&&' id="'+n+'"',i&&' class="'+i+'"',t)}function $(e){return Number.isInteger(e)&&500>=e}function I(e){var t="",n="",i=e.indexOf("#");return i>=0&&(t=e.substr(i+1),e=e.substr(0,i),i=t.indexOf("#"),i>=0&&(n=C._.escape(t.substr(i+1)),t=t.substr(0,i)),t=C._.escape(t)),e=e.trim().replace(imports.hotConfig.EXCLUDE_REGEXP,""),[e.substr(0,100),t.substr(0,128),n.substr(0,128)]}function _(e){for(var t="",n=0;e>n;n++){var i=(36*Math.random()).toString(36)[0];Math.random()<.5&&(i=i.toUpperCase()),t+=i}return t}function T(e){if("string"==typeof e)return E(e);if("function"==typeof e)return E(e(n));for(var t=arguments.length,n=[],i=1;t>i;i++)n[i-1]=arguments[i];var o=e.slice(0,t).map(function(e,t){var i=n[t-1],o=void 0;return o=0===t||!i&&0!==i?"":i instanceof Object?M(i):i,o+e}).join("");return E(o)}function E(e){var t=-1;return e.replace(/\n(\s+)/g,function(e,n){return 0>t&&(t=n.replace(/\t/g,"    ").length),n.slice(Math.min(n.length,t))}).replace(/^\s*\n/gm,"")}function M(e){var t="";for(var n in e){t+=" ";var i=e[n];i===!0?t+=n:(i||0===i)&&(t+=n+'="'+i+'"')}return t}function O(e){var t="",n=!0,i=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=r.value;(s||0===s)&&(t&&(t+=", "),t+=s)}}catch(l){i=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return t}function q(e){var t=C.config.staff.classes[main.ident&&main.ident.auth];return t&&!!t.rights[e]}var A=o(["<syncwatch ",">\n			syncwatch\n		</syncwatch>"],["<syncwatch ",">\n			syncwatch\n		</syncwatch>"]),L=o(['<span class="act">\n			<a href="','"\n				',"\n				","\n			>\n				","\n			</a>\n		</span>"],['<span class="act">\n			<a href="','"\n				',"\n				","\n			>\n				","\n			</a>\n		</span>"]);Object.defineProperty(n,"__esModule",{value:!0}),n.thumbStyles=void 0,n.touchable_spoiler_tag=r,n.imageUploadURL=a,n.getNum=s,n.getID=l,n.getModel=c,n.parseEls=u,n.parseEl=d,n.listener=f,n.once=h,n.outerWidth=m,n.isSage=p,n.serverTime=g,n.readable_dice=v,n.pick_spoiler=w,n.readable_filesize=k,n.pad=x,n.action_link_html=S,n.resonableLastN=$,n.parse_name=I,n.randomID=_,n.parseHTML=T,n.commaList=O,n.checkAuth=q;var C=e("main"),B=void 0;n.thumbStyles=["small","sharp","hide"]},{main:"main"}],main:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var r=o(['<style>\n		.locked:after {\n			content: "','";\n		}\n		.locked > header nav:after {\n			content: " (',')";\n		}\n	</style>'],['<style>\n		.locked:after {\n			content: "','";\n		}\n		.locked > header nav:after {\n			content: " (',')";\n		}\n	</style>']),a=e("./fsm"),s=i(a),l=e("underscore"),c=e("backbone"),u=e("js-cookie"),d=e("backbone.radio");e("core-js"),e("dom4"),e("backbone.nativeview"),c.View=c.NativeView;var f=t.exports=d.channel("main");l.extend(f,{_:l,Backbone:c,Cookie:u,FSM:s["default"],$script:e("scriptjs"),SockJS:e("sockjs-client"),_deferred:[],defer:function(e){return f._deferred.push(e),f},execDefered:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this._deferred[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;r()}}catch(a){t=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}},dispatcher:{}}),l.extend(f,{config:config,configHash:configHash,clientHash:clientHash,isMobile:isMobile});var h=3;if(localStorage.cookieVersion!=h){for(var m in u.get()){var p=f.config.boards.enabled.slice();p.push("");var g=!0,v=!1,y=void 0;try{for(var b,w=p[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var k=b.value;u.remove(m,{path:k})}}catch(x){v=!0,y=x}finally{try{!g&&w["return"]&&w["return"]()}finally{if(v)throw y}}}localStorage.cookieVersion=h}/[&\?]debug=true/.test(location.href)&&(f.config.hard.debug=!0),f.config.hard.debug&&(d.DEBUG=!0,window.Backbone=c,d.tuneIn("main")),f.send=f.request.bind(f,"send"),f.Memory=e("./memory");var S=f.lang=e("lang"),$=f.state=e("./state"),I=f.util=e("./util");f.options=e("./options"),f.scroll=e("./scroll"),$.page.set("tabID",common.randomID(32)),document.head.appendChild(I.parseDOM(common.parseHTML(r,S.thread_locked,S.locked))),l.extend(f,{$threads:document.query("threads"),$name:document.query("input[name=name]"),$email:document.query("input[name=email]"),connSM:new s["default"]("load"),postSM:new s["default"]("none")}),l.extend(f,{loop:e("./loop"),time:e("./time"),amusement:e("./amusement")}),f.posts=e("./posts"),f.Extract=e("./extract"),f.client=e("./client"),f.conection=e("./connection"),l.extend(f,{history:e("./history"),hide:e("./hide")}),f.execDefered(),f.request("loading:hide")},{"./amusement":1,"./client":2,"./connection":3,"./extract":4,"./fsm":5,"./hide":6,"./history":7,"./loop":8,"./memory":9,"./options":10,"./posts":18,"./scroll":24,"./state":25,"./time":26,"./util":27,backbone:void 0,"backbone.nativeview":void 0,"backbone.radio":void 0,"core-js":void 0,dom4:void 0,"js-cookie":void 0,lang:void 0,scriptjs:void 0,"sockjs-client":void 0,underscore:void 0}]},{},["main"]);
//# sourceMappingURL=main.js.map
