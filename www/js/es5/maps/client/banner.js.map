{"version":3,"sources":["client/banner.js"],"names":["System","register","_export","_context","_taggedTemplateLiteral","strings","raw","Object","freeze","defineProperties","value","_templateObject","_templateObject2","main","Backbone","common","dispatcher","etc","options","modalMap","BannerView","banner","NotificationView","setters","execute","require","banner_identity","banner_FAQ","banner_schedule","View","extend","initialize","this","center","document","getElementById","info","reply","clearRadio","events","click .bfloat","renderInfo","msg","innerHTML","revealBmodal","event","bmodal","target","closest","getAttribute","el","isShown","getComputedStyle","display","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","queryAll","Symbol","iterator","next","done","_el","style","err","top","offsetHeight","renderRadio","data","JSON","parse","attrs","title","lang","googleSong","href","encodeURIComponent","np","parseHTML","listeners","dj","exports","view","notification","render","click","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_el2","remove","class","parseDOM","after","setElement","NOTIFICATION","UPDATE_BANNER","RADIO","get","isMobile"],"mappings":"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","file":"client/banner.js","sourcesContent":["/*\n * Handles all things banner and notifications\n */\n\nconst main = require('./main'),\n\t{Backbone, common, dispatcher, etc, options} = main;\n\nconst modalMap = {\n\t'options': 'options-panel',\n\t'banner_identity': 'identity',\n\t'banner_FAQ': 'FAQ',\n\t'banner_schedule': 'schedule'\n};\n\nconst BannerView = Backbone.View.extend({\n\tinitialize() {\n\t\tthis.center = document.getElementById('banner_center');\n\t\tthis.info = document.getElementById('banner_info');\n\t\t// Publish a listener to the message bus\n\t\tmain.reply('banner:radio:clear', this.clearRadio, this);\n\t},\n\tevents: {\n\t\t'click .bfloat': 'revealBmodal'\n\t},\n\trenderInfo(msg) {\n\t\tthis.info.innerHTML = msg;\n\t},\n\t// Toggle the display of the modal windows under the banner\n\trevealBmodal(event) {\n\t\tconst bmodal = modalMap[event.target.closest('.bfloat')\n\t\t\t.getAttribute('id')];\n\t\tif (!bmodal)\n\t\t\treturn;\n\t\tconst el = document.getElementById(bmodal),\n\t\t\tisShown = el && getComputedStyle(el).display !== 'none';\n\t\tfor (let el of document.queryAll('.bmodal')) {\n\t\t\tel.style.display = 'none'\n\t\t}\n\n\t\t// We hid the currently displayed window. All is well\n\t\tif (isShown)\n\t\t\treturn;\n\n\t\t// Place 5 pixels bellow banner\n\t\tel.style.top = document.getElementById('banner').offsetHeight + 5\n\t\t\t+ 'px';\n\t\tel.style.display = 'block';\n\t},\n\t// r/a/dio stream info rendering\n\trenderRadio(data) {\n\t\tdata = JSON.parse(data);\n\t\tconst attrs = {\n\t\t\ttitle: main.lang.googleSong,\n\t\t\thref: `https://google.com/search?q=${encodeURIComponent(data.np)}`,\n\t\t\ttarget: '_blank'\n\t\t};\n\t\tthis.center.innerHTML = common.parseHTML\n\t\t\t`<a href=\"http://r-a-d.io/\" target=\"_blank\">\n\t\t\t\t[${data.listeners}] ${data.dj}\n\t\t\t</a>\n\t\t\t&nbsp;&nbsp;\n\t\t\t<a ${attrs}>\n\t\t\t\t<b>${data.np}</b>\n\t\t\t</a>`;\n\t},\n\tclearRadio() {\n\t\tthis.center.innerHTML = '';\n\t}\n});\n\nconst banner = exports.view = new BannerView({\n\tel: document.getElementById('banner')\n});\n\n// Notification messages bellow the banner\nconst NotificationView = exports.notification = Backbone.View.extend({\n\tinitialize(msg) {\n\t\tthis.render(msg);\n\t},\n\tevents: {\n\t\t'click': 'remove'\n\t},\n\trender(msg) {\n\t\tfor (let el of document.queryAll('.notification')) {\n\t\t\tel.remove();\n\t\t}\n\t\tconst attrs = {\n\t\t\tclass: 'notification modal',\n\t\t\tstyle: `top: ${banner.el.offsetHeight + 5}px;`\n\t\t};\n\t\tconst el = etc.parseDOM(common.parseHTML\n\t\t\t`<span ${attrs}>\n\t\t\t\t<b class=\"admin\">\n\t\t\t\t\t${msg}\n\t\t\t\t</b>\n\t\t\t</span>`);\n\t\tbanner.el.after(el);\n\t\tthis.setElement(el);\n\t\treturn this;\n\t}\n});\nmain.reply('notification', msg => new NotificationView(msg));\n\ndispatcher[common.NOTIFICATION] = msg => new NotificationView(msg[0]);\ndispatcher[common.UPDATE_BANNER] = msg => banner.renderInfo(msg[0]);\n// R/a/dio banner is disabled on mobile\ndispatcher[common.RADIO] = msg =>\n\toptions.get('nowPlaying') && !main.isMobile && banner.renderRadio(msg[0]);\n"],"sourceRoot":"/source/"}