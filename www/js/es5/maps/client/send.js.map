{"version":3,"sources":["client/send.js"],"names":["System","register","_export","_context","connectToSW","cont","navigator","serviceWorker","controller","postMessage","location","href","chan","port2","setTimeout","message","setters","_common","execute","send","msg","transfers","port1","MessageChannel","window","addEventListener","disconnect"],"mappings":"AAAA,YAAaA,QAAOC,UAAU,aAAa,SAASC,EAAQC,GAkB5D,QAASC,KACR,GAAMC,GAAOC,UAAUC,cAAcC,UADf,OAEjBH,OAALA,GAIKI,YAAYC,SAASC,MAAOC,EAAKC,YAHrCC,YAAWV,EAAa,IArB4C,GAAIW,GAAQH,CAkBlF,QAAAI,SAAA,SAAAC,GAdQF,EAAAE,EAAAF,UAAAG,QAAA,WAKD,QAASC,GAAKC,EAAKC,GACpBA,EAGJT,EAAKU,MAAMb,YAAYW,EAAKC,GAF5BT,EAAKU,MAAMb,YAAYW,GALnBR,EAAO,GAAIW,gBAGVrB,EAAA,OAAAiB,GAkBPf,IAEAoB,OAAOC,iBAAiB,eAAgB,WAAA,MACvCN,GAAKJ,EAAQW","file":"client/send.js","sourcesContent":["/*\n Communication with the ServiceWorker backend\n*/\n\nimport {message} from '../common'\n\nconst chan = new MessageChannel()\n\n// Send a message to the ServiceWorker thorough the private channel\nexport function send(msg, transfers) {\n\tif (!transfers) {\n\t\tchan.port1.postMessage(msg)\n\t} else {\n\t\tchan.port1.postMessage(msg, transfers)\n\t}\n}\n\n// Establish a private message channel with the ServiceWorker\nfunction connectToSW() {\n\tconst cont = navigator.serviceWorker.controller\n\tif (!cont) {\n\t\tsetTimeout(connectToSW, 10)\n\t\treturn\n\t}\n\tcont.postMessage(location.href, [chan.port2])\n}\n\nconnectToSW()\n\nwindow.addEventListener(\"beforeunload\", () =>\n\tsend(message.disconnect))\n"],"sourceRoot":"/source/"}