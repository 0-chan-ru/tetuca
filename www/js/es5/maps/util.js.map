{"version":3,"sources":["util.js"],"names":["System","register","_export","_context","_toArray","arr","Array","isArray","from","_taggedTemplateLiteral","strings","raw","Object","freeze","defineProperties","value","readableSyncwatch","dice","parseHTML","_templateObject","readableRegularDice","bit","_dice","bias","rolls","slice","eq","length","join","sum","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","undefined","_step2","_iterator2","Symbol","iterator","next","done","roll","err","formatHTML","str","replace","config","escape","_templateObject2","cachedOffset","thumbStyles","setters","_main","_vendorUnderscore","execute","touchable_spoiler_tag","del","html","getNum","el","parseInt","getAttribute","getID","closest","parseEls","string","document","createElement","innerHTML","children","childNodes","parseEl","firstChild","listener","type","selector","handler","addEventListener","event","target","matches","call","this","once","removeEventListener","outerWidth","style","getComputedStyle","props","width","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","prop","isSage","email","trim","serverTime","d","Date","now","imports","isNode","main","request","readable_dice","inner","toString","hotConfig","EIGHT_BALL","test","pick_spoiler","metaIndex","imgs","SPOILER_IMAGES","n","i","Math","floor","random","index","readable_filesize","size","round","pad","action_link_html","href","name","id","cls","resonableLastN","Number","isInteger","parse_name","tripcode","secure","hash","indexOf","substr","EXCLUDE_REGEXP","randomID","len","char","toUpperCase","callSite","_len","arguments","args","_key","apply","output","parseAtributes","attrs","key","val","commaList","items","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","item","checkAuth","action","staff","classes","ident","auth","rights"],"mappings":"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","file":"util.js","sourcesContent":["/*\n Client-side helper functions\n */\n\nimport {config} from './main'\nimport {escape} from '../vendor/underscore'\n\n/**\n * Make spoiler tags toggleable on mobile\n * @param {Element}\n */\nexport function touchable_spoiler_tag(del) {\n\tdel.html = '<del onclick=\"void(0)\">'\n}\n\n/**\n * Retrieve post number of post element\n * @param {Element} el\n * @returns {int}\n */\nexport function getNum(el) {\n\tif (!el) {\n\t    return 0\n\t}\n\treturn parseInt(el.getAttribute('id').slice(1), 10)\n}\n\n/**\n * Retrieve post number of closest parent post\n * @param {Element} el\n * @returns {int}\n */\nexport function getID(el) {\n\tif (!el) {\n    \treturn 0\n\t}\n\treturn getNum(el.closest('article, section'))\n}\n\n/**\n * Parse HTML string to node array\n * @param {string} string\n * @returns {Element[]}\n */\nexport function parseEls(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\tconst children = el.childNodes\n\treturn Array.from(children)\n}\n\n/**\n * Parse HTML string to Element\n * @param {string} string\n * @returns {Element}\n */\nexport function parseEl(string) {\n\tconst el = document.createElement('div')\n\tel.innerHTML = string\n\treturn el.firstChild\n}\n\n/**\n * Add an event listener that filters targets according to a CSS selector\n * @param {Element} el - Target element\n * @param {string} type - Event type\n * @param {string} selector - CSS selector\n * @param {function} handler - Callback function\n */\nexport function listener(el, type, selector, handler) {\n\tel.addEventListener(type, function (event) {\n\t\tif (event.target.matches(selector)) {\n\t\t\thandler.call(this, event)\n\t\t}\n\t})\n}\n\n/**\n * Add event listener to element, that will only be executed once\n * @param {Element} el - Target element\n * @param {string} type\t- Event type\n * @param {function} handler - Callback function\n */\nexport function once(el, type, handler) {\n\tel.addEventListener(type, function (event) {\n\t\thandler.call(this, event)\n\t\tel.removeEventListener(type, handler)\n\t})\n}\n\n/**\n * Return width of element with padding and margin\n * @param {Element} el\n * @returns {int}\n */\nexport function outerWidth(el) {\n\tconst style =  getComputedStyle(el),\n\t\tprops = ['marginLeft', 'marginRight', 'paddingLeft','paddingRight']\n\tlet width = 0\n\tfor (let prop of props) {\n\t\twidth += parseInt(style[prop]);\n\t}\n\treturn width\n}\n\n/**\n * Confirms email is saging\n * @param {string} email\n * @returns {bool}\n */\nexport function isSage(email) {\n\treturn email && email.trim() === 'sage'\n}\n\n// TODO: Refactor server time syncronisation\nlet cachedOffset;\nexport function serverTime() {\n\tconst d = Date.now();\n\tif (imports.isNode)\n\t\treturn d;\n\n\t// The offset is intialised as 0, so there is something to return, until\n\t// we get a propper number from the server.\n\tif (!cachedOffset)\n\t\tcachedOffset = imports.main.request('time:offset');\n\treturn d + cachedOffset;\n}\n\nexport function readable_dice(bit, dice) {\n\tlet inner;\n\tswitch (bit) {\n\t\tcase '#flip':\n\t\t\tinner = (dice[2] == 2).toString();\n\t\t\tbreak;\n\t\tcase '#8ball':\n\t\t\tinner = imports.hotConfig.EIGHT_BALL[dice[2] - 1];\n\t\t\tbreak;\n\t\tcase '#pyu':\n\t\tcase '#pcount':\n\t\tcase '#q':\n\t\t\tinner = dice[0];\n\t\t\tbreak;\n\t}\n\tif (inner !== undefined)\n\t\treturn escape(`${bit} (${inner})`);\n\tif (/^#sw/.test(bit))\n\t\treturn readableSyncwatch(dice[0]);\n\treturn readableRegularDice(bit, dice);\n}\n\nfunction readableSyncwatch(dice) {\n\tdice.class = 'embed';\n\treturn parseHTML\n\t\t`<syncwatch ${dice}>\n\t\t\tsyncwatch\n\t\t</syncwatch>`;\n}\n\nfunction readableRegularDice(bit, dice) {\n\tconst [max, bias, ...rolls] = dice\n\tbit += ' (';\n\tconst eq = rolls.length > 1 || bias;\n\tif (eq)\n\t\tbit += rolls.join(', ');\n\tif (bias)\n\t\tbit += (bias < 0 ? ' - ' + (-bias) : ' + ' + bias);\n\tlet sum = bias;\n\tfor (let roll of rolls) {\n\t\tsum += roll;\n\t}\n\treturn bit + (eq ? ' = ' : '') + sum + ')';\n}\n\nexport function pick_spoiler(metaIndex) {\n\tconst imgs = imports.config.SPOILER_IMAGES,\n\t\tn = imgs.length;\n\tlet i;\n\tif (metaIndex < 0)\n\t\ti = Math.floor(Math.random() * n);\n\telse\n\t\ti = metaIndex % n;\n\treturn {\n\t\tindex: imgs[i],\n\t\tnext: (i + 1) % n\n\t};\n}\n\nexport const thumbStyles = ['small', 'sharp', 'hide']\n\nexport function readable_filesize(size) {\n\t/* Dealt with it. */\n\tif (size < 1024)\n\t\treturn size + ' B';\n\tif (size < 1048576)\n\t\treturn Math.round(size / 1024) + ' KB';\n\tsize = Math.round(size / 104857.6).toString();\n\treturn size.slice(0, -1) + '.' + size.slice(-1) + ' MB';\n}\n\nexport function pad(n) {\n\treturn (n < 10 ? '0' : '') + n;\n}\n\n// Various UI-related links wrapped in []\nexport function action_link_html(href, name, id, cls) {\n\treturn parseHTML\n\t\t`<span class=\"act\">\n\t\t\t<a href=\"${href}\"\n\t\t\t\t${id && ` id=\"${id}\"`}\n\t\t\t\t${cls && ` class=\"${cls}\"`}\n\t\t\t>\n\t\t\t\t${name}\n\t\t\t</a>\n\t\t</span>`;\n}\n\n/**\n * Confirm last N posts to view setting matches bounds\n * @param {int} n\n * @returns {bool}\n */\nexport function resonableLastN(n) {\n\treturn Number.isInteger(n) && n <= 500\n}\n\nexport function parse_name(name) {\n\tvar tripcode = '', secure = '';\n\tvar hash = name.indexOf('#');\n\tif (hash >= 0) {\n\t\ttripcode = name.substr(hash + 1);\n\t\tname = name.substr(0, hash);\n\t\thash = tripcode.indexOf('#');\n\t\tif (hash >= 0) {\n\t\t\tsecure = escape(tripcode.substr(hash + 1));\n\t\t\ttripcode = tripcode.substr(0, hash);\n\t\t}\n\t\ttripcode = escape(tripcode);\n\t}\n\tname = name.trim().replace(imports.hotConfig.EXCLUDE_REGEXP, '');\n\treturn [\n\t\tname.substr(0, 100), tripcode.substr(0, 128),\n\t\tsecure.substr(0, 128)\n\t];\n}\n\n/**\n * Generate a random alphannumeric string of lower and upper case hexadecimal\n * characters\n * @param {int} len\t- String length\n * @returns {string}\n */\nexport function randomID(len) {\n\tlet id = ''\n\tfor (let i = 0; i < len; i++) {\n\t\tlet char = (Math.random() * 36).toString(36)[0]\n\t\tif (Math.random() < 0.5)\n\t\t\tchar = char.toUpperCase()\n\t\tid += char\n\t}\n\treturn id\n}\n\n/**\n * Template string tag function for HTML. Strips indentation and trailing\n * newlines. Based on https://gist.github.com/zenparsing/5dffde82d9acef19e43c\n * @param {*}\n * @returns {string}\n */\nexport function parseHTML(callSite, ...args) {\n\t// if arguments.length === 1\n\tif (typeof callSite === 'string') {\n\t\treturn formatHTML(callSite)\n\t}\n\tif (typeof callSite === 'function') {\n\t\treturn (...args) => formatHTML(callSite(...args))\n\t}\n\n\tlet output = callSite[0]\n\tfor (let i = 1; i <= args.length; i++) {\n\t    output += args[i - 1] + callSite[i]\n\t}\n\n\treturn formatHTML(output)\n}\n\n/**\n * Strip indentation and remove empty lines from HTML string\n */\nfunction formatHTML(str) {\n\treturn str.replace(/\\s*\\n\\s*/g, '')\n}\n\n/**\n * Generate an HTML element attribute list\n * @param {Object} attrs\n * @returns {string}\n */\nexport function parseAtributes(attrs) {\n\tlet html = ''\n\tfor (let key in attrs) {\n\t\thtml += ' '\n\t\tconst val = attrs[key]\n\t\tif (val === true)\n\t\t\thtml += key\n\t\telse if (val || val === 0)\n\t\t\thtml += `${key}=\"${val}\"`\n\t}\n\treturn html\n}\n\n/**\n * Makes a ', ' seperated list out of on array of strings\n * @param {string[]} items\n * @returns {string}\n */\nexport function commaList(items) {\n\tlet html = ''\n\tfor (let item of items) {\n\t\t// Falsy value. Skip item.\n\t\tif (!item && item !== 0)\n\t\t\tcontinue\n\t\tif (html)\n\t\t\thtml += ', '\n\t\thtml += item\n\t}\n\treturn html\n}\n\n/**\n * Acertains client has the proper authorisation to perfrom task. This is only\n * for rendering. The same validation is performed server-side.\n * @param {string} action - Privilidged action to check permission for\n * @returns {bool}\n */\nexport function checkAuth(action) {\n\tconst cls = config.staff.classes[main.ident && main.ident.auth]\n    return cls && !!cls.rights[action]\n}\n"],"sourceRoot":"/source/"}