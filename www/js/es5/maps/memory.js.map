{"version":3,"sources":["memory.js"],"names":["System","register","_export","_classCallCheck","instance","Constructor","TypeError","isObject","isEmpty","_size","Cookie","_createClass","Memory","setters","_underscore","size","_jsCookie","execute","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","expiry","needCookie","_this","this","setTimeout","purgeExpired","value","object","nums","keys","sort","a","b","parseInt","set","join","Math","floor","Date","now","localStorage","removeItem","remove","getItem","val","undefined","JSON","parse","e","purgeAll","setItem","stringify","bakeCookie","readAll","writeAll","limit","expired","time","push","lim"],"mappings":"AAAA,YAAaA,QAAOC,UAAU,aAAa,aAAa,SAASC,GAA+D,QAASC,GAAgBC,EAASC,GAAa,KAAKD,YAAoBC,IAAc,KAAM,IAAIC,WAAU,qCAAhK,GAAIC,GAASC,EAAQC,EAAMC,EAAOC,EAAaC,CAAwJ,QAAQC,SAAS,SAASC,GAAaP,EAASO,EAAYP,SAASC,EAAQM,EAAYN,QAAQC,EAAMK,EAAYC,MAAO,SAASC,GAAWN,EAAOM,IAAaC,QAAQ,WAAWN,EAAa,WAAY,QAASO,GAAiBC,EAAOC,GAAO,IAAI,GAAIC,GAAE,EAAEA,EAAED,EAAME,OAAOD,IAAI,CAAC,GAAIE,GAAWH,EAAMC,EAAGE,GAAWC,WAAWD,EAAWC,aAAY,EAAMD,EAAWE,cAAa,EAAQ,SAAWF,KAAWA,EAAWG,UAAS,GAAKC,OAAOC,eAAeT,EAAOI,EAAWM,IAAIN,IAAc,MAAO,UAASlB,EAAYyB,EAAWC,GAAuI,MAAvHD,IAAWZ,EAAiBb,EAAY2B,UAAUF,GAAeC,GAAYb,EAAiBb,EAAY0B,GAAoB1B,MAAmBO,EAAO,WAAY,QAASA,GAAOiB,EAAII,EAAOC,GAAY,GAAIC,GAAMC,IAAKjC,GAAgBiC,KAAKxB,GAAQwB,KAAKP,IAAIA,EAAIO,KAAKH,OAAOA,EAAOG,KAAKF,WAAWA,EAAWG,WAAW,WAAW,MAAOF,GAAMG,gBAAiB,KAAs0C,MAA/zC3B,GAAaC,IAASiB,IAAI,aAAaU,MAAM,SAAoBC,GAAQ,GAAIJ,KAAKF,WAAT,CAA2B,GAAIO,GAAKd,OAAOe,KAAKF,EAAQC,GAAKE,KAAK,SAASC,EAAEC,GAAG,MAAOC,UAASF,EAAE,IAAIE,SAASD,EAAE,MAAOnC,EAAOqC,IAAIX,KAAKP,IAAIY,EAAKO,KAAK,UAAUnB,IAAI,MAAMU,MAAM,WAAe,MAAOU,MAAKC,MAAMC,KAAKC,MAAM,QAAUvB,IAAI,WAAWU,MAAM,WAAoBc,aAAaC,WAAWlB,KAAKP,KAAQO,KAAKF,YAAWxB,EAAO6C,OAAOnB,KAAKP,QAASA,IAAI,UAAUU,MAAM,WAAmB,GAAIV,GAAIwB,aAAaG,QAAQpB,KAAKP,IAAK,KAAIA,EAAI,QAAU,IAAI4B,GAAIC,MAAU,KAAID,EAAIE,KAAKC,MAAM/B,GAAM,MAAMgC,IAAK,MAAOtD,GAASkD,GAAKA,QAAW5B,IAAI,WAAWU,MAAM,SAAkBC,GAAQ,MAAGhC,GAAQgC,GAAeJ,KAAK0B,YAAWT,aAAaU,QAAQ3B,KAAKP,IAAI8B,KAAKK,UAAUxB,QAASJ,MAAK6B,WAAWzB,OAAYX,IAAI,QAAQU,MAAM,SAAeV,GAAK,GAAIW,GAAOJ,KAAK8B,SAAuD,OAA7C1B,GAAOX,GAAKO,KAAKgB,MAAMhB,KAAK+B,SAAS3B,GAAe/B,EAAM+B,MAAYX,IAAI,OAAOU,MAAM,WAAgB,MAAO9B,GAAM2B,KAAK8B,cAAerC,IAAI,eAAeU,MAAM,WAAwB,GAAIH,KAAKH,OAAT,CAAuB,GAAIO,GAAOJ,KAAK8B,UAAcd,EAAIhB,KAAKgB,MAAMgB,EAAM,MAAMhC,KAAKH,OAAWoC,IAAW,KAAI,GAAIxC,KAAOW,GAAO,CAAC,GAAI8B,GAAK9B,EAAOX,EAAQyC,IAAMlB,EAAIkB,EAAKF,GAAMC,EAAQE,KAAK1C,GAAM,GAAIwC,EAAQ/C,OAAZ,CAA0B,IAAI,GAAID,GAAE,EAAEmD,EAAIH,EAAQ/C,OAASkD,EAAFnD,EAAMA,UAAYmB,GAAO6B,EAAQhD,GAAKe,MAAK+B,SAAS3B,SAAoB5B,KAAYV,EAAQ,UAAUU","file":"memory.js","sourcesContent":["'use strict';System.register(['underscore','js-cookie'],function(_export){var isObject,isEmpty,_size,Cookie,_createClass,Memory;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}return {setters:[function(_underscore){isObject=_underscore.isObject;isEmpty=_underscore.isEmpty;_size=_underscore.size;},function(_jsCookie){Cookie=_jsCookie;}],execute:function(){_createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\" in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();Memory=(function(){function Memory(key,expiry,needCookie){var _this=this;_classCallCheck(this,Memory);this.key=key;this.expiry=expiry;this.needCookie=needCookie;setTimeout(function(){return _this.purgeExpired();},5000);}_createClass(Memory,[{key:'bakeCookie',value:function bakeCookie(object){if(!this.needCookie)return;var nums=Object.keys(object);nums.sort(function(a,b){return parseInt(a,10)-parseInt(b,10);});Cookie.set(this.key,nums.join('/'));}},{key:'now',value:function now(){return Math.floor(Date.now()/1000);}},{key:'purgeAll',value:function purgeAll(){localStorage.removeItem(this.key);if(this.needCookie)Cookie.remove(this.key);}},{key:'readAll',value:function readAll(){var key=localStorage.getItem(this.key);if(!key)return {};var val=undefined;try{val=JSON.parse(key);}catch(e) {}return isObject(val)?val:{};}},{key:'writeAll',value:function writeAll(object){if(isEmpty(object))return this.purgeAll();localStorage.setItem(this.key,JSON.stringify(object));this.bakeCookie(object);}},{key:'write',value:function write(key){var object=this.readAll();object[key]=this.now();this.writeAll(object);return _size(object);}},{key:'size',value:function size(){return _size(this.readAll());}},{key:'purgeExpired',value:function purgeExpired(){if(!this.expiry)return;var object=this.readAll();var now=this.now(),limit=86400*this.expiry;var expired=[];for(var key in object){var time=object[key];if(time&&now>time+limit)expired.push(key);}if(!expired.length)return;for(var i=0,lim=expired.length;i<lim;i++){delete object[expired[i]];}this.writeAll(object);}}]);return Memory;})();_export('default',Memory);}};});"],"sourceRoot":"/source/"}