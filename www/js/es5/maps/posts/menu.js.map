{"version":3,"sources":["posts/menu.js"],"names":["System","register","_export","_context","main","$","_","Backbone","common","util","lang","state","MenuView","setters","execute","require","module","exports","View","extend","className","tagName","actions","events","click","initialize","_ref","parent","_popup_menu","this","render","html","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","action","value","err","el","innerHTML","append","style","left","getBoundingClientRect","outerWidth","offsetWidth","handleClick","e","stopPropagation","request","target","getAttribute","model","remove","stopListening","reply","prototype","$threads","on","event","getModel"],"mappings":"AAAA,YAAaA,QAAOC,YAAY,SAASC,EAAQC,GAAU,GAAIC,GAAKC,EAAEC,EAAEC,EAASC,EAAOC,EAAKC,EAAKC,EAAMC,CAAS,QAAQC,WAAWC,QAAQ,WAItIV,EAAOW,QAAQ,WACnBV,EAA6CD,EAA7CC,EAAGC,EAA0CF,EAA1CE,EAAGC,EAAuCH,EAAvCG,SAAUC,EAA6BJ,EAA7BI,OAAQC,EAAqBL,EAArBK,KAAMC,EAAeN,EAAfM,KAAMC,EAASP,EAATO,MAEhCC,EAAWI,OAAOC,QAAUV,EAASW,KAAKC,QAC/CC,UAAW,mBACXC,QAAS,KAETC,SAAU,SAAU,QACpBC,QACCC,MAAO,eAERC,WAAA,SAAAC,GAAqB,GAATC,GAAAD,EAAAC,MAASA,GACbC,YAAcC,KADDA,KAEfF,OAASA,EAFME,KAGfC,UAENA,OAAA,WACC,GAAIC,GAAO,GADHC,GAAA,EAAAC,GAAA,EAAAC,EAAAC,MAAA,KAER,IAAA,GAAmBC,GAAnBC,EAAmBR,KAAKP,QAALgB,OAAAC,cAAnBP,GAAAI,EAAAC,EAAAG,QAAAC,MAAAT,GAAA,EAAiC,CAAA,GAAxBU,GAAAN,EAAAO,KAAwBZ,IAChC,kBAA0BW,EAAA,KAAWhC,EAAKgC,GAAL,SADtC,MAAAE,GAAAX,GAAA,EAAAC,EAAAU,EAAA,QAAA,KAAAZ,GAAAK,EAAAA,WAAAA,EAAAA,YAAA,QAAA,GAAAJ,EAAA,KAAAC,IAFQ,GAKDW,GAAchB,KAAdgB,GAAIlB,EAAUE,KAAVF,MALHkB,GAMLC,UAAYf,EANPJ,EAODoB,OAAOF,GAPNA,EAWLG,MAAMC,KAAOJ,EAAGK,wBAAwBD,KACC,IAAxCxC,EAAK0C,WAAWN,GAAMA,EAAGO,aAC1B,MAGJC,YAAA,SAAYC,GACXA,EAAEC,kBADYnD,EAEToD,QAAQF,EAAEG,OAAOC,aAAa,aAAc7B,KAAK8B,OAFxC9B,KAGT+B,UAENA,OAAA,WACC/B,KAAKF,OAAOC,YAAc,KADlBC,KAEHgB,GAAGe,SAFA/B,KAGHgC,mBAIPzD,EAAK0D,MAAM,cAAe,SAAApB,GAAA,MACzBpC,GAAEa,OAAOP,EAASmD,UAAUzC,QAASoB,KAEtCtC,EAAK4D,SAASC,GAAG,QAAS,WAAY,SAAAC,GAAS,GACvCT,GAAUS,EAAVT,MADuC,IAI1CA,EAAO7B,YACV,MAAO6B,GAAO7B,YAAYgC,QAD3B,IAGMD,GAAQlD,EAAK0D,SAASV,EACxBE,IACH,GAAI/C,IAAUe,OAAQ8B,EAAQE,MAAAA","file":"posts/menu.js","sourcesContent":["/*\n Post action header dropdown menu\n */\n\nconst main = require('../main'),\n\t{$, _, Backbone, common, util, lang, state} = main;\n\nconst MenuView = module.exports = Backbone.View.extend({\n\tclassName: 'popup-menu glass',\n\ttagName: 'ul',\n\t// Post menu items\n\tactions: ['report', 'hide'],\n\tevents: {\n\t\tclick: 'handleClick'\n\t},\n\tinitialize({parent}) {\n\t\tparent._popup_menu = this;\n\t\tthis.parent = parent;\n\t\tthis.render();\n\t},\n\trender() {\n\t\tlet html = '';\n\t\tfor (let action of this.actions) {\n\t\t\thtml += `<li data-type=\"${action}\">${lang[action]}</li>`\n\t\t}\n\t\tconst {el, parent} = this;\n\t\tel.innerHTML = html;\n\t\tparent.append(el);\n\n\t\t// Calculate position. Can't use CSS translate, because it shifts\n\t\t// the background.\n\t\tel.style.left = el.getBoundingClientRect().left\n\t\t\t- (util.outerWidth(el) + el.offsetWidth) * 0.6\n\t\t\t+ 'px';\n\t},\n\t// Forward post model to appropriate handler\n\thandleClick(e) {\n\t\te.stopPropagation();\n\t\tmain.request(e.target.getAttribute('data-type'), this.model);\n\t\tthis.remove();\n\t},\n\tremove() {\n\t\tthis.parent._popup_menu = null;\n\t\tthis.el.remove();\n\t\tthis.stopListening();\n\t}\n});\n\nmain.reply('menu:extend', action =>\n\t_.extend(MenuView.prototype.actions, action));\n\nmain.$threads.on('click', '.control', event => {\n\tconst {target} = event;\n\n\t// Menu already exists on the element. Remove it instead.\n\tif (target._popup_menu)\n\t\treturn target._popup_menu.remove();\n\n\tconst model = util.getModel(target);\n\tif (model)\n\t\tnew MenuView({parent: target, model});\n});\n"],"sourceRoot":"/source/"}