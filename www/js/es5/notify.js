"use strict";System.register([],function(e){var t,n,i,o,c,r,s,a,u,d,f,h,l,p,g;return{setters:[],execute:function(){t=require("./main"),n=t.$,i=t._,o=t.Backbone,c=t.config,r=t.connSM,s=t.etc,a=t.state,u=t.options,d=t.config.MEDIA_URL,f="",h=new XMLHttpRequest,h.open("GET",d+"css/ui/disconnected.ico"),h.responseType="blob",h.onload=function(){200===this.status&&(f=window.URL.createObjectURL(this.response))},h.send(),l=o.Model.extend({initialize:function(){var e=this;this.$favicon=n("#favicon"),this.check(this),this.listenTo(this,"change",this.check),t.reply("post:inserted",function(t){t.get("mine")||document.hidden&&e.set("unreadCount",e.get("unreadCount")+1)}),t.reply("notify:title",function(t){return e.set("title",t)}),document.addEventListener("visibilitychange",function(t){var n=t.target.hidden;e.set({hidden:n,unreadCount:0,reply:!n})},!1);var i=function(){return e.set("alert",!0)};r.on("dropped",i),r.on("desynced",i),r.on("synced",function(){return p.set("alert",!1)})},check:function(e){var t=e.attributes,n=t.hidden,i=t.unreadCount,o=t.reply,c=t.alert,r=d+"favicon.ico";if(c)return this.render(f,"--- ");if(!n)return this.render(r,"");var s="";i&&(s+="("+i+") ",r=d+"css/ui/unreadFavicon.ico"),o&&(s=">> "+s,r=d+"css/ui/replyFavicon.ico"),this.render(r,s)},render:function(e,t){document.title=t+this.get("title"),this.$favicon.attr("href",e)}}),p=new l({unreadCount:0,title:document.title}),g=new t.Memory("replies",3),t.reply("repliedToMe",function(e){var n=a.posts.get(e);if(n&&(n=n.attributes,!(e in g.readAll()))){if(u.get("notification")&&document.hidden&&!t.isMobile){var i=new Notification(t.lang.quoted,{icon:n.image&&"hide"!==u.get("thumbs")&&!t.oneeSama.workMode?t.oneeSama.thumbPath(n.image):d+"css/ui/favbig.png",body:n.body});i.onclick=function(){window.focus(),location.hash="#p"+e}}p.set({reply:!0}),g.write(e)}}),t.reply("time:syncwatch",function(){u.get("notification")&&document.hidden&&(new Notification(t.lang.syncwatchStarting).onclick=function(){return window.focus()})})}}});
//# sourceMappingURL=maps/notify.js.map
