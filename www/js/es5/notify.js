"use strict";System.register([],function(e,t){var n,i,o,c,r,s,a,u,d,f,h,l,p,g,y;return{setters:[],execute:function(){n=require("./main"),i=n.$,o=n._,c=n.Backbone,r=n.config,s=n.connSM,a=n.etc,u=n.state,d=n.options,f=n.config.MEDIA_URL,h="",l=new XMLHttpRequest,l.open("GET",f+"css/ui/disconnected.ico"),l.responseType="blob",l.onload=function(){200===this.status&&(h=window.URL.createObjectURL(this.response))},l.send(),p=c.Model.extend({initialize:function(){var e=this;this.$favicon=i("#favicon"),this.check(this),this.listenTo(this,"change",this.check),n.reply("post:inserted",function(t){t.get("mine")||document.hidden&&e.set("unreadCount",e.get("unreadCount")+1)}),n.reply("notify:title",function(t){return e.set("title",t)}),document.addEventListener("visibilitychange",function(t){var n=t.target.hidden;e.set({hidden:n,unreadCount:0,reply:!n})},!1);var t=function(){return e.set("alert",!0)};s.on("dropped",t),s.on("desynced",t),s.on("synced",function(){return g.set("alert",!1)})},check:function(e){var t=e.attributes,n=t.hidden,i=t.unreadCount,o=t.reply,c=t.alert,r=f+"favicon.ico";if(c)return this.render(h,"--- ");if(!n)return this.render(r,"");var s="";i&&(s+="("+i+") ",r=f+"css/ui/unreadFavicon.ico"),o&&(s=">> "+s,r=f+"css/ui/replyFavicon.ico"),this.render(r,s)},render:function(e,t){document.title=t+this.get("title"),this.$favicon.attr("href",e)}}),g=new p({unreadCount:0,title:document.title}),y=new n.Memory("replies",3),n.reply("repliedToMe",function(e){var t=u.posts.get(e);if(t&&(t=t.attributes,!(e in y.readAll()))){if(d.get("notification")&&document.hidden&&!n.isMobile){var i=new Notification(n.lang.quoted,{icon:t.image&&"hide"!==d.get("thumbs")&&!n.oneeSama.workMode?n.oneeSama.thumbPath(t.image):f+"css/ui/favbig.png",body:t.body});i.onclick=function(){window.focus(),location.hash="#p"+e}}g.set({reply:!0}),y.write(e)}}),n.reply("time:syncwatch",function(){d.get("notification")&&document.hidden&&(new Notification(n.lang.syncwatchStarting).onclick=function(){return window.focus()})})}}});
//# sourceMappingURL=maps/notify.js.map
