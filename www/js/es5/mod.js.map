{"version":3,"sources":["node_modules/browser-pack/_prelude.js","mod.js","client/mod/input.js","client/mod/panels.js","client/mod/title.js","client/mod/toolbox.js","client/mod/util.js","client/index.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length",1,"module","_toConsumableArray","arr","Array","isArray","arr2","from","_taggedTemplateLiteral","strings","raw","Object","freeze","defineProperties","value","_slicedToArray","sliceIterator","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","err","TypeError","_templateObject","_templateObject2","_templateObject3","_templateObject4","main","util","$","Backbone","common","lang","modals","parseHTML","InputBoxView","View","extend","className","events","submit","initialize","this","type","render","html","renderInput","send","$el","prependTo","$toolbox","find","first","focus","event","preventDefault","values","target","each","checked","handler","kill","remove","NotificationInputView","size","placeholder","mod","placeholders","msg","NOTIFICATION","notification","BanInputView","field","reason","_lang$mod$displayBan","displayBan","label","title","info","renderReasonPrompt","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","getSelected","num","BAN","concat","append","needReason","ban","./util",2,"table","rows","func","row","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","cell","_","dispatcher","etc","oneeSama","Memory","state","PanelView","_this","appendTo","$overlay","kind","el","innerHTML","renderContents","postRender","scrollTop","scrollHeight","ModLogView","MOD_LOG","act","postRef","op","formatLog","time","log","AdminPanelView","id","ADMIN_PANEL","click .unban","_this2","banCount","mnemonic","unban","UNBAN","getAttribute","parentElement","adminPanel","RequestPanelView","click .close","click #rescan","removed","scan","readAll","requests","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","posts","models","attributes","m","body","match","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","request","replace","trim","sortBy","safe","parseDOM","rescan","removeRequest","write","closest","djPanel",3,"override","parent","method","upgrade","orig","_len2","arguments","args","_key2","apply","auth","ident","$name","after","$authName","hook","classList","add","document","createTextNode","hotConfig","get","change","posting","ComposerView","prototype","_len","_key",4,"input","panels","childViews","ToolboxView","specs","accessLevels","level","checkAuth","forEach","right","controls","ln","$controls","$checkboxToggle","prop","$toggle","show","prepend","$mnemonicStyle","localStorage","noMnemonics","click #toolboxToggle","click .modButton","toggleButtons","hidden","model","text","toggle","set","buttonHandler","clearSelection","loopCheckboxes","toggleMnemonics","hide","spoilerImages","deleteImages","toggleChild","sendNotification","modLog","renderPanel","deletePosts","lockThreads","Model","./input","./panels",5,"getID","compact","els","$threads","getElementsByClassName","config","window","IDENT","loggedInUser","email","x_csrf","csrf","rel","href","MEDIA_URL","cssHash","staff","STAFF_BOARD","children","last","./title","./toolbox"],"mappings":"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","file":"mod.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err) {_d=true;_e=err;}finally {try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};})();var _templateObject=_taggedTemplateLiteral(['<form>\\n\\t\\t\\t\\t','\\n\\t\\t\\t\\t<input type=\"submit\" value=\"','\">\\n\\t\\t\\t</form>'],['<form>\\n\\t\\t\\t\\t','\\n\\t\\t\\t\\t<input type=\"submit\" value=\"','\">\\n\\t\\t\\t</form>']),_templateObject2=_taggedTemplateLiteral(['<input ','>'],['<input ','>']),_templateObject3=_taggedTemplateLiteral(['<label ','>\\n\\t\\t\\t\\t<input type=\"checkbox\">\\n\\t\\t\\t\\t','\\n\\t\\t\\t</label>'],['<label ','>\\n\\t\\t\\t\\t<input type=\"checkbox\">\\n\\t\\t\\t\\t','\\n\\t\\t\\t</label>']),_templateObject4=_taggedTemplateLiteral(['<b class=\"reasonPrompt admin\">\\n\\t\\t\\t\\t\\t','\\n\\t\\t\\t\\t</b>'],['<b class=\"reasonPrompt admin\">\\n\\t\\t\\t\\t\\t','\\n\\t\\t\\t\\t</b>']);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else {return Array.from(arr);}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var util=require('./util');var $=main.$;var Backbone=main.Backbone;var common=main.common;var lang=main.lang;var modals=main.modals;var parseHTML=common.parseHTML;var InputBoxView=Backbone.View.extend({className:'mod inputBox',events:{submit:'submit'},initialize:function initialize(){modals[this.type]=this;this.render();},render:function render(){var html=parseHTML(_templateObject,this.renderInput(),lang.send);this.$el.html(html).prependTo(main.$toolbox.$el).find('input').first().focus();},submit:function submit(event){event.preventDefault();var values=[];$(event.target).find('input[type!=submit]').each(function(){values.push(this.type==='checkbox'?this.checked:this.value);});this.handler(values);},kill:function kill(){delete modals[this.type];this.remove();}});var NotificationInputView=InputBoxView.extend({type:'notification',renderInput:function renderInput(){return parseHTML(_templateObject2,{type:'text',size:25,placeholder:lang.mod.placeholders.msg});},handler:function handler(msg){main.send([common.NOTIFICATION,msg[0]]);this.kill();}});exports.notification=NotificationInputView;var BanInputView=InputBoxView.extend({type:'ban',renderInput:function renderInput(){var html='';var _arr=['days','hours','minutes'];for(var _i=0;_i<_arr.length;_i++){var field=_arr[_i];html+=parseHTML(_templateObject2,{type:'number',placeholder:lang.mod.placeholders[field]});}html+=parseHTML(_templateObject2,{type:'text',size:25,placeholder:lang.mod.placeholders.reason});var _lang$mod$displayBan=_slicedToArray(lang.mod.displayBan,2);var label=_lang$mod$displayBan[0];var title=_lang$mod$displayBan[1];html+=parseHTML(_templateObject3,{title:title},label);return html;},handler:function handler(info){if(!info[3])return this.renderReasonPrompt();for(var i=0;i<3;i++){info[i]=+info[i];}info[4]=+info[4];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=util.getSelected()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var num=_step.value;main.send([common.BAN,num].concat(_toConsumableArray(info)));}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}this.kill();},renderReasonPrompt:function renderReasonPrompt(){this.$el.find('.reasonPrompt').remove();this.$el.append(parseHTML(_templateObject4,lang.mod.needReason)).find('input[type=text]').focus();}});exports.ban=BanInputView;\n\n},{\"./util\":5,\"main\":undefined}],2:[function(require,module,exports){\n'use strict';var main=require('main');var _=main._;var Backbone=main.Backbone;var common=main.common;var dispatcher=main.dispatcher;var etc=main.etc;var oneeSama=main.oneeSama;var lang=main.lang;var modals=main.modals;var Memory=main.Memory;var state=main.state;var PanelView=Backbone.View.extend({className:'modal mod panel glass',initialize:function initialize(){var _this=this;this.$el.appendTo(main.$overlay);modals[this.type]=this;dispatcher[this.kind]=function(msg){return _this.render(msg[0]);};main.send([this.kind]);},render:function render(info){if(!info.length){return this.el.innerHTML=\"God's in his Heaven. All's right\"+\" with the world.\";}this.el.innerHTML=this.renderContents(info);this.postRender&&this.postRender();this.el.scrollTop=this.el.scrollHeight;return this;},kill:function kill(){delete dispatcher[this.kind];delete modals[this.type];this.remove();}});var ModLogView=PanelView.extend({type:'log',kind:common.MOD_LOG,renderContents:function renderContents(info){return table(info,function(act){return [act.num?oneeSama.postRef(act.num,act.op):'',lang.mod.formatLog(act),oneeSama.time(act.time)];});}});exports.log=ModLogView;var AdminPanelView=PanelView.extend({type:'adminPanel',id:'adminPanel',kind:common.ADMIN_PANEL,events:{'click .unban':'unban'},renderContents:function renderContents(info){var _this2=this;this.banCount=0;return table(info,function(ban){_this2.banCount++;return [oneeSama.mnemonic(ban[0]),oneeSama.time(ban[1]),'<a class=\"unban\" data-id=\"'+ban[0]+'\">'+lang.mod.unban+'</a>'];});},unban:function unban(event){var el=event.target;main.send([common.UNBAN,el.getAttribute('data-id')]);el.parentElement.parentElement.remove();if(! --this.banCount)this.kill();}});exports.adminPanel=AdminPanelView;function table(rows,func){var html='<table>';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=rows[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var row=_step.value;html+='<tr>';var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=func(row)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var cell=_step2.value;html+='<td>'+cell+'</td>';}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}html+='</tr>';}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}html+='</table>';return html;}var RequestPanelView=PanelView.extend({type:'djPanel',events:{'click .close':'removeRequest','click #rescan':'scan'},initialize:function initialize(){main.$overlay[0].append(this.el);modals[this.type]=this;this.removed=new Memory('request',2);this.scan();},scan:function scan(){var removed=this.removed.readAll(),requests=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=state.posts.models[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var attributes=_step3.value.attributes;if(attributes.num in removed)continue;var m=attributes.body.match(/\\/r\\/[^\\n]+$/gm);if(!m)continue;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=m[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var request=_step4.value;request=request.replace('/r/','').trim();requests.push([attributes.num,attributes.mnemonic,request]);}}catch(err) {_didIteratorError4=true;_iteratorError4=err;}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally {if(_didIteratorError4){throw _iteratorError4;}}}}}catch(err) {_didIteratorError3=true;_iteratorError3=err;}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}return this.render(_.sortBy(requests,1));},renderContents:function renderContents(requests){return table(requests,function(request){return [oneeSama.postRef(request[0],oneeSama.op).safe,oneeSama.mnemonic(request[1]),request[2],'<a class=\"close\" data-id=\"'+request[0]+'\">X</a>'];});},postRender:function postRender(){this.el.append(etc.parseDOM('<a id=\"rescan\">'+lang.rescan+'</a>')[0]);},removeRequest:function removeRequest(event){event.preventDefault();var el=event.target;this.removed.write(el.getAttribute('data-id'));el.closest('tr').remove();}});exports.djPanel=RequestPanelView;\n\n},{\"main\":undefined}],3:[function(require,module,exports){\n'use strict';var _templateObject=_taggedTemplateLiteral(['<label title=\"','\" class=\"mod\">\\n\\t\\t<input type=\"checkbox\" id=\"authName\">\\n\\t\\t ','\\n\\t </label>'],['<label title=\"','\" class=\"mod\">\\n\\t\\t<input type=\"checkbox\" id=\"authName\">\\n\\t\\t ','\\n\\t </label>']);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var etc=main.etc;var lang=main.lang;var state=main.state;var auth=main.ident.auth;main.$name.after(main.common.parseHTML(_templateObject,lang.mod.title[1],lang.mod.title[0]));var $authName=main.$('#authName');main.oneeSama.hook('fillMyName',function(el){var checked=$authName[0].checked;if(checked){el.classList.add(auth==='admin'?'admin':'moderator');el.append(document.createTextNode(' ## '+state.hotConfig.get('staff_aliases')[auth]));}});$authName.change(function(){return main.request('postForm:indentity');});override(main.posts.posting.ComposerView.prototype,'allocationMessage',function(orig){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}var msg=orig.call.apply(orig,[this].concat(args));if($authName[0].checked)msg.auth=auth;return msg;});function override(parent,method,upgrade){var orig=parent[method];parent[method]=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return upgrade.call.apply(upgrade,[this,orig].concat(args));};}\n\n},{\"main\":undefined}],4:[function(require,module,exports){\n'use strict';var _templateObject=_taggedTemplateLiteral(['<a class=\"modButton\" data-kind=\"','\" title=\"','\">\\n\\t\\t\\t\\t\\t','\\n\\t\\t\\t\\t</a>'],['<a class=\"modButton\" data-kind=\"','\" title=\"','\">\\n\\t\\t\\t\\t\\t','\\n\\t\\t\\t\\t</a>']),_templateObject2=_taggedTemplateLiteral(['<style>\\n\\t\\t\\t\\t.postCheckbox {\\n\\t\\t\\t\\t\\tdisplay: inline-block;\\n\\t\\t\\t\\t}\\n\\t\\t\\t</style>'],['<style>\\n\\t\\t\\t\\t.postCheckbox {\\n\\t\\t\\t\\t\\tdisplay: inline-block;\\n\\t\\t\\t\\t}\\n\\t\\t\\t</style>']),_templateObject3=_taggedTemplateLiteral(['<style>\\n\\t\\t\\t\\theader > .mod.addr {\\n\\t\\t\\t\\t\\tdisplay: none;\\n\\t\\t\\t\\t}\\n\\t\\t\\t</style>'],['<style>\\n\\t\\t\\t\\theader > .mod.addr {\\n\\t\\t\\t\\t\\tdisplay: none;\\n\\t\\t\\t\\t}\\n\\t\\t\\t</style>']);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else {return Array.from(arr);}}function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}));}var main=require('main');var input=require('./input');var panels=require('./panels');var util=require('./util');var $=main.$;var _=main._;var Backbone=main.Backbone;var common=main.common;var lang=main.lang;var modals=main.modals;var parseHTML=common.parseHTML;var childViews={ban:input.ban,log:require('./panels').log,adminPanel:panels.adminPanel,notification:input.notification,djPanel:panels.djPanel};var ToolboxView=Backbone.View.extend({id:'toolbox',className:'mod modal panel glass',initialize:function initialize(){this.render();},render:function render(){var specs=this.specs=['clearSelection','spoilerImages','deleteImages','deletePosts','modLog'];if(main.ident.auth==='dj')specs=this.specs=['djPanel'];var accessLevels=[['dj',['toggleMnemonics']],['moderator',['lockThreads','ban']],['admin',['sendNotification','renderPanel']]];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=accessLevels[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var level=_step.value;if(!common.checkAuth(level[0],main.ident))break;level[1].forEach(function(right){return specs.push(right);});}}catch(err) {_didIteratorError=true;_iteratorError=err;}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}var controls='<span>';for(var i=0;i<specs.length;i++){var ln=lang.mod[specs[i]];controls+=parseHTML(_templateObject,i,ln[1],ln[0]);}controls+='</span>';this.$controls=$(controls);this.$checkboxToggle=$(parseHTML(_templateObject2)).appendTo('head').prop('disabled',true);this.$toggle=$('<a id=\"toolboxToggle\">'+lang.show+'</a>');this.$el.prepend(this.$controls,this.$toggle).appendTo(main.$overlay);this.$mnemonicStyle=$(parseHTML(_templateObject3)).appendTo('head').prop('disabled',localStorage.noMnemonics!=='true');return this;},events:{'click #toolboxToggle':'toggleButtons','click .modButton':'buttonHandler'},toggleButtons:function toggleButtons(){var hidden=!this.model.get('shown');this.$toggle.text(lang[hidden?'hide':'show']);this.$controls.toggle(0);this.$checkboxToggle.prop('disabled',!hidden);this.model.set('shown',hidden);},buttonHandler:function buttonHandler(event){this[this.specs[event.target.getAttribute('data-kind')]](event);},clearSelection:function clearSelection(){util.loopCheckboxes(function(el){return el.checked=false;});},toggleMnemonics:function toggleMnemonics(){var hide=localStorage.noMnemonics==='true';this.$mnemonicStyle.prop('disabled',hide);localStorage.noMnemonics=!hide;},send:function send(type){main.send([common[type]].concat(_toConsumableArray(util.getSelected())));},spoilerImages:function spoilerImages(){this.send('SPOILER_IMAGES');},deleteImages:function deleteImages(){this.send('DELETE_IMAGES');},toggleChild:function toggleChild(type){if(modals[type])modals[type].kill();else new childViews[type]();},sendNotification:function sendNotification(){this.toggleChild('notification');},modLog:function modLog(){this.toggleChild('log');},djPanel:function djPanel(){this.toggleChild('djPanel');},ban:function ban(){this.toggleChild('ban');},renderPanel:function renderPanel(){this.toggleChild('adminPanel');},deletePosts:function deletePosts(){this.send('DELETE_POSTS');},lockThreads:function lockThreads(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=util.getSelected()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var num=_step2.value;var model=main.state.posts.get(num);if(!model||model.get('op'))continue;main.send([common[!model.get('locked')?'LOCK_THREAD':'UNLOCK_THREAD'],num]);}}catch(err) {_didIteratorError2=true;_iteratorError2=err;}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}});main.$toolbox=new ToolboxView({model:new Backbone.Model()});\n\n},{\"./input\":1,\"./panels\":2,\"./util\":5,\"main\":undefined}],5:[function(require,module,exports){\n'use strict';var main=require('main');function getSelected(){var checked=[];loopCheckboxes(function(el){return el.checked&&checked.push(main.etc.getID(el));});return main._.compact(checked);}exports.getSelected=getSelected;function loopCheckboxes(func){var els=main.$threads[0].getElementsByClassName('postCheckbox');for(var i=0;i<els.length;i++){func(els[i]);}}exports.loopCheckboxes=loopCheckboxes;\n\n},{\"main\":undefined}],\"mod\":[function(require,module,exports){\n'use strict';var main=require('main');var $=main.$;var config=main.config;var ident=main.ident=window.IDENT;window.loggedInUser=ident.email;window.x_csrf=ident.csrf;main.$overlay=$('<div id=\"modOverlay\"></div>').appendTo('body');main.modals={};require('./title');require('./toolbox');$('<link/>',{rel:'stylesheet',href:config.MEDIA_URL+'css/mod.css?v='+main.cssHash}).appendTo('head');var staff=config.STAFF_BOARD;$('#navTop').children('a').last().after(' / <a href=\"../'+staff+'/\" class=\"history\">'+staff+'</a>');\n\n},{\"./title\":3,\"./toolbox\":4,\"main\":undefined}]},{},[])\n\n","/*\nVarious input boxes\n */\n\nconst main = require('main'),\n\tutil = require('./util'),\n\t{$, Backbone, common, lang, modals} = main,\n\t{parseHTML} = common;\n\nconst InputBoxView = Backbone.View.extend({\n\tclassName: 'mod inputBox',\n\tevents: {\n\t\tsubmit: 'submit'\n\t},\n\tinitialize() {\n\t\tmodals[this.type] = this;\n\t\tthis.render();\n\t},\n\trender() {\n\t\tconst html = parseHTML\n\t\t\t`<form>\n\t\t\t\t${this.renderInput()}\n\t\t\t\t<input type=\"submit\" value=\"${lang.send}\">\n\t\t\t</form>`;\n\t\tthis.$el\n\t\t\t.html(html)\n\t\t\t.prependTo(main.$toolbox.$el)\n\t\t\t.find('input').first().focus();\n\t},\n\tsubmit(event) {\n\t\tevent.preventDefault();\n\t\tconst values = [];\n\t\t$(event.target).find('input[type!=submit]').each(function () {\n\t\t\tvalues.push(this.type === 'checkbox' ? this.checked : this.value);\n\t\t});\n\t\tthis.handler(values);\n\t},\n\tkill() {\n\t\tdelete modals[this.type];\n\t\tthis.remove();\n\t}\n});\n\nconst NotificationInputView = InputBoxView.extend({\n\ttype: 'notification',\n\trenderInput() {\n\t\treturn parseHTML `<input ${{\n\t\t\ttype: 'text',\n\t\t\tsize: 25,\n\t\t\tplaceholder: lang.mod.placeholders.msg\n\t\t}}>`;\n\t},\n\thandler(msg) {\n\t\tmain.send([common.NOTIFICATION, msg[0]]);\n\t\tthis.kill();\n\t}\n});\nexports.notification = NotificationInputView;\n\nconst BanInputView = InputBoxView.extend({\n\ttype: 'ban',\n\trenderInput() {\n\t\tlet html = '';\n\t\tfor (let field of ['days', 'hours', 'minutes']) {\n\t\t\thtml += parseHTML `<input ${{\n\t\t\t\ttype: 'number',\n\t\t\t\tplaceholder: lang.mod.placeholders[field]\n\t\t\t}}>`\n\t\t}\n\t\thtml += parseHTML `<input ${{\n\t\t\ttype: 'text',\n\t\t\tsize: 25,\n\t\t\tplaceholder: lang.mod.placeholders.reason\n\t\t}}>`;\n\t\tconst [label, title] = lang.mod.displayBan;\n\t\thtml += parseHTML\n\t\t\t`<label ${{title}}>\n\t\t\t\t<input type=\"checkbox\">\n\t\t\t\t${label}\n\t\t\t</label>`;\n\t\treturn html;\n\t},\n\thandler(info) {\n\t\t// Ensure reason field is filled\n\t\tif (!info[3])\n\t\t\treturn this.renderReasonPrompt();\n\t\t\n\t\t// Coerce time units and checkbox value to integers\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\tinfo[i] = +info[i];\n\t\t}\n\t\tinfo[4] = +info[4];\n\t\tfor (let num of util.getSelected()) {\n\t\t\tmain.send([common.BAN, num, ...info]);\n\t\t}\n\t\tthis.kill();\n\t},\n\trenderReasonPrompt() {\n\t\tthis.$el.find('.reasonPrompt').remove();\n\t\tthis.$el\n\t\t\t.append(parseHTML\n\t\t\t\t`<b class=\"reasonPrompt admin\">\n\t\t\t\t\t${lang.mod.needReason}\n\t\t\t\t</b>`)\n\t\t\t.find('input[type=text]').focus();\n\t}\n});\nexports.ban = BanInputView;\n","/*\nModeration log modal view\n */\n\nconst main = require('main'),\n\t{_, Backbone, common, dispatcher, etc, oneeSama, lang, modals, Memory,\n\t\tstate} = main\n\nconst PanelView = Backbone.View.extend({\n\tclassName: 'modal mod panel glass',\n\tinitialize() {\n\t\tthis.$el.appendTo(main.$overlay);\n\t\tmodals[this.type] = this;\n\n\t\t// Register websocket handler\n\t\tdispatcher[this.kind] = msg => this.render(msg[0]);\n\t\t// Send request\n\t\tmain.send([this.kind]);\n\t},\n\trender(info) {\n\t\tif (!info.length) {\n\t\t\treturn this.el.innerHTML = \"God's in his Heaven. All's right\"\n\t\t\t\t+ \" with the world.\";\n\t\t}\n\t\tthis.el.innerHTML = this.renderContents(info);\n\t\tthis.postRender && this.postRender()\n\n\t\t// Scroll to the end of the log\n\t\tthis.el.scrollTop = this.el.scrollHeight;\n\t\treturn this;\n\t},\n\tkill() {\n\t\tdelete dispatcher[this.kind];\n\t\tdelete modals[this.type];\n\t\tthis.remove();\n\t}\n});\n\nconst ModLogView = PanelView.extend({\n\ttype: 'log',\n\tkind: common.MOD_LOG,\n\trenderContents(info) {\n\t\treturn table(info, act => [\n\t\t\t// Unbans do not have a target post\n\t\t\tact.num ? oneeSama.postRef(act.num, act.op) : '',\n\t\t\tlang.mod.formatLog(act),\n\t\t\toneeSama.time(act.time)\n\t\t]);\n\t}\n});\nexports.log = ModLogView;\n\nconst AdminPanelView = PanelView.extend({\n\ttype: 'adminPanel',\n\tid: 'adminPanel',\n\tkind: common.ADMIN_PANEL,\n\tevents: {\n\t\t'click .unban': 'unban'\n\t},\n\trenderContents(info) {\n\t\tthis.banCount = 0;\n\t\treturn table(info, ban => {\n\t\t\tthis.banCount++;\n\t\t\treturn [\n\t\t\t\toneeSama.mnemonic(ban[0]),\n\t\t\t\toneeSama.time(ban[1]),\n\t\t\t\t`<a class=\"unban\" data-id=\"${ban[0]}\">${lang.mod.unban}</a>`\n\t\t\t];\n\t\t});\n\t},\n\tunban(event) {\n\t\tconst el = event.target;\n\t\tmain.send([common.UNBAN, el.getAttribute('data-id')]);\n\t\tel.parentElement.parentElement.remove();\n\n\t\t// Check if any bans left\n\t\tif (!--this.banCount)\n\t\t\tthis.kill();\n\t}\n});\nexports.adminPanel = AdminPanelView;\n\n/**\n * Construct a table from an array of items and a consumer funtion that returns\n * an array of column contents.\n */\nfunction table(rows, func) {\n\tlet html = '<table>';\n\tfor (let row of rows) {\n\t\thtml += '<tr>';\n\t\tfor (let cell of func(row)) {\n\t\t\thtml += `<td>${cell}</td>`;\n\t\t}\n\t\thtml += '</tr>';\n\t}\n\thtml += '</table>';\n\treturn html;\n}\n\nconst RequestPanelView = PanelView.extend({\n\ttype: 'djPanel',\n\tevents: {\n\t\t'click .close': 'removeRequest',\n\t\t'click #rescan': 'scan'\n\t},\n\n\t/**\n\t * Override parent method, because we don't query the server\n\t */\n\tinitialize() {\n\t\tmain.$overlay[0].append(this.el)\n\t\tmodals[this.type] = this;\n\t\tthis.removed = new Memory('request', 2)\n\t    this.scan()\n\t},\n\n\t/**\n\t * Scan thread for `/r/ song` strings, we have not removed yet\n\t */\n\tscan() {\n\t    const removed = this.removed.readAll(),\n\t\t\trequests = []\n\t\tfor (let {attributes} of state.posts.models) {\n\t\t\t// Post's request(s) already processed\n\t\t\tif (attributes.num in removed)\n\t\t\t\tcontinue\n\t\t    const m = attributes.body.match(/\\/r\\/[^\\n]+$/gm)\n\t\t\tif (!m)\n\t\t\t    continue\n\t\t\tfor (let request of m) {\n\t\t\t    request = request.replace('/r/', '').trim()\n\t\t\t\trequests.push([attributes.num, attributes.mnemonic, request])\n\t\t\t}\n\t\t}\n\t\treturn this.render(_.sortBy(requests, 1))\n\t},\n\n\t/**\n\t * Render the inner table\n\t */\n\trenderContents(requests) {\n\t\treturn table(requests, request => [\n\t\t\toneeSama.postRef(request[0], oneeSama.op).safe,\n\t\t\toneeSama.mnemonic(request[1]),\n\t\t\trequest[2],\n\t\t\t`<a class=\"close\" data-id=\"${request[0]}\">X</a>`\n\t\t])\n\t},\n\n\t/**\n\t * Extra rendering operations to perform that deviate from parent class\n\t */\n\tpostRender() {\n\t    this.el.append(etc.parseDOM(`<a id=\"rescan\">${lang.rescan}</a>`)[0])\n\t},\n\n\t/**\n\t * Remove a request from the list and persist removal to localStorage\n\t */\n\tremoveRequest(event) {\n\t\tevent.preventDefault()\n\t\tconst el = event.target\n\t\tthis.removed.write(el.getAttribute('data-id'))\n\t\tel.closest('tr').remove()\n\t}\n})\nexports.djPanel = RequestPanelView\n","/*\nToggle and preview staff titles on new posts\n */\n\nconst main = require('main'),\n\t{etc, lang, state} = main,\n\t{auth} = main.ident;\n\n// Insert toggler checkbox into name form\nmain.$name.after(main.common.parseHTML\n\t`<label title=\"${lang.mod.title[1]}\" class=\"mod\">\n\t\t<input type=\"checkbox\" id=\"authName\">\n\t\t ${lang.mod.title[0]}\n\t </label>`);\n\nconst $authName = main.$('#authName');\n\n// Preview the title in postForm\nmain.oneeSama.hook('fillMyName', el => {\n\tconst checked = $authName[0].checked;\n\tif (checked) {\n\t\tel.classList.add(auth === 'admin' ? 'admin' : 'moderator');\n\t\tel.append(document.createTextNode(' ## '\n\t\t\t+ state.hotConfig.get('staff_aliases')[auth]));\n\t}\n});\n$authName.change(() => main.request('postForm:indentity'));\n\n// Extend default allocation request\noverride(main.posts.posting.ComposerView.prototype, 'allocationMessage',\n\tfunction (orig, ...args) {\n\t\tconst msg = orig.call(this, ...args);\n\t\tif ($authName[0].checked)\n\t\t\tmsg.auth = auth;\n\t\treturn msg;\n\t});\n\n// Override a method on an object with a new method\nfunction override(parent, method, upgrade) {\n\tconst orig = parent[method];\n\tparent[method] = function (...args) {\n\t\treturn upgrade.call(this, orig, ...args);\n\t}\n}\n","/*\nView containing controls of moderation actions\n */\n\nconst main = require('main'),\n\tinput = require('./input'),\n\tpanels = require('./panels'),\n\tutil = require('./util'),\n\t{$, _, Backbone, common, lang, modals} = main,\n\t{parseHTML} = common;\n\nconst childViews = {\n\tban: input.ban,\n\tlog: require('./panels').log,\n\tadminPanel: panels.adminPanel,\n\tnotification: input.notification,\n\tdjPanel: panels.djPanel\n};\n\nconst ToolboxView = Backbone.View.extend({\n\tid: 'toolbox',\n\tclassName: 'mod modal panel glass',\n\tinitialize() {\n\t\tthis.render();\n\t},\n\trender() {\n\t\tlet specs = this.specs = [\n\t\t\t'clearSelection',\n\t\t\t'spoilerImages',\n\t\t\t'deleteImages',\n\t\t\t'deletePosts',\n\t\t\t'modLog'\n\t\t];\n\n\t\t// Add aditional panel buttons by priveledge level\n\t\tif (main.ident.auth === 'dj')\n\t\t\tspecs = this.specs = ['djPanel']\n\t\tconst accessLevels = [\n\t\t\t['dj', ['toggleMnemonics']],\n\t\t\t['moderator', ['lockThreads', 'ban']],\n\t\t\t['admin', ['sendNotification', 'renderPanel']]\n\t\t]\n\t\tfor (let level of accessLevels) {\n\t\t\tif (!common.checkAuth(level[0], main.ident))\n\t\t\t\tbreak\n\t\t\tlevel[1].forEach(right => specs.push(right))\n\t\t}\n\n\t\tlet controls = '<span>';\n\t\tfor (let i = 0; i < specs.length; i++) {\n\t\t\tconst ln = lang.mod[specs[i]];\n\t\t\tcontrols += parseHTML\n\t\t\t\t`<a class=\"modButton\" data-kind=\"${i}\" title=\"${ln[1]}\">\n\t\t\t\t\t${ln[0]}\n\t\t\t\t</a>`;\n\t\t}\n\t\tcontrols += '</span>';\n\t\tthis.$controls = $(controls);\n\n\t\tthis.$checkboxToggle = $(parseHTML\n\t\t\t\t`<style>\n\t\t\t\t.postCheckbox {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t</style>`\n\t\t)\n\t\t\t.appendTo('head')\n\t\t\t// Disabled only works if the emelemnt is in the DOM\n\t\t\t.prop('disabled', true);\n\n\t\tthis.$toggle = $(`<a id=\"toolboxToggle\">${lang.show}</a>`);\n\t\tthis.$el.prepend(this.$controls, this.$toggle)\n\t\t\t.appendTo(main.$overlay);\n\n\t\t// Sets mnemonic visbility\n\t\tthis.$mnemonicStyle = $(parseHTML\n\t\t\t\t`<style>\n\t\t\t\theader > .mod.addr {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t</style>`\n\t\t)\n\t\t\t.appendTo('head')\n\t\t\t.prop('disabled', localStorage.noMnemonics !== 'true');\n\t\treturn this;\n\t},\n\tevents: {\n\t\t'click #toolboxToggle': 'toggleButtons',\n\t\t'click .modButton': 'buttonHandler'\n\t},\n\ttoggleButtons() {\n\t\tconst hidden = !this.model.get('shown');\n\t\tthis.$toggle.text(lang[hidden ? 'hide' : 'show']);\n\t\tthis.$controls.toggle(0);\n\t\tthis.$checkboxToggle.prop('disabled', !hidden);\n\t\tthis.model.set('shown', hidden);\n\t},\n\tbuttonHandler(event) {\n\t\tthis[this.specs[event.target.getAttribute('data-kind')]](event);\n\t},\n\tclearSelection() {\n\t\tutil.loopCheckboxes(el => el.checked = false);\n\t},\n\ttoggleMnemonics() {\n\t\tconst hide = localStorage.noMnemonics === 'true';\n\t\tthis.$mnemonicStyle.prop('disabled', hide);\n\t\tlocalStorage.noMnemonics = !hide;\n\t},\n\tsend(type) {\n\t\tmain.send([common[type], ...util.getSelected()]);\n\t},\n\tspoilerImages() {\n\t\tthis.send('SPOILER_IMAGES');\n\t},\n\tdeleteImages() {\n\t\tthis.send('DELETE_IMAGES');\n\t},\n\ttoggleChild(type) {\n\t\tif(modals[type])\n\t\t\tmodals[type].kill();\n\t\telse\n\t\t\tnew childViews[type];\n\t},\n\t// Push a notification message to all clients\n\tsendNotification() {\n\t\tthis.toggleChild('notification');\n\t},\n\tmodLog() {\n\t\tthis.toggleChild('log');\n\t},\n\tdjPanel() {\n\t    this.toggleChild('djPanel')\n\t},\n\tban() {\n\t\tthis.toggleChild('ban');\n\t},\n\trenderPanel() {\n\t\tthis.toggleChild('adminPanel');\n\t},\n\tdeletePosts() {\n\t\tthis.send('DELETE_POSTS');\n\t},\n\tlockThreads() {\n\t\tfor (let num of util.getSelected()) {\n\t\t\tconst model = main.state.posts.get(num);\n\t\t\t// Model exists and is an OP\n\t\t\tif (!model || model.get('op'))\n\t\t\t\tcontinue;\n\t\t\tmain.send([\n\t\t\t\tcommon[!model.get('locked') ? 'LOCK_THREAD' : 'UNLOCK_THREAD'],\n\t\t\t\tnum\n\t\t\t]);\n\t\t}\n\t}\n});\n\nmain.$toolbox = new ToolboxView({\n\tmodel: new Backbone.Model()\n});\n","/*\nCommon utility functions\n */\n\nconst main = require('main');\n\n// Gather salected post checkboxes\nfunction getSelected() {\n\tconst checked = [];\n\tloopCheckboxes(el => el.checked && checked.push(main.etc.getID(el)));\n\n\t// Postforms will not have an ID, so we remove falsy values\n\treturn main._.compact(checked);\n}\nexports.getSelected = getSelected;\n\nfunction loopCheckboxes(func) {\n\tconst els = main.$threads[0].getElementsByClassName('postCheckbox');\n\tfor (let i = 0; i < els.length; i++) {\n\t\tfunc(els[i]);\n\t}\n}\nexports.loopCheckboxes = loopCheckboxes;\n","/*\nClient-side administration logic\n */\n\nconst main = require('main'),\n\t{$, config} = main;\n\n//XXX: This module in general is not very DRY. Need to refactor later.\n\n// Only used to affect some client rendering practises. Anything actually\n// needing security has stricter authorisation checks.\nconst ident = main.ident = window.IDENT;\n\n// Pass login status to ./www/js/login.js\nwindow.loggedInUser = ident.email;\nwindow.x_csrf = ident.csrf;\n\n// Container for all moderation modals\nmain.$overlay = $('<div id=\"modOverlay\"></div>').appendTo('body');\n\n// Open modal map\nmain.modals = {};\n\nrequire('./title');\nrequire('./toolbox');\n\n$('<link/>', {\n\trel: 'stylesheet',\n\thref: `${config.MEDIA_URL}css/mod.css?v=${main.cssHash}`\n}).appendTo('head');\n\n// Add staff board to board navigation\nconst staff = config.STAFF_BOARD;\n$('#navTop')\n\t.children('a')\n\t.last()\n\t.after(` / <a href=\"../${staff}/\" class=\"history\">${staff}</a>`);\n"],"sourceRoot":"/source/"}